<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>GFI App</title>
  <style>
    body{
      background: #a5ebff;
    }
    .chartstyle{
      /*height:500px;*/
      background: #a5ebff;
      margin:10px;
      padding:0px;
      border:1px solid black;
    }
  </style>
  <link rel="stylesheet" type="text/css" href="../d3/c3.css">
  <!-- Proj4 -->
  <script type="text/javascript" src="../proj4js/lib/proj4js.js"></script>

  <!-- JQuery -->
  <link rel="stylesheet" href="../jquery/jquery-ui.css" />
  <script src="../d3/d3.v3.min.js" charset="utf-8"></script>
  
  <script src="../jquery/jquery-1.12.4.min.js"></script>
  <script src="../jquery/jquery-ui.min.js"></script>
  <script src="../jquery/jquery.mousewheel.js"></script>
  <script src="../jquery/jquery-ui-timepicker-addon.js"></script>
  


  
  <script src="../d3/c3.min.js"></script>
  
  <script type="text/javascript" src="../webmapjs/WMJSTools.js"></script>
  <script type="text/javascript" src="gfiapp_d3c3.js"></script>

  <script type="text/javascript">

  
    $(window).on("message", function(e) {
     $("#chart").html("<img src=\"../webmapjs/img/ajax-loader.gif\" alt=\"Loading...\"/>");
      var data = e.originalEvent.data;  // Should work.
      if(!isDefined(data.layers)){
        $("#info").html("No valid data received:<br/>"+data);
        return;
      }
      var html = "";
     
      html+="timeseries graph for location ["+Math.round(data.lon*100)/100+","+Math.round(data.lat*100)/100+"]<br/>";
      //html+="shift key: "+data.shiftKeyPressed+"<br/>";
       $("#chart").empty();
      for(var j=0;j<data.layers.length;j++){
        //console.log(data.layers[j].gfiUrl);
        var urlObject = composeUrlObjectFromURL(data.layers[j].gfiUrl);
        //console.log("urlObject.location:"+urlObject.location);
        //console.log("data.layers[j].gfiUrl:"+data.layers[j].gfiUrl);
        var GFIURL = urlObject.location+"?";
        
        for(key in urlObject.kvp){
          var value = urlObject.kvp[key];
          //console.log("A"+key+"="+value);
          if(key == 'info_format')value = 'application/json';
          if(key == 'time')value = '1000-01-01T00:00:00Z/3000-01-01T00:00:00Z';
          //console.log("B"+key+"="+value);
          GFIURL+=(key + "="+URLEncode(value))+"&";
        }
       // console.log("GFIURL:"+GFIURL);
        //GFIURL+="figwidth="+($( window ).width()-20)+"&";
        //GFIURL+="figheight=200";
        //html+='<img src="'+GFIURL+'"/><br/>';
        $("#chart").append("<div class='chartstyle' id='chart"+j+"'></div>")
        $("#chart"+j).html("<img src=\"../webmapjs/img/ajax-loader.gif\" alt=\"Loading...\"/>");
        loadDataForURL(GFIURL,'chart'+j);
      }
      $("#info").html(html);
    });
    
    $(document).ready(function(){
     $("#info").html("Click on the map to create a timeseries graph.");
    });
     

  
  </script>

</head>
<body>

<div id='info'></div>
<div id="chart"></div>
</body>
</html>
