var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,c,e){a instanceof String&&(a=String(a));for(var f=a.length,b=0;b<f;b++){var d=a[b];if(c.call(e,d,b,a))return{i:b,v:d}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,e){a!=Array.prototype&&a!=Object.prototype&&(a[c]=e.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,c,e,f){if(c){e=$jscomp.global;a=a.split(".");for(f=0;f<a.length-1;f++){var b=a[f];b in e||(e[b]={});e=e[b]}a=a[a.length-1];f=e[a];c=c(f);c!=f&&null!=c&&$jscomp.defineProperty(e,a,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,e){return $jscomp.findInternal(this,a,e).v}},"es6-impl","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var c=0;return $jscomp.iteratorPrototype(function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,c){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var e=0,f={next:function(){if(e<a.length){var b=e++;return{value:c(b,a[b]),done:!1}}f.next=function(){return{done:!0,value:void 0}};return f.next()}};f[Symbol.iterator]=function(){return f};return f};
$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,e){return e})}},"es6","es3");$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,e,f){var b=this.length||0;0>e&&(e=Math.max(0,b+e));if(null==f||f>b)f=b;f=Number(f);0>f&&(f=Math.max(0,b+f));for(e=Number(e||0);e<f;e++)this[e]=a;return this}},"es6-impl","es3");
function Console(a){function c(a){a=(a+"").replace(/&/g,"&amp;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");a=a.replace(/\"/g,"&quot;");return a=a.replace(/\n/g,"<br>")}var e=a,f="";this.println=function(a,d){f=0==d?f+("<p class='stdoutmessage'>"+a+"</p>"):f+("<p class='stdoutmessage'>"+c(a)+"</p>");isDefined(e)&&(e.innerHTML=f,e.scrollTop=e.scrollHeight);17824<f.length&&(f=f.substring(f.length-13368))};this.errprintln=function(a,d){f=0==d?f+("<p class='stderrmessage'>"+a+"</p>"):f+("<p class='stderrmessage'>"+
c(a)+"</p>");isDefined(e)&&(e.innerHTML=f,e.scrollTop=e.scrollHeight)};this.cls=function(){f="";isDefined(e)&&(e.innerHTML=f)};this.setSize=function(a,d){isDefined(e)&&(e.scrollTop=e.scrollHeight,e.style.width=a+"px",e.style.height=d+"px",e.width=a+"px",e.height=d+"px")};this.setElement=function(a){e=a;isDefined(e)&&(e.style.overflow="scroll",e.style.display="block",e.style.position="absolute",e.style.width="100%",e.style.height="100%",e.style.font="normal 12px courier",e.noWrap=!0,e.style.whiteSpace=
"nowrap",e.innerHTML=f,e.scrollTop=e.scrollHeight)};this.setElement(a)}function isDefined(a){return"undefined"===typeof a?!1:!0}function isNull(a){return null===a?!0:!1}function toArray(a){if(!a)return[];if(a.length)return a;var c=[];c[0]=a;return c}var WMJSSet=function(){};WMJSSet.prototype.add=function(a){this[a]=!0};WMJSSet.prototype.remove=function(a){delete this[a]};
function WMJSKVP(a){var c=[];this._parse=function(a){var c=[];if(a=a.split("&"))for(var b in a){var d=a[b].split("=");if(2==d.length){var e=d[0],d=d[1];c[e]instanceof Array||(c[e]=[]);c[e].push(d)}}return c};this.getKeys=function(){var a=new WMJSSet;for(key in c)a.add(key);return a};this.getValues=function(a){return c[a]};this.getKeyValues=function(){return c};return c=this._parse(a)}
var preventdefault_event=function(a){a=a||window.event;a.preventDefault?a.preventDefault():a.returnValue=!1},attach_event=function(a,c,e){if("mousewheel"==c){var f=function(a,d){var b=0;a||(a=window.event,window.event.cancelBubble=!0,window.event.returnValue=!1);a.wheelDelta?b=a.wheelDelta/120:a.detail&&(b=-a.detail/3);b&&d(b);a.preventDefault&&a.preventDefault();a.returnValue=!1};a.addEventListener&&a.addEventListener("DOMMouseScroll",function(a){f(a,e)},!1);a.onmousewheel=document.onmousewheel=
function(a){f(a,e)}}else browser.isNS?a.addEventListener(c,e,!0):(a.attachEvent("on"+c,e),void 0!=window.event&&(window.event.cancelBubble=!0,window.event.returnValue=!1))},del_event=function(a,c,e){var f=!0;browser.isOP&&(f=!1);a.removeEventListener?a.removeEventListener(c,e,f):a.detachEvent&&(a.detachEvent(c,e),a.detachEvent("on"+c,e))},getClick_X=function(a){return browser.isNS?a.clientX+window.scrollX:window.event.clientX+document.documentElement.scrollLeft+document.body.scrollLeft},getClick_Y=
function(a){return browser.isNS?a.clientY+window.scrollY:window.event.clientY+document.documentElement.scrollTop+document.body.scrollTop},findElementPos=function(a){for(var c=a,e=curtop=0;a;)e+=a.offsetLeft,curtop+=a.offsetTop,a=a.offsetParent;return[e,curtop,parseInt(c.style.width+e),parseInt(c.style.height+curtop)]};
function Browser(){this.isKonqueror=this.isOP=this.isNS=this.isIE=!1;this.name=navigator.appName;this.version=null;-1!=navigator.userAgent.indexOf("Opera")?this.isOP=!0:"Netscape"==navigator.appName||"Konqueror"==navigator.appName?this.isKonqueror=this.isNS=!0:-1!=navigator.appName.indexOf("Microsoft")&&(this.isIE=!0)}var browser=new Browser;function IsNumeric(a){var c=!0;for(i=0;i<a.length&&1==c;i++){var e=a.charAt(i);-1=="0123456789.".indexOf(e)&&(c=!1)}return c}
function dump(a,c,e){var f="";e||(e="");c||(c=0);if("object"==typeof a)for(var b in a){var d=a[b];if(IsNumeric(b)){b="["+b+"]";var k=e.substr(0,e.length-1)+b}else k=e+b;f="object"==typeof d?f+dump(d,c+1,k+"."):f+(k+'="'+d+'"<br>\n')}else f="===>"+a+"<===("+typeof a+")";return f}
var Url={encode:function(a){return escape(this._utf8_encode(a))},decode:function(a){alert("Deprecated function !!! WMJSTools line 325 with ["+a+"]");return this._utf8_decode(unescape(a))},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var c="",e=0;e<a.length;e++){var f=a.charCodeAt(e);128>f?c+=String.fromCharCode(f):(127<f&&2048>f?c+=String.fromCharCode(f>>6|192):(c+=String.fromCharCode(f>>12|224),c+=String.fromCharCode(f>>6&63|128)),c+=String.fromCharCode(f&63|128))}return c},_utf8_decode:function(a){var c=
"",e=0;for(c1=c2=0;e<a.length;){var f=a.charCodeAt(e);128>f?(c+=String.fromCharCode(f),e++):191<f&&224>f?(c2=a.charCodeAt(e+1),c+=String.fromCharCode((f&31)<<6|c2&63),e+=2):(c2=a.charCodeAt(e+1),c3=a.charCodeAt(e+2),c+=String.fromCharCode((f&15)<<12|(c2&63)<<6|c3&63),e+=3)}return c}};Array.indexOf||(Array.prototype.indexOf=function(a){for(var c=0;c<this.length;c++)if(this[c]==a)return c;return-1});
function createXHR(){try{return new XMLHttpRequest}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(a){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){}return!1}
function MakeJSONRequest(a,c,e,f,b){function d(a){e?e(a,f):c(void 0,f)}function k(){0==b?(a=requestProxy+"REQUEST="+URLEncode(a),MakeJSONRequest(a,c,e,f,!0)):d("status("+m.status+") to "+a)}a=-1==a.indexOf("?")?a+"?":a+"&";a+="rand="+Math.random();b||(b=!1);try{var m=createXHR();m.open("GET",a,!0);m.onreadystatechange=function(){if(4==m.readyState)if(200==m.status){try{var b=eval("("+m.responseText+")")}catch(p){d("Invalid JSON: '"+m.responseText+"'");return}void 0==b?d("request returned no data:"+
a):c(b,f)}else k()};m.send(null)}catch(q){k()}}
function MakeHTTPRequest(a,c,e,f,b){function d(a){e?e(a,f):c(void 0,f)}function k(){0==b?(a=requestProxy+"REQUEST="+URLEncode(a),MakeHTTPRequest(a,c,e,f,!0)):d("status("+m.status+") to "+a)}a=-1==a.indexOf("?")?a+"?":a+"&";a+="rand="+Math.random();b||(b=!1);try{var m=createXHR();m.open("GET",a,!0);m.onreadystatechange=function(){if(4==m.readyState)if(200==m.status){try{var a=m.responseText}catch(p){d("Exception occured:"+p);return}void 0==a||""==a?d("request returned no data"):c(a,f)}else k()};m.send(null)}catch(q){k()}}
var URLDecode=function(a){if(!isDefined(a))return"";a=a.replaceAll("+"," ");a=a.replaceAll("%2B","+");a=a.replaceAll("%20"," ");a=a.replaceAll("%5E","^");a=a.replaceAll("%26","&");a=a.replaceAll("%3F","?");a=a.replaceAll("%3E",">");a=a.replaceAll("%3C","<");a=a.replaceAll("%5C","\\");a=a.replaceAll("%2F","/");a=a.replaceAll("%25","%");a=a.replaceAll("%3A",":");a=a.replaceAll("%27","'");return a=a.replaceAll("%24","$")},URLEncode=function(a){if(!a||void 0==a||""==a||"string"!=typeof a)return a;a=a.replace(/\%/g,
"%25");a=a.replace(/\+/g,"%2B");a=a.replace(/\ /g,"%20");a=a.replace(/\^/g,"%5E");a=a.replace(/\&/g,"%26");a=a.replace(/\?/g,"%3F");a=a.replace(/\>/g,"%3E");a=a.replace(/\</g,"%3C");a=a.replace(/\\/g,"%5C");for(var c="",e=0;e<a.length;e++){var f=a.charAt(e);if(" "==f)c+="%20";else if(-1!="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz%-_.!~*'()".indexOf(f))c+=f;else{var b=f.charCodeAt(0);255<b?(alert("Unicode Character '"+f+"' cannot be encoded using standard URL encoding.\n(URL encoding only supports 8-bit characters.)\nA space (+) will be substituted."),
c+="+"):(c+="%",c+="0123456789ABCDEF".charAt(b>>4&15),c+="0123456789ABCDEF".charAt(b&15))}}return c};String.prototype.replaceAll=function(a,c){for(var e=this,f=e.indexOf(a);-1!=f;)e=e.replace(a,c),f=e.indexOf(a);return e};String.prototype.trim=function(){var a=this.replace(/^\s+/,"");return a=a.replace(/\s+$/,"")};function checkValidInputTokens(a){var c=/^([a-zA-Z'_:~%?\$,\.\0-9 \-=/&])+$/;return c.test(a)&&(a=URLDecode(a),c.test(a))?!0:!1}
function getUrlVars(){for(var a=[],c,e=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),f=0;f<e.length;f++)c=e[f].split("="),c[1]=URLDecode(c[1]),0!=checkValidInputTokens(c[0])&&0!=checkValidInputTokens(c[1])&&(a[c[0]]=c[1]+"");return a}
function getUrlVarsFromHashTag(){var a=[];var c=window.location.hash.indexOf("#");"?"==window.location.hash[c+1]&&c++;for(var e=window.location.hash.slice(c+1).split("&"),f=0;f<e.length;f++)c=e[f].split("="),c[1]=URLDecode(c[1]),0!=checkValidInputTokens(c[0])&&0!=checkValidInputTokens(c[1])&&(a[c[0]]=c[1]+"");return a}
var composeUrlObjectFromURL=function(a){var c=[];if(!isDefined(a))return c;var e="";a=a.split("?");1<a.length?(e=a[0],a=a[1].split("&")):a=a[0].split("&");for(var f=0;f<a.length;f++)hash=a[f].split("="),isDefined(hash[1])?(hash[1]=URLDecode(hash[1]),0!=checkValidInputTokens(hash[0])&&0!=checkValidInputTokens(hash[1])&&isDefined(hash[1])&&0<hash[1].length&&(c[hash[0].toLowerCase()]=hash[1]+"")):(hash=a[f].split("%3D"),isDefined(hash[1])&&(hash[1]=URLDecode(hash[1]),0!=checkValidInputTokens(hash[0])&&
0!=checkValidInputTokens(hash[1])&&isDefined(hash[1])&&0<hash[1].length&&(c[hash[0].toLowerCase()]=hash[1]+"")));a[0].indexOf("=");return{location:e,kvp:c}},currentLocationHash="",hashTagCheckerInUse=!1,_checkIfHashTagChanged=function(a){var c=window.location.hash;currentLocationHash!=c&&0<c.length&&(currentLocationHash=c,-1!=window.location.href.indexOf("#")&&(c=window.location.href.split("#")[1],c=c.replaceAll("%27","'"),urlVars=getUrlVarsFromHashTag(),isDefined(urlVars.clearhash)&&"1"==urlVars.clearhash&&
(currentLocationHash=window.location.hash=""),a(c,urlVars)));setTimeout(function(){_checkIfHashTagChanged(a)},100)},checkIfHashTagChanged=function(a){isDefined(a)&&(1==hashTagCheckerInUse?alert("checkIfHashTagChanged is in use"):(hashTagCheckerInUse=!0,_checkIfHashTagChanged(a)))},decodeBase64=function(a){var c={},e,f=0,b,d=0,k,m="",q=String.fromCharCode,p=a.length;for(e=0;64>e;e++)c["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e)]=e;for(b=0;b<p;b++)for(e=c[a.charAt(b)],
f=(f<<6)+e,d+=6;8<=d;)((k=f>>>(d-=8)&255)||b<p-2)&&(m+=q(k));return m};function DateInterval(a,c,e,f,b,d){this.year=parseInt(a);this.month=parseInt(c);this.day=parseInt(e);this.hour=parseInt(f);this.minute=parseInt(b);this.second=parseInt(d);this.isRegularInterval=!1;0==this.month&&0==this.year&&(this.isRegularInterval=!0);this.getTime=function(){if(0!=this.month)throw"month != 0";if(0!=this.year)throw"year != 0";var a=0+86400*this.day;a+=3600*this.hour;a+=60*this.minute;a+=this.second;return 1E3*a};this.toISO8601=function(){var a="P";0!=this.year&&(a+=this.year+"Y");
0!=this.month&&(a+=this.month+"M");0!=this.day&&(a+=this.day+"D");0!=this.hour&&0!=this.minute&&0!=this.second&&(a+="T");0!=this.hour&&(a+=this.hour+"H");0!=this.minute&&(a+=this.minute+"M");0!=this.second&&(a+=this.second+"S");return a}}
function parseISO8601DateToDate(a){try{var c=a.split("T");c[0]=c[0].replace(/-/g,":");c[0]=c[0].replace(/::/g,":-");var e=c[0].split(":"),f=c[1].split(":"),b=new Date(Date.UTC(e[0],e[1]-1,e[2],f[0],f[1],f[2].split("Z")[0]));b.add=function(a){0==a.isRegularInterval?(0!=a.year&&this.setUTCFullYear(this.getUTCFullYear()+a.year),0!=a.month&&this.setUTCMonth(this.getUTCMonth()+a.month),0!=a.day&&this.setUTCDate(this.getUTCDate()+a.day),0!=a.hour&&this.setUTCHours(this.getUTCHours()+a.hour),0!=a.minute&&
this.setUTCMinutes(this.getUTCMinutes()+a.minute),0!=a.second&&this.setUTCSeconds(this.getUTCSeconds()+a.second)):this.setTime(this.getTime()+a.getTime())};b.substract=function(a){0==a.isRegularInterval?(0!=a.year&&this.setUTCFullYear(this.getUTCFullYear()-a.year),0!=a.month&&this.setUTCMonth(this.getUTCMonth()-a.month),0!=a.day&&this.setUTCDate(this.getUTCDate()-a.day),0!=a.hour&&this.setUTCHours(this.getUTCHours()-a.hour),0!=a.minute&&this.setUTCMinutes(this.getUTCMinutes()-a.minute),0!=a.second&&
this.setUTCSeconds(this.getUTCSeconds()-a.second)):this.setTime(this.getTime()-a.getTime())};b.addMultipleTimes=function(a,b){0==a.isRegularInterval?(0!=a.year&&this.setUTCFullYear(this.getUTCFullYear()+a.year*b),0!=a.month&&this.setUTCMonth(this.getUTCMonth()+a.month*b),0!=a.day&&this.setUTCDate(this.getUTCDate()+a.day*b),0!=a.hour&&this.setUTCHours(this.getUTCHours()+a.hour*b),0!=a.minute&&this.setUTCMinutes(this.getUTCMinutes()+a.minute*b),0!=a.second&&this.setUTCSeconds(this.getUTCSeconds()+a.second*
b)):this.setTime(this.getTime()+a.getTime()*b)};b.substractMultipleTimes=function(a,b){0==a.isRegularInterval?(0!=a.year&&this.setUTCFullYear(this.getUTCFullYear()-a.year*b),0!=a.month&&this.setUTCMonth(this.getUTCMonth()-a.month*b),0!=a.day&&this.setUTCDate(this.getUTCDate()-a.day*b),0!=a.hour&&this.setUTCHours(this.getUTCHours()-a.hour*b),0!=a.minute&&this.setUTCMinutes(this.getUTCMinutes()-a.minute*b),0!=a.second&&this.setUTCSeconds(this.getUTCSeconds()-a.second*b)):this.setTime(this.getTime()-
a.getTime()*b)};b.toISO8601=function(){function a(a,b){a+="";b-=a.length;var c,d="";for(c=0;c<b;c++)d+="0"+d;return d+a}return a(this.getUTCFullYear(),4)+"-"+a(this.getUTCMonth()+1,2)+"-"+a(this.getUTCDate(),2)+"T"+a(this.getUTCHours(),2)+":"+a(this.getUTCMinutes(),2)+":"+a(this.getUTCSeconds(),2)+"Z"};b.clone=function(){return parseISO8601DateToDate(b.toISO8601())};return b}catch(d){throw"In parseISO8601DateToDate:"+d;}}
function parseISO8601IntervalToDateInterval(a){if("P"==a.charAt(0)){var c=a.split("T"),e=a=0,f=0,b=0;seconds=minutes=0;var d=c[0].split("P")[1];if(d){var k=d.indexOf("Y");var m=d.indexOf("M"),q=d.indexOf("D");-1!=k&&(a=d.substring(0,k));-1!=m&&(e=d.substring(k+1,m));-1!=q&&(-1!=m&&(k=m),f=d.substring(k+1,q))}0<c.length&&isDefined(c[1])&&(c=c[1])&&(k=c.indexOf("H"),d=c.indexOf("M"),m=c.indexOf("S"),-1!=k&&(b=c.substring(0,k)),-1!=d&&(minutes=c.substring(k+1,d)),-1!=m&&(-1!=d&&(k=d),seconds=c.substring(k+
1,m)));return new DateInterval(a,e,f,b,minutes,seconds)}}function getNumberOfTimeSteps(a,c,e){var f=0;if(0!=e.month||0!=e.year){a=a.clone();for(c=c.getTime();a.getTime()<c;)a.add(e),f++;f++}else f=parseInt((c.getTime()-a.getTime())/e.getTime()+.5)+1;return f}
function parseISOTimeRangeDuration(a){a=a.split("/");void 0==a[2]&&(a[2]="PT1M");void 0==a[1]&&(a[1]=a[0],a[2]="PT1M");this.startTime=parseISO8601DateToDate(a[0]);this.stopTime=parseISO8601DateToDate(a[1]);this.timeInterval=parseISO8601IntervalToDateInterval(a[2]);this.timeSteps=getNumberOfTimeSteps(this.startTime,this.stopTime,this.timeInterval);this.getTimeSteps=function(){return this.timeSteps};this.getDateAtTimeStep=function(a){if(0==this.timeInterval.isRegularInterval){var c=this.startTime.clone();
c.addMultipleTimes(this.timeInterval,a)}else{c=this.startTime.clone();var f=this.timeInterval.getTime(),f=f*a;c.setTime(c.getTime()+f)}return c};this.getTimeStepFromISODate=function(a,e){try{currentDate=parseISO8601DateToDate(a)}catch(f){throw"The date '"+a+"' is not a valid date";}return this.getTimeStepFromDate(currentDate,e)};this.getTimeStepFromDate=function(a,e){e||(e=!1);var c=a.getTime();if(c<this.startTime.getTime()){if(1==e)throw 0;return 0}var b=this.stopTime.clone();b.add(this.timeInterval);
if(c>b.getTime()){if(1==e)throw this.timeSteps-1;return this.timeSteps-1}if(c>this.stopTime.getTime())return this.timeSteps-1;if(0==this.timeInterval.isRegularInterval){e=this.startTime.clone();for(j=0;j<this.timeSteps;j++){b=e.getTime();e.add(this.timeInterval);var d=e.getTime();if(c>=b&&c<d)return j}throw"Date "+a.toISO8601()+" not found!";}a=(a.getTime()-this.startTime.getTime())/this.timeInterval.getTime();return a=parseInt(a+.5);throw"Date "+a.toISO8601()+" not found";};this.getTimeStepFromDate_WithinRange=
function(a){return this.getTimeStepFromDate(a,!0)};this.getTimeStepFromDate_Clipped=function(a){return this.getTimeStepFromDate(a,!1)}};Proj4js.defs["EPSG:3575"]="+proj=laea +lat_0=90 +lon_0=10 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs";Proj4js.defs["EPSG:3785"]="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs";Proj4js.defs["EPSG:3857"]="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs";Proj4js.defs["EPSG:3411"]="+proj=stere +lat_0=90 +lat_ts=70 +lon_0=-45 +k=1 +x_0=0 +y_0=0 +a=6378273 +b=6356889.449 +units=m +no_defs";
Proj4js.defs["EPSG:3412"]="+proj=stere +lat_0=-90 +lat_ts=-70 +lon_0=0 +k=1 +x_0=0 +y_0=0 +a=6378273 +b=6356889.449 +units=m +no_defs";Proj4js.defs["EPSG:4326"]="+proj=longlat +datum=WGS84 +no_defs";Proj4js.defs["EPSG:28992"]="+proj=sterea +lat_0=52.15616055555555 +lon_0=5.38763888888889 +k=0.9999079 +x_0=155000 +y_0=463000 +ellps=bessel +units=m +no_defs  <>";Proj4js.defs["EPSG:32661"]="+proj=stere +lat_0=90 +lat_ts=90 +lon_0=0 +k=0.994 +x_0=2000000 +y_0=2000000 +ellps=WGS84 +datum=WGS84 +units=m +no_defs";
Proj4js.defs["EPSG:102100"]=Proj4js.defs["EPSG:3857"];var epsgDescriptionLookup=[];epsgDescriptionLookup["EPSG:3411"]="NSIDC Sea Ice Polar Stereographic North";epsgDescriptionLookup["EPSG:3412"]="NSIDC Sea Ice Polar Stereographic South";epsgDescriptionLookup["EPSG:3575"]="Lambert azimuthal equal-area projection Europe";epsgDescriptionLookup["EPSG:3785"]="Mercator (deprecated)";epsgDescriptionLookup["EPSG:3857"]="Mercator";epsgDescriptionLookup["EPSG:4258"]="ETRS89";
epsgDescriptionLookup["EPSG:4326"]="World Lat lon WGS84";epsgDescriptionLookup["CRS:84"]="World Lat lon WGS84";epsgDescriptionLookup["EPSG:25831"]="ETRS89 / UTM zone 31N";epsgDescriptionLookup["EPSG:25832"]="ETRS89 / UTM zone 32N";epsgDescriptionLookup["EPSG:28992"]="Dutch Amersfoort / RD New";epsgDescriptionLookup["EPSG:32661"]="Polar Stereographic WGS 84 / UPS North";$.widget("ui.iconbutton",$.extend({},$.ui.button.prototype,{_init:function(){$.ui.button.prototype._init.call(this);this.element.removeClass("ui-corner-all").addClass("ui-iconbutton").unbind(".button")}}));var WebMapJSMapNo=0,logging=!1,base="./",noimage,loadingImageSrc,WMSControlsImageSrc,mapPinImageSrc,scaleBarURL,setBaseURL=function(a){base=a;noimage=base+"/img/blank.gif?";loadingImageSrc=base+"/img/ajax-loader.gif";WMSControlsImageSrc=base+"/img/mapcontrols.gif";mapPinImageSrc=base+"/img/dot.gif";isDefined(scaleBarURL)||(scaleBarURL=base+"/php/makeScaleBar.php?")};setBaseURL(base);
var debug=function(a){},error=function(a){},WMJScheckURL=function(a){if(!isDefined(a))return"?";a=a.trim();-1==a.indexOf("?")&&(a+="?");return a};function WMJSProjection(){this.bbox=new WMJSBBOX;this.srs="EPSG:4326"}
function WMJSMap(a){var c,e,f,b;function d(a){function l(ia){ia.currentTarget.removeEventListener("load",l,!1);c(a)}function b(l){(l=(l||event).srcElement)&&/^(complete|loaded)$/i.test(l.readyState)&&(l.detachEvent("onreadystatechange",b),c(a))}function c(a){1!=a.loadEventDone&&(a.loadEventDone=!0,a.loadEvent&&a.loadEvent(a))}a.style.left="0px";a.style.top="0px";a.loadEventDone=!1;a.failed=!1;a.addEventListener?a.addEventListener("load",l,!1):a.attachEvent("onreadystatechange",b);a.onerror=function(){a.src&&
a.src!=noimage&&(error(a.src),a.failed=!0,a.loadEvent&&a.loadEvent(a))}}function k(a){if(a){for(var l=0;l<r.length;l++)if(r[l]==a)return l;return-1}}function m(a){if(isDefined(a.name)&&(a.format||(a.format="image/png",error("layer format missing!")),!(1>a.name.length))){if("GFI:TIME_ELEVATION"==v){var l=a.getmapURL;l+="&SERVICE=WMS&REQUEST=GetFeatureInfo&VERSION="+a.version;l+="&LAYERS="+URLEncode(a.name);var b=a.name.split(",");l+="&QUERY_LAYERS="+URLEncode(b[b.length-1]);l=l+"&BBOX=29109.947643979103,6500000,1190890.052356021,7200000"+
("&CRS="+URLEncode("EPSG:3857")+"&");l+="WIDTH="+I;l+="&HEIGHT="+D;if(a.version==WMSVersion.version100||a.version==WMSVersion.version111)l+="&X=707&Y=557";a.version==WMSVersion.version130&&(l+="&I=707&J=557");l+="&FORMAT=image/gif&INFO_FORMAT=image/png&STYLES=";a=g.dateToISO8601(new Date(n.left));b=g.dateToISO8601(new Date(n.right));return l=l+("&time="+a+"/"+b)+("&elevation="+n.bottom+"/"+n.top)}l=a.getmapURL;l+="&SERVICE=WMS&";l+="VERSION="+a.version+"&";l+="REQUEST=GetMap&";l+="LAYERS="+URLEncode(a.name)+
"&";l+="WIDTH="+I+"&";l+="HEIGHT="+D+"&";l+=g.getBBOXandProjString(a);l+="STYLES="+URLEncode(a.currentStyle)+"&";l+="FORMAT="+a.format+"&";l=!0===a.transparent?l+"TRANSPARENT=TRUE&":l+"TRANSPARENT=FALSE&";try{l+=qa(a)}catch(Fa){return}return l+=a.wmsextensions.url}}function q(){p.mousedown(g.mouseDownEvent);p.mousewheel(g.mouseWheelEvent);attach_event(document,"mouseup",g.mouseUpEvent);attach_event(document,"mousemove",g.mouseMoveEvent);if(g.isTouchDevice()){g.enableInlineGetFeatureInfo(!1);var a=
new Hammer.Manager(document.body);a.add(new Hammer.Pan);a.add(new Hammer.Pinch);a.get("pan").set({direction:Hammer.DIRECTION_ALL});a.add(new Hammer.Swipe).recognizeWith(a.get("pan"));a.on("panstart",function(a){a.preventDefault();g.mouseDown(a.center.x,a.center.y,a)});a.on("panmove",function(a){a.preventDefault();g.mouseMove(a.center.x,a.center.y,a)});a.on("panend",function(a){a.preventDefault();g.mouseUp(a.center.x,a.center.y,a)});a.on("pinchstart",function(a){a.preventDefault();g.pinchStart(a.center.x,
a.center.y,a)});a.on("pinchmove",function(a){a.preventDefault();g.pinchMove(a.center.x,a.center.y,a)});a.on("pinchend",function(a){a.preventDefault();g.pinchEnd(a.center.x,a.center.y,a)});g.hideControls()}g.setMapModePan()}try{isDefined(xml2jsonrequestURL)}catch(l){xml2jsonrequestURL=base+"/php/xml2jsonrequest.php?"}try{isDefined(requestProxy)}catch(l){requestProxy=base+"/php/MakeRequest.php?"}try{isDefined(scaleBarURL)}catch(l){scaleBarURL=base+"/php/makeScaleBar.php?"}var p,t,v,E=new WMJSBBOX,ba=
new WMJSBBOX,I=2,D=2,r=[],L=[],F="",X=0,g=this;g.renderer="WMJSCanvasBuffer";var fa=!1,M=document.createElement("div"),w=document.createElement("div"),J=document.createElement("div"),A=document.createElement("div"),B=document.createElement("div"),u=document.createElement("div"),aa=document.createElement("div"),ja=!0,n=new WMJSBBOX,C=new WMJSBBOX,ya=new WMJSBBOX,Na=new WMJSBBOX,T=new WMJSBBOX,U=[],Ga=new WMJSImageStore(360,void 0,"wmjslegendbuffer");g.getLegendStore=function(){return Ga};var K=[],
na=new WMJSImageStore(360,void 0,"wmjsimagebuffer"),Ha=$('<div class="WMJSDivBuffer-loading"/>',{}),Oa=0,ca=0,ra=1,za,sa=0,W=0,Ia=0,Ja=0,Y=Array(3),Ka=Array(3);for(j=0;3>j;j++)Y[j]=new WMJSProjection,Ka[j]=new WMJSProjection;var Pa=!0,z=new WMJSListener;this.getGraphingData=function(){return this.graphingData};this.setGraphingData=function(a){this.graphingData=a};var O=function(l){a.id||(a.id="WebMapJSMapNo_"+WebMapJSMapNo,WebMapJSMapNo++);return a.id+"_"+l};this.enableInlineGetFeatureInfo=function(a){Pa=
a};this.closeAllGFIDialogs=function(){WMJSDialog.closeAllDialogs(V)};var V=[],Qa=function(){ha()},ta=[],Aa=0,ua=!1,ha=function(a){if(!(2>U.length)){try{0==isDefined(a)&&(a=!1);if(1==ua&&isDefined(Qa)){z.addToCallback("onlegendready",Qa);return}ua=!0;if(1==ja){if(ta.length!=r.length)a=!0;else for(var l=0;l<r.length;l++){var b=g.getLegendGraphicURLForLayer(r[l]);isDefined(b)&&ta[l]!==b&&(ta[l]=b,a=!0)}if(a){ta=[];for(l=0;l<r.length;l++)!1!==r[l].enabled&&(b=g.getLegendGraphicURLForLayer(r[l]),isDefined(b)&&
(ta[l]=b,U[Aa].setSrc(l,b)));var c=Aa;Aa=1-Aa;try{U[c].load(function(){try{for(var a=0,l=0,b=0;b<U[c].layers.length;b++){var ia=U[c].layers[b].getElement()[0].width,d=U[c].layers[b].getElement()[0].height,a=a+ia;l<d&&(l=d)}U[c].setPosition(I-a,D-l);U[c].display();U[1-c].hide()}catch(Xa){console.error(Xa)}ua=!1;z.triggerEvent("onlegendready")})}catch(la){console.log(la),U[0].hide(),U[1].hide(),ua=!1,z.triggerEvent("onlegendready")}return}}else U[0].hide(),U[1].hide()}catch(la){console.log(la)}ua=!1;
z.triggerEvent("onlegendready")}};this.getCapabilitiesJSON=function(a,b){WMJSGetCapabilities(a,!0,b,function(a){error(a);b(a)})};this.rebuildMapDimensions=function(){for(var a=0;a<L.length;a++)L[a].used=!1;for(i=0;i<r.length;i++)for(a=0;a<r[i].dimensions.length;a++){var b=r[i].dimensions[a],c=g.getDimension(b.name);isDefined(c)?c.used=!0:(b=b.clone(),b.used=!0,L.push(b))}for(a=0;a<L.length;a++)0==L[a].used&&(L.splice(a,1),a--);z.triggerEvent("onmapdimupdate")};this.getLayerByServiceAndName=function(a,
b){for(var l=0;l<r.length;l++){var ia=r[r.length-l-1];if(ia.name==b&&ia.service==a)return ia}};this.getLayers=function(){for(var a=[],b=0;b<r.length;b++)a.push(r[r.length-b-1]);return a};this.setLayer=function(a,b){return g.addLayer(a,b,a)};this.setActiveLayer=function(a){za=a;ha();z.triggerEvent("onchangeactivelayer")};this.calculateNumBaseLayers=function(){X=0;if(F)for(var a=0;a<F.length;a++)F[a].enabled&&0==F[a].keepOnTop&&X++};this.enableLayer=function(a){a.enabled=!0;g.calculateNumBaseLayers();
g.rebuildMapDimensions();ha(!0)};this.disableLayer=function(a){a.enabled=!1;g.calculateNumBaseLayers();g.rebuildMapDimensions();ha(!0)};this.toggleLayer=function(a){a.enabled=1==a.enabled?!1:!0;g.calculateNumBaseLayers();g.rebuildMapDimensions();ha(!0)};this.displayLayer=function(a,b){a.enabled=b;g.calculateNumBaseLayers();g.rebuildMapDimensions();ha(!0)};this.removeAllLayers=function(){r=[];L=[]};this.deleteLayer=function(a){if(!(0>=r.length)){a=k(a);if(0<=a){for(var l=a;l<r.length-1;l++)r[l]=r[l+
1];r.length--;za=void 0;0<=a&&a<r.length?(g.rebuildMapDimensions(),g.setActiveLayer(r[a])):0<r.length&&(g.rebuildMapDimensions(),g.setActiveLayer(r[r.length-1]))}g.rebuildMapDimensions()}};this.moveLayerDown=function(a){var l=k(a);if(0<l){a=r[l-1];var b=r[l];a&&b&&(r[l]=a,r[l-1]=b)}else try{error("moveLayerDown: layer '"+a.name+"' not found.")}catch(Fa){error("moveLayerDown: layer invalid.")}};this.moveLayerUp=function(a){var l=k(a);if(l<r.length-1){a=r[l+1];var b=r[l];a&&b&&(r[l]=a,r[l+1]=b)}else try{error("moveLayerUp: layer '"+
a.name+"' not found.")}catch(Fa){error("moveLayerUp: layer invalid.")}};this.addLayer=function(a){isDefined(a)&&(a.parentMaps.push(g),r.push(a),a.parseLayer(function(a){for(var l=0;l<a.dimensions.length;l++){var b=g.getDimension(a.dimensions[l].name);isDefined(b)&&isDefined(b.currentValue)&&1==a.dimensions[l].linked&&a.dimensions[l].setClosestValue(b.currentValue)}g.rebuildMapDimensions();z.triggerEvent("onlayeradd")},void 0,"WMJSLayer::addLayer"))};this.getActiveLayer=function(){return za};this.setProjection=
function(a,b){g.hideMapPin();a||(a="EPSG:4326");"object"==typeof a&&(b=a.bbox,a=a.srs);v=a;g.proj4.srs==v&&isDefined(this.proj4.projection)||(g.proj4.projection=new Proj4js.Proj(v),g.proj4.srs=v);g.setBBOX(b);ba.setBBOX(b);g.updateMouseCursorCoordinates();z.triggerEvent("onsetprojection",[v,n])};this.getBBOX=function(){return n};this.getProjection=function(a){return{srs:v,bbox:n}};this.getSize=function(){return{width:I,height:D}};this.getWidth=function(){return I};this.getHeight=function(){return D};
this.repositionLegendGraphic=function(a){ja?ha(a):(U[0].hide(),U[1].hide())};this.setSize=function(l,b){if(l&&b){var c=this.getProjection();I=parseInt(l);D=parseInt(b);if(4>I||isNaN(I))I=4;if(4>D||isNaN(D))D=4;c.srs&&c.bbox||(error("this.setSize: Setting default projection (EPSG:4326 with (-180,-90,180,90)"),c.srs="EPSG:4326",c.bbox.left=-180,c.bbox.bottom=-90,c.bbox.right=180,c.bbox.top=90,g.setProjection(c.srs,c.bbox));p.css({width:I,height:D});t.css({width:I,height:D});a.style.width=I+"px";a.style.height=
D+"px";g.setBBOX(E);g.repositionMapPin();g.showBoundingBox();1<K.length&&(K[0].setPosition(0,0),K[0].resize(g.getWidth(),g.getHeight()),K[1].setPosition(0,0),K[1].resize(g.getWidth(),g.getHeight()));g.repositionLegendGraphic(!0);z.triggerEvent("onresize",[I,D])}};this.getBBOXandProjString=function(a){var l="";if(a.version==WMSVersion.version100||a.version==WMSVersion.version111)l+="SRS="+URLEncode(v)+"&",l+="BBOX="+n.left+","+n.bottom+","+n.right+","+n.top+"&";a.version==WMSVersion.version130&&(l+=
"CRS="+URLEncode(v)+"&",l="EPSG:4326"==v&&0==a.wms130bboxcompatibilitymode?l+("BBOX="+n.bottom+","+n.left+","+n.top+","+n.right+"&"):l+("BBOX="+n.left+","+n.bottom+","+n.right+","+n.top+"&"));return l};this.isTouchDevice=function(){return"undefined"!==typeof window.ontouchstart};this.getDimensionRequestString=function(a){return qa(a)};this.dateToISO8601=function(a){function l(a,l){a+="";l-=a.length;var b,c="";for(b=0;b<l;b++)c+="0"+c;return c+a}return l(a.getUTCFullYear(),4)+"-"+l(a.getUTCMonth()+
1,2)+"-"+l(a.getUTCDate(),2)+"T"+l(a.getUTCHours(),2)+":"+l(a.getUTCMinutes(),2)+":"+l(a.getUTCSeconds(),2)+"Z"};this.abort=function(){z.triggerEvent("onmapready");fa=!1;z.triggerEvent("onloadingcomplete")};this.isBusy=function(){return fa||0==K[0].ready||0==K[1].ready?!0:!1};this.getLegendGraphicURLForLayer=function(a){if(a){var l=a.legendGraphic;if(l){l+="&layers="+URLEncode(a.name)+"&";try{1==a.legendIsDimensionDependant&&(l+=g.getDimensionRequestString(a)+"&")}catch(ma){return}return l=l+"&transparent=true&width=90&height=250&"+
a.wmsextensions.url}}};this.showScaleBar=function(){M.img&&(M.img.style.display="")};this.hideScaleBar=function(){M.img&&(M.img.style.display="none")};this.getMaxNumberOfAnimations=function(){return 72};this.draw=function(a){g.isAnimating||(T.setBBOX(n),g.drawAndLoad(a))};this.drawAndLoad=function(a){z.triggerEvent("beforedraw");if(0==g.isAnimating&&void 0!=a&&"object"==typeof a&&0<a.length){if(72<a.length){alert("Too many animations given, max is 72");g.draw("self");return}g.isAnimating=!0;z.triggerEvent("onstartanimation",
g);g.currentAnimationStep=0;g.animationList=[];g.mouseHoverAnimationBox=!1;for(var l=0;l<a.length;l++){var b={name:a[l].name,value:a[l].value};g.setDimension(a[l].name,a[l].value);b.requests=g.getWMSRequests();g.animationList.push(b)}g.setDimension(g.animationList[g.currentAnimationStep].name,g.animationList[g.currentAnimationStep].value)}if(1==g.isAnimating){for(l=0;l<g.animationList.length;l++)g.setDimension(g.animationList[l].name,g.animationList[l].value),g.animationList[l].requests=g.getWMSRequests(),
g.animationList[l].imagesInPrefetch=void 0;g.setDimension(g.animationList[g.currentAnimationStep].name,g.animationList[g.currentAnimationStep].value);isDefined(void 0)&&(void 0).el.hide()}g._pdraw()};var Ya=function(){debug("--\x3e onmapready event called");g.draw("onmapready callback")};this.getWMSRequests=function(){var a=[],b=g.getNumLayers();for(j=0;j<b;j++)if(r[j].service&&r[j].enabled){var c=m(r[j]);c&&a.push(c)}return a};this.prefetch=function(a){var l=[];for(j=0;j<a.length;j++){var b=na.getImage(a[j]);
0==b.isLoaded()&&0==b.isLoading()&&(l.push(b),b.load())}return l};this.getImageStore=function(){return na};this.isThisRequestLoaded=function(a){a=na.getImageForSrc(a);if(void 0==a)return 0;if(a.isLoaded())return 2;if(a.isLoading())return 1};this.mouseHoverAnimationBox=!1;this._pdraw=function(){if(0!=Oa)if(fa)1==z.addToCallback("onmapready",Ya)&&debug("Suspending on onmapready");else{var a,b=0;X=0;if(F)for(var c=0;c<F.length;c++)F[c].enabled&&0==F[c].keepOnTop&&(X++,a=m(F[c]))&&(K[ca].setSrc(b,a,g.getWidth(),
g.getHeight()),K[ca].setOpacity(b,F[c].opacity),b++);for(c=0;c<g.getNumLayers();c++)r[c].service&&r[c].enabled&&(a=m(r[c],r[c].dimensions))&&(K[ca].setSrc(b,a),K[ca].setOpacity(b,r[c].opacity),r[c].image=K[ca].layers[b],b++);if(F)for(c=0;c<F.length;c++)F[c].enabled&&1==F[c].keepOnTop&&(a=m(F[c]))&&(K[ca].setSrc(b,a),K[ca].setOpacity(b,F[c].opacity),b++);g.flipBuffers();z.triggerEvent("ondrawready");ha()}};var Ra,va=function(a){if(0!=K.length){var l=n;isDefined(a)&&(l=a);C=l;K[ra].setBBOX(C,ya);K[ra].mapbbox=
C;g.showBoundingBox(A.bbox,C);z.triggerEvent("onupdatebbox",C)}},Sa=new WMJSTimer;g.flipBuffers=function(){var a=ra,b=ca;z.triggerEvent("onmapstartloading");fa=!0;Sa.init(500,function(){Ha.show()});Na.setBBOX(n);K[b].load(function(){try{K[a].srs=v,K[b].bbox=n.clone(),K[b].srs=v,ya.setBBOX(Na),K[b].display(C,ya),u.oldx=u.exactX,u.oldy=u.exactY,K[a].hide(),ra=b,ca=a}catch(ma){console.log(ma)}fa=!1;z.triggerEvent("onmaploadingcomplete");z.triggerEvent("onloadingcomplete");z.triggerEvent("onmapready");
Ha.hide();Sa.stop()})};g.redrawBuffer=function(){K[ra].display()};this.addBaseLayers=function(a){if(a)for(X=0,a=toArray(a),F.push(a),j=0;j<F.length;j++)1==F.keepOnTop&&X++;else F=void 0};this.setBaseLayers=function(a){if(a)for(X=0,F=a,j=0;j<F.length;j++)1==F.keepOnTop&&X++;else F=void 0};this.getBaseLayers=function(){return F};this.getNumLayers=function(){return r.length};this.getBaseElement=function(){return p};var wa=0,Za=new WMJSTimer;this.mouseWheelEvent=function(a,b,c,d){a.stopPropagation();
preventdefault_event(a);if(1!=wa){wa=1;var l=C.right-C.left,e=C.bottom-C.top;a=g.getGeoCoordFromPixelCoord({x:G,y:H},T);d=(a.x-C.left)/l;c=(a.y-C.top)/e;var l=.05*l,f=.05*e;0>b&&(l=-l,f=-f);b=C.left+l;e=C.top+f;l=C.right-l;f=C.bottom-f;d=d*(l-b)+b-a.x;a=c*(f-e)+e-a.y;C.left=b-d;C.bottom=f-a;C.right=l-d;C.top=e-a;va(C);wa=0;g.zoomTo(C);Za.init(250,function(){g.draw("mouseWheelEvent")})}};var N;this.pinchStart=function(a,d,q){f=q.pointers[0].clientX;b=q.pointers[0].clientY;c=q.pointers[1].clientX;e=
q.pointers[1].clientY;N=n.clone();Z=0;wa=ga=1};this.pinchMove=function(a,d,q){Z=0;pinchMove1={x:q.pointers[0].clientX,y:q.pointers[0].clientY};pinchMove2={x:q.pointers[1].clientX,y:q.pointers[1].clientY};a=pinchMove2.x-pinchMove1.x;d=c-f;q=pinchMove2.y-pinchMove1.y;var l=e-b;0==d&&(d=1);0==l&&(l=1);a*a>q*q?(a/=d,d=f-pinchMove1.x/a,n.right=((I-pinchMove1.x)/a+f)/I*(N.right-N.left)+N.left,n.left=d/I*(N.right-N.left)+N.left,a=(N.right-N.left)/(N.top-N.bottom),d=(n.top+n.bottom)/2,a=(n.left-n.right)/
2/a,n.bottom=d+a,n.top=d-a):(a=q/l,d=b-pinchMove1.y/a,n.bottom=((D-pinchMove1.y)/a+b)/D*(N.bottom-N.top)+N.top,n.top=d/D*(N.bottom-N.top)+N.top,a=(N.right-N.left)/(N.top-N.bottom),d=(n.right+n.left)/2,a*=(n.bottom-n.top)/2,n.left=d+a,n.right=d-a);va(n)};this.pinchEnd=function(a,b,c){wa=ga=Z=0;g.zoomTo(n);g.draw("pinchEnd")};var qa=function(a){a=a.dimensions;for(var b="",l=0;l<a.length;l++){var c=a[l].name;c="TIME"==c.toUpperCase()?c:"ELEVATION"==c.toUpperCase()?c:"DIM_"+c;b+="&"+c;b+="="+URLEncode(a[l].currentValue);
if(a[l].currentValue==WMJSDateOutSideRange||a[l].currentValue==WMJSDateTooEarlyString||a[l].currentValue==WMJSDateTooLateString)throw WMJSDateOutSideRange;}return b},G=0,H=0,P=-1E4,Q=-1E4,da=1E4,ea=1E4,ga=0,Z=0,R="pan";this.getWMSMetaDataRequestURL=function(a){var b=a.service,b=b+("&SERVICE=WMS&REQUEST=GetMetaData&VERSION="+a.version),b=b+("&LAYER="+URLEncode(a.name)),b=b+"&FORMAT=text/html";try{b+="&"+qa(a)}catch(ma){return}debug("<a target='_blank' href='"+b+"'>"+b+"</a>",!1);return b};var ka=0,
La=[],Ma=function(a,b){this.layer=a;this.data=b},$a=function(a,b,c,d,e){d=d+("&GRAPHSTYLE="+e)+("&"+g.getBBOXandProjString(a));d+="&LAYERS="+URLEncode(a.name);d+="WIDTH="+I;d+="&HEIGHT="+D;d+="&X="+b;d+="&Y="+c;d+="&FORMAT=image/png";d+="&INFO_FORMAT=text/html";d+="&STYLES=";try{d+="&"+qa(a)}catch(Ba){return}debug("<a target='_blank' href='"+d+"'>"+d+"</a>",!1);return d};this.getWMSGetFeatureInfoRequestURL=function(a,b,c){var l=WMJScheckURL(a.service),l=l+("&SERVICE=WMS&REQUEST=GetFeatureInfo&VERSION="+
a.version),l=l+("&LAYERS="+URLEncode(a.name)),d=a.name.split(","),l=l+("&QUERY_LAYERS="+URLEncode(d[d.length-1])),l=l+("&"+g.getBBOXandProjString(a)),l=l+("WIDTH="+I),l=l+("&HEIGHT="+D);if(a.version==WMSVersion.version100||a.version==WMSVersion.version111)l=l+("&X="+b)+("&Y="+c);a.version==WMSVersion.version130&&(l=l+("&I="+b)+("&J="+c));l+="&FORMAT=image/gif&INFO_FORMAT=text/html&STYLES=";try{l+="&"+qa(a)}catch(Ba){return}debug("<a target='_blank' href='"+l+"'>"+l+"</a>",!1);return l};var Ca=function(a,
b){ka--;a=b?1==b.queryable?new Ma(b,a):new Ma(b,"not queryable"):new Ma(b,"Query failed...");La.push(a);0>=ka&&(ka=0,z.triggerEvent("ongetfeatureinfoready",La))},ab=function(){debug("resuming on ongetpointinfoready");g.getPointInfo(P,Q)},Da=!1;this.getPointInfo=function(a,b){if(Da)debug("suspending on ongetpointinfoready"),g.addListener("ongetpointinfoready",ab,!1);else{Da=!0;z.triggerEvent("beforegetpointinfo");var l=g.getGraphingData();if(void 0==l)error("getPointInfo getGraphingData is undefined"),
Da=!1;else{debug("getPointInfo("+a+","+b+") "+l.layer.name);var c=$a(l.layer,a,b,l.service,l.style);debug("GetPointInfo: "+c);var e=new Image;e.loadEvent=function(){Da=!1;var a={};a.url=c;a.layer=l.layer;a.img=e;z.triggerEvent("ongetpointinfoready",a)};d(e);e.src=c}}};var bb=function(){debug("resuming on ongetfeatureinfoready");z.triggerEvent("beforegetfeatureinfo");g.getFeatureInfo(P,Q)};this.getFeatureInfo=function(a,b){if(0<ka)debug("suspending on ongetfeatureinfoready"),g.addListener("ongetfeatureinfoready",
bb,!1);else{debug("GetFeatureInfo:");La=[];for(var l=ka=0;l<r.length;l++){var c=r[r.length-l-1];c.getFeatureInfoUrl="";c.service&&c.enabled&&1==c.queryable&&(c.getFeatureInfoUrl=g.getWMSGetFeatureInfoRequestURL(c,a,b),isDefined(c.getFeatureInfoUrl)?ka++:c.getFeatureInfoUrl="")}0==ka&&z.triggerEvent("ongetfeatureinfoready",["No layers to query"]);for(l=0;l<r.length;l++)if(a=r[r.length-l-1],""!=a.getFeatureInfoUrl)if(0==a.queryable)Ca("Layer is not queryable.",a);else try{MakeHTTPRequest(a.getFeatureInfoUrl,
Ca,function(a,b){Ca(a,b);error(a)},a)}catch(la){Ca("Exception: "+la,a)}}};this.getGetFeatureInfoObjectAsHTML=function(a){var b="";try{for(var b=b+'<div class="getfeatureinfo">',l=0;l<r.length;l++)for(var c=0;c<a.length;c++)a[c].layer==r[l]&&(b+='<div class="getfeatureinfolayer">',b+="<b><a target='_blank' href='"+a[c].layer.getFeatureInfoUrl+"'>"+a[c].layer.title+"</a></b><br/>",b+=a[c].data,b+="</div>");b+="</div>"}catch(la){b="No layers to query."}return b};this.getMapPinXY=function(){return[u.exactX,
u.exactY]};this.positionMapPinByLatLon=function(a){debug("positionMapPinByLatLon at "+a.x+","+a.y);a=g.getPixelCoordFromLatLong(a);g.setMapPin(a.x,a.y);g.showMapPin()};this.repositionMapPin=function(){var a=g.getPixelCoordFromGeoCoord({x:u.geoPosX,y:u.geoPosY});g.setMapPin(a.x,a.y)};this.setMapPin=function(a,b){var l=a;"object"===typeof a&&(l=a.x,b=a.y);l&&b&&(u.x=parseInt(l),u.y=parseInt(b),u.exactX=parseFloat(l),u.exactY=parseFloat(b),a=g.getGeoCoordFromPixelCoord({x:u.exactX,y:u.exactY}),u.geoPosX=
a.x,u.geoPosY=a.y,u.style.left=u.x-5+"px",u.style.top=u.y-7+"px")};this.isMapPinVisible=function(){return"none"==u.style.display?!1:!0};this.showMapPin=function(){u.innerHTML="<img src='"+mapPinImageSrc+"'>";u.style.display=""};this.hideMapPin=function(){u.style.display="none"};this.setMapModeGetInfo=function(){R="info";p.css("cursor","default")};this.setMapModeZoomBoxIn=function(a){R="zoom";p.css("cursor","default")};this.setMapModeZoomOut=function(a){R="zoomout";p.css("cursor","default")};this.setMapModePan=
function(a){R="pan";p.css("cursor","default")};this.setMapModePoint=function(a,b){R="point";p.css("cursor","url(webmapjs/img/aero_pen.cur), default")};var xa=void 0;this.setMapModeNone=function(a){R="none";p.css("cursor","default")};this.getMouseCoordinatesForDocument=function(b){if(isDefined(b.changedTouches))return{x:parseInt(b.changedTouches[0].screenX),y:parseInt(b.changedTouches[0].screenY)};var l=$(a).parent().offset(),c=b.pageX,d=b.pageY;void 0==c&&(c=getClick_X(b));void 0==d&&(d=getClick_Y(b));
return{x:c-l.left,y:d-l.top}};this.getMouseCoordinatesForElement=function(b){if(isDefined(b.changedTouches))return{x:parseInt(b.changedTouches[0].screenX),y:parseInt(b.changedTouches[0].screenY)};var c=$(a).parent().offset(),l=b.pageX,d=b.pageY;void 0==l&&(l=getClick_X(b));void 0==d&&(d=getClick_Y(b));return{x:l-c.left,y:d-c.top}};this.mouseDown=function(a,b,c){var l=!1;c&&1==c.shiftKey&&(l=!0);l?(void 0==xa&&(xa=R),R="zoom"):void 0!=xa&&(R=xa,xa=void 0);P=a;Q=b;Z=1;z.triggerEvent("mousedown",{map:g,
x:P,y:Q});"info"==R?(g.setMapPin(P,Q),g.showMapPin(),z.triggerEvent("beforegetfeatureinfo",{map:g,x:P,y:Q}),g.getFeatureInfo(P,Q)):"point"==R&&(g.setMapPin(P,Q),g.showMapPin(),g.getPointInfo(P,Q))};var Ta=!1,S=!1;this.updateMouseCursorCoordinates=function(a){var b=g.getGeoCoordFromPixelCoord(a),c,l;isDefined(b)&&(b.x&&(c=Math.round(100*b.x)/100),b.y&&(l=Math.round(100*b.y)/100));if(isDefined(c)&&isDefined(l)){a=g.getLatLongFromPixelCoord(a);var d,e;isDefined(a)&&(a.x&&(d=Math.round(100*a.x)/100),
a.y&&(e=Math.round(100*a.y)/100));a='<div class="webmapjs_coordinates"><table class="webmapjs_coordinates">';"GFI:TIME_ELEVATION"!=v&&(a="EPSG:4326"!=v?a+("<tr><td>XY </td><td>&nbsp;</td><td>(</td><td> "+c+" </td><td> , </td><td>"+l+" </td><td>)</td></tr>"):a+"<tr><td>&nbsp</td></tr>",isDefined(d)&&isDefined(e)&&(a+="<tr><td>LonLat </td><td>&nbsp;</td><td>( </td><td>"+d+" </td><td> , </td><td>"+e+"</td><td> )</td></tr>"));"GFI:TIME_ELEVATION"==v&&(a+="<tr><td>Time:</td><td>"+g.dateToISO8601(new Date(d))+
" </td></tr>",a+="<tr><td>Elevation:</td><td>"+e+" </td></tr>");w.innerHTML=a+"</table></div>"}else w.innerHTML='<table class="coordinates"><tr><td>&nbsp;</td></tr><tr><td>'+I18n.projection.text+": "+v+"</td></tr></table>"};this.mouseDownEvent=function(a){preventdefault_event(a);var b=g.getMouseCoordinatesForDocument(a);g.mouseDown(b.x,b.y,a)};this.mouseMoveEvent=function(a){preventdefault_event(a);var b=g.getMouseCoordinatesForDocument(a);g.mouseMove(b.x,b.y,a)};this.mouseUpEvent=function(a){preventdefault_event(a);
var b=g.getMouseCoordinatesForDocument(a);g.mouseUp(b.x,b.y,a)};this.mouseMove=function(b,c){G=b;H=c;if(1==A.displayed&&0==oa){b=g.getPixelCoordFromGeoCoord({x:A.bbox.left,y:A.bbox.top});c=g.getPixelCoordFromGeoCoord({x:A.bbox.right,y:A.bbox.bottom});var d=!1;0==Z&&(!1===S&&(Ta=p.css("cursor")),6>Math.abs(G-b.x)&&H>b.y&&H<c.y&&(d=!0,p.css("cursor","col-resize"),S="left"),6>Math.abs(H-b.y)&&G>b.x&&G<c.x&&(d=!0,p.css("cursor","row-resize"),S="top"),6>Math.abs(G-c.x)&&H>b.y&&H<c.y&&(d=!0,p.css("cursor",
"col-resize"),S="right"),6>Math.abs(H-c.y)&&G>b.x&&G<c.x&&(d=!0,p.css("cursor","row-resize"),S="bottom"),6>Math.abs(G-b.x)&&6>Math.abs(H-b.y)&&(d=!0,p.css("cursor","nw-resize"),S="topleft"),6>Math.abs(G-c.x)&&6>Math.abs(H-b.y)&&(d=!0,p.css("cursor","ne-resize"),S="topright"),6>Math.abs(G-b.x)&&6>Math.abs(H-c.y)&&(d=!0,p.css("cursor","sw-resize"),S="bottomleft"),6>Math.abs(G-c.x)&&6>Math.abs(H-c.y)&&(d=!0,p.css("cursor","se-resize"),S="bottomright"));if(1==d||!1!==S&&1==Z){1==Z&&("left"==S&&(b.x=G),
"top"==S&&(b.y=H),"right"==S&&(c.x=G),"bottom"==S&&(c.y=H),"topleft"==S&&(b.x=G,b.y=H),"topright"==S&&(c.x=G,b.y=H),"bottomleft"==S&&(b.x=G,c.y=H),"bottomright"==S&&(c.x=G,c.y=H),b=g.getGeoCoordFromPixelCoord(b),c=g.getGeoCoordFromPixelCoord(c),A.bbox.left=b.x,A.bbox.top=b.y,A.bbox.right=c.x,A.bbox.bottom=c.y,g.showBoundingBox(A.bbox),z.triggerEvent("bboxchanged",{map:g,bbox:A.bbox}));return}S=!1;p.css("cursor",Ta)}b=0>H|0>G|G>I|H>D?-1:0;if(-1==b){try{z.triggerEvent("onmousemove",[void 0,void 0]),
g.updateMouseCursorCoordinates(void 0)}catch(Ba){console.log(Ba)}da=G;ea=H;0!=oa&&(1==Z&&"zoomout"==R&&g.zoomOut(),Z=0,1==ga&&Ua(da,ea))}else{if(1==Z&&!(3>Math.abs(P-G)&&3>Math.abs(Q-H))){c=G;b=H;if(0==ga){if("pan"==R){p.css("cursor","move");var d=parseInt(c),l=parseInt(b);u.oldx=u.exactX;u.oldy=u.exactY;for(var e=0;e<V.length;e++)V[e].origX=V[e].x,V[e].origY=V[e].y;oa=1;C.setBBOX(T);pa=g.getGeoCoordFromPixelCoord({x:d,y:l},T)}"zoom"==R&&(p.css("cursor","crosshair"),Ea=1);ga=1}"pan"==R&&0!=oa&&(c=
parseInt(c),b=parseInt(b),0>G||0>H||G>parseInt(a.style.width)||H>parseInt(a.style.height)?Va(c,b):(c=g.getGeoCoordFromPixelCoord({x:c,y:b},T),b=c.x-pa.x,c=c.y-pa.y,g.setMapPin(u.oldx+b/(n.right-n.left)*I,u.oldy+c/(n.bottom-n.top)*D),C.left=T.left-b,C.bottom=T.bottom-c,C.right=T.right-b,C.top=T.top-c,va(C)));"zoom"==R&&0!=Ea&&(c=G-P,b=H-Q,0>c&&0>b?p.css("cursor","not-allowed"):p.css("cursor","crosshair"),h=b,J.style.display="",0>c?(c=-c,J.style.left=G+"px"):J.style.left=P+"px",0>h?(h=-h,J.style.top=
H+"px"):J.style.top=Q+"px",J.style.width=c+"px",J.style.height=h+"px")}z.triggerEvent("onmousemove",[G,H]);g.updateMouseCursorCoordinates({x:G,y:H})}};this.mouseUp=function(a,b,c){da=a;ea=b;if(1==Z){"zoomout"==R&&g.zoomOut();if(0==ga&&3>Math.abs(P-da)&&3>Math.abs(Q-ea)){isDefined(c)&&z.triggerEvent("mouseclicked",{map:g,x:da,y:ea,shiftKeyPressed:1==c.shiftKey});if(1==Pa){var d=void 0;0==V.length?(d=WMJSDialog.createDialog({x:da,y:ea,autoDestroy:!1},p,g),V.push(d)):d=V[0];0==d.hasBeenDragged&&(1==
d.moveToMouseCursor?d.setXY(da,ea):d.setXY(5,5));d.on("hide",function(a,b){d.hasBeenDragged=!1});d.setLoading();d.show();g.addListener("ongetfeatureinfoready",function(a){d.setHTML(g.getGetFeatureInfoObjectAsHTML(a))},!0)}g.setMapPin(P,Q);g.showMapPin();z.triggerEvent("beforegetfeatureinfo");g.getFeatureInfo(P,Q)}z.triggerEvent("mouseup",{map:g,x:da,y:ea})}Z=0;1==ga&&Ua(da,ea)};var Ua=function(a,b){if(0!=ga&&(ga=0,"pan"==R&&Va(a,b),"zoom"==R)){b=da-P;var c=ea-Q;p.css("cursor","default");0!=Ea&&(Ea=
0,J.style.display="none",0>b&&0>c||(a=new WMJSBBOX,0>b?(a.left=P+b,a.right=P):(a.left=P,a.right=P+b),0>c?(a.top=Q+c,a.bottom=Q):(a.top=Q,a.bottom=Q+c),b=g.pixelCoordinatesToXY({x:a.left,y:a.bottom}),c=g.pixelCoordinatesToXY({x:a.right,y:a.top}),a.left=b.x,a.bottom=b.y,a.right=c.x,a.top=c.y,g.zoomTo(a),g.draw("mapZoomEnd")))}},oa=0,pa,Va=function(a,b){p.css("cursor","default");a=parseInt(a);b=parseInt(b);if(0!=oa){oa=0;var c=g.getGeoCoordFromPixelCoord({x:a,y:b},T),d=c.x-pa.x,c=c.y-pa.y;pa=g.getGeoCoordFromPixelCoord({x:a,
y:b},T);g.setMapPin(u.oldx+d/(n.right-n.left)*I,u.oldy+c/(n.bottom-n.top)*D);C.left=T.left-d;C.bottom=T.bottom-c;C.right=T.right-d;C.top=T.top-c;va(C);g.zoomTo(C);g.draw("mapPanEnd")}},Ea=0;this.zoomTo=function(a){var b=!1;a=new WMJSBBOX(a);try{var c=(E.left-E.right)/(E.bottom-E.top)}catch(Fa){b=!0}isNaN(c)&&(b=!0);1==b&&(error("Invalid bbox: setting ratio to 1"),c=1);0>c&&(c=-c);c>I/D?(b=(a.top+a.bottom)/2,c=(a.left-a.right)/2/c,a.bottom=b+c,a.top=b-c):(b=(a.right+a.left)/2,c*=(a.bottom-a.top)/2,
a.left=b+c,a.right=b-c);g.setBBOX(a);va(n);T.setBBOX(n);a=g.getPixelCoordFromGeoCoord({x:u.geoPosX,y:u.geoPosY});g.setMapPin(a.x,a.y);for(a=0;a<V.length;a++)g.getPixelCoordFromGeoCoord({x:V[a].geoPosX,y:V[a].geoPosY}),0==V[a].hasBeenDragged&&1==V[a].moveToMouseCursor&&V[a].setXY(V[a].origX+x,V[a].origY+y)};this.pixelCoordinatesToXY=function(a){return g.getGeoCoordFromPixelCoord(a)};this.getGeoCoordFromPixelCoord=function(a,b){var c=n;b&&(c=b);if(isDefined(a)){try{var d=a.x/I*(c.right-c.left)+c.left;
var l=a.y/D*(c.bottom-c.top)+c.top}catch(Ba){return}return{x:d,y:l}}};this.proj4={};this.proj4.srs="empty";this.proj4.projection=void 0;var Wa=new Proj4js.Proj("EPSG:4326");this.getPixelCoordFromLatLong=function(a){var b=new Proj4js.Point;try{b.x=parseFloat(a.x),b.y=parseFloat(a.y),g.proj4.srs==v&&isDefined(this.proj4.projection)||(g.proj4.projection=new Proj4js.Proj(v),g.proj4.srs=v),Proj4js.transform(Wa,g.proj4.projection,b)}catch(ma){alert(debug("error in getPixelCoordFromLatLong "+ma));return}return g.getPixelCoordFromGeoCoord(b)};
this.WCJSSearchRequest=function(a){a.trim().match(/^(-?(?:[1-8]?\d(?:\.\d+)?|90(?:\.0+)?),-?(?:180(?:\.0+)?|(?:(?:1[0-7]\d)|(?:[1-9]?\d))(?:\.\d+)?))$/)?(splitted=a.split(","),lat=splitted[0],lng=splitted[1],g.calculateBoundingBoxAndZoom(lat,lng)):"undefined"===typeof geoNamesURL||"undefined"===typeof knmiGeoNamesURL?error(I18n.no_urls_in_config.text):a.trim()?(searchDef=a.trim().match(/^[a-zA-Z0-9 ]*$/))?(a=knmiGeoNamesURL.replace("{searchTerm}",searchDef),debug(I18n.debug_searching_location.text),
debug("<a target='_blank' href='"+a+"'>"+a+"</a>",!1),$.ajax({dataType:"jsonp",contentType:"application/jsonp",jsonpCallback:"resultGeo",crossDomain:!0,type:"GET",url:a,success:function(a){if(0===$(a).length){var b=geoNamesURL.replace("{searchTerm}",searchDef).replace("{username}",defaultUsernameSearch);g.WCJSSearchRequestGeoNames(b)}else b=parseFloat($(a)[0].lat),a=parseFloat($(a)[0].lon),g.calculateBoundingBoxAndZoom(b,a)},error:function(a,b,c){error(I18n.geonames_api_call_failed.text)}})):(debug(I18n.only_alpha_num_allowed.text),
$("#searchtextfield").attr("value","")):(debug(I18n.no_search_definition.text),$("#searchtextfield").attr("value",""))};this.WCJSSearchRequestGeoNames=function(a){debug(I18n.debug_searching_sqlite_location.text);debug("<a target='_blank' href='"+a+"'>"+a+"</a>",!1);$.ajax({dataType:"xml",type:"GET",url:a,success:function(a){if("0"===$(a).find("totalResultsCount").text())error(I18n.no_results_search.text);else{var b=parseFloat($(a).find("geoname").find("lat").text());a=parseFloat($(a).find("geoname").find("lng").text());
g.calculateBoundingBoxAndZoom(b,a)}},error:function(a,b,c){error(I18n.geonames_sqlite_call_failed.text)}})};this.calculateBoundingBoxAndZoom=function(a,b){var c=5E5;if("EPSG:4326"===g.proj4.projection.srsCode||"EPSG:50001"===g.proj4.projection.srsCode)c=5;var d=g.getPixelCoordFromLatLong({x:b,y:a}),d=g.getGeoCoordFromPixelCoord(d),e=new WMJSBBOX;e.left=d.x-c;e.bottom=d.y-c;e.right=d.x+c;e.top=d.y+c;g.zoomTo(e);g.positionMapPinByLatLon({x:b,y:a});g.draw("zoomIn")};this.getLatLongFromPixelCoord=function(a){var b=
new Proj4js.Point;try{b.x=a.x/I*(n.right-n.left)+n.left,b.y=a.y/D*(n.bottom-n.top)+n.top,this.proj4.srs!=v&&(this.proj4.projection=new Proj4js.Proj(v),this.proj4.srs=v),Proj4js.transform(this.proj4.projection,Wa,b)}catch(ma){return}return{x:b.x,y:b.y}};this.getPixelCoordFromGeoCoord=function(a,b,c,d){var e=I,l=D,f=n;isDefined(c)&&(e=c);isDefined(d)&&(l=d);isDefined(b)&&(f=b);return{x:e*(a.x-f.left)/(f.right-f.left),y:l*(a.y-f.top)/(f.bottom-f.top)}};this.addListener=function(a,b,c){return z.addToCallback(a,
b,c)};this.removeListener=function(a){return z.removeEvents(a)};this.getListener=function(a){return z};this.suspendEvent=function(a){z.suspendEvent(a)};this.resumeEvent=function(a){z.resumeEvent(a)};this.getDimensionList=function(){return L};this.getDimension=function(a){for(var b=0;b<L.length;b++)if(L[b].name==a)return L[b]};this.setDimension=function(a,b){if(isDefined(a)&&isDefined(b)){for(var c=void 0,d=0;d<L.length;d++)if(L[d].name==a){c=L[d];break}0==isDefined(c)&&(c={name:a,currentValue:b},
L.push(c));if(isDefined(c)){if(isDefined(void 0)&&(void 0).setValue(a,b),c.currentValue!=b){c.currentValue=b;if(1==g.buildLayerDimsBusy)alert("b");else for(a=0;a<L.length;a++)for(b=L[a],c=0;c<r.length;c++)for(d=0;d<r[c].dimensions.length;d++){var e=r[c].dimensions[d];if(1==e.linked&&e.name==b.name){if("current"==b.currentValue||"default"==b.currentValue||""==b.currentValue||"earliest"==b.currentValue||"middle"==b.currentValue||"latest"==b.currentValue)b.currentValue=e.getClosestValue(b.currentValue);
g.buildLayerDimsBusy=!0;e.setClosestValue(b.currentValue);g.buildLayerDimsBusy=!1}}z.triggerEvent("ondimchange")}}else error("WebMapJS::setDimension: Dimension "+a+" not found")}else error("Unable to set dimension with undefined value or name")};this.setLayerOpacity=function(a,b){if(a){a.opacity=b;var c=X;for(j=0;j<g.getNumLayers();j++)if(r[j].service&&r[j].enabled){if(a==r[j]){g.setBufferImageOpacity(ca,c,b);break}c++}}};this.zoomToLayer=function(a){var b=a;b||(b=za);if(b){for(var c=0;c<b.projectionProperties.length;c++)if(b.projectionProperties[c].srs==
v){a=b.projectionProperties[c].bbox.right-b.projectionProperties[c].bbox.left;var d=b.projectionProperties[c].bbox.top-b.projectionProperties[c].bbox.bottom,b=b.projectionProperties[c].bbox.clone();b.left-=a/100;b.right+=a/100;b.bottom-=d/100;b.top+=d/100;g.zoomTo(b);g.draw("zoomTolayer");return}error("Unable to find the correct bbox with current map projection "+v+" for layer "+b.title+". Using default bbox instead.")}g.zoomTo(ba);g.draw("zoomTolayer")};this.setPreviousExtent=function(){Ia=1;W++;
W>=sa&&(W=sa-1);g.setProjection(Y[W].srs,Y[W].bbox);g.draw("setPreviousExtent")};this.setNextExtent=function(){Ja=1;W--;0>W&&(W=0);g.setProjection(Y[W].srs,Y[W].bbox);g.draw("setNextExtent")};this.setBBOX=function(a,b,c,d){n.setBBOX(a,b,c,d);E.setBBOX(n);"GFI:TIME_ELEVATION"!=v&&(a=I/D,(n.right-n.left)/(n.top-n.bottom)>a?(b=(n.top+n.bottom)/2,a=(n.left-n.right)/2/a,n.bottom=b+a,n.top=b-a):(b=(n.right+n.left)/2,a*=(n.bottom-n.top)/2,n.left=b+a,n.right=b-a));C.setBBOX(n);T.setBBOX(n);if(0==Ja&&0==Ia){if(0!=
W){for(j=0;j<=W;j++)Ka[j]=Y[j];for(j=0;j<=W;j++)Y[j]=Ka[W-j];W=0}for(j=2;0<j;j--)Y[j].bbox.setBBOX(Y[j-1].bbox),Y[j].srs=Y[j-1].srs;Y[0].bbox.setBBOX(n);Y[0].srs=v;sa++;3<sa&&(sa=3)}Ia=Ja=0};this.zoomOut=function(){var a=(E.right-E.left)/6;this.zoomTo(new WMJSBBOX(E.left-a,E.bottom-a,E.right+a,E.top+a));g.draw("zoomOut")};this.zoomIn=function(a){var b=(E.left-E.right)/8;if(0==isDefined(a))a=1;else if(0==a)return;b*=a;this.zoomTo(new WMJSBBOX(E.left-b,E.bottom-b,E.right+b,E.top+b));g.draw("zoomIn")};
this.searchForLocation=function(a){g.WCJSSearchRequest(a)};this.hideControls=function(){B.style.display="none";$("#"+O("buttonzoomin")).hide();$("#"+O("buttonzoomout")).hide();$("#"+O("buttondragmap")).hide();$("#"+O("buttonzoombox")).hide();$("#"+O("buttonzoomhome")).hide()};this.addControls=function(a){B.style.display="";(function(a,b,c,d){var e=new Image;e.style.margin="0px";e.style.padding="2px 0px 2px 0px";e.style.border="0px solid #000000";e.src=a;e.unselect=function(){e.style.background="none";
e.style.padding="2px 0px 2px 0px";e.setOpacity(1);e.style.border="0px solid #000000";e.isSelected=void 0};e.select=function(){e.setOpacity(.6);e.style.padding="4px 0px 2px 4px";e.isSelected=!0};e.setOpacity=function(a){var b=parseFloat(a);e.style.opacity=1*b;e.style.filter="alpha(opacity="+100*b+")";1==a&&(e.style.filter="")};e.myClick=function(a){preventdefault_event(a);var c=getClick_X(a)-(void 0).left;a=getClick_Y(a)-(void 0).top;if(e.radiogroup)for(c=0;c<B.childNodes.length;c++)B.childNodes[c].radiogroup&&
B.childNodes[c].radiogroup==e.radiogroup&&(e==B.childNodes[c]?void 0==e.isSelected?(B.childNodes[c].select(),b()):(B.childNodes[c].unselect(),d()):B.childNodes[c].unselect());else b(c,a-2)};e.onclick=e.myClick;c&&(e.radiogroup=c);B.appendChild(e)})(WMSControlsImageSrc,function(a,b){g.setMapModeNone();var c=.25*(n.right-n.left);0<=a&&18>a&&20<=b&&38>b&&g.zoomTo(new WMJSBBOX(n.left-c,n.bottom,n.right-c,n.top));20<=a&&38>a&&0<=b&&18>b&&g.zoomTo(new WMJSBBOX(n.left,n.bottom+c,n.right,n.top+c));40<=a&&
58>a&&20<=b&&38>b&&g.zoomTo(new WMJSBBOX(n.left+c,n.bottom,n.right+c,n.top));20<=a&&38>a&&40<=b&&58>b&&g.zoomTo(new WMJSBBOX(n.left,n.bottom-c,n.right,n.top-c));20<=a&&38>a&&20<=b&&38>b&&(g.setMapModeNone(),g.zoomToLayer(g.getActiveLayer()));0<=a&&18>a&&64<=b&&90>b&&g.setMapModeZoomBoxIn();20<=a&&38>a&&64<=b&&90>b&&g.setMapModePan();40<=a&&58>a&&64<=b&&90>b&&g.setMapModeGetInfo();20<=a&&38>a&&90<=b&&106>b&&g.zoomIn();20<=a&&38>a&&110<=b&&126>b&&g.zoomOut()});B.style.height="156px";var b=function(){B.style.left=
"5px";B.style.top=g.getSize().height-parseInt(B.style.height)+"px"};b();g.addListener("onresize",b,!0);g.addListener("onlayersready",function(){var a=g.getActiveLayer(),b=a.dimensions[0];"time"!=b.name||a.timeRange||(a.timeRange=new parseISOTimeRangeDuration(b.values))},!0);a&&a.showGetFeatureInfoWindow&&(g.addListener("beforegetfeatureinfo",function(a){},!0),g.addListener("ongetfeatureinfoready",function(a){},!0))};this.displayLegendInMap=function(a){ja=a;g.repositionLegendGraphic()};this.showBoundingBox=
function(a,b){isDefined(a)&&(A.bbox=a,A.style.display="",A.displayed=!0);!0===A.displayed&&(a=n,isDefined(b)&&(a=b),b=this.getPixelCoordFromGeoCoord({x:A.bbox.left,y:A.bbox.top},a),a=this.getPixelCoordFromGeoCoord({x:A.bbox.right,y:A.bbox.bottom},a),A.style.left=b.x-1+"px",A.style.top=b.y-2+"px",A.style.width=a.x-b.x+"px",A.style.height=a.y-b.y-1+"px")};this.hideBoundingBox=function(){A.style.display="none";A.displayed=!1};this.getOverlayElement=function(){return t};this.setDebugFunction=function(a){debug=
a};this.setErrorFunction=function(a){error=a};(function(){var b;var c=O("baseDiv");jQuery("<div/>",{id:c,css:{position:"relative",overflow:"hidden",width:a.style.width,height:a.style.height,border:"0px  solid black",margin:0,padding:0,clear:"both",left:"0px",top:"0px"}}).appendTo(a);p=$("#"+c);c=O("overlayDiv");jQuery("<div/>",{id:c,css:{position:"relative",overflow:"hidden",zIndex:100,width:a.style.width-2,height:a.style.height-2,border:"0px  solid black",margin:0,padding:0,clear:"both",left:"0px",
top:"0px",boxSizing:"border-box",pointerEvents:"none",background:"none",backgroundColor:"none"}}).appendTo(p);t=$("#"+c);p.css("cursor","default");a.style.margin="0px";a.style.padding="0px";a.style.border="none";a.style.lineHeight="0px";a.style.display="block";J.style.position="absolute";J.style.display="none";J.style.border="2px dashed #000000";J.style.margin="0px";J.style.padding="0px";J.style.lineHeight="0";J.style.background="#AFFFFF";J.style.opacity="0.3";J.style.filter="alpha(opacity=30)";J.style.left=
"0px";J.style.top="0px";J.style.width="100px";J.style.height="100px";J.style.zIndex=1E3;J.oncontextmenu=function(){return!1};p.append(J);A.style.position="absolute";A.style.display="none";A.style.border="3px solid #6060FF";A.style.margin="0px";A.style.padding="0px";A.style.lineHeight="0";A.style.left="0px";A.style.top="0px";A.style.width="100px";A.style.height="100px";A.style.zIndex=1E3;A.oncontextmenu=function(){return!1};p.append(A);B.style.position="absolute";B.style.display="none";B.style.border=
"0px solid #808080";B.style.margin="0px";B.style.padding="4px";B.style.lineHeight="0";B.style.background="none";B.style.left="5px";B.style.top="0px";B.style.width="32px";B.style.height="138px";B.style.zIndex=2E3;B.oncontextmenu=function(){return!1};p.append(B);u.style.position="absolute";u.style.display="none";u.style.border="none";u.style.margin="0px";u.style.padding="0px";u.style.lineHeight="0";u.style.background="none";u.style.opacity="1.0";u.style.filter="alpha(opacity=100)";u.style.left="0px";
u.style.top="0px";u.style.width="100px";u.style.height="100px";u.style.zIndex=1E3;u.oncontextmenu=function(){return!1};p.append(u);aa.style.position="absolute";aa.style.zIndex=1E3;aa.style.width="auto";aa.style.height="auto";aa.style.background="none";aa.oncontextmenu=function(){return!1};aa.innerHTML="";p.append(aa);p.append(Ha);M.style.display="none";M.style.position="absolute";M.style.zIndex=800;M.style.background="none";M.style.display="";M.style.left="4px";M.style.bottom="4px";M.style.width=
"400px";M.style.height="20px";p.append(M);w.style.display="none";w.style.position="absolute";w.style.zIndex=800;w.style.background="none";w.style.display="";w.style.left="4px";w.style.bottom="25px";w.style.lineHeight="10px";w.style.fontSize="9px";w.style.fontStyle="normal";w.style.fontFamily="Verdana, Arial, Helvetica";w.style.padding="0px";w.style.margin="0px";p.append(w);jQuery("<div/>",{id:O("buttonzoomin"),css:{position:"absolute",right:"30px",top:"-8px",width:"48px",height:"48px",margin:"0px",
padding:"0px",zIndex:3E3},mousedown:function(a){a.stopPropagation();preventdefault_event(a)},click:function(){g.zoomIn()}}).appendTo(p);var d=jQuery("<div/>",{id:O("buttonzoombox"),css:{position:"absolute",right:"30px",top:"42px",width:"48px",height:"48px",margin:"0px",padding:"0px",zIndex:3E3},mousedown:function(a){a.stopPropagation();preventdefault_event(a)},click:function(){g.setMapModeZoomBoxIn();d.iconbutton({icons:{primary:"wmjs-icon-zoombox-activated"}});e.iconbutton({icons:{primary:"wmjs-icon-dragpan"}})}}).appendTo(p);
jQuery("<div/>",{id:O("buttonzoomhome"),css:{position:"absolute",right:"30px",top:"87px",width:"48px",height:"48px",margin:"0px",padding:"0px",zIndex:3E3},mousedown:function(a){a.stopPropagation();preventdefault_event(a)},click:function(){g.zoomToLayer()}}).appendTo(p);"undefined"!==typeof defaultUsernameSearch&&(jQuery("<div/>",{id:O("searchboxdiv"),mousedown:function(a){a.stopPropagation()}}).addClass("webmapjs_searchboxdiv").html("<input class='webmapjs_locationfield' type='text' name='searchtextfield' id='searchtextfield' placeholder="+
I18n.place_search_term.text+" />",{mousedown:function(a){a.stopPropagation();preventdefault_event(a)}}).appendTo(p),jQuery("<button/>",{id:O("searchboxbutton"),mousedown:function(a){a.stopPropagation()},click:function(){var a=$("#searchtextfield").attr("value");g.searchForLocation(a)}}).addClass("webmapjs_locationbutton").appendTo(p),$("#searchtextfield").keypress(function(a){if(13==a.which)return a=$("#searchtextfield").attr("value"),g.searchForLocation(a),!1}));var e=jQuery("<div/>",{id:O("buttondragmap"),
css:{position:"absolute",right:"30px",top:"135px",width:"48px",height:"48px",margin:"0px",padding:"0px",zIndex:3E3},mousedown:function(a){a.stopPropagation();preventdefault_event(a)},click:function(){g.setMapModePan();e.iconbutton({icons:{primary:"wmjs-icon-dragpan-activated"}});d.iconbutton({icons:{primary:"wmjs-icon-zoombox"}})}}).appendTo(p);jQuery("<div/>",{id:O("buttonzoomout"),css:{position:"absolute",right:"30px",top:"181px",width:"48px",height:"48px",margin:"0px",padding:"0px",zIndex:2E3},
mousedown:function(a){a.stopPropagation();preventdefault_event(a)},mouseup:function(a){a.stopPropagation();preventdefault_event(a)},click:function(a){a.stopPropagation();preventdefault_event(a);g.zoomOut()}}).appendTo(p);$("#"+O("buttonzoomout")).click(function(a){a.stopPropagation()});$("#"+O("buttonzoomin")).iconbutton({text:!1,icons:{primary:"wmjs-icon-zoomin"}});$("#"+O("buttonzoomhome")).iconbutton({text:!1,icons:{primary:"wmjs-icon-zoomhome"}});$("#"+O("buttonzoombox")).iconbutton({text:!1,
icons:{primary:"wmjs-icon-zoombox"}});$("#"+O("buttondragmap")).iconbutton({text:!1,icons:{primary:"wmjs-icon-dragpan-activated"}});$("#"+O("buttonzoomout")).iconbutton({text:!1,icons:{primary:"wmjs-icon-zoomout"}});q();n.left=-180;n.bottom=-90;n.right=180;n.top=90;v="EPSG:4326";g.setSize(a.style.width,a.style.height);for(var f=0;2>f;f++)"WMJSDivBuffer"==g.renderer?b=new WMJSDivBuffer(z,"imagebuffer",na,g.getWidth(),g.getHeight()):"WMJSCanvasBuffer"==g.renderer&&(b=new WMJSCanvasBuffer(z,"imagebuffer",
na,g.getWidth(),g.getHeight())),c=function(a){for(var b=0;2>b;b++)K[b].imageLoadComplete(a);Ra.checkAnimation()},na.setLoadEventCallback(c),K.push(b),p.append(b.getBuffer());for(f=0;2>f;f++)b=new WMJSDivBuffer(z,"legendbuffer",Ga),c=function(a){for(var b=0;2>b;b++)U[b].imageLoadComplete(a)},Ga.setLoadEventCallback(c),U.push(b),p.append(b.div);z.addToCallback("draw",g.draw,!0);Ra=new WMJSAnimate(g);Oa=1})()};WMJSEmptyLayerName="empty_layer";WMJSEmptyLayerTitle="empty layer";
function WMJSLayer(a){this.getlegendgraphicURL=this.getfeatureinfoURL=this.getmapURL=this.WMJSService=this.service=void 0;this.keepOnTop=!1;this.transparent=!0;this.hasError=!1;this.legendIsDimensionDependant=!0;this.wms130bboxcompatibilitymode=!1;this.version=WMSVersion.version111;this.path="";this.objectpath=[];this.wmsextensions=function(a){this.wmsextensions.colorscalerange="";isDefined(a.colorscalerange)&&(this.wmsextensions.colorscalerange=a.colorscalerange);this.wmsextensions.url="";2<this.wmsextensions.colorscalerange.length&&
(this.wmsextensions.url+="&COLORSCALERANGE="+this.wmsextensions.colorscalerange)};this.wmsextensions.url="";this.name=this.jsonlayer_v1_1_1=void 0;this.title=WMJSEmptyLayerTitle;this.abstract=void 0;this.dimensions=[];this.legendGraphic="";this.projectionProperties=[];this.queryable=!1;this.enabled=!0;this.styles=void 0;this.currentStyle="";this.id=-1;this.opacity=1;this.getCapabilitiesDoc=this.image=void 0;this.serviceTitle="not defined";this.onReady=function(a){};this.parentMaps=[];this.getLayerName=
function(){return this.name};this.setOpacity=function(a){this.opacity=a;this.image&&(this.image.setOpacity(this.opacity),this.parentMaps[0].redrawBuffer())};this.remove=function(){for(var a=0;a<this.parentMaps.length;a++)this.parentMaps[a].deleteLayer(this),this.parentMaps[a].draw("WMJSLayer::remove")};this.moveUp=function(){for(var a=0;a<this.parentMaps.length;a++)this.parentMaps[a].moveLayerUp(this),this.parentMaps[a].draw("WMJSLayer::moveUp")};this.moveDown=function(){for(var a=0;a<this.parentMaps.length;a++)this.parentMaps[a].moveLayerDown(this),
this.parentMaps[a].draw("WMJSLayer::moveDown")};this.zoomToLayer=function(){for(var a=0;a<this.parentMaps.length;a++)this.parentMaps[a].zoomToLayer(this)};this.draw=function(a){for(var c=0;c<this.parentMaps.length;c++)this.parentMaps[c].draw("WMJSLayer::draw::"+a)};this.setDimension=function(a,e){for(var c=void 0,b=0;b<this.dimensions.length;b++)this.dimensions[b].name==a&&(c=this.dimensions[b]);if(0!=isDefined(c)&&0!=isDefined(e)&&(c.setValue(e),1==c.linked))for(b=0;b<this.parentMaps.length;b++)this.parentMaps[b].setDimension(a,
c.getValue())};this.configureDimensions=function(){var a=this.jsonlayer_v1_1_1;if(a){for(var e=toArray(a.Dimension),f=this.objectpath.length-1;0<=f;f--){var b=this.objectpath[f].Dimension;if(!isNull(b)&&isDefined(b))for(var d=0;d<b.length;d++){var k=b[d];if(!isNull(k)&&isDefined(k)){for(var m=!1,q=0;q<e.length;q++)if(k.attr.name.toLowerCase()===e[f].attr.name.toLowerCase()){m=!0;break}m||e.push(k)}}}a=toArray(a.Extent);this.dimensions=[];for(f=0;f<e.length;f++){b=new WMJSDimension;b.name=e[f].attr.name.toLowerCase();
b.units=e[f].attr.units;for(q=0;q<a.length;q++)a[q].attr.name.toLowerCase()==b.name&&(b.values=a[q].value?a[q].value.trim():"",a[q].attr["default"]?b.defaultValue=a[q].attr["default"].trim():(d=b.values.split("/"),1<d.length?b.defaultValue=d[1]:0<d.length&&(b.defaultValue=d[0])),a[q].value||(error("No extent defined for dim "+b.name+" in layer "+this.title),error("Using default value "+b.defaultValue),b.values=b.defaultValue));this.version==WMSVersion.version130&&(b.values=e[f].value,b.defaultValue=
e[f].attr["default"]);q=b.defaultValue;0<this.parentMaps.length?(d=this.parentMaps[0].getDimension(b.name),isDefined(d)&&(isDefined(d.currentValue)?(q=b.getClosestValue(d.currentValue),debug("WMJSLayer::configureDimensions Dimension "+b.name+" default value ["+q+"] is based on map value ["+d.currentValue+"]")):debug("WMJSLayer::configureDimensions Map dimension currentValue for "+b.name+" does not exist."))):debug("WMJSLayer::configureDimensions Layer has no parentmaps");b.currentValue=q;b.parentLayer=
this;isDefined(b.values)?this.dimensions.push(b):error("Skipping dimension "+b.name)}}};this.parseLayer=function(c,e,f){var b=this;b.hasError=!1;var d=function(a){isDefined(c)&&c(a)},k=function(c,e){b.hasError=!0;b.lastError=e;b.title=I18n.service_has_error.text;error(e);d(c);isDefined(a.failure)&&a.failure(c,e)};b.WMJSService=WMJSgetServiceFromStore(this.service);b.WMJSService.getCapabilities(function(a){(function(a,b){function c(b,d,e){for(var f=[],m=0;m<e.length;m++)f.push(e[m]);f.push(b);for(e=
0;e<b.length;e++)if(b[e].Layer){m=d;try{m+=b[e].Title.value+"/"}catch(M){}c(toArray(b[e].Layer),m,f)}else if(b[e].Name&&b[e].Name.value==a.name){r(b[e],d,f);break}}if(0==b||void 0==b)a.title=I18n.service_has_error.text,a.abstract=I18n.not_available_message.text,k(a,I18n.unable_to_connect_server.text);else{try{var e=a.WMJSService.getCapabilityElement(b)}catch(L){k(a,L);return}a.version=a.WMJSService.version;var f=e.Layer;if(isDefined(f)){try{a.serviceTitle=f.Title.value}catch(L){a.serviceTitle="Unnamed service"}try{for(var m=
e.Request.GetMap.Format,q=0;q<m.length;q++)m[q].value.indexOf("24"),m[q].value.indexOf("32")}catch(L){error("This WMS service has no getmap formats listed: using image/png")}if(void 0==a.name||1>a.name.length)a.title=WMJSEmptyLayerTitle,a.abstract=I18n.not_available_message.text,d(a);else{var p=0,r=function(c,d,m){a.jsonlayer_v1_1_1=c;a.getmapURL=void 0;try{a.getmapURL=e.Request.GetMap.DCPType.HTTP.Get.OnlineResource.attr["xlink:href"]}catch(w){}isDefined(a.getmapURL)||(a.getmapURL=a.service,error("GetMap OnlineResource is not specified. Using default."));
a.getfeatureinfoURL=void 0;try{a.getfeatureinfoURL=e.Request.GetFeatureInfo.DCPType.HTTP.Get.OnlineResource.attr["xlink:href"]}catch(w){}isDefined(a.getfeatureinfoURL)||(a.getfeatureinfoURL=a.service,error("GetFeatureInfo OnlineResource is not specified. Using default."));a.getlegendgraphicURL=void 0;try{a.getlegendgraphicURL=e.Request.GetLegendGraphic.DCPType.HTTP.Get.OnlineResource.attr["xlink:href"]}catch(w){}isDefined(a.getlegendgraphicURL)||(a.getlegendgraphicURL=a.service,error("GetLegendGraphic OnlineResource is not specified. Using default."));
a.getmapURL=WMJScheckURL(a.getmapURL);a.getfeatureinfoURL=WMJScheckURL(a.getfeatureinfoURL);a.getlegendgraphicURL=WMJScheckURL(a.getlegendgraphicURL);a.getCapabilitiesDoc=b;a.title=c.Title.value;try{a.abstract=c.Abstract.value}catch(w){a.abstract=I18n.not_available_message.text}a.path=d;a.objectpath=m;a.styles=void 0;a.jsonlayer=a;try{d="";c.Style&&(d=toArray(c.Style));a.styles=d;for(var g=0;g<a.styles.length;g++){var k=a.styles[g];k.index=g;k.nrOfStyles=a.styles.length;k.title="default";k.name="default";
k.legendURL="";k.abstracttext="No abstract available";try{k.title=k.Title.value}catch(w){}try{k.name=k.Name.value}catch(w){}try{k.legendURL=k.LegendURL.OnlineResource.attr["xlink:href"]}catch(w){}try{k.abstracttext=k.Abstract.value}catch(w){}}""==a.currentStyle&&(a.currentStyle=a.styles[0].Name.value);a.setStyle(a.currentStyle)}catch(w){a.currentStyle="",a.styles="",error("No styles found for layer "+a.title)}a.configureDimensions();k=toArray(c.SRS);isDefined(c.CRS)&&(k=toArray(c.CRS));a.projectionProperties=
[];var q=[];d=function(b){if(isDefined(b.BoundingBox))for(b=toArray(b.BoundingBox),g=0;g<b.length;g++){var c=b[g].attr.SRS;isDefined(b[g].attr.CRS)&&(c=b[g].attr.CRS);c&&0<c.length&&(c=decodeURIComponent(c));for(var d=!1,e=0;e<a.projectionProperties.length;e++)if(c==a.projectionProperties[e].srs){d=!0;break}0==d&&(d=new WMJSProjection,d.srs=c,c=!1,a.version==WMSVersion.version130&&"EPSG:4326"==d.srs&&0==a.wms130bboxcompatibilitymode&&(c=!0),0==c?(d.bbox.left=parseFloat(b[g].attr.minx),d.bbox.bottom=
parseFloat(b[g].attr.miny),d.bbox.right=parseFloat(b[g].attr.maxx),d.bbox.top=parseFloat(b[g].attr.maxy)):(d.bbox.left=parseFloat(b[g].attr.miny),d.bbox.bottom=parseFloat(b[g].attr.minx),d.bbox.right=parseFloat(b[g].attr.maxy),d.bbox.top=parseFloat(b[g].attr.maxx)),a.projectionProperties.push(d),q.push(d.srs))}};d(c);d(f);for(g=0;g<k.length;g++)-1==q.indexOf(k[g].value)&&(d=new WMJSProjection,error("Warning: BoundingBOX missing for SRS "+k[g].value),d.bbox.left=-180,d.bbox.bottom=-90,d.bbox.right=
180,d.bbox.top=90,d.srs=k[g].value,a.projectionProperties.push(d));q="";a.queryable=!1;try{1==parseInt(c.attr.queryable)?a.queryable=!0:a.queryable=!1}catch(w){error("Unable to detect whether this layer is queryable (for layer "+a.title+")")}p=1},m=toArray(f.Layer),q=[];q.push(f);c(m,"",q);if(0==p)return m="",m=a.name?"Unable to find layer '"+a.name+"' in service '"+a.service+"'":"Unable to find layer '"+a.title+"' in service '"+a.service+"'",a.title="--- layer not found in service ---",a.abstract=
I18n.not_available_message.text,k(a,m),a;if(a.onReady)a.onReady(a);d(a);return a}}else k(a,"No Layer element in service")}})(b,a)},function(a){k(b,a)},e)};this.cloneLayer=function(){var a=new WMJSLayer;for(i in this)a[i]=this[i];return a};this.setName=function(a){this.name=a;this.parseLayer(void 0,void 0,"WMJSLayer::setName")};this.getLayerRelative=function(a,e,f){isDefined(f)||(f=0);var b=this;b.WMJSService.getLayerObjectsFlat(function(c){for(var d=-1,m=0;m<c.length;m++)if(c[m].name==b.name){d=m;
break}-1==d?e("Current layer ["+b.name+"] not in this service"):(-1===f&&d--,1===f&&d++,d>c.length-1&&(d=0),0>d&&(d=c.length-1),a(c[d],d,c.length))},e)};this.autoSelectLayer=function(a,e){this.WMJSService.getLayerObjectsFlat(function(c){for(var b=0;b<c.length;b++)if(isDefined(c[b].name)&&-1==c[b].name.indexOf("baselayer")&&-1==c[b].path.indexOf("baselayer")){a(c[b]);break}},e)};this.getNextLayer=function(a,e){this.getLayerRelative(a,e,1)};this.getPreviousLayer=function(a,e){this.getLayerRelative(a,
e,-1)};this.setStyle=function(a){debug("WMJSLayer::setStyle: "+a);if(0==this.styles.length)this.legendGraphic=this.currentStyle="",debug("Layer has no styles.");else{for(var c=0;c<this.styles.length;c++)if(this.styles[c].name==a){this.legendGraphic=this.styles[c].legendURL;this.currentStyle=this.styles[c].name;return}debug("WMJSLayer::setStyle: Style "+a+" not found, setting style "+this.styles[0].name);this.currentStyle=this.styles[0].name;this.legendGraphic=this.styles[0].legendURL}};this.getStyleObject=
function(a,e){if(0!=isDefined(this.styles))for(var c=0;c<this.styles.length;c++)if(this.styles[c].name==a)return-1===e&&c--,1===e&&c++,0>c&&(c=this.styles.length-1),c>this.styles.length-1&&(c=0),this.styles[c].nrOfStyles=this.styles.length,this.styles[c].index=c,this.styles[c]};this.getStyle=function(){return this.currentStyle};this.setService=function(a){this.getgraphinfoURL=this.getlegendgraphicURL=this.getfeatureinfoURL=this.getmapURL=this.service=a};this.getDimension=function(a){for(var c=0;c<
this.dimensions.length;c++)if(this.dimensions[c].name==a)return this.dimensions[c]};this.getProjection=function(a){for(var c=0;c<this.projectionProperties.length;c++)if(this.projectionProperties[c].srs==a)return a=[],a.srs=this.projectionProperties[c].srs+"",a.bbox=new WMJSBBOX(this.projectionProperties[c].bbox.left,this.projectionProperties[c].bbox.bottom,this.projectionProperties[c].bbox.right,this.projectionProperties[c].bbox.top),a};this.display=function(a){this.enabled=a;for(a=0;a<this.parentMaps.length;a++)this.parentMaps[a].displayLayer(this,
this.enabled)};a&&(this.getlegendgraphicURL=this.getfeatureinfoURL=this.getmapURL=this.service=a.service,this.name=a.name,a.getgraphinfoURL&&(this.getgraphinfoURL=a.getgraphinfoURL),a.style&&(this.currentStyle=a.style),this.format=a.format?a.format:"image/png",a.opacity&&(this.opacity=a.opacity),a.title&&(this.title=a.title),this.abstract=I18n.not_available_message.text,!1===a.enabled&&(this.enabled=!1),1==a.keepOnTop&&(this.keepOnTop=!0),!0===a.transparent&&(this.transparent=!0),!1===a.transparent&&
(this.transparent=!1),isDefined(a.onReady)&&(this.onReady=a.onReady,this.parseLayer(void 0,void 0,"WMJSLayer::configOptions")))};function WMJSBBOX(a,c,e,f){this.left=-180;this.bottom=-90;this.right=180;this.top=90;this.clone=function(a){void 0==a&&(a=this);var b=new WMJSBBOX;b.left=a.left;b.bottom=a.bottom;b.right=a.right;b.top=a.top;return b};this.setBBOX=function(a,c,e,f){if(void 0==a)this.left=-180,this.bottom=-90,this.right=180,this.top=90;else{if(!c)if("object"==typeof a){var b=a;void 0==b.length?(a=b.left,c=b.bottom,e=b.right,f=b.top):(a=parseFloat(b[0]),c=parseFloat(b[1]),e=parseFloat(b[2]),f=parseFloat(b[3]))}else try{b=
a.split(","),4!=b.length&&error("Invalid map bounding box: '"+a+"'"),a=parseFloat(b[0]),c=parseFloat(b[1]),e=parseFloat(b[2]),f=parseFloat(b[3])}catch(p){}if(void 0==a||void 0==c||void 0==e||void 0==f)void 0==a&&(a=-180),void 0==e&&(e=180),void 0==c&&(c=-90),void 0==f&&(f=90);this.left=a;this.bottom=c;this.right=e;this.top=f}};this.equals=function(a){return this.left==a.left&&this.right==a.right&&this.top==a.top&&this.bottom==a.bottom?!0:!1};this.toString=function(){return this.left+","+this.bottom+
","+this.right+","+this.top};this.setBBOX(a,c,e,f)};WMJSDateOutSideRange="outside range";WMJSDateTooEarlyString="date too early";WMJSDateTooLateString="date too late";
function WMJSDimension(a){this.parentLayer=this.defaultValue=this.currentValue=this.values=this.units=this.name=void 0;this.linked=!0;isDefined(a)&&(isDefined(a.name)&&(this.name=a.name),isDefined(a.units)&&(this.units=a.units),isDefined(a.values)&&(this.values=a.values),isDefined(a.currentValue)&&(this.currentValue=a.currentValue),isDefined(a.defaultValue)&&(this.defaultValue=a.defaultValue),isDefined(a.parentLayer)&&(this.parentLayer=a.parentLayer),isDefined(a.linked)&&(this.linked=a.linked));var c=
!1,e,f=[],b=void 0,d=[],k=function(a){if(1!=c&&isDefined(a.values)){c=!0;"ISO8601"==a.units?0<a.values.indexOf("/")?(b="timestartstopres",e=new parseISOTimeRangeDuration(a.values)):b="timevalues":(b="anyvalue",a.linked=!1);if("timestartstopres"!=b){for(var m=a.values.split(","),k=0;k<m.length;k++){var t=m[k].split("/");if(3==t.length){var k=parseFloat(t[0]),v=parseFloat(t[1]),t=parseFloat(t[2]),v=v+t;k>v&&(v=k);for(0>=t&&(t=1);k<v;k+=t)d.push(k)}else d.push(m[k])}if("timevalues"==b)for(k=0;k<d.length;k++)f[k]=
parseISO8601DateToDate(d[k])}isDefined(a.defaultValue)||(a.defaultValue=a.getValueForIndex(0));isDefined(a.currentValue)||(a.currentValue=a.getValueForIndex(0))}};this.getValue=function(){return isDefined(this.currentValue)?this.currentValue:this.defaultValue};this.setValue=function(a){a!=WMJSDateOutSideRange&&a!=WMJSDateTooEarlyString&&a!=WMJSDateTooLateString&&(this.currentValue=a)};this.setClosestValue=function(a){this.currentValue=this.getClosestValue(a)};this.getClosestValue=function(a){var b=
-1,c=WMJSDateOutSideRange;try{b=this.getIndexForValue(a),c=this.getValueForIndex(b)}catch(t){"number"==typeof t&&(c=0==t?WMJSDateTooEarlyString:WMJSDateTooLateString)}"current"==a||"default"==a||""==a?c=this.defaultValue:"latest"==a?c=this.getValueForIndex(dim.size()-1):"earliest"==a?c=this.getValueForIndex(0):"middle"==a&&(a=this.size()/2-1,0>a&&(a=0),c=this.getValueForIndex(a));return c};this.getValueForIndex=function(a){k(this);if(0>a)return-1==a?WMJSDateTooEarlyString:-2==a?WMJSDateTooLateString:
-1;if("timestartstopres"==b){try{return e.getDateAtTimeStep(a).toISO8601()}catch(q){}return e.getDateAtTimeStep(a)}if("timevalues"==b||"anyvalue"==b)return d[a]};this.get=function(a){return this.getValueForIndex(a)};this.getIndexForValue=function(a,c){k(this);isDefined(c)||(c=!0);if("string"==typeof a&&"current"==a&&"current"!=this.defaultValue)return this.getIndexForValue(this.defaultValue);if("timestartstopres"==b)try{return"string"==typeof a?e.getTimeStepFromISODate(a,c):e.getTimeStepFromDate(a,
c)}catch(E){return 0==parseInt(E)?-1:-2}if("timevalues"==b)try{var m=parseISO8601DateToDate(a).getTime(),q;for(c=a=0;c<d.length;c++){var v=f[c].getTime()-m;0>v&&(v=-v);0==c&&(q=v);v<q&&(q=v,a=c)}return a}catch(E){return error("WMSJDimension::getIndexForValue,2: "+E),-1}if("anyvalue"==b)for(c=0;c<d.length;c++)if(d[c]==a)return c;return-1};this.size=function(){k(this);if("timestartstopres"==b)return e.getTimeSteps();if("timevalues"==b||"anyvalue"==b)return d.length};this.clone=function(){var a=new WMJSDimension;
a.name=this.name;a.units=this.units;a.values=this.values;a.currentValue=this.currentValue;a.defaultValue=this.defaultValue;a.parentLayer=this.parentLayer;a.linked=this.linked;return a};k(this)};var WMSVersion={version100:"1.0.0",version111:"1.1.1",version130:"1.3.0"},WMJSGetCapabilities=function(a,c,e,f){if(0==isDefined(a))f(I18n.no_service_defined.text);else if(0==a.length)f(I18n.service_url_empty.text);else{try{isDefined(xml2jsonrequestURL)}catch(d){xml2jsonrequestURL=base+"/php/xml2jsonrequest.php?"}try{isDefined(requestProxy)}catch(d){requestProxy=base+"/php/MakeRequest.php?"}var b=xml2jsonrequestURL+"request=";-1==a.indexOf("?")&&(a+="?");debug("GetCapabilities:");a+="&service=WMS&request=GetCapabilities";
debug("<a target='_blank' href='"+a+"'>"+a+"</a>",!1);b+=URLEncode(a);debug(b);debug(URLEncode(a));debug(a);$.ajax({dataType:"jsonp",url:b,success:e,error:function(a){f(I18n.unable_to_do_getcapabilities.text+":\n"+b+"\n"+I18n.result.text+":\n"+a)}})}},WMJSServiceStore=[],WMJSgetServiceFromStore=function(a){for(var c=0;c<WMJSServiceStore.length;c++)if(WMJSServiceStore[c].service==a)return WMJSServiceStore[c];a=new WMJSService({service:a});WMJSServiceStore.push(a);return a};
function WMJSService(a){function c(a,b){return a.sort(function(a,c){a=a[b];c=c[b];return a<c?-1:a>c?1:0})}this.abstract=this.onlineresource=this.title=this.service=void 0;this.version=WMSVersion.version111;this.getcapabilitiesDoc=void 0;this.busy=!1;var e=void 0,f=this;a&&(this.service=a.service,this.title=a.title);this.getCapabilityElement=function(a){try{var b=a.WMT_MS_Capabilities.Capability}catch(m){try{b=a.WMS_Capabilities.Capability}catch(q){throw I18n.no_capability_element_found.text;}}if(!isDefined(b))throw I18n.no_capability_element_found.text;
return b};this.checkVersion=function(a){var b=WMSVersion.version111;try{WMSVersion.version100==a.WMT_MS_Capabilities.attr.version&&(b=WMSVersion.version100),WMSVersion.version111==a.WMT_MS_Capabilities.attr.version&&(b=WMSVersion.version111),WMSVersion.version130==a.WMT_MS_Capabilities.attr.version&&(b=WMSVersion.version130)}catch(m){try{WMSVersion.version100==a.WMS_Capabilities.attr.version&&(b=WMSVersion.version100),WMSVersion.version111==a.WMS_Capabilities.attr.version&&(b=WMSVersion.version111),
WMSVersion.version130==a.WMS_Capabilities.attr.version&&(b=WMSVersion.version130)}catch(q){throw f.checkException(a);}}return b==WMSVersion.version111||b==WMSVersion.version130?b:WMSVersion.version111};var b=[];this.getCapabilities=function(a,c,f){e=void 0;var d=this;if(this.busy)a={callback:a,fail:c},b.push(a);else if(d.getcapabilitiesDoc&&1!=f)a(this.getcapabilitiesDoc);else{d.busy=!0;var k=function(a){d.busy=!1;for(var c=0;c<b.length;c++)b[c].fail(a),b[c].fail=function(){};b=[]};a={callback:a,
fail:c};b.push(a);WMJSGetCapabilities(this.service,!1,function(a){d.busy=!1;d.getcapabilitiesDoc=a;try{d.version=d.checkVersion(a)}catch(E){k(E);return}var c=a.WMS_Capabilities;c||(c=a.WMT_MS_Capabilities);try{d.abstract=c.Service.Abstract.value}catch(E){this.abstract=I18n.not_available_message.text}try{d.title=c.Service.Title.value}catch(E){this.title=I18n.not_available_message.text}try{d.onlineresource=c.Service.OnlineResource.value?c.Service.OnlineResource.value:c.Service.OnlineResource.attr["xlink:href"]}catch(E){d.onlineresource=
I18n.not_available_message.text}for(c=0;c<b.length;c++)b[c].callback(a),b[c].callback=function(){};b=[];d.busy=!1},k)}};this.checkException=function(a){if(a.ServiceExceptionReport){var b="Undefined";if(a=a.ServiceExceptionReport.ServiceException){try{a.attr.code&&(b=a.attr.code)}catch(m){}if(a.value)return a=a.value,"Exception: "+b+".\n"+a}return I18n.wms_service_exception_code.text+b}};this.getNodes=function(a,b,e){this.nodeCache=void 0;b||(b=function(a){error(a)});var d=function(d){function e(a,
b,d){for(var f=0;f<a.length;f++){var k=!1;a[f].Name&&(k=!0);try{a[f].Layer&&(k=!1)}catch(F){}a[f].Name?k={name:a[f].Name.value,text:a[f].Title.value,leaf:k,path:d}:(isNull(a[f].Title)&&(a[f].Title=[],a[f].Title.value="Layer"),k={text:a[f].Title.value,leaf:k});b.push(k);a[f].Layer&&(k.children=[],e(toArray(a[f].Layer),k.children,d+a[f].Title.value))}c(b,"text")}var k={},m=f.getCapabilityElement(d).Layer;try{f.version=f.checkVersion(d)}catch(ba){b(ba);return}d=toArray(m.Layer);try{k.text=m.Title.value}catch(ba){k.text=
I18n.unnamed_service.text}k.leaf=!1;k.expanded=!0;k.children=[];e(d,k.children,"");a(k)};this.getCapabilities(function(a){d(a)},function(a){b(a)},e)};this.getLayerNames=function(a,b){this.getNodes(function(b){var c=[],d=function(a){for(var b=0;b<a.length;b++)a[b].name&&c.push(a[b].name),a[b].children&&d(a[b].children)};d(b.children);a(c)},b)};this.getLayerObjectsFlat=function(a,b){isDefined(e)&&a(e);this.getNodes(function(b){var c=[],d=function(a){for(var b=0;b<a.length;b++)a[b].name&&c.push(a[b]),
a[b].children&&d(a[b].children)};d(b.children);a(c)},b)}};function WMJSListener(){function a(){this.functionpointer=this.name=void 0;this.finished=0;this.keepOnCall=!1}var c=[],e=0,f=[],b=this;this.addToCallback=function(b,f,m){var d=-1;m||(m=!1);for(var k=0;k<e;k++){if(1==c[k].finished){d=k;break}if(c[k].name==b&&c[k].functionpointer==f)return c[k].keepOnCall=m,!1}-1==d&&(d=e,e++,c[d]=new a);c[d].name=b;c[d].functionpointer=f;c[d].finished=0;c[d].keepOnCall=m;return!0};this.removeEvents=function(a){for(var b=0;b<e;b++)0==c[b].finished&&c[b].name==a&&0==
c[b].keepOnCall&&(c[b].finished=1)};this.suspendEvent=function(a){f[a]=!0};this.resumeEvent=function(a){f[a]=!1};this.triggerEvent=function(a,k){if(1!=f[a])for(var d=0;d<e;d++)if(0==c[d].finished&&c[d].name==a){0==c[d].keepOnCall&&(c[d].finished=1);try{c[d].functionpointer(k,b)}catch(q){console.log("Error for event "+a+" with "+k),console.log(q)}}}};function WMJSTimer(){function a(){f&&clearTimeout(e);f=!1}function c(){0==d?(a(),""!=m&&m()):(--d,f=!0,e=self.setTimeout(function(){c()},b))}this.init=function(b,e){d=parseInt(b/10+.5);1>d&&(d=1);k=d;m=e;a();0<d&&c()};this.reset=function(){d=k};this.stop=function(){a()};var e=null,f=!1,b=10,d,k,m=""};var sliderTooltip=function(a){isDefined(a)?(a='<div class="slidertooltip"><div class="slidertooltip-inner">'+a+"</div></div>",$(".relativecontrol .ui-slider-handle").html(a)):$(".ui-slider-handle .relativecontrol").html("")},RelativeSlider=function(a){var c=this,e=a.renderTo;$('<input class="datetimepicker"/><br/><span class="relativeslider"/><span class="timeprevious"/><span class="timenext"/>').appendTo(e);var f=0,b=function(b){f+=b;NaN<f&&(f=NaN);0>f&&(f=0);isDefined(a.change)&&a.change(c,f)},
d=e.find(".relativeslider").slider({min:0,max:100,value:50,animate:1E3,change:function(a,c){a.originalEvent&&(a=parseInt(c.value-50),b(a),50!=c.value&&d.slider("value",50))},slide:function(b,d){d=parseInt(d.value-50);b=f;d=f+d;void 0<d&&(d=void 0);0>d&&(d=0);isDefined(a.slide)&&a.slide(c,d);f=b}});d.addClass("relativecontrol");e.find(".timeprevious").iconbutton({text:!1,icons:{primary:"ui-icon-circle-triangle-w"}});e.find(".timenext").iconbutton({text:!1,icons:{primary:"ui-icon-circle-triangle-e"}});
e.find(".timeprevious").click(function(){b(-1)});e.find(".timenext").click(function(){b(1)});var k=e.find(".datetimepicker").datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss",separator:"T",showOn:"button",buttonText:"",altFieldTimeOnly:!1,showAnim:"slideDown",changeMonth:!0,changeYear:!0,showTimezone:!1,onSelect:function(a,b){b=c.setPositionByText(a);a!=b.dimvalue&&k.datetimepicker("setDate",b.dimvalue.replace("Z",""))},css:{zIndex:4E3}});this.setPosition=function(a){f=a};this.setPositionByText=
function(b){if(isDefined(a.textUpdate))return a.textUpdate(c,b)};this.setText=function(a,b){a=a.replace("Z","");e.find(".datetimepicker").val(a)};this.setMax=function(a,b,c){k.datetimepicker("option",{minDate:b.replace("Z",""),maxDate:c.replace("Z","")})}},TimeSlider=function(a){var c,e;this.setDimension=function(a,b,d){c=a;isDefined(void 0)&&(void 0).setMax(a.size(),a.getValueForIndex(0),a.getValueForIndex(a.size()-1));e="";this.setValue(a.name,a.getValue())};this.setValue=function(a,b){if(isDefined(c)&&
"time"==a&&e!=b){e=b;try{var d=c.getIndexForValue(b)}catch(k){d=c.size()-1,b=c.getValueForIndex(d),debug("Date "+b+" is outside range: "+d)}isDefined(void 0)&&((void 0).setText(b),(void 0).setPosition(d));return{index:d,dimvalue:b}}}};var WMJSProcessing=function(a){var c=a.url,e=!1;a.failure||(a.failure=function(a){alert(dump(a))});var f=function(b){var c=void 0;try{c=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessAccepted"].value}catch(t){}if(isDefined(c)){var f=b["wps:ExecuteResponse"].attr.statusLocation,m=new WMJSTimer,q=function(b){if(0!=e){var c=void 0,d=void 0,f=void 0,k=void 0,m=void 0;b.error&&(k=!0,m=b.error);try{k=!0,m=dump(b.ExceptionReport.Exception)}catch(r){}try{k=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessFailed"],
m="Process failed",m=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessFailed"]["wps:ExceptionReport"]["ows:Exception"]["ows:ExceptionText"].value}catch(r){}if(isDefined(k))e=!1,a.failure({message:m});else{try{c=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessSucceeded"].value}catch(r){}try{d=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessStarted"].attr.percentCompleted,f=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessStarted"].value,0==f.indexOf("processstarted")&&(f=f.substr(14))}catch(r){}isDefined(c)?
(c=b["wps:ExecuteResponse"]["wps:ProcessOutputs"]["wps:Output"],a.progress(100,"completed"),a.success(c,b),e=!1):a.progress(parseFloat(d),f)}}},p=function(){$.ajax({dataType:"jsonp",url:xml2jsonrequestURL+"request="+URLEncode(f),data:"",success:q}).fail(function(b){e=!1;a.failure({message:"<h1>Invalid JSON returned from server:</h1><hr/>"+b.responseText})});e&&m.init(1E3,p)};p()}else{c="";try{c=dump(b.ExceptionReport.Exception.attr),a.failure({message:"Process was not accepted, ExceptionReport:\n"+
c})}catch(t){b.error?(b.message||(b.message=b.error),a.failure(b)):(c=dump(b),a.failure({message:"Process was not accepted (dump):\n"+c}))}}};this.execute=function(b,d){e=!0;b=c+"service=WPS&request=execute&identifier="+b+"&version=1.0.0&storeExecuteResponse=true&status=true&";b+="datainputs=";var k="",m;for(m in d)if("object"==typeof d[m])for(var q in d[m])0<k.length&&(k+=";"),k+=m+"="+encodeURIComponent(d[m][q]);else 0<k.length&&(k+=";"),k+=m+"="+encodeURIComponent(d[m]);$.ajax({dataType:"jsonp",
url:xml2jsonrequestURL,data:{request:b+k},success:f}).fail(function(b){a.failure({message:b.responseText})})}};var WMJSCoverage=function(a){this.service=this.name=void 0;this.dimensions=[];this.supportedProjections=[];this.nativeFormat=this.nativeCRS=this.originY=this.originX=this.cellsizeY=this.cellsizeX=this.height=this.width=void 0;this.formats=[];this.setDimension=function(a,e){this.dimensions.push({name:a,value:e,currentValue:e})};isDefined(a)&&(this.name=a.name,this.service=a.service)},WCJSRequest=function(a,c,e,f){var b=xml2jsonrequestURL+"request=";-1==a.indexOf("?")&&(a+="?");debug("GetCapabilities:");
var d=a+"&service=WCS&REQUEST=DescribeCoverage&COVERAGE="+c;debug("<a target='_blank' href='"+d+"'>"+d+"</a>",!1);b+=URLEncode(d);$.ajax({dataType:"jsonp",url:b,success:function(b){b.service=a;b.name=c;e(b)},error:function(a){f(I18n.unable_to_do_getcapabilities.text+":\n"+b+"\n"+I18n.result.text+":\n"+a)}})},parseDescribeCoverage=function(a,c){c=c?c:new WMJSCoverage;c.service=a.service;try{c.name=a.CoverageDescription.CoverageOffering.name.value}catch(m){alert("This layer has no Web Coverage Service.");
return}c.title=a.CoverageDescription.CoverageOffering.label.value;c["abstract"]=a.CoverageDescription.CoverageOffering.description.value;var e=a.CoverageDescription.CoverageOffering.lonLatEnvelope["gml:pos"][0].value.replaceAll(" ",",");var f=a.CoverageDescription.CoverageOffering.lonLatEnvelope["gml:pos"][1].value.replaceAll(" ",",");c.lonlatbox=new WMJSBBOX(e+","+f);for(var b=toArray(a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:Envelope"]),d=0;d<b.length;d++){var k=b[d].attr.srsName;
e=b[d]["gml:pos"][0].value.replaceAll(" ",",");f=b[d]["gml:pos"][1].value.replaceAll(" ",",");f=new WMJSBBOX(e+","+f);c.supportedProjections.push({srs:k,bbox:f.toString()})}d=a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:RectifiedGrid"]["gml:limits"]["gml:GridEnvelope"]["gml:high"].value.split(" ");c.width=parseInt(d[0])+1;c.height=parseInt(d[1])+1;c.cellsizeX=parseFloat(a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:RectifiedGrid"]["gml:offsetVector"][0].value.split(" ")[0]);
c.cellsizeY=parseFloat(a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:RectifiedGrid"]["gml:offsetVector"][1].value.split(" ")[1]);c.originX=a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:RectifiedGrid"]["gml:origin"]["gml:pos"].value.split(" ")[0];c.originY=a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:RectifiedGrid"]["gml:origin"]["gml:pos"].value.split(" ")[1];c.nativeCRS=a.CoverageDescription.CoverageOffering.supportedCRSs.nativeCRSs?
a.CoverageDescription.CoverageOffering.supportedCRSs.nativeCRSs.value:"EPSG:4326";c.nativeFormat=a.CoverageDescription.CoverageOffering.supportedFormats.attr.nativeFormat;a=toArray(a.CoverageDescription.CoverageOffering.supportedFormats.formats);for(d=0;d<a.length;d++)c.formats.push(a[d].value);return c};var WMJSImage=function(a,c,e){var f=this;this.srcToLoad=a;var b="undefined image",d=!1,k=!1,m=!1,q=1;f.isLoaded=function(){return k?!1:d};f.isLoading=function(){return k};f.checkIfThisSourceIsSet=function(a){return b==a||this.srcToLoad==a?!0:!1};f.setSource=function(a){k||(this.srcToLoad=a,d=b==this.srcToLoad?!0:!1)};f.clear=function(){b="undefined image";this.srcToLoad="";m=k=d=!1};f.getSrc=function(){return this.srcToLoad};f.hasError=function(){return m};f.load=function(){m=!1;1==d?p(f):(k=!0,this.srcToLoad==
b?p(f):(t.load(function(){p(f,!1)}),t.error(function(){p(f,!0)}),t.attr("src",this.srcToLoad+"&"+Math.random())))};var p=function(a,e){if(0!=k||1!=d)m=e,k=!1,d=!0,b=this.srcToLoad,isDefined(c)&&c(f)};f.setOpacity=function(a){q=parseFloat(a);t.css("opacity",q)};f.getOpacity=function(a){return q};f.setPosition=function(a,b){t.css({top:parseInt(b)+"px",left:parseInt(a)+"px",position:"absolute"})};f.setSize=function(a,b){a=parseInt(a);b=parseInt(b);0==a||0==b||isNaN(a)||isNaN(b)||(t.width(parseInt(a)+
"px"),t.height(parseInt(b)+"px"))};f.setZIndex=function(a){t.zIndex=a};f.getElement=function(){return t};var t=$(document.createElement("img"));"wmjsimagebuffer"==e?(t.left="0px",t.top="0px",t.css({position:"absolute"})):t.css({position:"relative"});t.onselectstart=function(){return!1};t.ondrag=function(){return!1};return f};var WMJSImageStore=function(a,c,e){this.images=[];this.imagesbysrc={};var f=this.imageLife=0,b=this,d=c;b.getImageForSrc=function(a){if(b.imagesbysrc[a])return b.imagesbysrc[a]};b.clear=function(){for(var a=0;a<b.images.length;a++)b.images[a].clear()};b.setLoadEventCallback=function(a){d=a};b.getNumImagesLoading=function(){for(var a=0,c=0;c<b.images.length;c++)b.images[c].isLoading()&&a++;return a};b.getImage=function(c){var k=b.getImageForSrc(c);if(void 0!=k)return k.imageLife=f++,k;if(b.images.length<
a)k=new WMJSImage(c,d,e),k.setSource(c),k.KVP=WMJSKVP(c),b.imagesbysrc[c]=k,k.imageLife=f++,b.images.push(k);else{k=-1;for(var q=f,p=0;p<b.images.length;p++)0==b.images[p].isLoading()&&1==b.images[p].isLoaded()&&q>=b.images[p].imageLife&&(q=b.images[p].imageLife,k=p);if(-1==k){alert("not enough cache for "+e);return}k=b.images[k];b.imagesbysrc[k.srcToLoad]&&delete b.imagesbysrc[k.srcToLoad];k.setSource(c);k.KVP=WMJSKVP(c);b.imagesbysrc[c]=k;k.imageLife=f++}return k}};var WMJSDivBuffer=function(a,c,e,f,b){var d=this;this.div=$(document.createElement("div"));this.hidden=this.ready=!0;this.layers=[];var k=f,m=b;"imagebuffer"==c&&this.div.addClass("wmjsimagebuffer");"legendbuffer"==c&&this.div.addClass("wmjslegendbuffer");this.div.addClass("WMJSDivBuffer-noselect");this.imageLoadComplete=function(b){q();a.triggerEvent("onimageload")};var q=function(){for(var a=0;a<d.layers.length;a++)if(0==d.layers[a].isLoaded())return;d.finishedLoading()},p=new WMJSImage("webmapjs/img/stoploading.png",
function(){console.log("fake image loaded");q()},c);this.hide=function(){d.hidden=!0;d.div.hide();d.layers=[]};this.display=function(){if(0!=d.hidden){d.hidden=!1;d.div.empty();for(var a=0;a<d.layers.length;a++)d.layers[a].setSize(k,m),0==d.layers[a].hasError()?d.div.append(d.layers[a].getElement()):error("<a target='_blank' href='"+d.layers[a].getSrc()+"'>"+d.layers[a].getSrc()+"</a>",!1);d.div.show()}};this.finishedLoading=function(){if(!d.ready){d.ready=!0;try{if(isDefined(d.onLoadReadyFunction))d.onLoadReadyFunction(d)}catch(t){error("Exception in Divbuffer::finishedLoading: "+
t)}}};this.setPosition=function(a,b){if(isNaN(a)||isNaN(b))b=a=0;d.div.css({top:b,left:a})};this.setSize=function(a,b){d.div.width(a);d.div.height(b);for(var c=0;c<this.layers.length;c++)this.layers[c].setSize(a,b)};this.resize=function(a,b){k=a;m=b;d.setSize(a,b);d.div.width(a);d.div.height(b)};this.load=function(a){if(0!=d.ready){d.ready=!1;a?this.onLoadReadyFunction=a:d.onLoadReadyFunction=function(){};for(a=d.nrLoading=0;a<this.layers.length;a++)d.layers[a].loadThisOne=!1,0==d.layers[a].isLoaded()&&
(d.layers[a].loadThisOne=!0,d.nrLoading++);if(0==this.nrLoading)q();else{"imagebuffer"==c&&debug("GetMap:");"legendbuffer"==c&&debug("GetLegendGraphic:");for(a=0;a<this.layers.length;a++)1==this.layers[a].loadThisOne&&debug("<a target='_blank' href='"+this.layers[a].getSrc()+"'>"+this.layers[a].getSrc()+"</a>",!1);for(a=0;a<this.layers.length;a++)1==this.layers[a].loadThisOne&&this.layers[a].load()}}};this.setSrc=function(a,b,c,d){if(isDefined(b)){for(;a>=this.layers.length;)this.layers.push(p);b=
e.getImage(b);b.setZIndex(a);this.layers[a]=b}else console.log("undefined")};this.setOpacity=function(a,b){a>=this.layers.length?error("setOpacity :invalid id"):(b=parseFloat(b),this.layers[a].setOpacity(b))};this.getBuffer=function(){return d.div}};var WMJSCanvasBuffer=function(a,c,e,f,b){var d=this;this.canvas=$("<canvas/>",{"class":"WMJSCanvasBuffer"}).width(f).height(b);var k=d.canvas[0].getContext("2d");k.canvas.width=f;k.canvas.height=b;this.hidden=this.ready=!0;this.layerstodisplay=[];this.layers=[];var m=f,q=b;"imagebuffer"==c&&this.canvas.addClass("wmjsimagebuffer");"legendbuffer"==c&&this.canvas.addClass("wmjslegendbuffer");this.canvas.addClass("WMJSCanvasBuffer-noselect");this.imageLoadComplete=function(b){p();a.triggerEvent("onimageload")};
var p=function(){for(var a=0;a<d.layers.length;a++)if(0==d.layers[a].isLoaded())return;d.finishedLoading()},t=new WMJSImage("webmapjs/img/stoploading.png",function(){console.log("fake image loaded");p()},c);this.hide=function(){d.hidden=!0;d.canvas.hide();d.layers=[]};this.display=function(a,b){d.hidden=!1;k.globalAlpha=1;k.beginPath();k.rect(0,0,m,q);k.fillStyle="white";k.fill();if(a){var c=v({x:b.left,y:b.top},a);var e=v({x:b.right,y:b.bottom},a)}for(b=0;b<d.layerstodisplay.length;b++)if(d.layerstodisplay[b].setSize(m,
q),0==d.layerstodisplay[b].hasError()){var f=d.layerstodisplay[b].getOpacity();k.globalAlpha=f;f=d.layerstodisplay[b].getElement()[0];a?k.drawImage(f,c.x,c.y,e.x-c.x,e.y-c.y):k.drawImage(f,0,0,m,q)}else error("<a target='_blank' href='"+d.layerstodisplay[b].getSrc()+"'>"+d.layerstodisplay[b].getSrc()+"</a>",!1);d.canvas.show()};this.finishedLoading=function(){if(!d.ready){d.ready=!0;for(var a=0;a<d.layers.length;a++)d.layerstodisplay[a]=d.layers[a];try{if(isDefined(d.onLoadReadyFunction))d.onLoadReadyFunction(d)}catch(D){error("Exception in Divbuffer::finishedLoading: "+
D)}}};this.setPosition=function(a,b){};this.setSize=function(a,b){};this.resize=function(a,b){a=parseInt(a);b=parseInt(b);m=a;q=b;d.setSize(a,b);d.canvas.width(a);d.canvas.height(b);k.canvas.height=b;k.canvas.width=a};this.load=function(a){if(0!=d.ready){d.ready=!1;d.layerstodisplay=[];a?this.onLoadReadyFunction=a:d.onLoadReadyFunction=function(){};for(a=d.nrLoading=0;a<this.layers.length;a++)d.layers[a].loadThisOne=!1,0==d.layers[a].isLoaded()&&(d.layers[a].loadThisOne=!0,d.nrLoading++);if(0==this.nrLoading)p();
else{"imagebuffer"==c&&debug("GetMap:");"legendbuffer"==c&&debug("GetLegendGraphic:");for(a=0;a<this.layers.length;a++)1==this.layers[a].loadThisOne&&debug("<a target='_blank' href='"+this.layers[a].getSrc()+"'>"+this.layers[a].getSrc()+"</a>",!1);for(a=0;a<this.layers.length;a++)1==this.layers[a].loadThisOne&&this.layers[a].load()}}};this.setSrc=function(a,b,c,d){if(isDefined(b)){for(;a>=this.layers.length;)this.layers.push(t);b=e.getImage(b);b.setZIndex(a);this.layers[a]=b}else console.log("undefined")};
var v=function(a,b){return{x:m*(a.x-b.left)/(b.right-b.left),y:q*(a.y-b.top)/(b.bottom-b.top)}},E,ba;this.setBBOX=function(a,b){if(E!=b+""||ba!=a+"")E=b+"",ba=a+"",0==d.hidden&&d.display(a,b)};this.setOpacity=function(a,b){a>=this.layers.length?error("setOpacity :invalid id"):(b=parseFloat(b),this.layers[a].getOpacity()!=b&&this.layers[a].setOpacity(b))};this.getBuffer=function(){return d.canvas}};function WMJSTimeSelector(a,c,e){var f=function(){this.values=[]};f.prototype.add=function(a){if(!0===this[a])return!1;this[a]=!0;this.values.push(a);return!0};var b=this;this.element=a;this.webmapjs=void 0;this.values=[];var d=24;isDefined(e)&&(d=e);var k=$('<div class="WMJSTimeSelector-controlElement WMJSTimeSelector-noselect"/>',{}),m=$('<div class="WMJSTimeSelector-timeChooserElement WMJSTimeSelector-noselect"/>',{}),q=$('<div class="WMJSTimeSelector-timeinfo WMJSTimeSelector-noselect"/>',{}),
p=$('<div class=""WMJSTimeSelector-controlElementBottom WMJSTimeSelector-noselect"/>',{});this.element.append(q);this.element.append(k);this.element.append(m);this.element.append(p);a=$("<button>&lt;&lt;</button>").button().click(function(){var a=b.makeDateList(b.webmapjs,b.currentValue,d);B(a[0])});e=$("<button>&gt;&gt;</button>").button().click(function(){var a=b.makeDateList(b.webmapjs,b.currentValue,d);B(a[a.length-1])});var t=$("<button>&lt;</button>").button().click(function(){for(var a=b.makeDateList(b.webmapjs,
b.currentValue,d),c=1;c<a.length;c++)if(a[c]==b.currentValue){B(a[c-1]);return}B(a[0])}),v=$("<button>&gt;</button>").button().click(function(){for(var a=b.makeDateList(b.webmapjs,b.currentValue,d),c=0;c<a.length-1;c++)if(a[c]==b.currentValue){B(a[c+1]);return}B(a[a.length-1])});k.append("<table class='WMJSTimeSelector-table'><tr><th>"+I18n.year.text+"</th><th>"+I18n.month.text+"</th><th>"+I18n.day.text+"</th><th>"+I18n.hour.text+"</th><th>"+I18n.min.text+"</th></tr><tr><td><input class='WMJSTimeSelector_yearspinner'/></td><td><input class='WMJSTimeSelector_monthspinner'/></td><td><input class='WMJSTimeSelector_dayspinner'/></td><td><input class='WMJSTimeSelector_hourspinner'/></td><td><input class='WMJSTimeSelector_minutespinner'/></td></tr>");
var E=$("<button>"+I18n.load_all.text+"</button>").button().click(function(){for(var a=b.values,c=0;c<a.length;c++)aa(a[c])}),ba=$("<button>"+I18n.play_animation.text+"</button>").button().click(function(){for(var a=b.values,c=[],d=0;d<a.length;d++)aa(a[d]),c.push({name:"time",value:a[d]});b.webmapjs.draw(c)}),I=$("<button>"+I18n.stop.text+"</button>").button().click(function(){b.webmapjs.stopAnimating()});p.append(E);p.append(ba);p.append(I);var D=k.find(".WMJSTimeSelector_yearspinner"),r=k.find(".WMJSTimeSelector_monthspinner"),
L=k.find(".WMJSTimeSelector_dayspinner"),F=k.find(".WMJSTimeSelector_hourspinner"),X=k.find(".WMJSTimeSelector_minutespinner"),g=k.find(".WMJSTimeSelector_secondspinner"),p=$('<div class="WMJSTimeSelector_timebuttons"/>',{});p.append(a);p.append(t);p.append(v);p.append(e);k.append(p);var fa="",M=function(a,b){for(a=""+a;a.length<b;)a="0"+a;return a},w=function(a,c){var d=fa;"year"==a&&(d=[M(c,4),d.slice(4)].join(""));"month"==a&&(d=[d.slice(0,5),M(c,2),d.slice(7)].join(""));"day"==a&&(d=[d.slice(0,
8),M(c,2),d.slice(10)].join(""));"hour"==a&&(d=[d.slice(0,11),M(c,2),d.slice(13)].join(""));"minute"==a&&(d=[d.slice(0,14),M(c,2),d.slice(16)].join(""));"second"==a&&(d=[d.slice(0,17),M(c,2),d.slice(19)].join(""));a=parseISO8601DateToDate(d);d=a.toISO8601();if(d!=b.currentValue&&(c=b.makeDateList(b.webmapjs,d,3),c[1]==b.currentValue)){var e=parseISO8601DateToDate(c[1]);a>e?d=c[2]:a<e&&(d=c[0])}d!=fa&&(J(d),B(d));return!1},J=function(a){isDefined(a)&&(fa=a,D.spinner("value",a.substring(0,4)),r.spinner("value",
a.substring(5,7)),L.spinner("value",a.substring(8,10)),F.spinner("value",a.substring(11,13)),X.spinner("value",a.substring(14,16)),g.spinner("value",a.substring(17,19)))};D.spinner({spin:function(a,b){return w("year",b.value)},change:function(a,b){w("year",$(a.target).spinner("value"))},numberFormat:"d4"});r.spinner({spin:function(a,b){return w("month",b.value)},change:function(a,b){w("month",$(a.target).spinner("value"))},numberFormat:"d2"});L.spinner({spin:function(a,b){return w("day",b.value)},
change:function(a,b){w("day",$(a.target).spinner("value"))},numberFormat:"d2"});F.spinner({spin:function(a,b){return w("hour",b.value)},change:function(a,b){w("hour",$(a.target).spinner("value"))},numberFormat:"d2"});X.spinner({spin:function(a,b){return w("minute",b.value)},change:function(a,b){w("minute",$(a.target).spinner("value"))},numberFormat:"d2"});g.spinner({spin:function(a,b){return w("second",b.value)},change:function(a,b){w("second",$(a.target).spinner("value"))},numberFormat:"d2"});D.spinner().keyup(function(a,
b){13==(a.keyCode||a.which)&&w("year",$(event.target).spinner("value"))});r.spinner().keyup(function(a,b){13==(a.keyCode||a.which)&&w("month",$(event.target).spinner("value"))});L.spinner().keyup(function(a,b){13==(a.keyCode||a.which)&&w("day",$(event.target).spinner("value"))});F.spinner().keyup(function(a,b){13==(a.keyCode||a.which)&&w("hour",$(event.target).spinner("value"))});X.spinner().keyup(function(a,b){13==(a.keyCode||a.which)&&w("minute",$(event.target).spinner("value"))});g.spinner().keyup(function(a,
b){13==(a.keyCode||a.which)&&w("second",$(event.target).spinner("value"))});this.loadingComplete=function(a){this.generate(a,!1,!0)};this.dimensionUpdate=function(a){this.generate(a,!0,!0)};this.dimensionChange=function(a){this.generate(a,!1,!1)};var A=function(a){J(a);a=parseISO8601DateToDate(a);$(q).html(I18n.local_time.text+":<br/><b>"+a.toString().replace(/GMT.*/g,"")+"</b>")},B=function(a){b.webmapjs.stopAnimating();A(a);c(a)};this.makeDateList=function(a,b,c){var d=[];a=a.getLayers();for(var e=
0;e<a.length;e++)if(1==a[e].enabled){var g=a[e].getDimension("time");g&&d.push(g)}g=new f;for(e=0;e<c;e++)for(var k=0;k<d.length;k++){var m=d[k];a=m.getIndexForValue(b,!1);var n=e+a;0>n&&(n=0);n>m.size()-1&&(n=m.size()-1);0<=n&&n<m.size()&&g.add(m.getValueForIndex(n));n=-e+a;0>n&&(n=0);n>m.size()-1&&(n=m.size()-1);0<=n&&n<m.size()&&g.add(m.getValueForIndex(n))}g.values.sort();for(e=d=0;e<g.values.length;e++)if(b==g.values[e]){d=e;break}k=0;b=new f;for(e=0;e<c;e++){a=d+e;if(0<a&&a<g.values.length&&
1==b.add(g.values[a])&&(k++,k>c))break;a=d-e;if(0<a&&a<g.values.length&&1==b.add(g.values[a])&&(k++,k>c))break}b.values.sort();c=[];for(e=0;e<b.values.length;e++)c.push(b.values[e]);return c};var u=function(a){if(!b.webmapjs)return!1;var c=b.webmapjs.getDimension("time");if(!isDefined(c))return!1;c=c.currentValue;b.webmapjs.suspendEvent("ondimchange");b.webmapjs.suspendEvent("ondimupdate");b.webmapjs.setDimension("time",a);a=function(){var a=b.webmapjs.getWMSRequests();if(0==a.length)return!1;for(var c=
0;c<a.length;c++)if(0==b.webmapjs.isThisRequestLoaded(a[c]))return!1;return!0}();b.webmapjs.setDimension("time",c);b.webmapjs.resumeEvent("ondimchange");b.webmapjs.resumeEvent("ondimupdate");return a},aa=function(a){if(!b.webmapjs)return!1;var c=b.webmapjs.getDimension("time");if(!isDefined(c))return!1;c=c.currentValue;b.webmapjs.suspendEvent("ondimchange");b.webmapjs.suspendEvent("ondimupdate");b.webmapjs.setDimension("time",a);a=[];var d=b.webmapjs.getWMSRequests();if(0==d.length)a=!1;else for(var e=
0;e<d.length;e++)0==b.webmapjs.isThisRequestLoaded(d[e])&&a.push(d[e]);b.webmapjs.prefetch(a);b.webmapjs.setDimension("time",c);b.webmapjs.resumeEvent("ondimchange");b.webmapjs.resumeEvent("ondimupdate");return a};this.generate=function(a,c,e){this.webmapjs=a;if(a.getDimension("time")){k.show();q.show();var f=a.getDimension("time").currentValue;if("current"==f)for(var g=a.getLayers(),n=0;n<g.length;n++){var p=g[n].getDimension("time");p&&(f=p.getValueForIndex(p.getIndexForValue(f,!1)))}b.currentValue=
f;A(b.currentValue);if(0==c){g=!1;if(isDefined(b.values))for($(b.element).find(".WMJSTimeSelector-tr").removeClass("WMJSTimeSelector-col-selected"),n=0;n<b.values.length;n++)c=!1,p=$(b.element).find(".WMJSTimeSelector-tr:eq("+n+")"),!0===e&&(c=!1,p.hasClass("WMJSTimeSelector-col-loaded")&&(c=!0),c||(c=1==u(b.values[n])),c?p.addClass("WMJSTimeSelector-col-loaded"):p.removeClass("WMJSTimeSelector-col-loaded")),b.currentValue==b.values[n]&&(b.currentValue=f,p.addClass("WMJSTimeSelector-col-selected"),
g=!0);if(1==g)return}b.values=b.makeDateList(a,f,d);a="<table class='WMJSTimeSelector-table WMJSTimeSelector-noselect'>";e=function(a){var b="WMJSTimeSelector-tr";1==a.isLoaded&&(b+=" WMJSTimeSelector-col-loaded");a.value==f&&(b+=" WMJSTimeSelector-col-selected");return"<tr class='"+b+"'>"+("<td class='WMJSTimeSelector-colindex'>"+a.index+"</td><td class='WMJSTimeSelector-col'>"+a.textdate+"</td><td class='WMJSTimeSelector-colindex'>"+a.index+"</td><td class='WMJSTimeSelector-col'>"+a.texttime+"</td>")+
"</tr>"};c={};for(n=0;n<b.values.length;n++)c.index=n,c.value=b.values[n],c.text=c.value.replace(/T/g," | "),c.text=c.text.replace(/Z/g," "),c.textdate=c.value.split("T")[0],c.texttime=c.value.split("T")[1],c.texttime=c.texttime.split(":")[0]+":"+c.texttime.split(":")[1]+"z",c.isLoaded=u(c.value),a+=e(c);n=""+(a+"</table>");$(m).html(n);var r=function(a){a=$(a.target).parent().find("td").first().html();B(b.values[a])};$(b.element).find(".WMJSTimeSelector-tr").mouseover(function(a){0!=ja&&r(a)});$(b.element).find(".WMJSTimeSelector-tr").mousedown(r)}else $(m).html(I18n.no_dimensions_available.text),
k.hide(),q.hide(),b.currentValue="",b.values=[]};var ja=!1;$(document).mousedown(function(){ja=!0}).mouseup(function(){ja=!1});$(b.element).bind("mousewheel",function(a){var b=0;try{isDefined(a.originalEvent.deltaY)&&(b=a.originalEvent.deltaY)}catch(ya){}0==b&&(b=0<a.originalEvent.wheelDelta/120?-1:1);0>b?t.click():v.click()})};var GFITimeElevationWindow=function(a){this.t=function(){return 123};this.setSize=function(c,b){c-=80;b-=70;a.width(c);a.height(b);var d=a.find(".timeaxis").get(0).getContext("2d");d.canvas.height=50;d.canvas.width=c;d=a.find(".heightaxis").get(0).getContext("2d");d.canvas.height=b;d.canvas.width=60;e.setSize(c,b);e.draw()};a.html('<table class="gfi_table"><tr class="gfi_table_tr"><td class="gfi_table_td"><canvas class="heightaxis" class="gfi_nomarginpadding"  ></canvas></td><td class="gfi_table_td"><div class="gfi_nomarginpadding gfi_mainmap" style="width:1200px;height:600px;"></div></td><td><div class="legend"></div></td></tr><tr class="gfi_table_tr"><td class="gfi_table_td"></td><td><canvas class="timeaxis"  class="gfi_nomarginpadding"   ></canvas><td class="gfi_table_td"></td></tr></table>');
var c=a.find(".gfi_mainmap").get(0);var e=new WMJSMap(c);e.hideScaleBar();e.displayLegendInMap(!1);e.getOverlayElement().css("border","1px solid black");this.setSize(a.width(),a.height());this.updateBBOX=function(c){var b=a.find(".timeaxis").get(0).getContext("2d");b.fillStyle="#FFF";b.font="10px Arial";b.fillRect(0,0,e.getWidth(),50);var d=-1;for(var f=Math.round(c.left);f<Math.round(c.right);f+=1E4){var m=new Date(f);-1==d&&(d=m.getUTCHours());if(d!=m.getUTCHours()){b.fillStyle="#000000";var q=
(f-c.left)/(c.right-c.left)*e.getWidth();b.beginPath();b.moveTo(q-1,0);b.lineTo(q-1,10);b.stroke();d=m.getUTCHours();b.fillText(d,q-b.measureText(d).width/2-1,20);d=m.getUTCHours()}}b.font="14px Arial";b.fillText("time UTC (h)",e.getWidth()/2-100,38);b=a.find(".heightaxis").get(0).getContext("2d");b.font="10px Arial";b.fillStyle="#FFF";b.fillRect(0,0,60,e.getHeight());b.textAlign="right";d=-1.1;if(!(100<Math.abs(Math.round(c.top)-Math.round(c.bottom))/1E3)){for(f=Math.round(c.bottom);f<Math.round(c.top);f+=
1)m=Math.floor(f/1E3),-1.1==d&&(d=m),d!=m&&(b.fillStyle="#000000",q=(f-c.top)/(c.bottom-c.top)*e.getHeight(),b.beginPath(),b.moveTo(50,q),b.lineTo(60,q),b.stroke(),d=f,b.fillText(d,48,q+3),d=m);b.save();b.translate(5,e.getHeight()/2-50);b.rotate(-Math.PI/2);b.font="14px Arial";b.fillText("height (m)",5,6);b.restore()}};this.drawLegend=function(){var c=e.getLayers()[0],c=e.getLegendGraphicURLForLayer(c);a.find(".legend").html('<img class="legendimg" src="'+c+'&TRANSPARENT=TRUE"/>')};e.addListener("onupdatebbox",
this.updateBBOX,!0);e.setProjection("GFI:TIME_ELEVATION",[(new Date("2016-04-01T00:00:00Z")).getTime(),0,(new Date("2016-04-02T00:00:00Z")).getTime(),15270]);this.updateBBOX(e.getProjection().bbox);this.getWebMapJS=function(){return e}};var WMJSAnimate=function(a){a.animationDelay=250;var c=a.getListener(),e=a.getImageStore(),f=this,b=document.createElement("div");$(b).mouseout(function(){a.mouseHoverAnimationBox=!1});var d=0,k=function(){if(0==a.isAnimating)a.isAnimatingLoopRunning=!1;else if(a.animationTimer.init(50,k),f.checkAnimation(),d--,!(0<d)){var b=a.animationDelay;0==a.currentAnimationStep&&(b*=3);a.currentAnimationStep==a.animationList.length-1&&(b*=5);d=b/60;if(!1===a.mouseHoverAnimationBox){0!=a.isAnimating&&1!=a.animateBusy&&
((b=a.animationList[a.currentAnimationStep])?(a.setDimension(b.name,b.value),a._pdraw(),a.animateBusy=!1):error("No animation step for "+a.currentAnimationStep));b=a.currentAnimationStep+1;b>=a.animationList.length&&(b=0);var c=!1,e=0,t=a.animationList[b];a.setDimension(t.name,t.value);a.animationList[b].requests=a.getWMSRequests();t=a.animationList[a.currentAnimationStep];a.setDimension(t.name,t.value);for(t=0;t<a.animationList[b].requests.length;t++){var v=a.animationList[b].requests[t];(v=a.getImageStore().getImageForSrc(v))&&
v.isLoaded()?e++:(d=0,console.log("LOADING: "+b))}e==a.animationList[b].requests.length&&(c=!0);c&&(a.currentAnimationStep=b)}}};a.isAnimatingLoopRunning=!1;f.checkAnimation=function(){if(0==a.isAnimating)a.isAnimatingLoopRunning=!1;else{a.animationTimer||(a.animationTimer=new WMJSTimer);c.triggerEvent("onnextanimationstep",a);if(!1===a.mouseHoverAnimationBox){var b=e.getNumImagesLoading();if(2>b&&0<a.animationList.length)for(var d=0;6>d;d++){for(var f=d+a.currentAnimationStep;0>f;)f+=a.animationList.length;
for(;f>=a.animationList.length;)f-=a.animationList.length;0>f&&(f=0);if(0<=f){var t=a.animationList[f];a.setDimension(t.name,t.value);a.animationList[f].requests=a.getWMSRequests();t=a.animationList[a.currentAnimationStep];a.setDimension(t.name,t.value);a.animationList[f].imagesInPrefetch=a.prefetch(a.animationList[f].requests);b+=a.animationList[f].imagesInPrefetch.length;if(1<b)break}}}0==a.isAnimatingLoopRunning&&(a.isAnimatingLoopRunning=!0,k())}};a.stopAnimating=function(){0!=a.isAnimating&&
(b.style.display="none",a.isAnimating=!1,a.animateBusy=!1,a.rebuildMapDimensions(),c.triggerEvent("onstopanimation",a))};a.currentAnimationStep=0;a.animationList=void 0;a.isAnimating=!1;a.setAnimationDelay=function(b){1>b&&(b=1);a.animationDelay=b};b.style.zIndex=1E4;b.style.background="none";b.style.position="absolute";b.style.border="none";b.style.margin="0px";b.style.padding="0px";b.style.lineHeight="14px";b.style.fontFamily='"Courier New", "Lucida Console", Monospace';b.style.fontSize="10px";
a.getBaseElement().append(b)};var WMJSDialog={},WMJSDialogsCreated=0;WMJSDialog.closeAllDialogs=function(a){for(var c=0;c<a.length;c++)a[c].remove()};
WMJSDialog.createDialog=function(a,c,e){WMJSDialogsCreated++;var f=0,b=0,d=!0;isDefined(a.id);isDefined(a.x)&&(f=a.x);isDefined(a.y)&&(b=a.y);isDefined(a.autoDestroy)&&(d=a.autoDestroy);var k=jQuery("<div />",{css:{minHeight:"20px",height:200,width:420,zIndex:2E3,borderTop:"1px solid #8890D0",borderRight:"1px solid #8890D0",borderBottom:"1px solid #6670B0",borderLeft:"1px solid #6670B0",position:"absolute",margin:0,padding:"0px",backgroundColor:"#EEF",display:"inline-block"},mousedown:function(a){a.stopPropagation();
preventdefault_event(a)},mousewheel:function(a){a.stopPropagation()}}).appendTo(c);k.hasBeenDragged=!1;k.on("drag",function(a,b){k.hasBeenDragged=!0});k.resizable();k.draggable();k.closeDialog=function(){0==d?(k.hide(),k.trigger("hide")):(k.remove(),dialogClosed(k))};k.keyup(function(a){27==a.keyCode&&k.closeDialog()});jQuery("<div/>",{css:{position:"absolute",right:"6px",top:"-3px",margin:"0px",padding:"0px",zIndex:1200},click:function(){k.closeDialog()}}).appendTo(k).iconbutton({text:!1,icons:{primary:"wmjs-icon-close"}});
var m=jQuery("<div/>",{css:{position:"absolute",right:"0px",top:"18px",background:"#FFF",borderTop:"2px solid #6670B0",width:"100%",height:"100%",overflow:"auto",fontSize:"10px",lineHeight:"12px"},mousedown:function(a){a.stopPropagation();preventdefault_event(a)}}).appendTo(k);k.resize(function(){m.css({width:k.width()+"px",height:k.height()-18+"px"})});k.resize();k.setLoading=function(){m.html('<img style="margin-left:10px;margin-top:10px;" src="'+loadingImageSrc+'"/>')};k.setXY=function(a,b){k.hasBeenDragged=
!1;k.css({left:a+"px",top:b+"px"});var c=e.getGeoCoordFromPixelCoord({x:a,y:b});k.geoPosX=c.x;k.geoPosY=c.y;k.x=a;k.y=b};k.setXY(f,b);k.origX=f;k.origY=b;k.setLoading();k.setHTML=function(a){m.html(a)};isDefined(a.dataURL)&&(c=function(a){m.html(a)},MakeHTTPRequest(a.dataURL,c,c));return k};
