'use strict';(function(a){a&&a.prototype&&null==a.prototype.children&&Object.defineProperty(a.prototype,"children",{get:function(){for(var a=0,c,f=this.childNodes,b=[];c=f[a++];)1===c.nodeType&&b.push(c);return b}})})(window.Node||window.Element);
"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(a,d){if(null==a)throw new TypeError("Cannot convert undefined or null to object");for(var c=Object(a),f=1;f<arguments.length;f++){var b=arguments[f];if(null!=b)for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(c[e]=b[e])}return c},writable:!0,configurable:!0});Math.log10=Math.log10||function(a){return Math.log(a)*Math.LOG10E};
Array.prototype.filter||(Array.prototype.filter=function(a){if(void 0===this||null===this)throw new TypeError;var d=Object(this),c=d.length>>>0;if("function"!==typeof a)throw new TypeError;for(var f=[],b=2<=arguments.length?arguments[1]:void 0,e=0;e<c;e++)if(e in d){var l=d[e];a.call(b,l,e,d)&&f.push(l)}return f});function Console(a){function d(a){a=(a+"").replace(/&/g,"&amp;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");a=a.replace(/\"/g,"&quot;");return a=a.replace(/\n/g,"<br>")}var c=a,f="";this.println=function(a,e){f=0==e?f+("<p class='stdoutmessage'>"+a+"</p>"):f+("<p class='stdoutmessage'>"+d(a)+"</p>");isDefined(c)&&(c.innerHTML=f,c.scrollTop=c.scrollHeight);17824<f.length&&(f=f.substring(f.length-13368))};this.errprintln=function(a,e){f=0==e?f+("<p class='stderrmessage'>"+a+"</p>"):f+("<p class='stderrmessage'>"+
d(a)+"</p>");isDefined(c)&&(c.innerHTML=f,c.scrollTop=c.scrollHeight)};this.cls=function(){f="";isDefined(c)&&(c.innerHTML=f)};this.setSize=function(a,d){isDefined(c)&&(c.scrollTop=c.scrollHeight,c.style.width=a+"px",c.style.height=d+"px",c.width=a+"px",c.height=d+"px")};this.setElement=function(a){c=a;isDefined(c)&&(c.style.overflow="scroll",c.style.display="inline-block",c.style.position="absolute",c.style.width="100%",c.style.height="100%",c.style.font="normal 12px courier",c.noWrap=!0,c.style.whiteSpace=
"nowrap",c.innerHTML=f,c.scrollTop=c.scrollHeight)};this.setElement(a)}function isDefined(a){return"undefined"===typeof a?!1:!0}function isNull(a){return null===a?!0:!1}function toArray(a){if(!a)return[];if(a.length)return a;var d=[];d[0]=a;return d}var WMJSSet=function(){};WMJSSet.prototype.add=function(a){this[a]=!0};WMJSSet.prototype.remove=function(a){delete this[a]};
function WMJSKVP(a){var d=[];this._parse=function(a){var d=[];if(a=a.split("&"))for(var b in a){var e=a[b].split("=");if(2==e.length){var l=e[0],e=e[1];d[l]instanceof Array||(d[l]=[]);d[l].push(e)}}return d};this.getKeys=function(){var a=new WMJSSet;for(key in d)a.add(key);return a};this.getValues=function(a){return d[a]};this.getKeyValues=function(){return d};return d=this._parse(a)}
var preventdefault_event=function(a){a=a||window.event;a.preventDefault?a.preventDefault():a.returnValue=!1},attach_event=function(a,d,c){if("mousewheel"==d){var f=function(a,d){var f=0;a||(a=window.event,window.event.cancelBubble=!0,window.event.returnValue=!1);a.wheelDelta?f=a.wheelDelta/120:a.detail&&(f=-a.detail/3);f&&d(f);a.preventDefault&&a.preventDefault();a.returnValue=!1};a.addEventListener&&a.addEventListener("DOMMouseScroll",function(a){f(a,c)},!1);a.onmousewheel=document.onmousewheel=
function(a){f(a,c)}}else browser.isNS?a.addEventListener(d,c,!0):(a.attachEvent("on"+d,c),void 0!=window.event&&(window.event.cancelBubble=!0,window.event.returnValue=!1))},del_event=function(a,d,c){var f=!0;browser.isOP&&(f=!1);a.removeEventListener?a.removeEventListener(d,c,f):a.detachEvent&&(a.detachEvent(d,c),a.detachEvent("on"+d,c))},getClick_X=function(a){return browser.isNS?a.clientX+window.scrollX:window.event.clientX+document.documentElement.scrollLeft+document.body.scrollLeft},getClick_Y=
function(a){return browser.isNS?a.clientY+window.scrollY:window.event.clientY+document.documentElement.scrollTop+document.body.scrollTop},findElementPos=function(a){for(var d=a,c=curtop=0;a;)c+=a.offsetLeft,curtop+=a.offsetTop,a=a.offsetParent;return[c,curtop,parseInt(d.style.width+c),parseInt(d.style.height+curtop)]};
function Browser(){this.isKonqueror=this.isOP=this.isNS=this.isIE=!1;this.name=navigator.appName;this.version=null;-1!=navigator.userAgent.indexOf("Opera")?this.isOP=!0:"Netscape"==navigator.appName||"Konqueror"==navigator.appName?this.isKonqueror=this.isNS=!0:-1!=navigator.appName.indexOf("Microsoft")&&(this.isIE=!0)}var browser=new Browser;function IsNumeric(a){var d=!0,c;for(i=0;i<a.length&&1==d;i++)c=a.charAt(i),-1=="0123456789.".indexOf(c)&&(d=!1);return d}
function dump(a,d,c){var f="";c||(c="");d||(d=0);if("object"===typeof a)for(var b in a){var e=a[b],l=c;IsNumeric(b)?(b="["+b+"]",l=c.substr(0,c.length-1)+b):l=c+b;f="object"===typeof e?f+dump(e,d+1,l+"."):f+(l+'="'+e+'"<br>\n')}else f="===>"+a+"<===("+typeof a+")";return f}
var Url={encode:function(a){return escape(this._utf8_encode(a))},decode:function(a){alert("Deprecated function !!! WMJSTools line 325 with ["+a+"]");return this._utf8_decode(unescape(a))},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var d="",c=0;c<a.length;c++){var f=a.charCodeAt(c);128>f?d+=String.fromCharCode(f):(127<f&&2048>f?d+=String.fromCharCode(f>>6|192):(d+=String.fromCharCode(f>>12|224),d+=String.fromCharCode(f>>6&63|128)),d+=String.fromCharCode(f&63|128))}return d},_utf8_decode:function(a){for(var d=
"",c=0,f=c1=c2=0;c<a.length;)f=a.charCodeAt(c),128>f?(d+=String.fromCharCode(f),c++):191<f&&224>f?(c2=a.charCodeAt(c+1),d+=String.fromCharCode((f&31)<<6|c2&63),c+=2):(c2=a.charCodeAt(c+1),c3=a.charCodeAt(c+2),d+=String.fromCharCode((f&15)<<12|(c2&63)<<6|c3&63),c+=3);return d}};Array.indexOf||(Array.prototype.indexOf=function(a){for(var d=0;d<this.length;d++)if(this[d]==a)return d;return-1});
function createXHR(){try{return new XMLHttpRequest}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(a){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){}return!1}
function MakeJSONRequest(a,d,c,f,b){function e(a){c?c(a,f):d(void 0,f)}function l(){0==b?(a=requestProxy+"REQUEST="+URLEncode(a),MakeJSONRequest(a,d,c,f,!0)):e("status("+m.status+") to "+a)}a=-1==a.indexOf("?")?a+"?":a+"&";a+="rand="+Math.random();b||(b=!1);try{var m=createXHR();m.open("GET",a,!0);m.onreadystatechange=function(){if(4==m.readyState)if(200==m.status){try{var b=eval("("+m.responseText+")")}catch(c){e("Invalid JSON: '"+m.responseText+"'");return}void 0==b?e("request returned no data:"+
a):d(b,f)}else l()};m.send(null)}catch(n){l()}}
function MakeHTTPRequest(a,d,c,f,b){function e(a){c?c(a,f):d(void 0,f)}function l(){0==b?(a=requestProxy+"REQUEST="+URLEncode(a),MakeHTTPRequest(a,d,c,f,!0)):e("status("+m.status+") to "+a)}a=-1==a.indexOf("?")?a+"?":a+"&";a+="rand="+Math.random();b||(b=!1);try{var m=createXHR();m.open("GET",a,!0);m.onreadystatechange=function(){if(4==m.readyState)if(200==m.status){try{var a=m.responseText}catch(b){e("Exception occured:"+b);return}void 0==a||""==a?e("request returned no data"):d(a,f)}else l()};m.send(null)}catch(n){l()}}
var URLDecode=function(a){if(!isDefined(a))return"";a=a.replaceAll("+"," ");a=a.replaceAll("%2B","+");a=a.replaceAll("%20"," ");a=a.replaceAll("%5E","^");a=a.replaceAll("%26","&");a=a.replaceAll("%3F","?");a=a.replaceAll("%3E",">");a=a.replaceAll("%3C","<");a=a.replaceAll("%5C","\\");a=a.replaceAll("%2F","/");a=a.replaceAll("%25","%");a=a.replaceAll("%3A",":");a=a.replaceAll("%27","'");return a=a.replaceAll("%24","$")},URLEncode=function(a){if(!a||void 0==a||""==a||"string"!==typeof a)return a;a=
a.replace(/\%/g,"%25");a=a.replace(/\+/g,"%2B");a=a.replace(/\ /g,"%20");a=a.replace(/\^/g,"%5E");a=a.replace(/\&/g,"%26");a=a.replace(/\?/g,"%3F");a=a.replace(/\>/g,"%3E");a=a.replace(/\</g,"%3C");a=a.replace(/\\/g,"%5C");for(var d="",c=0;c<a.length;c++){var f=a.charAt(c);if(" "==f)d+="%20";else if(-1!="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz%-_.!~*'()".indexOf(f))d+=f;else{var b=f.charCodeAt(0);255<b?(alert("Unicode Character '"+f+"' cannot be encoded using standard URL encoding.\n(URL encoding only supports 8-bit characters.)\nA space (+) will be substituted."),
d+="+"):(d+="%",d+="0123456789ABCDEF".charAt(b>>4&15),d+="0123456789ABCDEF".charAt(b&15))}}return d};String.prototype.replaceAll=function(a,d){for(var c=this,f=c.indexOf(a);-1!=f;)c=c.replace(a,d),f=c.indexOf(a);return c};String.prototype.trim=function(){var a;a=this.replace(/^\s+/,"");return a=a.replace(/\s+$/,"")};function checkValidInputTokens(a){var d=/^([a-zA-Z'_:~%?\$,\.\0-9 \-=/&])+$/;return d.test(a)&&(a=URLDecode(a),d.test(a))?!0:!1}
function getUrlVars(){for(var a=[],d,c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),f=0;f<c.length;f++)d=c[f].split("="),d[1]=URLDecode(d[1]),0!=checkValidInputTokens(d[0])&&0!=checkValidInputTokens(d[1])&&(a[d[0]]=d[1]+"");return a}
function getUrlVarsFromHashTag(){var a=[],d;d=window.location.hash.indexOf("#");"?"==window.location.hash[d+1]&&d++;for(var c=window.location.hash.slice(d+1).split("&"),f=0;f<c.length;f++)d=c[f].split("="),d[1]=URLDecode(d[1]),0!=checkValidInputTokens(d[0])&&0!=checkValidInputTokens(d[1])&&(a[d[0]]=d[1]+"");return a}
var composeUrlObjectFromURL=function(a){var d=[];if(!isDefined(a))return d;var c="",f=[],f=a.split("?");1<f.length?(c=f[0],f=f[1].split("&")):f=f[0].split("&");for(a=0;a<f.length;a++)hash=f[a].split("="),isDefined(hash[1])?(hash[1]=URLDecode(hash[1]),0!=checkValidInputTokens(hash[0])&&0!=checkValidInputTokens(hash[1])&&isDefined(hash[1])&&0<hash[1].length&&(d[hash[0].toLowerCase()]=hash[1]+"")):(hash=f[a].split("%3D"),isDefined(hash[1])&&(hash[1]=URLDecode(hash[1]),0!=checkValidInputTokens(hash[0])&&
0!=checkValidInputTokens(hash[1])&&isDefined(hash[1])&&0<hash[1].length&&(d[hash[0].toLowerCase()]=hash[1]+"")));f[0].indexOf("=");return{location:c,kvp:d}},currentLocationHash="",hashTagCheckerInUse=!1,_checkIfHashTagChanged=function(a){var d=window.location.hash;currentLocationHash!=d&&0<d.length&&(currentLocationHash=d,-1!=window.location.href.indexOf("#")&&(d=window.location.href.split("#")[1],d=d.replaceAll("%27","'"),urlVars=getUrlVarsFromHashTag(),isDefined(urlVars.clearhash)&&"1"==urlVars.clearhash&&
(currentLocationHash=window.location.hash=""),a(d,urlVars)));setTimeout(function(){_checkIfHashTagChanged(a)},100)},checkIfHashTagChanged=function(a){isDefined(a)&&(1==hashTagCheckerInUse?alert("checkIfHashTagChanged is in use"):(hashTagCheckerInUse=!0,_checkIfHashTagChanged(a)))},decodeBase64=function(a){var d={},c,f=0,b,e=0,l,m="",n=String.fromCharCode,k=a.length;for(c=0;64>c;c++)d["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(c)]=c;for(b=0;b<k;b++)for(c=d[a.charAt(b)],
f=(f<<6)+c,e+=6;8<=e;)((l=f>>>(e-=8)&255)||b<k-2)&&(m+=n(l));return m};function DateInterval(a,d,c,f,b,e){this.year=parseInt(a);this.month=parseInt(d);this.day=parseInt(c);this.hour=parseInt(f);this.minute=parseInt(b);this.second=parseInt(e);this.isRegularInterval=!1;0==this.month&&0==this.year&&(this.isRegularInterval=!0);this.getTime=function(){var a;if(0!=this.month)throw"month != 0";if(0!=this.year)throw"year != 0";a=0+86400*this.day;a+=3600*this.hour;a+=60*this.minute;a+=this.second;return 1E3*a};this.toISO8601=function(){var a="P";0!=this.year&&(a+=this.year+"Y");
0!=this.month&&(a+=this.month+"M");0!=this.day&&(a+=this.day+"D");0!=this.hour&&0!=this.minute&&0!=this.second&&(a+="T");0!=this.hour&&(a+=this.hour+"H");0!=this.minute&&(a+=this.minute+"M");0!=this.second&&(a+=this.second+"S");return a}}
function parseISO8601DateToDate(a){if(a){var d=a.split("T");d[0]=d[0].replace(/-/g,":");d[0]=d[0].replace(/::/g,":-");a=d[0].split(":");var d=d[1].split(":"),c=new Date(Date.UTC(a[0],a[1]-1,a[2],d[0],d[1],d[2].split("Z")[0]));c.add=function(a){0==a.isRegularInterval?(0!=a.year&&this.setUTCFullYear(this.getUTCFullYear()+a.year),0!=a.month&&this.setUTCMonth(this.getUTCMonth()+a.month),0!=a.day&&this.setUTCDate(this.getUTCDate()+a.day),0!=a.hour&&this.setUTCHours(this.getUTCHours()+a.hour),0!=a.minute&&
this.setUTCMinutes(this.getUTCMinutes()+a.minute),0!=a.second&&this.setUTCSeconds(this.getUTCSeconds()+a.second)):this.setTime(this.getTime()+a.getTime())};c.substract=function(a){0==a.isRegularInterval?(0!=a.year&&this.setUTCFullYear(this.getUTCFullYear()-a.year),0!=a.month&&this.setUTCMonth(this.getUTCMonth()-a.month),0!=a.day&&this.setUTCDate(this.getUTCDate()-a.day),0!=a.hour&&this.setUTCHours(this.getUTCHours()-a.hour),0!=a.minute&&this.setUTCMinutes(this.getUTCMinutes()-a.minute),0!=a.second&&
this.setUTCSeconds(this.getUTCSeconds()-a.second)):this.setTime(this.getTime()-a.getTime())};c.addMultipleTimes=function(a,b){0==a.isRegularInterval?(0!=a.year&&this.setUTCFullYear(this.getUTCFullYear()+a.year*b),0!=a.month&&this.setUTCMonth(this.getUTCMonth()+a.month*b),0!=a.day&&this.setUTCDate(this.getUTCDate()+a.day*b),0!=a.hour&&this.setUTCHours(this.getUTCHours()+a.hour*b),0!=a.minute&&this.setUTCMinutes(this.getUTCMinutes()+a.minute*b),0!=a.second&&this.setUTCSeconds(this.getUTCSeconds()+a.second*
b)):this.setTime(this.getTime()+a.getTime()*b)};c.substractMultipleTimes=function(a,b){0==a.isRegularInterval?(0!=a.year&&this.setUTCFullYear(this.getUTCFullYear()-a.year*b),0!=a.month&&this.setUTCMonth(this.getUTCMonth()-a.month*b),0!=a.day&&this.setUTCDate(this.getUTCDate()-a.day*b),0!=a.hour&&this.setUTCHours(this.getUTCHours()-a.hour*b),0!=a.minute&&this.setUTCMinutes(this.getUTCMinutes()-a.minute*b),0!=a.second&&this.setUTCSeconds(this.getUTCSeconds()-a.second*b)):this.setTime(this.getTime()-
a.getTime()*b)};c.toISO8601=function(){function a(b,d){var c=b+"",f=d-c.length,n,k="";for(n=0;n<f;n++)k+="0"+k;return k+c}return a(this.getUTCFullYear(),4)+"-"+a(this.getUTCMonth()+1,2)+"-"+a(this.getUTCDate(),2)+"T"+a(this.getUTCHours(),2)+":"+a(this.getUTCMinutes(),2)+":"+a(this.getUTCSeconds(),2)+"Z"};c.clone=function(){return parseISO8601DateToDate(c.toISO8601())};return c}console.log("Warning: no date given to parseISO8601DateToDate")}
function parseISO8601IntervalToDateInterval(a){if("P"==a.charAt(0)){var d=a.split("T"),c=a=0,f=0,b=0;seconds=minutes=0;var e=d[0].split("P")[1];if(e){var l=e.indexOf("Y"),m=e.indexOf("M"),n=e.indexOf("D");-1!=l&&(a=e.substring(0,l));-1!=m&&(c=e.substring(l+1,m));-1!=n&&(-1!=m&&(l=m),f=e.substring(l+1,n))}0<d.length&&isDefined(d[1])&&(d=d[1])&&(l=d.indexOf("H"),e=d.indexOf("M"),m=d.indexOf("S"),-1!=l&&(b=d.substring(0,l)),-1!=e&&(minutes=d.substring(l+1,e)),-1!=m&&(-1!=e&&(l=e),seconds=d.substring(l+
1,m)));return new DateInterval(a,c,f,b,minutes,seconds)}}function getNumberOfTimeSteps(a,d,c){var f=0;if(0!=c.month||0!=c.year){a=a.clone();for(d=d.getTime();a.getTime()<d;)a.add(c),f++;f++}else f=parseInt((d.getTime()-a.getTime())/c.getTime()+.5)+1;return f}
function parseISOTimeRangeDuration(a){a=a.split("/");void 0==a[2]&&(a[2]="PT1M");void 0==a[1]&&(a[1]=a[0],a[2]="PT1M");this.startTime=parseISO8601DateToDate(a[0]);this.stopTime=parseISO8601DateToDate(a[1]);this.timeInterval=parseISO8601IntervalToDateInterval(a[2]);this.timeSteps=getNumberOfTimeSteps(this.startTime,this.stopTime,this.timeInterval);this.getTimeSteps=function(){return this.timeSteps};this.getDateAtTimeStep=function(a){if(0==this.timeInterval.isRegularInterval){var c=this.startTime.clone();
c.addMultipleTimes(this.timeInterval,a)}else{var c=this.startTime.clone(),f=this.timeInterval.getTime(),f=f*a;c.setTime(c.getTime()+f)}return c};this.getTimeStepFromISODate=function(a,c){try{currentDate=parseISO8601DateToDate(a)}catch(f){throw"The date '"+a+"' is not a valid date";}return this.getTimeStepFromDate(currentDate,c)};this.getTimeStepFromDate=function(a,c){c||(c=!1);var f=a.getTime();if(f<this.startTime.getTime()){if(1==c)throw 0;return 0}var b=this.stopTime.clone();b.add(this.timeInterval);
if(f>b.getTime()){if(1==c)throw this.timeSteps-1;return this.timeSteps-1}if(f>this.stopTime.getTime())return this.timeSteps-1;b=0;if(0==this.timeInterval.isRegularInterval){b=this.startTime.clone();for(j=0;j<this.timeSteps;j++){var e=b.getTime();b.add(this.timeInterval);var l=b.getTime();if(f>=e&&f<l)return j}throw"Date "+a.toISO8601()+" not found!";}b=(a.getTime()-this.startTime.getTime())/this.timeInterval.getTime();return b=parseInt(b);throw"Date "+a.toISO8601()+" not found";};this.getTimeStepFromDate_WithinRange=
function(a){return this.getTimeStepFromDate(a,!0)};this.getTimeStepFromDate_Clipped=function(a){return this.getTimeStepFromDate(a,!1)}}function getCurrentDateIso8601(){return parseISO8601DateToDate((new Date).toISOString().substring(0,19)+"Z")};Proj4js.defs["EPSG:3575"]="+proj=laea +lat_0=90 +lon_0=10 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs";Proj4js.defs["EPSG:3785"]="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs";Proj4js.defs["EPSG:3857"]="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs";Proj4js.defs["EPSG:3411"]="+proj=stere +lat_0=90 +lat_ts=70 +lon_0=-45 +k=1 +x_0=0 +y_0=0 +a=6378273 +b=6356889.449 +units=m +no_defs";
Proj4js.defs["EPSG:3412"]="+proj=stere +lat_0=-90 +lat_ts=-70 +lon_0=0 +k=1 +x_0=0 +y_0=0 +a=6378273 +b=6356889.449 +units=m +no_defs";Proj4js.defs["EPSG:4326"]="+proj=longlat +datum=WGS84 +no_defs";Proj4js.defs["EPSG:28992"]="+proj=sterea +lat_0=52.15616055555555 +lon_0=5.38763888888889 +k=0.9999079 +x_0=155000 +y_0=463000 +ellps=bessel +units=m +no_defs  <>";Proj4js.defs["EPSG:32661"]="+proj=stere +lat_0=90 +lat_ts=90 +lon_0=0 +k=0.994 +x_0=2000000 +y_0=2000000 +ellps=WGS84 +datum=WGS84 +units=m +no_defs";
Proj4js.defs["EPSG:102100"]=Proj4js.defs["EPSG:3857"];var epsgDescriptionLookup=[];epsgDescriptionLookup["EPSG:3411"]="NSIDC Sea Ice Polar Stereographic North";epsgDescriptionLookup["EPSG:3412"]="NSIDC Sea Ice Polar Stereographic South";epsgDescriptionLookup["EPSG:3575"]="Lambert azimuthal equal-area projection Europe";epsgDescriptionLookup["EPSG:3785"]="Mercator (deprecated)";epsgDescriptionLookup["EPSG:3857"]="Mercator";epsgDescriptionLookup["EPSG:4258"]="ETRS89";
epsgDescriptionLookup["EPSG:4326"]="World Lat lon WGS84";epsgDescriptionLookup["CRS:84"]="World Lat lon WGS84";epsgDescriptionLookup["EPSG:25831"]="ETRS89 / UTM zone 31N";epsgDescriptionLookup["EPSG:25832"]="ETRS89 / UTM zone 32N";epsgDescriptionLookup["EPSG:28992"]="Dutch Amersfoort / RD New";epsgDescriptionLookup["EPSG:32661"]="Polar Stereographic WGS 84 / UPS North";$.widget("ui.iconbutton",$.extend({},$.ui.button.prototype,{_init:function(){$.ui.button.prototype._init.call(this);this.element.removeClass("ui-corner-all").addClass("ui-iconbutton").unbind(".button")}}));var WMJSTileRenderer=function(a,d,c,f,b,e,l,m,n){if(n){"streetmap"===n&&(n="OSM");"pdok"===n&&(n="OSM");"naturalearth2"===n&&(n="NaturalEarth2");var k=m[n];if(k){var p=k[c];if(!p)for(var w in m)if(m.hasOwnProperty(w))for(var z in m[w])m[w].hasOwnProperty(z)&&z===c&&(p=m[w][z]);m=Math.PI;var q=256,u=12756274*m/q,r=-12756274*m/2,J=12756274*m/2;p.tileSize&&(q=p.tileSize);p.resolution&&(u=p.resolution);p.origX&&(r=p.origX);p.origY&&(J=p.origY);m=u*q+r;var D=J-u*q,R=m-r,g=J-D;(function(k){var n=p.home,
m=p.tileServerType;k<p.minLevel&&(k=p.minLevel);k>p.maxLevel&&(k=p.maxLevel);var w=Math.pow(2,k),z=R/(u/w*q),K=g/(u/w*q),w=parseInt(Math.round((a.left-r)/R*z/1+.5)),t=parseInt(Math.round((a.right-r)/R*z/1+.5)),B=parseInt(Math.round(K-(a.bottom-D)/g*K+.5)),Y=parseInt(Math.round(K-(a.top-D)/g*K+.5)),fa=function(a,b,d){a=u/Math.pow(2,a);return{x:b*a+r,y:J-d*a}},V=function(a,b,d,c){c=c*(a.y-b.top)/(b.bottom-b.top);return{x:parseFloat(d*(a.x-b.left)/(b.right-b.left)),y:parseFloat(c)}},O=function(a,c,k,
e){var g,p,w,u;w=fa(c,k*q,e*q);u=fa(c,(k+1)*q,(e+1)*q);g=w.x;p=w.y;w=u.x;u=u.y;g=V({x:g,y:p},d,f,b);w=V({x:w,y:u},d,f,b);p=void 0;"osm"===m&&(p=n+c+"/"+k+"/"+e+".png");if("arcgisonline"===m||"wmst"===m)p=n+c+"/"+e+"/"+k;c=l.getImage(p);!1===c.isLoaded()&&!1===c.hasError()&&!1===c.isLoading()&&c.load();if(c.isLoaded())try{a.drawImage(c.getElement()[0],parseInt(g.x),parseInt(g.y),parseInt(w.x-g.x)+1,parseInt(w.y-g.y)+1)}catch(r){}};if("EPSG:4326"===c||"EPSG:4258"===c)z*=2;1>Y&&(Y=1);Y>K&&(Y=K);1>w&&
(w=1);w>z&&(w=z);1>B&&(B=1);B>K&&(B=K);1>t&&(t=1);t>z&&(t=z);if(!(10<B-Y||10<t-w))for(z=Y-1;z<B;z++)for(K=w-1;K<t;K++)O(e,k,K,z)})(parseInt(Math.log(Math.abs(m-r)/((a.right-a.left)/f*q))/Math.log(2)))}else console.error("Tiled layer with name "+n+" not found")}else console.error("layerName not defined")};var WMJSImageStore=function(a,d,c){this.imagesbysrc={};var f=this.imageLife=0,b=this,e=[],l=function(a,b){for(var d=0;d<e.length;d++)e[d](a)};b.getImageForSrc=function(a){if(b.imagesbysrc[a])return b.imagesbysrc[a]};b.clear=function(){for(var a in b.imagesbysrc)b.imagesbysrc.hasOwnProperty(a)&&b.imagesbysrc[a].clear()};b.addLoadEventCallback=function(a){e.push(a)};b.getNumImagesLoading=function(){var a=0,d;for(d in b.imagesbysrc)b.imagesbysrc.hasOwnProperty(d)&&b.imagesbysrc[d].isLoading()&&a++;return a};
b.getImage=function(e){var n=b.getImageForSrc(e);if(void 0!==n)return n.imageLife=f++,n;var k;n=b.imagesbysrc;if(Object.keys)k=Object.keys(n);else{var p=[];for(k in n)Object.prototype.hasOwnProperty.call(n,k)&&p.push(k);k=p}if(k.length<a)return n=new WMJSImage(e,l,d,c),n.setSource(e),n.KVP=WMJSKVP(e),b.imagesbysrc[e]=n,n.imageLife=f++,n;k=-1;var n=f,w;for(w in b.imagesbysrc)b.imagesbysrc.hasOwnProperty(w)&&(p=b.imagesbysrc[w],!1===p.isLoading()&&!0===p.isLoaded()&&n>=p.imageLife&&(n=p.imageLife,k=
w));console.log("Reusing image "+k+" with lifetime "+n);if(-1===k)console.error("not enough cache for "+d);else return n=b.imagesbysrc[k],delete b.imagesbysrc[k],n.clear(),n.setSource(e),n.KVP=WMJSKVP(e),b.imagesbysrc[e]=n,n.imageLife=f++,n}};var WebMapJSMapNo=0,WebMapJSMapVersion="3.0.4",logging=!1,base="./",noimage,showDialog=!0,loadingImageSrc,WMSControlsImageSrc,mapPinImageSrc,scaleBarURL,enableConsoleDebugging=!1,enableConsoleErrors=!1,debug=function(a){enableConsoleDebugging&&console.log(a)},error=function(a){enableConsoleErrors&&console.log("WebMapJS warning: ",a)},WMJScheckURL=function(a){if(!isDefined(a))return"?";a=a.trim();-1==a.indexOf("?")&&(a+="?");return a};
function WMJSProjection(){this.bbox=new WMJSBBOX;this.srs="EPSG:4326"}var legendImageStore,getMapImageStore,bgMapImageStore,maxAnimationSteps=1E3;legendImageStore=new WMJSImageStore(5*maxAnimationSteps,"wmjslegendbuffer");getMapImageStore=new WMJSImageStore(5*maxAnimationSteps,"wmjsimagebuffer");bgMapImageStore=new WMJSImageStore(5E3,"wmjsimagebuffer",{randomizer:!1});
var setBaseURL=function(a){base=a;noimage=base+"/img/blank.gif?";loadingImageSrc=base+"/img/ajax-loader.gif";WMSControlsImageSrc=base+"/img/mapcontrols.gif";mapPinImageSrc=base+"/img/dot.gif";isDefined(scaleBarURL)||(scaleBarURL=base+"/php/makeScaleBar.php?");xml2jsonrequestURL=base+"/php/xml2jsonrequest.php?"},showDialogs=function(a){showDialog=a};
function WMJSMap(a,d){var c,f,b,e;function l(a){function E(b){b.currentTarget.removeEventListener("load",E,!1);d(a)}function b(E){(E=(E||event).srcElement)&&/^(complete|loaded)$/i.test(E.readyState)&&(E.detachEvent("onreadystatechange",b),d(a))}function d(a){1!=a.loadEventDone&&(a.loadEventDone=!0,a.loadEvent&&a.loadEvent(a))}a.style.left="0px";a.style.top="0px";a.loadEventDone=!1;a.failed=!1;a.addEventListener?a.addEventListener("load",E,!1):a.attachEvent("onreadystatechange",b);a.onerror=function(){a.src&&
a.src!=noimage&&(error(a.src),a.failed=!0,a.loadEvent&&a.loadEvent(a))}}function m(a){if(a){for(var E=0;E<r.length;E++)if(r[E]==a)return E;return-1}}function n(){k.mousedown(g.mouseDownEvent);k.mousewheel(g.mouseWheelEvent);attach_event(document,"mouseup",g.mouseUpEvent);attach_event(document,"mousemove",g.mouseMoveEvent);if(g.isTouchDevice()){g.enableInlineGetFeatureInfo(!1);var a=new Hammer.Manager(document.body);a.add(new Hammer.Pan);a.add(new Hammer.Pinch);a.get("pan").set({direction:Hammer.DIRECTION_ALL});
a.add(new Hammer.Swipe).recognizeWith(a.get("pan"));a.on("panstart",function(a){a.preventDefault();g.mouseDown(a.center.x,a.center.y,a)});a.on("panmove",function(a){a.preventDefault();g.mouseMove(a.center.x,a.center.y,a)});a.on("panend",function(a){a.preventDefault();g.mouseUp(a.center.x,a.center.y,a)});a.on("pinchstart",function(a){a.preventDefault();g.pinchStart(a.center.x,a.center.y,a)});a.on("pinchmove",function(a){a.preventDefault();g.pinchMove(a.center.x,a.center.y,a)});a.on("pinchend",function(a){a.preventDefault();
g.pinchEnd(a.center.x,a.center.y,a)})}g.setMapModePan()}this.setBaseURL=function(a){base=a;noimage=base+"/img/blank.gif?";loadingImageSrc=base+"/img/ajax-loader.gif";WMSControlsImageSrc=base+"/img/mapcontrols.gif";mapPinImageSrc=base+"/img/dot.gif";isDefined(scaleBarURL)||(scaleBarURL=base+"/php/makeScaleBar.php?")};this.showDialogs=function(a){showDialog=a};this.setBaseURL(base);this.setXML2JSONURL=function(a){xml2jsonrequest=a};this.setWMJSTileRendererTileSettings=function(a){tileRenderSettings=
a};try{isDefined(d)&&(xml2jsonrequestURL=d)}catch(U){xml2jsonrequestURL=base+"/php/xml2jsonrequest.php?"}try{isDefined(requestProxy)}catch(U){requestProxy=base+"/php/MakeRequest.php?"}try{isDefined(scaleBarURL)}catch(U){scaleBarURL=base+"/php/makeScaleBar.php?"}var k,p,w=new WMJSBBOX,z=new WMJSBBOX,q=2,u=2,r=[],J=[],D="",R=0,g=this;g.renderer="WMJSCanvasBuffer";var ea=!1,I=document.createElement("div"),A=document.createElement("div"),v=document.createElement("div"),S=document.createElement("div"),
K=!0,t=new WMJSBBOX,B=new WMJSBBOX,Y=new WMJSBBOX,fa=new WMJSBBOX,V=new WMJSBBOX,O=[];g.getLegendStore=function(){return legendImageStore};var H=[],qa=!1,Xa="default",Ba=!1,Ia="default",Ya=!1,Za=!1,Ja=$('<div class="WMJSDivBuffer-loading"/>',{}),$a=0,da=0,ga=1,Ca,ra=0,W=0,La=0,Ma=0,Z=Array(3),Na=Array(3);for(j=0;3>j;j++)Z[j]=new WMJSProjection,Na[j]=new WMJSProjection;var ab=!0,C=new WMJSListener;this.getGraphingData=function(){return this.graphingData};this.setGraphingData=function(a){this.graphingData=
a};var Oa=function(U){a.id||(a.id="WebMapJSMapNo_"+WebMapJSMapNo,WebMapJSMapNo++);return a.id+"_"+U};this.enableInlineGetFeatureInfo=function(a){ab=a};this.closeAllGFIDialogs=function(){WMJSDialog.closeAllDialogs(T)};var T=[],bb=function(){enableConsoleDebugging&&console.log("onlegendready called");ha()},sa=[],Da=0,ta=!1,ha=function(a){if(!(2>O.length)){try{0==isDefined(a)&&(a=!1);if(1==ta&&isDefined(bb)){1==C.addToCallback("onlegendready",bb)&&enableConsoleDebugging&&console.log("Suspending on onlegendready");
return}ta=!0;if(1==K){if(sa.length!=r.length)a=!0;else for(var E=0;E<r.length;E++){var b=g.getLegendGraphicURLForLayer(r[E]);isDefined(b)&&sa[E]!==b&&(sa[E]=b,a=!0)}if(a){sa=[];for(E=0;E<r.length;E++)!1!==r[E].enabled&&(b=g.getLegendGraphicURLForLayer(r[E]),isDefined(b)&&(sa[E]=b,O[Da].setSrc(E,b)));var d=Da;Da=1-Da;try{O[d].load(function(){enableConsoleDebugging&&console.log("Legend buffer nr"+d);try{for(var a=0,U=0;U<O[d].layers.length;U++){O[d].layers[U].getElement();var E=O[d].layers[U].getElement()[0].height;
a<E&&(a=E)}O[d].display();O[1-d].hide()}catch(b){console.error(b)}ta=!1;C.triggerEvent("onlegendready")})}catch(c){console.error(c),O[0].hide(),O[1].hide(),ta=!1,C.triggerEvent("onlegendready")}return}}else O[0].hide(),O[1].hide()}catch(c){console.log(c)}ta=!1;C.triggerEvent("onlegendready")}},Pa="",Qa="";this.setMessage=function(a){Qa=a&&""!==a?a:""};this.setTimeOffset=function(a){Pa=a&&""!==a?a:""};this.canvasErrors=[];this.getCapabilitiesJSON=function(a,E){WMJSGetCapabilities(a,!0,E,function(a){error(a);
E(a)})};this.rebuildMapDimensions=function(){for(var a=0;a<J.length;a++)J[a].used=!1;for(i=0;i<r.length;i++)for(a=0;a<r[i].dimensions.length;a++){var E=r[i].dimensions[a],b=g.getDimension(E.name);isDefined(b)?b.used=!0:(E=E.clone(),E.used=!0,J.push(E))}for(a=0;a<J.length;a++)0==J[a].used&&(J.splice(a,1),a--);C.triggerEvent("onmapdimupdate")};this.getLayerByServiceAndName=function(a,b){for(var d=0;d<r.length;d++){var c=r[r.length-d-1];if(c.name==b&&c.service==a)return c}};this.getLayers=function(){for(var a=
[],b=0;b<r.length;b++)a.push(r[r.length-b-1]);return a};this.setLayer=function(a,b){return g.addLayer(a,b,a)};this.setActive=function(a){Ya=a;Za=!0};this.setActiveLayer=function(a){Ca=a;ha();C.triggerEvent("onchangeactivelayer")};this.calculateNumBaseLayers=function(){R=0;if(D)for(var a=0;a<D.length;a++)D[a].enabled&&0==D[a].keepOnTop&&R++};this.enableLayer=function(a){a.enabled=!0;g.calculateNumBaseLayers();g.rebuildMapDimensions();ha(!0)};this.disableLayer=function(a){a.enabled=!1;g.calculateNumBaseLayers();
g.rebuildMapDimensions();ha(!0)};this.toggleLayer=function(a){a.enabled=1==a.enabled?!1:!0;g.calculateNumBaseLayers();g.rebuildMapDimensions();ha(!0)};this.displayLayer=function(a,b){a.enabled=b;g.calculateNumBaseLayers();g.rebuildMapDimensions();ha(!0)};this.removeAllLayers=function(){for(var a=0;a<r.length;++a)r[a].setAutoUpdate(!1);r=[];J=[];C.triggerEvent("onlayeradd")};this.deleteLayer=function(a){if(!(0>=r.length)){a.setAutoUpdate(!1);a=m(a);if(0<=a){for(var b=a;b<r.length-1;b++)r[b]=r[b+1];
r.length--;Ca=void 0;0<=a&&a<r.length?(g.rebuildMapDimensions(),g.setActiveLayer(r[a])):0<r.length&&(g.rebuildMapDimensions(),g.setActiveLayer(r[r.length-1]))}C.triggerEvent("onlayerchange");g.rebuildMapDimensions()}};this.moveLayerDown=function(a){var b=m(a);if(0<b){a=r[b-1];var d=r[b];a&&d&&(r[b]=a,r[b-1]=d)}else try{error("moveLayerDown: layer '"+a.name+"' not found.")}catch(c){error("moveLayerDown: layer invalid.")}};this.moveLayerUp=function(a){var b=m(a);if(b<r.length-1){a=r[b+1];var d=r[b];
a&&d&&(r[b]=a,r[b+1]=d)}else try{error("moveLayerUp: layer '"+a.name+"' not found.")}catch(c){error("moveLayerUp: layer invalid.")}};this.addLayer=function(a){isDefined(a)&&(a.parentMaps.includes(g)||a.parentMaps.push(g),r.push(a),a.parseLayer(function(a){for(var b=0;b<a.dimensions.length;b++){var U=g.getDimension(a.dimensions[b].name);isDefined(U)&&isDefined(U.currentValue)&&1==a.dimensions[b].linked&&a.dimensions[b].setClosestValue(U.currentValue)}g.rebuildMapDimensions();C.triggerEvent("onlayeradd")},
void 0,"WMJSLayer::addLayer"))};this.getActiveLayer=function(){return Ca};this.setProjection=function(a,b){g.hideMapPin();a||(a="EPSG:4326");"object"===typeof a&&(b=a.bbox,a=a.srs);p=a;g.proj4.srs==p&&isDefined(this.proj4.projection)||(g.proj4.projection=new Proj4js.Proj(p),g.proj4.srs=p);g.setBBOX(b);z.setBBOX(b);g.updateMouseCursorCoordinates();C.triggerEvent("onsetprojection",[p,t])};this.getBBOX=function(){return B};this.getProjection=function(a){return{srs:p,bbox:t}};this.getSize=function(){return{width:q,
height:u}};this.getWidth=function(){return q};this.getHeight=function(){return u};this.repositionLegendGraphic=function(a){K?ha(a):(O[0].hide(),O[1].hide())};this.resizeHeight=this.resizeWidth=-1;var Ra=!1,nb=new WMJSTimer;this.setSize=function(a,b){enableConsoleDebugging&&console.log("setSize",a,b);4>parseInt(a)||4>parseInt(b)?console.log("Skipping setSize",a,b):(this.resizeWidth=parseInt(a),this.resizeHeight=parseInt(b),!1===Ra?(Ra=!0,g._setSize(g.resizeWidth,g.resizeHeight)):nb.init(200,function(){Ra=
!1;g._setSize(g.resizeWidth,g.resizeHeight);g.draw("resizeTimer")}))};this._setSize=function(b,d){if(b&&d&&!(4>parseInt(b)||4>parseInt(d))){enableConsoleDebugging&&console.log("setSize("+b+","+d+")");var c=this.getProjection();q=parseInt(b);u=parseInt(d);if(4>q||isNaN(q))q=4;if(4>u||isNaN(u))u=4;c.srs&&c.bbox||(error("this.setSize: Setting default projection (EPSG:4326 with (-180,-90,180,90)"),c.srs="EPSG:4326",c.bbox.left=-180,c.bbox.bottom=-90,c.bbox.right=180,c.bbox.top=90,g.setProjection(c.srs,
c.bbox));k.css({width:q,height:u});a.style.width=q+"px";a.style.height=u+"px";g.setBBOX(w);g.repositionMapPin();g.showBoundingBox();1<H.length&&(H[0].resize(g.getWidth(),g.getHeight()),H[1].resize(g.getWidth(),g.getHeight()));1<O.length&&(O[0].resize(g.getWidth(),g.getHeight()),O[1].resize(g.getWidth(),g.getHeight()));g.repositionLegendGraphic(!0);H[ga]&&H[ga].display();C.triggerEvent("onresize",[q,u])}};this.getBBOXandProjString=function(a){var b="";if(a.version==WMSVersion.version100||a.version==
WMSVersion.version111)b+="SRS="+URLEncode(p)+"&",b+="BBOX="+t.left+","+t.bottom+","+t.right+","+t.top+"&";a.version==WMSVersion.version130&&(b+="CRS="+URLEncode(p)+"&",b="EPSG:4326"==p&&0==a.wms130bboxcompatibilitymode?b+("BBOX="+t.bottom+","+t.left+","+t.top+","+t.right+"&"):b+("BBOX="+t.left+","+t.bottom+","+t.right+","+t.top+"&"));return b};this.isTouchDevice=function(){return"undefined"!==typeof window.ontouchstart};this.getDimensionRequestString=function(a){return ua(a)};this.dateToISO8601=function(a){function b(a,
d){var U=a+"",E=d-U.length,c,k="";for(c=0;c<E;c++)k+="0"+k;return k+U}return b(a.getUTCFullYear(),4)+"-"+b(a.getUTCMonth()+1,2)+"-"+b(a.getUTCDate(),2)+"T"+b(a.getUTCHours(),2)+":"+b(a.getUTCMinutes(),2)+":"+b(a.getUTCSeconds(),2)+"Z"};this.buildWMSGetMapRequest=function(a){if(isDefined(a.name)&&(a.format||(a.format="image/png",error("layer format missing!")),!(1>a.name.length))){if("GFI:TIME_ELEVATION"==p){var b=a.getmapURL,b=b+("&SERVICE=WMS&REQUEST=GetFeatureInfo&VERSION="+a.version),b=b+("&LAYERS="+
URLEncode(a.name)),d=a.name.split(","),b=b+("&QUERY_LAYERS="+URLEncode(d[d.length-1])),b=b+"&BBOX=29109.947643979103,6500000,1190890.052356021,7200000"+("&CRS="+URLEncode("EPSG:3857")+"&"),b=b+("WIDTH="+q),b=b+("&HEIGHT="+u);if(a.version==WMSVersion.version100||a.version==WMSVersion.version111)b+="&X=707",b+="&Y=557";a.version==WMSVersion.version130&&(b+="&I=707",b+="&J=557");b+="&FORMAT=image/gif";b+="&INFO_FORMAT=image/png";b+="&STYLES=";a=g.dateToISO8601(new Date(t.left));d=g.dateToISO8601(new Date(t.right));
b+="&time="+a+"/"+d;return b+="&elevation="+t.bottom+"/"+t.top}b=a.getmapURL;b+="&SERVICE=WMS&";b+="VERSION="+a.version+"&";b+="REQUEST=GetMap&";b+="LAYERS="+URLEncode(a.name)+"&";b+="WIDTH="+q+"&";b+="HEIGHT="+u+"&";b+=g.getBBOXandProjString(a);b+="STYLES="+URLEncode(a.currentStyle)+"&";b+="FORMAT="+a.format+"&";b=!0===a.transparent?b+"TRANSPARENT=TRUE&":b+"TRANSPARENT=FALSE&";try{b+=ua(a)}catch(c){return}return b+=a.wmsextensions.url}};this.abort=function(){C.triggerEvent("onmapready");ea=!1;C.triggerEvent("onloadingcomplete")};
this.isBusy=function(){return ea||0==H[0].ready||0==H[1].ready?!0:!1};this.getLegendGraphicURLForLayer=function(a){if(a){var b=a.legendGraphic;if(b){b+="&layers="+URLEncode(a.name)+"&";try{1==a.legendIsDimensionDependant&&(b+=g.getDimensionRequestString(a)+"&")}catch(d){return}return b=b+"&transparent=true&width=90&height=250&"+a.wmsextensions.url}}};var Sa=!0;this.showScaleBar=function(){Sa=!0;console.log("todo showScaleBar")};this.hideScaleBar=function(){Sa=!1;console.log("todo hideScaleBar")};
this.getMaxNumberOfAnimations=function(){return maxAnimationSteps};this.drawLastTimes=function(a,b){b||(b="hours");if(0!==r.length){var d=this.getActiveLayer();if(d&&(d=d.getDimension("time"))){for(var c=d.size()-1,k=[],e=moment.utc(d.getValueForIndex(c)),f=e.subtract(a,b);0<=c;){e=d.getValueForIndex(c--);if(!e||e===WMJSDateTooEarlyString||f.isAfter(moment.utc(e)))break;k.unshift({name:"time",value:e})}this.draw(k)}}};this.drawAutomatic=function(a,b){if(0!==r.length){for(var d=a.format("YYYY-MM-DDTHH:mm:ss"),
c=[],k=0;moment(d)<b&&1E3>k;){k++;for(var e=null,f=r.length-1;0<=f;f--){var n=r[f].getDimension("time");n&&(n=n.getNextClosestValue(d))&&"date too early"!==n&&(null===e||moment(n)<moment(e))&&(e=n)}if(null===e)break;c.push({name:"time",value:e});d=e}if(0<c.length)c.pop(),this.draw(c);else if(d=r[0].getDimension("time")){c=d.size();e=Math.min(d.size(),100);k=[];for(e=c-e;e<c;++e)k.push({name:d.name,value:d.getValueForIndex(e)});this.draw(k)}}};new WMJSDebouncer;this.display=function(){H[ga].display(B,
Y);enableConsoleDebugging&&console.log("drawnBBOX.setBBOX(bbox)");V.setBBOX(t)};this.draw=function(a){g.isAnimating?enableConsoleDebugging&&console.log("ANIMATING: Skipping draw:"+a):g._draw(a)};this._draw=function(a){enableConsoleDebugging&&console.log("draw:"+a);enableConsoleDebugging&&console.log("drawnBBOX.setBBOX(bbox)");V.setBBOX(t);a:if(!(4>q||4>u)){C.triggerEvent("beforedraw");if(!1===g.isAnimating&&void 0!==a&&"object"===typeof a&&0<a.length){if(a.length>maxAnimationSteps){alert("Too many animations given, max is "+
maxAnimationSteps);g.draw("self");break a}g.isAnimating=!0;C.triggerEvent("onstartanimation",g);g.currentAnimationStep=0;g.animationList=[];g.mouseHoverAnimationBox=!1;for(var b=0;b<a.length;b++){var d={name:a[b].name,value:a[b].value};g.setDimension(a[b].name,a[b].value,!1);d.requests=g.getWMSRequests();g.animationList.push(d)}g.setDimension(g.animationList[g.currentAnimationStep].name,g.animationList[g.currentAnimationStep].value,!1);cb.checkAnimation()}4>q||4>u?console.log("map too small, skipping"):
g._pdraw()}};var ob=function(){debug("--\x3e onmapready event called");g.draw("onmapready callback")};this.getWMSRequests=function(){var a=[],b=g.getNumLayers();for(j=0;j<b;j++)if(r[j].service&&r[j].enabled){var d=g.buildWMSGetMapRequest(r[j]);d&&a.push(d)}return a};this.prefetch=function(a){var b=[];for(j=0;j<a.length;j++){var d=getMapImageStore.getImage(a[j]);0==d.isLoaded()&&0==d.isLoading()&&(b.push(d),d.load())}return b};this.getImageStore=function(){return getMapImageStore};this.isThisRequestLoaded=
function(a){a=getMapImageStore.getImageForSrc(a);if(void 0==a)return 0;if(a.isLoaded())return 2;if(a.isLoading())return 1};this.mouseHoverAnimationBox=!1;this._pdraw=function(){if(0!=$a)if(ea)1==C.addToCallback("onmapready",ob)&&debug("Suspending on onmapready");else{enableConsoleDebugging&&console.log("loadLayers");var a,b=0;R=0;if(D)for(var d=0;d<D.length;d++)D[d].enabled&&!1===D[d].keepOnTop&&(!D[d].type||"twms"!==D[d].type)&&(R++,a=g.buildWMSGetMapRequest(D[d]))&&(H[da].setSrc(b,a,g.getWidth(),
g.getHeight(),{layer:D[d]}),H[da].setOpacity(b,D[d].opacity),b++);for(d=d=0;d<g.getNumLayers();d++)r[d].service&&r[d].enabled&&(a=g.buildWMSGetMapRequest(r[d],r[d].dimensions))&&(H[da].setSrc(b,a,g.getWidth(),g.getHeight(),{layer:r[d]}),H[da].setOpacity(b,r[d].opacity),r[d].image=H[da].layers[b],b++);if(D)for(d=0;d<D.length;d++)D[d].enabled&&1==D[d].keepOnTop&&(a=g.buildWMSGetMapRequest(D[d]))&&(H[da].setSrc(b,a,g.getWidth(),g.getHeight(),{layer:D[d]}),H[da].setOpacity(b,D[d].opacity),b++);g.flipBuffers();
C.triggerEvent("ondrawready",g);ha()}};var cb,la=function(a){if(0!=H.length){var b=t;isDefined(a)&&(b=a);B.copy(b);H[ga].setBBOX(B,Y);H[ga].mapbbox=B;g.showBoundingBox(A.bbox,B);C.triggerEvent("onupdatebbox",B);g.repositionMapPin(a)}},db=new WMJSTimer;g.flipBuffers=function(){enableConsoleDebugging&&console.log("flipBuffers");var a=ga,b=da;C.triggerEvent("onmapstartloading");ea=!0;db.init(500,function(){Ja.show()});fa.setBBOX(t);H[b]&&H[b].load(function(){enableConsoleDebugging&&console.log("flipBuffers loadcomplete");
try{H[a].srs=p,H[b].bbox=t.clone(),H[b].srs=p,enableConsoleDebugging&&console.log("loadedBBOX.setBBOX(bbox)"),Y.setBBOX(fa),enableConsoleDebugging&&console.log("-----------------------"),H[b].display(B,Y),v.oldx=v.exactX,v.oldy=v.exactY,H[a].hide(),ga=b,da=a}catch(d){console.log(d)}ea=!1;C.triggerEvent("onmaploadingcomplete",g);C.triggerEvent("onloadingcomplete",g);C.triggerEvent("onmapready",g);Ja.hide();db.stop()})};g.getBackBufferCanvasContext=function(){return H[da].getCanvasContext()};g.getFrontBufferCanvasContext=
function(){return H[ga].getCanvasContext()};g.redrawBuffer=function(){H[ga].display();enableConsoleDebugging&&console.log("drawnBBOX.setBBOX(bbox)");V.setBBOX(t)};this.addBaseLayers=function(a){if(a){R=0;a=toArray(a);D.push(a);for(j=0;j<D.length;j++)1==D.keepOnTop&&R++;C.triggerEvent("onlayeradd")}else D=void 0};this.setBaseLayers=function(a){if(a){R=0;D=a;for(j=0;j<D.length;j++)1==D.keepOnTop&&R++;C.triggerEvent("onlayerchange")}else D=void 0};this.getBaseLayers=function(){return D};this.getNumLayers=
function(){return r.length};this.getBaseElement=function(){return k};var va=0,ma,eb=new WMJSDebouncer,na=0,wa=new WMJSBBOX,ia=new WMJSBBOX,xa=new WMJSBBOX,fb=new WMJSBBOX,ja=0,oa=0,hb=function(){na=ma/1;var a=1-na;ia.left=wa.left*a+xa.left*na;ia.bottom=wa.bottom*a+xa.bottom*na;ia.right=wa.right*a+xa.right*na;ia.top=wa.top*a+xa.top*na;la(ia);ma+=1;1<ma?(ma=1,g.setBBOX(ia),g.display(),0===oa?(ja=oa=0,g.draw("flyZoomToBBOXTimerFunc")):(ja=oa=0,gb(B,fb))):eb.init(10,hb)},gb=function(a,b){1===ja?(fb.copy(b),
oa=1):(wa.copy(a),xa.copy(b),ma=1,oa=0,0===ja&&(ja=1,hb()))},ib=new WMJSBBOX,ya=new WMJSBBOX;this.mouseWheelEvent=function(a,b,d,c){a.stopPropagation();preventdefault_event(a);if(1!=va){va=1;var k=B.right-B.left,e=B.bottom-B.top;a=g.getGeoCoordFromPixelCoord({x:F,y:G},V);c=(a.x-B.left)/k;d=(a.y-B.top)/e;var f;0>b?(k*=-.15,f=-.15*e):(k*=.1,f=.1*e);b=B.left+k;e=B.top+f;k=B.right-k;f=B.bottom-f;c=c*(k-b)+b-a.x;a=d*(f-e)+e-a.y;b-=c;k-=c;e-=a;f-=a;ib.copy(B);ya.left=b;ya.bottom=f;ya.right=k;ya.top=e;va=
0;gb(ib,ya)}};var N;this.pinchStart=function(a,d,k){b=k.pointers[0].clientX;e=k.pointers[0].clientY;c=k.pointers[1].clientX;f=k.pointers[1].clientY;N=t.clone();X=0;va=ca=1};this.pinchMove=function(a,d,k){X=0;pinchMove1={x:k.pointers[0].clientX,y:k.pointers[0].clientY};pinchMove2={x:k.pointers[1].clientX,y:k.pointers[1].clientY};a=pinchMove2.x-pinchMove1.x;d=c-b;k=pinchMove2.y-pinchMove1.y;var Ka=f-e;0==d&&(d=1);0==Ka&&(Ka=1);a*a>k*k?(a/=d,d=b-pinchMove1.x/a,t.right=((q-pinchMove1.x)/a+b)/q*(N.right-
N.left)+N.left,t.left=d/q*(N.right-N.left)+N.left,a=(N.right-N.left)/(N.top-N.bottom),d=(t.top+t.bottom)/2,a=(t.left-t.right)/2/a,t.bottom=d+a,t.top=d-a):(a=k/Ka,d=e-pinchMove1.y/a,t.bottom=((u-pinchMove1.y)/a+e)/u*(N.bottom-N.top)+N.top,t.top=d/u*(N.bottom-N.top)+N.top,a=(N.right-N.left)/(N.top-N.bottom),d=(t.right+t.left)/2,a*=(t.bottom-t.top)/2,t.left=d+a,t.right=d-a);la(t)};this.pinchEnd=function(a,b,d){va=ca=X=0;g.zoomTo(t);g.draw("pinchEnd")};g.destroy=function(){g.stopAnimating();for(var a=
r.length-1;0<=a;a--)r[a].setAutoUpdate(!1);console.log("Detaching...");k.off("mousedown");k.off("mousewheel");del_event(document,"mouseup",g.mouseUpEvent);del_event(document,"mousemove",g.mouseMoveEvent)};var jb=function(a){return"TIME"==a.toUpperCase()||"ELEVATION"==a.toUpperCase()?a:"DIM_"+a},ua=function(a){for(var b="",d=0;d<a.dimensions.length;d++){var c=a.dimensions[d].getValue(),b=b+("&"+jb(a.dimensions[d].name)),b=b+("="+URLEncode(c));if(c==WMJSDateOutSideRange||c==WMJSDateTooEarlyString||
c==WMJSDateTooLateString)throw WMJSDateOutSideRange;}return b},F=0,G=0,L=-1E4,M=-1E4,aa=1E4,ba=1E4,ca=0,X=0,P="pan";this.getMapMode=function(){return P};this.getWMSMetaDataRequestURL=function(a){var b=a.service,b=b+("&SERVICE=WMS&REQUEST=GetMetaData&VERSION="+a.version),b=b+("&LAYER="+URLEncode(a.name)),b=b+"&FORMAT=text/html";try{b+="&"+ua(a)}catch(d){return}debug("<a target='_blank' href='"+b+"'>"+b+"</a>",!1);return b};var ka=0,Ta=[],Ua=function(a,b){this.layer=a;this.data=b},pb=function(a,b,d,
c,k){c+="&GRAPHSTYLE="+k;c+="&"+g.getBBOXandProjString(a);c+="&LAYERS="+URLEncode(a.name);c+="WIDTH="+q;c+="&HEIGHT="+u;c+="&X="+b;c+="&Y="+d;c+="&FORMAT=image/png";c+="&INFO_FORMAT=text/html";c+="&STYLES=";try{c+="&"+ua(a)}catch(e){return}debug("<a target='_blank' href='"+c+"'>"+c+"</a>",!1);return c};this.getWMSGetFeatureInfoRequestURL=function(a,b,d){var c=WMJScheckURL(a.service),c=c+("&SERVICE=WMS&REQUEST=GetFeatureInfo&VERSION="+a.version),c=c+("&LAYERS="+URLEncode(a.name)),k=a.name.split(","),
c=c+("&QUERY_LAYERS="+URLEncode(k[k.length-1])),c=c+("&"+g.getBBOXandProjString(a)),c=c+("WIDTH="+q),c=c+("&HEIGHT="+u);if(a.version==WMSVersion.version100||a.version==WMSVersion.version111)c=c+("&X="+b)+("&Y="+d);a.version==WMSVersion.version130&&(c+="&I="+b,c+="&J="+d);c+="&FORMAT=image/gif";c+="&INFO_FORMAT=text/html";c+="&STYLES=";try{c+="&"+ua(a)}catch(e){return}debug("<a target='_blank' href='"+c+"'>"+c+"</a>",!1);return c};var Ea=function(a,b){ka--;var d;d=b?1==b.queryable?new Ua(b,a):new Ua(b,
"not queryable"):new Ua(b,"Query failed...");Ta.push(d);0>=ka&&(ka=0,C.triggerEvent("ongetfeatureinfoready",Ta))},qb=function(){debug("resuming on ongetpointinfoready");g.getPointInfo(L,M)},Fa=!1;this.getPointInfo=function(a,b){if(Fa)debug("suspending on ongetpointinfoready"),g.addListener("ongetpointinfoready",qb,!1);else{Fa=!0;C.triggerEvent("beforegetpointinfo");var d=g.getGraphingData();if(void 0==d)error("getPointInfo getGraphingData is undefined"),Fa=!1;else{debug("getPointInfo("+a+","+b+") "+
d.layer.name);var c=pb(d.layer,a,b,d.service,d.style);debug("GetPointInfo: "+c);var k=new Image;k.loadEvent=function(){Fa=!1;var a={};a.url=c;a.layer=d.layer;a.img=k;C.triggerEvent("ongetpointinfoready",a)};l(k);k.src=c}}};var rb=function(){debug("resuming on ongetfeatureinfoready");C.triggerEvent("beforegetfeatureinfo");g.getFeatureInfo(L,M)};this.getFeatureInfo=function(a,b){if(0<ka)debug("suspending on ongetfeatureinfoready"),g.addListener("ongetfeatureinfoready",rb,!1);else{debug("GetFeatureInfo:");
Ta=[];for(var d=ka=0;d<r.length;d++){var c=r[r.length-d-1];c.getFeatureInfoUrl="";c.service&&c.enabled&&1==c.queryable&&(c.getFeatureInfoUrl=g.getWMSGetFeatureInfoRequestURL(c,a,b),isDefined(c.getFeatureInfoUrl)?ka++:c.getFeatureInfoUrl="")}0==ka&&C.triggerEvent("ongetfeatureinfoready",["No layers to query"]);for(d=0;d<r.length;d++)if(c=r[r.length-d-1],""!=c.getFeatureInfoUrl)if(0==c.queryable)Ea("Layer is not queryable.",c);else try{MakeHTTPRequest(c.getFeatureInfoUrl,Ea,function(a,b){Ea(a,b);error(a)},
c)}catch(k){Ea("Exception: "+k,c)}}};this.getGetFeatureInfoObjectAsHTML=function(a){var b="";try{for(var b=b+'<div class="getfeatureinfo">',d=0;d<r.length;d++)for(var c=0;c<a.length;c++)a[c].layer==r[d]&&(b+='<div class="getfeatureinfolayer">',b+="<b><a target='_blank' href='"+a[c].layer.getFeatureInfoUrl+"'>"+a[c].layer.title+"</a></b><br/>",b+=a[c].data,b+="</div>");b+="</div>"}catch(k){b="No layers to query."}return b};this.getMapPinXY=function(){return[v.exactX,v.exactY]};this.positionMapPinByLatLon=
function(a){debug("positionMapPinByLatLon at "+a.x+","+a.y);a=g.getPixelCoordFromLatLong(a);g.setMapPin(a.x,a.y);g.showMapPin()};this.repositionMapPin=function(a){var b=t;isDefined(a)&&(b=a);a=g.getPixelCoordFromGeoCoord({x:v.geoPosX,y:v.geoPosY},b);g.setMapPin(a.x,a.y,b)};this.setMapPin=function(a,b,d){var c=a;"object"===typeof a&&(c=a.x,b=a.y);c&&b&&(v.x=parseInt(c),v.y=parseInt(b),v.exactX=parseFloat(c),v.exactY=parseFloat(b),a=g.getGeoCoordFromPixelCoord({x:v.exactX,y:v.exactY},d),v.geoPosX=a.x,
v.geoPosY=a.y,v.style.left=v.x-5+"px",v.style.top=v.y-7+"px")};this.isMapPinVisible=function(){return"none"==v.style.display?!1:!0};this.showMapPin=function(){v.innerHTML="<img src='"+mapPinImageSrc+"'>";v.style.display=""};this.hideMapPin=function(){v.style.display="none"};this.setMapModeGetInfo=function(){P="info";k.css("cursor","default")};this.setMapModeZoomBoxIn=function(a){P="zoom";k.css("cursor","default")};this.setMapModeZoomOut=function(a){P="zoomout";k.css("cursor","default")};this.setMapModePan=
function(a){P="pan";k.css("cursor","default")};this.setMapModePoint=function(a,b){P="point";k.css("cursor","url(webmapjs/img/aero_pen.cur), default")};var za;this.setMapModeNone=function(a){P="none";k.css("cursor","default")};this.getMouseCoordinatesForDocument=function(b){if(isDefined(b.changedTouches))return{x:parseInt(b.changedTouches[0].screenX),y:parseInt(b.changedTouches[0].screenY)};var d=$(a).parent().offset(),c=b.pageX,k=b.pageY;void 0==c&&(c=getClick_X(b));void 0==k&&(k=getClick_Y(b));return{x:c-
d.left,y:k-d.top}};this.getMouseCoordinatesForElement=function(b){if(isDefined(b.changedTouches))return{x:parseInt(b.changedTouches[0].screenX),y:parseInt(b.changedTouches[0].screenY)};var d=$(a).parent().offset(),c=b.pageX,k=b.pageY;void 0==c&&(c=getClick_X(b));void 0==k&&(k=getClick_Y(b));return{x:c-d.left,y:k-d.top}};this.mouseDown=function(a,b,d){var c=!1;d&&1==d.shiftKey&&(c=!0);L=a;M=b;X=1;if(0===ca&&0===(0>M|0>L|L>q|M>u?-1:0))for(a=C.triggerEvent("beforemousedown",{mouseX:a,mouseY:b,mouseDown:!0,
event:d}),b=0;b<a.length;b++)if(!1===a[b])return;c?(void 0==za&&(za=P),P="zoom"):void 0!=za&&(P=za,za=void 0);C.triggerEvent("mousedown",{map:g,x:L,y:M});"info"==P?(debug("GetFeatureInfo"),g.setMapPin(L,M),g.showMapPin(),C.triggerEvent("beforegetfeatureinfo",{map:g,x:L,y:M}),g.getFeatureInfo(L,M)):"point"==P&&(g.setMapPin(L,M),g.showMapPin(),g.getPointInfo(L,M))};var kb=!1,Q=!1,Ga,Va;this.updateMouseCursorCoordinates=function(a){Va=a;Ga=g.getGeoCoordFromPixelCoord(a);g.display("updateMouseCursorCoordinates")};
this.mouseDownEvent=function(a){preventdefault_event(a);var b=g.getMouseCoordinatesForDocument(a);qa&&0>b.y||g.mouseDown(b.x,b.y,a)};this.mouseMoveEvent=function(a){preventdefault_event(a);var b=g.getMouseCoordinatesForDocument(a);0===X&&0<=b.y&&0>b.y&&0<=b.x&&b.x<=q?!1===qa&&(qa=!0,Xa=Ia,Ba=!0,g.setCursor("pointer"),g.draw("mouseMoveEvent")):!0===qa&&(Ba=qa=!1,g.setCursor(Xa),g.draw("mouseMoveEvent"));g.mouseMove(b.x,b.y,a)};this.mouseUpEvent=function(a){preventdefault_event(a);var b=g.getMouseCoordinatesForDocument(a);
g.mouseUp(b.x,b.y,a)};this.mouseMove=function(b,d){F=b;G=d;if(0===ca)for(var c=C.triggerEvent("beforemousemove",{mouseX:F,mouseY:G,mouseDown:1===X?!0:!1}),e=0;e<c.length;e++)if(!1===c[e])return;if(1==A.displayed&&0==pa){var c=g.getPixelCoordFromGeoCoord({x:A.bbox.left,y:A.bbox.top}),e=g.getPixelCoordFromGeoCoord({x:A.bbox.right,y:A.bbox.bottom}),f=!1;0==X&&(!1===Q&&(kb=k.css("cursor")),6>Math.abs(F-c.x)&&G>c.y&&G<e.y&&(f=!0,k.css("cursor","col-resize"),Q="left"),6>Math.abs(G-c.y)&&F>c.x&&F<e.x&&(f=
!0,k.css("cursor","row-resize"),Q="top"),6>Math.abs(F-e.x)&&G>c.y&&G<e.y&&(f=!0,k.css("cursor","col-resize"),Q="right"),6>Math.abs(G-e.y)&&F>c.x&&F<e.x&&(f=!0,k.css("cursor","row-resize"),Q="bottom"),6>Math.abs(F-c.x)&&6>Math.abs(G-c.y)&&(f=!0,k.css("cursor","nw-resize"),Q="topleft"),6>Math.abs(F-e.x)&&6>Math.abs(G-c.y)&&(f=!0,k.css("cursor","ne-resize"),Q="topright"),6>Math.abs(F-c.x)&&6>Math.abs(G-e.y)&&(f=!0,k.css("cursor","sw-resize"),Q="bottomleft"),6>Math.abs(F-e.x)&&6>Math.abs(G-e.y)&&(f=!0,
k.css("cursor","se-resize"),Q="bottomright"));if(1==f||!1!==Q&&1==X){1==X&&("left"==Q&&(c.x=F),"top"==Q&&(c.y=G),"right"==Q&&(e.x=F),"bottom"==Q&&(e.y=G),"topleft"==Q&&(c.x=F,c.y=G),"topright"==Q&&(e.x=F,c.y=G),"bottomleft"==Q&&(c.x=F,e.y=G),"bottomright"==Q&&(e.x=F,e.y=G),c=g.getGeoCoordFromPixelCoord(c),e=g.getGeoCoordFromPixelCoord(e),A.bbox.left=c.x,A.bbox.top=c.y,A.bbox.right=e.x,A.bbox.bottom=e.y,g.showBoundingBox(A.bbox),C.triggerEvent("bboxchanged",{map:g,bbox:A.bbox}));return}Q=!1;k.css("cursor",
kb)}if(-1==(0>G|0>F|F>q|G>u?-1:0)){try{C.triggerEvent("onmousemove",[void 0,void 0]),g.updateMouseCursorCoordinates(void 0)}catch(n){console.log(n)}aa=F;ba=G;0!=pa&&(1==X&&"zoomout"==P&&g.zoomOut(),X=0,1==ca&&lb(aa,ba))}else{if(1==X&&!(3>Math.abs(L-F)&&3>Math.abs(M-G))){e=F;c=G;if(0==ca){if("pan"==P){ja&&g.setBBOX(ia);ja=oa=0;eb.stop();k.css("cursor","move");var f=parseInt(e),l=parseInt(c);v.oldx=v.exactX;v.oldy=v.exactY;for(var p=0;p<T.length;p++)T[p].origX=T[p].x,T[p].origY=T[p].y;pa=1;enableConsoleDebugging&&
console.log("updateBBOX.setBBOX(drawnBBOX)");B.setBBOX(V);Aa=g.getGeoCoordFromPixelCoord({x:f,y:l},t)}"zoom"==P&&(k.css("cursor","crosshair"),Ha=1);ca=1}"pan"==P&&0!=pa&&(f=parseInt(e),l=parseInt(c),0>F||0>G||F>parseInt(a.clientWidth)||G>parseInt(a.clientHeight)?mb(f,l):(l=g.getGeoCoordFromPixelCoord({x:f,y:l},B),f=l.x-Aa.x,l=l.y-Aa.y,B.left-=f,B.bottom-=l,B.right-=f,B.top-=l,la(B)));"zoom"==P&&0!=Ha&&(e=F-L,c=G-M,0>e&&0>c?k.css("cursor","not-allowed"):k.css("cursor","crosshair"),h=c,I.style.display=
"",0>e?(e=-e,I.style.left=F+"px"):I.style.left=L+"px",0>h?(h=-h,I.style.top=G+"px"):I.style.top=M+"px",I.style.width=e+"px",I.style.height=h+"px")}C.triggerEvent("onmousemove",[F,G]);g.updateMouseCursorCoordinates({x:F,y:G})}};this.mouseUp=function(a,b,d){aa=a;ba=b;if(0===ca&&0===(0>ba|0>aa|aa>q|ba>u?-1:0))for(a=C.triggerEvent("beforemouseup",{mouseX:a,mouseY:b,mouseDown:!1,event:d}),b=0;b<a.length;b++)if(!1===a[b]){X=0;return}if(1==X){"zoomout"==P&&g.zoomOut();if(0==ca&&3>Math.abs(L-aa)&&3>Math.abs(M-
ba))if(isDefined(d)&&C.triggerEvent("mouseclicked",{map:g,x:aa,y:ba,shiftKeyPressed:1==d.shiftKey}),1==ab){var c;0==T.length?(c=WMJSDialog.createDialog({show:showDialog,x:aa,y:ba,autoDestroy:!1},k,g),T.push(c)):c=T[0];0==c.hasBeenDragged&&(1==c.moveToMouseCursor?c.setXY(aa,ba):c.setXY(5,45));c.on("hide",function(a,b){c.hasBeenDragged=!1});c.setLoading();c.show();g.addListener("ongetfeatureinfoready",function(a){c.setHTML(g.getGetFeatureInfoObjectAsHTML(a))},!0);g.setMapPin(L,M);g.showMapPin();C.triggerEvent("beforegetfeatureinfo");
g.getFeatureInfo(L,M)}else g.setMapPin(L,M),g.showMapPin();C.triggerEvent("mouseup",{map:g,x:aa,y:ba})}X=0;1==ca&&lb(aa,ba)};var lb=function(a,b){if(0!=ca){ca=0;"pan"==P&&mb(a,b);if("zoom"==P){var d=a,c=b,d=aa-L,c=ba-M;k.css("cursor","default");if(0!=Ha&&(Ha=0,I.style.display="none",!(0>d&&0>c))){var e=new WMJSBBOX;0>d?(e.left=L+d,e.right=L):(e.left=L,e.right=L+d);0>c?(e.top=M+c,e.bottom=M):(e.top=M,e.bottom=M+c);d=g.pixelCoordinatesToXY({x:e.left,y:e.bottom});c=g.pixelCoordinatesToXY({x:e.right,
y:e.top});e.left=d.x;e.bottom=d.y;e.right=c.x;e.top=c.y;g.zoomTo(e);g.draw("mapZoomEnd")}}C.triggerEvent("mapdragend",{map:g,x:aa,y:ba})}},pa=0,Aa,mb=function(a,b){k.css("cursor","default");var d=parseInt(a),c=parseInt(b);0!=pa&&(pa=0,c=g.getGeoCoordFromPixelCoord({x:d,y:c},V),d=c.x-Aa.x,c=c.y-Aa.y,B.left=V.left-d,B.bottom=V.bottom-c,B.right=V.right-d,B.top=V.top-c,la(B),g.zoomTo(B),g.draw("mapPanEnd"))},Ha=0;this.setCursor=function(a){Ia=a?a:"default";k.css("cursor",Ia)};this.zoomTo=function(a){enableConsoleDebugging&&
console.log("zoomTo");var b=!1;a=new WMJSBBOX(a);try{var d=(w.left-w.right)/(w.bottom-w.top)}catch(c){b=!0}isNaN(d)&&(b=!0);1==b&&(error("Invalid bbox: setting ratio to 1"),d=1);0>d&&(d=-d);d>q/u?(b=(a.top+a.bottom)/2,d=(a.left-a.right)/2/d,a.bottom=b+d,a.top=b-d):(b=(a.right+a.left)/2,d*=(a.bottom-a.top)/2,a.left=b+d,a.right=b-d);g.setBBOX(a);la(t);V.setBBOX(t);g.getPixelCoordFromGeoCoord({x:v.geoPosX,y:v.geoPosY});for(a=0;a<T.length;a++)g.getPixelCoordFromGeoCoord({x:T[a].geoPosX,y:T[a].geoPosY}),
0==T[a].hasBeenDragged&&1==T[a].moveToMouseCursor&&T[a].setXY(T[a].origX+x,T[a].origY+y)};this.pixelCoordinatesToXY=function(a){return g.getGeoCoordFromPixelCoord(a)};this.getGeoCoordFromPixelCoord=function(a,b){var d=t;b&&(d=b);if(isDefined(a)){try{var c=a.x/q*(d.right-d.left)+d.left,e=a.y/u*(d.bottom-d.top)+d.top}catch(k){return}return{x:c,y:e}}};this.proj4={};this.proj4.srs="empty";this.proj4.projection=void 0;var Wa=new Proj4js.Proj("EPSG:4326");this.getProj4=function(){g.proj4.srs==p&&isDefined(this.proj4.projection)||
(g.proj4.projection=new Proj4js.Proj(p),g.proj4.srs=p);return{lonlat:Wa,proj4:g.proj4.projection,Proj4js:Proj4js}};this.getPixelCoordFromLatLong=function(a){var b=new Proj4js.Point;try{b.x=parseFloat(a.x),b.y=parseFloat(a.y),g.proj4.srs==p&&isDefined(this.proj4.projection)||(g.proj4.projection=new Proj4js.Proj(p),g.proj4.srs=p),Proj4js.transform(Wa,g.proj4.projection,b)}catch(d){alert(debug("error in getPixelCoordFromLatLong "+d));return}return g.getPixelCoordFromGeoCoord(b)};this.WCJSSearchRequest=
function(a){function b(a,d,c){error(I18n.geonames_api_call_failed.text)}function d(a){if(0===$(a).length){var b=geoNamesURL.replace("{searchTerm}",searchDef).replace("{username}",defaultUsernameSearch);console.log("urlApiGeonames",b);g.WCJSSearchRequestGeoNames(b)}else b=parseFloat($(a)[0].lat),a=parseFloat($(a)[0].lon),g.calculateBoundingBoxAndZoom(b,a)}console.log(a);a.trim().match(/^(-?(?:[1-8]?\d(?:\.\d+)?|90(?:\.0+)?),-?(?:180(?:\.0+)?|(?:(?:1[0-7]\d)|(?:[1-9]?\d))(?:\.\d+)?))$/)?(splitted=a.split(","),
lat=splitted[0],lng=splitted[1],g.calculateBoundingBoxAndZoom(lat,lng)):"undefined"===typeof geoNamesURL&&"undefined"===typeof knmiGeoNamesURL?error(I18n.no_urls_in_config.text):a.trim()?(searchDef=a.trim().match(/^[a-zA-Z0-9 ]*$/))?"undefined"!==typeof knmiGeoNamesURL?(a=knmiGeoNamesURL.replace("{searchTerm}",searchDef),debug(I18n.debug_searching_location.text),debug("<a target='_blank' href='"+a+"'>"+a+"</a>",!1),$.ajax({dataType:"jsonp",contentType:"application/jsonp",jsonpCallback:"resultGeo",
crossDomain:!0,type:"GET",url:a,success:d,error:b})):(a=geoNamesURL.replace("{searchTerm}",searchDef).replace("{username}",defaultUsernameSearch),console.log("urlApiGeonames",a),g.WCJSSearchRequestGeoNames(a)):(debug(I18n.only_alpha_num_allowed.text),$("#searchtextfield").attr("value","")):(debug(I18n.no_search_definition.text),$("#searchtextfield").attr("value",""))};this.WCJSSearchRequestGeoNames=function(a){debug(I18n.debug_searching_sqlite_location.text);debug("<a target='_blank' href='"+a+"'>"+
a+"</a>",!1);$.ajax({dataType:"xml",type:"GET",url:a,success:function(a){if("0"===$(a).find("totalResultsCount").text())error(I18n.no_results_search.text);else{var b=parseFloat($(a).find("geoname").find("lat").text());a=parseFloat($(a).find("geoname").find("lng").text());g.calculateBoundingBoxAndZoom(b,a)}},error:function(a,b,d){error(I18n.geonames_sqlite_call_failed.text)}})};this.calculateBoundingBoxAndZoom=function(a,b){var d=5E5;if("EPSG:4326"===g.proj4.projection.srsCode||"EPSG:50001"===g.proj4.projection.srsCode)d=
5;var c=g.getPixelCoordFromLatLong({x:b,y:a}),c=g.getGeoCoordFromPixelCoord(c),e=new WMJSBBOX;e.left=c.x-d;e.bottom=c.y-d;e.right=c.x+d;e.top=c.y+d;g.zoomTo(e);g.positionMapPinByLatLon({x:b,y:a});g.draw("zoomIn")};this.getLatLongFromPixelCoord=function(a){var b=new Proj4js.Point;try{b.x=a.x/q*(t.right-t.left)+t.left,b.y=a.y/u*(t.bottom-t.top)+t.top,this.proj4.srs!=p&&(this.proj4.projection=new Proj4js.Proj(p),this.proj4.srs=p),Proj4js.transform(this.proj4.projection,Wa,b)}catch(d){return}return{x:b.x,
y:b.y}};this.getPixelCoordFromGeoCoord=function(a,b,d,c){var e=q,k=u,f=B;isDefined(d)&&(e=d);isDefined(c)&&(k=c);isDefined(b)&&(f=b);b=k*(a.y-f.top)/(f.bottom-f.top);return{x:parseFloat(e*(a.x-f.left)/(f.right-f.left)),y:parseFloat(b)}};this.addListener=function(a,b,d){return C.addToCallback(a,b,d)};this.removeListener=function(a,b){return C.removeEvents(a,b)};this.getListener=function(a){return C};this.suspendEvent=function(a){C.suspendEvent(a)};this.resumeEvent=function(a){C.resumeEvent(a)};this.getDimensionList=
function(){return J};this.getDimension=function(a){for(var b=0;b<J.length;b++)if(J[b].name==a)return J[b]};this.setDimension=function(a,b,d){debug("WebMapJS::setDimension('"+a+"','"+b+"')");if(isDefined(a)&&isDefined(b)){var c=g.getDimension(a);0==isDefined(c)&&(c={name:a,currentValue:b},J.push(c));isDefined(void 0)&&(void 0).setValue(a,b);if(c.currentValue!=b){c.currentValue=b;if(1==g.buildLayerDimsBusy)alert("b");else for(b=0;b<J.length;b++)for(var c=J[b],e=0;e<r.length;e++)for(var k=0;k<r[e].dimensions.length;k++){var f=
r[e].dimensions[k];if(1==f.linked&&f.name==c.name){if("current"==c.currentValue||"default"==c.currentValue||""==c.currentValue||"earliest"==c.currentValue||"middle"==c.currentValue||"latest"==c.currentValue)c.currentValue=f.getClosestValue(c.currentValue);g.buildLayerDimsBusy=!0;f.setClosestValue(c.currentValue);g.buildLayerDimsBusy=!1}}!1!==d&&(d=!0);!0===d&&C.triggerEvent("ondimchange",a)}}else error("Unable to set dimension with undefined value or name")};this.setLayerOpacity=function(a,b){if(a){a.opacity=
b;var d=R;for(j=0;j<g.getNumLayers();j++)if(r[j].service&&r[j].enabled){if(a==r[j]){g.setBufferImageOpacity(da,d,b);break}d++}}};this.zoomToLayer=function(a){var b=a;b||(b=Ca);if(b){for(var d=0;d<b.projectionProperties.length;d++)if(b.projectionProperties[d].srs==p){a=b.projectionProperties[d].bbox.right-b.projectionProperties[d].bbox.left;var c=b.projectionProperties[d].bbox.top-b.projectionProperties[d].bbox.bottom,b=b.projectionProperties[d].bbox.clone();b.left-=a/100;b.right+=a/100;b.bottom-=
c/100;b.top+=c/100;g.zoomTo(b);g.draw("zoomTolayer");return}error("Unable to find the correct bbox with current map projection "+p+" for layer "+b.title+". Using default bbox instead.")}g.zoomTo(z);g.draw("zoomTolayer")};this.setPreviousExtent=function(){La=1;W++;W>=ra&&(W=ra-1);g.setProjection(Z[W].srs,Z[W].bbox);g.draw("setPreviousExtent")};this.setNextExtent=function(){Ma=1;W--;0>W&&(W=0);g.setProjection(Z[W].srs,Z[W].bbox);g.draw("setNextExtent")};this.setBBOX=function(a,b,d,c){enableConsoleDebugging&&
console.log("setBBOX");t.setBBOX(a,b,d,c);w.setBBOX(t);if("GFI:TIME_ELEVATION"!==p){var e=q/u;if((t.right-t.left)/(t.top-t.bottom)>e){var k=(t.top+t.bottom)/2,e=(t.left-t.right)/2/e;t.bottom=k+e;t.top=k-e}else k=(t.right+t.left)/2,e*=(t.bottom-t.top)/2,t.left=k+e,t.right=k-e}B.setBBOX(t);V.setBBOX(t);if(0==Ma&&0==La){if(0!=W){for(j=0;j<=W;j++)Na[j]=Z[j];for(j=0;j<=W;j++)Z[j]=Na[W-j];W=0}for(j=2;0<j;j--)Z[j].bbox.setBBOX(Z[j-1].bbox),Z[j].srs=Z[j-1].srs;Z[0].bbox.setBBOX(t);Z[0].srs=p;ra++;3<ra&&(ra=
3)}La=Ma=0;if(!0===t.equals(a,b,d,c))return!1;C.triggerEvent("aftersetbbox",g);return!0};this.zoomOut=function(){var a=(w.right-w.left)/6;this.zoomTo(new WMJSBBOX(w.left-a,w.bottom-a,w.right+a,w.top+a));g.draw("zoomOut")};this.zoomIn=function(a){var b=(w.left-w.right)/8;if(0==isDefined(a))a=1;else if(0==a)return;b*=a;this.zoomTo(new WMJSBBOX(w.left-b,w.bottom-b,w.right+b,w.top+b));g.draw("zoomIn")};this.searchForLocation=function(a){g.WCJSSearchRequest(a)};this.displayLegendInMap=function(a){K=a;
g.repositionLegendGraphic()};this.showBoundingBox=function(a,b){isDefined(a)&&(A.bbox=a,A.style.display="",A.displayed=!0);if(!0===A.displayed){var d=t;isDefined(b)&&(d=b);var c=this.getPixelCoordFromGeoCoord({x:A.bbox.left,y:A.bbox.top},d),d=this.getPixelCoordFromGeoCoord({x:A.bbox.right,y:A.bbox.bottom},d);A.style.left=c.x-1+"px";A.style.top=c.y-2+"px";A.style.width=d.x-c.x+"px";A.style.height=d.y-c.y-1+"px"}};this.hideBoundingBox=function(){A.style.display="none";A.displayed=!1};this.setDebugFunction=
function(a){debug=a};this.setErrorFunction=function(a){error=a};(function(){try{tileRenderSettings=WMJSTileRendererTileSettings}catch(b){}a.style.height||(a.style.height="1px");a.style.width||(a.style.width="1px");var d=Oa("baseDiv");jQuery("<div/>",{id:d,css:{position:"relative",overflow:"hidden",width:a.clientWidth,height:a.clientHeight,border:"0px  solid black",margin:0,padding:0,clear:"both",left:"0px",top:"0px"}}).appendTo(a);k=$("#"+d);k.css("cursor","default");a.style.margin="0px";a.style.padding=
"0px";a.style.border="none";a.style.lineHeight="0px";a.style.display="inline-block";I.style.position="absolute";I.style.display="none";I.style.border="2px dashed #000000";I.style.margin="0px";I.style.padding="0px";I.style.lineHeight="0";I.style.background="#AFFFFF";I.style.opacity="0.3";I.style.filter="alpha(opacity=30)";I.style.left="0px";I.style.top="0px";I.style.width="100px";I.style.height="100px";I.style.zIndex=1E3;I.oncontextmenu=function(){return!1};k.append(I);A.style.position="absolute";
A.style.display="none";A.style.border="3px solid #6060FF";A.style.margin="0px";A.style.padding="0px";A.style.lineHeight="0";A.style.left="0px";A.style.top="0px";A.style.width="100px";A.style.height="100px";A.style.zIndex=1E3;A.oncontextmenu=function(){return!1};k.append(A);v.style.position="absolute";v.style.display="none";v.style.border="none";v.style.margin="0px";v.style.padding="0px";v.style.lineHeight="0";v.style.background="none";v.style.opacity="1.0";v.style.filter="alpha(opacity=100)";v.style.left=
"0px";v.style.top="0px";v.style.width="100px";v.style.height="100px";v.style.zIndex=1E3;v.oncontextmenu=function(){return!1};v.innerHTML="<img src='"+mapPinImageSrc+"'>";v.style.display="";k.append(v);S.style.position="absolute";S.style.zIndex=1E3;S.style.width="auto";S.style.height="auto";S.style.background="none";S.oncontextmenu=function(){return!1};S.innerHTML="";k.append(S);k.append(Ja);"undefined"!==typeof defaultUsernameSearch&&(jQuery("<div/>",{id:Oa("searchboxdiv"),mousedown:function(a){a.stopPropagation()}}).addClass("webmapjs_searchboxdiv").html("<input class='webmapjs_locationfield' type='text' name='searchtextfield' id='searchtextfield' placeholder="+
I18n.place_search_term.text+" />",{mousedown:function(a){a.stopPropagation();preventdefault_event(a)}}).appendTo(k),jQuery("<button/>",{id:Oa("searchboxbutton"),mousedown:function(a){a.stopPropagation()},click:function(){var a=$("#searchtextfield").val();g.searchForLocation(a)}}).addClass("webmapjs_locationbutton").appendTo(k),$("#searchtextfield").keypress(function(a){if(13==a.which)return a=$("#searchtextfield").val(),g.searchForLocation(a),!1}));n();t.left=-180;t.bottom=-90;t.right=180;t.top=90;
p="EPSG:4326";g.setSize(a.clientWidth,a.clientHeight);for(d=0;2>d;d++){var c=new WMJSCanvasBuffer(C,"imagebuffer",getMapImageStore,g.getWidth(),g.getHeight());getMapImageStore.addLoadEventCallback(c.imageLoadComplete);k.append(c.getBuffer());H.push(c)}for(d=0;2>d;d++)c=new WMJSCanvasBuffer(C,"legendbuffer",legendImageStore,g.getWidth(),g.getHeight()),legendImageStore.addLoadEventCallback(c.imageLoadComplete),k.append(c.getBuffer()),O.push(c);C.addToCallback("display",g.display,!0);C.addToCallback("draw",
function(){console.log("draw event triggered externally, skipping")},!0);cb=new WMJSAnimate(g);bgMapImageStore.addLoadEventCallback(function(a){g.draw("bgMapImageStore loaded")});g.addListener("beforecanvasstartdraw",function(a){if(D)for(var b=0;b<D.length;b++)!D[b].enabled||!1!==D[b].keepOnTop||D[b].type&&"twms"!==D[b].type||WMJSTileRenderer(t,B,p,q,u,a,bgMapImageStore,tileRenderSettings,D[b].name)},!0);var e=function(a,b,d,c,e){a.textBaseline="top";a.fillStyle="#FFF";a.globalAlpha=.75;var k=a.measureText(b).width;
a.fillRect(d-8,c-8,k+16,parseInt(e)+14);a.fillStyle="#444";a.globalAlpha=1;a.fillText(b,d,c+2)};g.addListener("beforecanvasdisplay",function(a){Za&&(a.beginPath(),a.rect(0,0,q,0),!1===Ya?(a.globalAlpha=Ba?.9:.4,a.fillStyle=Ba?"#017daf":"#EEE"):(a.globalAlpha=1,a.fillStyle="#017daf"),a.fill(),a.globalAlpha=1);for(i=0;i<r.length;i++)for(var b="",d=0;d<r[i].dimensions.length;d++)b+="&"+jb(r[i].dimensions[d].name),b+="="+URLEncode(r[i].dimensions[d].currentValue),r[i].dimensions[d].currentValue==WMJSDateOutSideRange?
g.canvasErrors.push({linkedInfo:{layer:r[i],message:"Time outside range"}}):r[i].dimensions[d].currentValue==WMJSDateTooEarlyString?g.canvasErrors.push({linkedInfo:{layer:r[i],message:"Time too early"}}):r[i].dimensions[d].currentValue==WMJSDateTooLateString&&g.canvasErrors.push({linkedInfo:{layer:r[i],message:"Time too late"}});if(g.canvasErrors&&0<g.canvasErrors.length){var d=q/2,c=6+15*g.canvasErrors.length,b=q-d;a.beginPath();a.rect(b,0,b+d,0+c);a.fillStyle="white";a.globalAlpha=.9;a.fill();a.globalAlpha=
1;a.fillStyle="black";a.font="10pt Helvetica";for(d=0;d<g.canvasErrors.length;d++)g.canvasErrors[d].linkedInfo?a.fillText("Layer with title "+g.canvasErrors[d].linkedInfo.layer.title+" failed to load"+(g.canvasErrors[d].linkedInfo.message?", "+g.canvasErrors[d].linkedInfo.message:""),b+5,11+15*d):a.fillText("Layer failed to load.",b+5,11+15*d);g.canvasErrors=[]}""!==Pa&&(a.font="20px Helvetica",e(a,Pa,q/2-70,u-26,20));""!==Qa&&(a.font="15px Helvetica",e(a,Qa,q/2-70,2,15));if(!0===Sa&&(b=function(){var a=
0,b=1E-7,d=q/(B.right-B.left);if(!(0>=d)){var c=25/d,a=0;do{b*=10;a=c/b;if(0===a)return;a=25/a}while(25>a);do{b/=2;a=c/b;if(0===a)return;a=25/a}while(25<a);do{b*=1.2;a=c/b;if(0===a)return;a=25/a}while(25>a);c=Math.pow(10,Math.round(Math.log10(b)+.5)-1);b=Math.round(b/c);2.5>b&&(b=2.5);2.5<b&&7.5>b&&(b=5);7.5<b&&(b=10);b*=c;a=25/d/b;return{width:parseInt(25/a),mapunits:b}}}())){d=u-25.5;a.beginPath();a.lineWidth=2.5;a.fillStyle="#000";a.strokeStyle="#000";a.font="9px Helvetica";a.textBaseline="middle";
for(c=0;2>c;c++)a.moveTo(7.5,21-c+d),a.lineTo(2*b.width+8.5,21-c+d);c=parseInt(Math.round(b.width/5));a.lineWidth=.5;for(var k=1;5>k;k++)a.moveTo(7.5+c*k,21+d),a.lineTo(7.5+c*k,16+d);a.lineWidth=1;a.moveTo(7.5,21+d);a.lineTo(7.5,14+d);a.moveTo(7.5+b.width,21+d);a.lineTo(7.5+b.width,14+d);a.moveTo(2*b.width+8.5,21+d);a.lineTo(2*b.width+8.5,14+d);c="";"EPSG:3411"===p&&(c="meter");"EPSG:3412"===p&&(c="meter");"EPSG:3575"===p&&(c="meter");"EPSG:4326"===p&&(c="degrees");"EPSG:28992"===p&&(c="meter");"EPSG:32661"===
p&&(c="meter");"EPSG:3857"===p&&(c="meter");"EPSG:900913"===p&&(c="meter");"EPSG:102100"===p&&(c="meter");"meter"===c&&1E3<b.mapunits&&(b.mapunits/=1E3,c="km");a.fillText("0",4.5,12+d);k=b.mapunits.toPrecision()+"";a.fillText(k,7.5+b.width-2.5*k.length+0,12+d);k=(2*b.mapunits).toPrecision()+"";a.fillText(k,7.5+2*b.width-2.5*k.length+0,12+d);a.fillText(c,2*b.width+17.5,18+d);a.stroke()}a.font="10px Helvetica";a.textBaseline="middle";isDefined(Ga)&&(d=1/Math.pow(10,parseInt(Math.log((t.right-t.left)/
q)/Math.log(10))-2),1>d&&(d=1),a.fillStyle="#000000",b=Math.round(Ga.x*d)/d,d=Math.round(Ga.y*d)/d,c="","EPSG:3857"===p&&(c="meter"),a.fillText("CoordYX: ("+d+", "+b+") "+c,5,u-50));isDefined(Va)&&(b=g.getLatLongFromPixelCoord(Va),isDefined(b)&&(a.fillStyle="#000000",d=Math.round(100*b.x)/100,a.fillText("Lat/Lon: ("+(Math.round(100*b.y)/100).toFixed(2)+", "+d.toFixed(2)+")  degrees",5,u-38)));a.fillStyle="#000000";a.fillText("Map projection: "+p,5,u-26);a.font="7px Helvetica";a.fillText("ADAGUC webmapjs "+
WebMapJSMapVersion,q-85,u-5)},!0);g.addListener("canvasonerror",function(a){g.canvasErrors=a},!0);$a=1})();la(t)};WMJSEmptyLayerName="empty_layer";WMJSEmptyLayerTitle="empty layer";
function WMJSLayer(a){this.autoupdate=!1;this.getlegendgraphicURL=this.getfeatureinfoURL=this.getmapURL=this.WMJSService=this.service=this.timer=void 0;this.keepOnTop=!1;this.transparent=!0;this.hasError=!1;this.legendIsDimensionDependant=!0;this.wms130bboxcompatibilitymode=!1;this.version=WMSVersion.version111;this.path="";this.type="wms";this.objectpath=[];this.wmsextensions=function(a){this.wmsextensions.colorscalerange="";isDefined(a.colorscalerange)&&(this.wmsextensions.colorscalerange=a.colorscalerange);
this.wmsextensions.url="";2<this.wmsextensions.colorscalerange.length&&(this.wmsextensions.url+="&COLORSCALERANGE="+this.wmsextensions.colorscalerange)};this.wmsextensions.url="";this.name=this.jsonlayer_v1_1_1=void 0;this.title=WMJSEmptyLayerTitle;this.abstract=void 0;this.dimensions=[];this.legendGraphic="";this.projectionProperties=[];this.queryable=!1;this.enabled=!0;this.styles=void 0;this.currentStyle="";this.id=-1;this.opacity=1;this.getCapabilitiesDoc=this.image=void 0;this.serviceTitle="not defined";
this.onReady=function(a){};this.parentMaps=[];this.getLayerName=function(){return this.name};this.toggleAutoUpdate=function(){(this.autoupdate=!this.autoupdate)?this.timer=setInterval(function(a){return function(){a.parseLayer(void 0,!0,"WMJSLayer::autoupdate")}}(this),6E4):clearInterval(this.timer)};this.setAutoUpdate=function(a,c,f){a!==this.autoupdate&&((this.autoupdate=a)?this.timer=setInterval(function(a){return function(){a.parseLayer(f,!0,"WMJSLayer::autoupdate")}}(this),c):clearInterval(this.timer))};
this.setOpacity=function(a){this.opacity=a;this.image&&(this.image.setOpacity(this.opacity),this.parentMaps[0].redrawBuffer())};this.remove=function(){for(var a=0;a<this.parentMaps.length;a++)this.parentMaps[a].deleteLayer(this),this.parentMaps[a].draw("WMJSLayer::remove");clearInterval(this.timer)};this.moveUp=function(){for(var a=0;a<this.parentMaps.length;a++)this.parentMaps[a].moveLayerUp(this),this.parentMaps[a].draw("WMJSLayer::moveUp")};this.moveDown=function(){for(var a=0;a<this.parentMaps.length;a++)this.parentMaps[a].moveLayerDown(this),
this.parentMaps[a].draw("WMJSLayer::moveDown")};this.zoomToLayer=function(){for(var a=0;a<this.parentMaps.length;a++)this.parentMaps[a].zoomToLayer(this)};this.draw=function(a){for(var c=0;c<this.parentMaps.length;c++)this.parentMaps[c].draw("WMJSLayer::draw::"+a)};this.handleReferenceTime=function(a,c){if("reference_time"===a){var f=this.getDimension("time");f&&(f.setStartTime(c),this.parentMaps&&0<this.parentMaps.length&&this.parentMaps[0].getListener().triggerEvent("ondimchange","time"))}};this.setDimension=
function(a,c){for(var f,b=0;b<this.dimensions.length;b++)this.dimensions[b].name==a&&(f=this.dimensions[b]);if(0!=isDefined(f)&&0!=isDefined(c)&&(f.setValue(c),this.handleReferenceTime(a,c),1==f.linked))for(b=0;b<this.parentMaps.length;b++)this.parentMaps[b].setDimension(a,f.getValue())};this.configureDimensions=function(){var a=this.cloneLayer(),c=this.jsonlayer_v1_1_1;if(c){for(var f=toArray(c.Dimension),b=this.objectpath.length-1;0<=b;b--){var e=this.objectpath[b].Dimension;if(!isNull(e)&&isDefined(e))for(var l=
0;l<e.length;l++){var m=e[l];if(!isNull(m)&&isDefined(m)){for(var n=!1,k=0;k<f.length;k++)if(m.attr.name.toLowerCase()===f[b].attr.name.toLowerCase()){n=!0;break}n||f.push(m)}}}c=toArray(c.Extent);this.dimensions=[];e=!1;for(b=0;b<f.length;b++){var p;"reference_time"===f[b].attr.name.toLowerCase()?(e=!0,p=new WMJSDimension({linked:!1})):p=new WMJSDimension;p.name=f[b].attr.name.toLowerCase();p.units=f[b].attr.units;for(k=0;k<c.length;k++)c[k].attr.name.toLowerCase()==p.name&&(p.values=c[k].value?
c[k].value.trim():"",c[k].attr["default"]?p.defaultValue=c[k].attr["default"].trim():(l=p.values.split("/"),1<l.length?p.defaultValue=l[1]:0<l.length&&(p.defaultValue=l[0])),c[k].value||(error("No extent defined for dim "+p.name+" in layer "+this.title),error("Using default value "+p.defaultValue),p.values=p.defaultValue));this.version==WMSVersion.version130&&(p.values=f[b].value,p.defaultValue=f[b].attr["default"]);k=p.defaultValue;0<this.parentMaps.length?(l=this.parentMaps[0].getDimension(p.name),
isDefined(l)&&l.linked&&(isDefined(l.currentValue)?(k=p.getClosestValue(l.currentValue),debug("WMJSLayer::configureDimensions Dimension "+p.name+" default value ["+k+"] is based on map value ["+l.currentValue+"]")):debug("WMJSLayer::configureDimensions Map dimension currentValue for "+p.name+" does not exist."))):debug("WMJSLayer::configureDimensions Layer has no parentmaps");1===a.dimensions.filter(function(a){return a.name===p.name}).length?(l=a.dimensions.filter(function(a){return a.name===p.name})[0],
isDefined(l.currentValue)?p.setValue(l.currentValue):p.setValue(k)):p.setValue(k);p.parentLayer=this;isDefined(p.values)?this.dimensions.push(p):error("Skipping dimension "+p.name)}e&&(a=this.getDimension("reference_time"),this.handleReferenceTime("reference_time",a.getValue()))}};this.parseLayer=function(d,c,f){var b=this;b.hasError=!1;var e=function(a){isDefined(d)&&d(a)},l=function(d,c){b.hasError=!0;b.lastError=c;b.title=I18n.service_has_error.text;error(c);e(d);isDefined(a.failure)&&a.failure(d,
c)};b.WMJSService=WMJSgetServiceFromStore(this.service);b.WMJSService.getCapabilities(function(a){(function(a,b){function d(b,c,e){for(var k=[],f=0;f<e.length;f++)k.push(e[f]);k.push(b);for(e=0;e<b.length;e++)if(b[e].Layer){f=c;try{f+=b[e].Title.value+"/"}catch(l){}d(toArray(b[e].Layer),f,k)}else if(b[e].Name&&b[e].Name.value==a.name){J(b[e],c,k);break}}if(0==b||void 0==b)a.title=I18n.service_has_error.text,a.abstract=I18n.not_available_message.text,l(a,I18n.unable_to_connect_server.text);else{var c;
try{c=a.WMJSService.getCapabilityElement(b)}catch(f){l(a,f);return}a.version=a.WMJSService.version;var m=c.Layer;if(isDefined(m)){try{a.serviceTitle=m.Title.value}catch(f){a.serviceTitle="Unnamed service"}try{for(var q=c.Request.GetMap.Format,u=0;u<q.length;u++)q[u].value.indexOf("24"),q[u].value.indexOf("32")}catch(f){error("This WMS service has no getmap formats listed: using image/png")}if(void 0==a.name||1>a.name.length)a.title=WMJSEmptyLayerTitle,a.abstract=I18n.not_available_message.text,e(a);
else{var r=0,J=function(d,e,f){a.jsonlayer_v1_1_1=d;a.getmapURL=void 0;try{a.getmapURL=c.Request.GetMap.DCPType.HTTP.Get.OnlineResource.attr["xlink:href"]}catch(l){}isDefined(a.getmapURL)||(a.getmapURL=a.service,error("GetMap OnlineResource is not specified. Using default."));a.getfeatureinfoURL=void 0;try{a.getfeatureinfoURL=c.Request.GetFeatureInfo.DCPType.HTTP.Get.OnlineResource.attr["xlink:href"]}catch(l){}isDefined(a.getfeatureinfoURL)||(a.getfeatureinfoURL=a.service,error("GetFeatureInfo OnlineResource is not specified. Using default."));
a.getlegendgraphicURL=void 0;try{a.getlegendgraphicURL=c.Request.GetLegendGraphic.DCPType.HTTP.Get.OnlineResource.attr["xlink:href"]}catch(l){}isDefined(a.getlegendgraphicURL)||(a.getlegendgraphicURL=a.service,error("GetLegendGraphic OnlineResource is not specified. Using default."));a.getmapURL=WMJScheckURL(a.getmapURL);a.getfeatureinfoURL=WMJScheckURL(a.getfeatureinfoURL);a.getlegendgraphicURL=WMJScheckURL(a.getlegendgraphicURL);a.getCapabilitiesDoc=b;a.title=d.Title.value;try{a.abstract=d.Abstract.value}catch(l){a.abstract=
I18n.not_available_message.text}a.path=e;a.objectpath=f;a.styles=void 0;a.jsonlayer=a;try{e="";d.Style&&(e=toArray(d.Style));a.styles=e;for(var p=0;p<a.styles.length;p++){var u=a.styles[p];u.index=p;u.nrOfStyles=a.styles.length;u.title="default";u.name="default";u.legendURL="";u.abstracttext="No abstract available";try{u.title=u.Title.value}catch(l){}try{u.name=u.Name.value}catch(l){}try{u.legendURL=u.LegendURL.OnlineResource.attr["xlink:href"]}catch(l){}try{u.abstracttext=u.Abstract.value}catch(l){}}""==
a.currentStyle&&(a.currentStyle=a.styles[0].Name.value);a.setStyle(a.currentStyle)}catch(l){a.currentStyle="",a.styles="",error("No styles found for layer "+a.title)}a.configureDimensions();u=toArray(d.SRS);isDefined(d.CRS)&&(u=toArray(d.CRS));a.projectionProperties=[];var q=[];e=function(b){if(isDefined(b.BoundingBox))for(b=toArray(b.BoundingBox),p=0;p<b.length;p++){var d;d=b[p].attr.SRS;isDefined(b[p].attr.CRS)&&(d=b[p].attr.CRS);d&&0<d.length&&(d=decodeURIComponent(d));for(var c=!1,e=0;e<a.projectionProperties.length;e++)if(d==
a.projectionProperties[e].srs){c=!0;break}0==c&&(c=new WMJSProjection,c.srs=d,d=!1,a.version==WMSVersion.version130&&"EPSG:4326"==c.srs&&0==a.wms130bboxcompatibilitymode&&(d=!0),0==d?(c.bbox.left=parseFloat(b[p].attr.minx),c.bbox.bottom=parseFloat(b[p].attr.miny),c.bbox.right=parseFloat(b[p].attr.maxx),c.bbox.top=parseFloat(b[p].attr.maxy)):(c.bbox.left=parseFloat(b[p].attr.miny),c.bbox.bottom=parseFloat(b[p].attr.minx),c.bbox.right=parseFloat(b[p].attr.maxy),c.bbox.top=parseFloat(b[p].attr.maxx)),
a.projectionProperties.push(c),q.push(c.srs))}};e(d);e(m);for(p=0;p<u.length;p++)-1==q.indexOf(u[p].value)&&(e=new WMJSProjection,error("Warning: BoundingBOX missing for SRS "+u[p].value),e.bbox.left=-180,e.bbox.bottom=-90,e.bbox.right=180,e.bbox.top=90,e.srs=u[p].value,a.projectionProperties.push(e));q="";a.queryable=!1;try{1==parseInt(d.attr.queryable)?a.queryable=!0:a.queryable=!1}catch(l){error("Unable to detect whether this layer is queryable (for layer "+a.title+")")}r=1},q=toArray(m.Layer),
u=[];u.push(m);d(q,"",u);if(0==r)return q="",q=a.name?"Unable to find layer '"+a.name+"' in service '"+a.service+"'":"Unable to find layer '"+a.title+"' in service '"+a.service+"'",a.title="--- layer not found in service ---",a.abstract=I18n.not_available_message.text,l(a,q),a;if(a.onReady)a.onReady(a);e(a);return a}}else l(a,"No Layer element in service")}})(b,a)},function(a){l(b,a)},c)};this.cloneLayer=function(){var a=new WMJSLayer;for(i in this)a[i]=this[i];return a};this.setName=function(a){this.name=
a;this.parseLayer(void 0,void 0,"WMJSLayer::setName")};this.getLayerRelative=function(a,c,f){isDefined(f)||(f=0);var b=this;b.WMJSService.getLayerObjectsFlat(function(e){for(var l=-1,m=0;m<e.length;m++)if(e[m].name==b.name){l=m;break}-1==l?c("Current layer ["+b.name+"] not in this service"):(-1===f&&l--,1===f&&l++,l>e.length-1&&(l=0),0>l&&(l=e.length-1),a(e[l],l,e.length))},c)};this.autoSelectLayer=function(a,c){this.WMJSService.getLayerObjectsFlat(function(c){for(var b=0;b<c.length;b++)if(isDefined(c[b].name)&&
-1==c[b].name.indexOf("baselayer")&&-1==c[b].path.indexOf("baselayer")){a(c[b]);break}},c)};this.getNextLayer=function(a,c){this.getLayerRelative(a,c,1)};this.getPreviousLayer=function(a,c){this.getLayerRelative(a,c,-1)};this.setStyle=function(a){debug("WMJSLayer::setStyle: "+a);if(0==this.styles.length)this.legendGraphic=this.currentStyle="",debug("Layer has no styles.");else{for(var c=0;c<this.styles.length;c++)if(this.styles[c].name==a){this.legendGraphic=this.styles[c].legendURL;this.currentStyle=
this.styles[c].name;return}debug("WMJSLayer::setStyle: Style "+a+" not found, setting style "+this.styles[0].name);this.currentStyle=this.styles[0].name;this.legendGraphic=this.styles[0].legendURL}};this.getStyleObject=function(a,c){if(0!=isDefined(this.styles))for(var f=0;f<this.styles.length;f++)if(this.styles[f].name==a)return-1===c&&f--,1===c&&f++,0>f&&(f=this.styles.length-1),f>this.styles.length-1&&(f=0),this.styles[f].nrOfStyles=this.styles.length,this.styles[f].index=f,this.styles[f]};this.getStyle=
function(){return this.currentStyle};this.setService=function(a){this.getgraphinfoURL=this.getlegendgraphicURL=this.getfeatureinfoURL=this.getmapURL=this.service=a};this.getDimension=function(a){for(var c=0;c<this.dimensions.length;c++)if(this.dimensions[c].name==a)return this.dimensions[c]};this.getProjection=function(a){for(var c=0;c<this.projectionProperties.length;c++)if(this.projectionProperties[c].srs==a)return a=[],a.srs=this.projectionProperties[c].srs+"",a.bbox=new WMJSBBOX(this.projectionProperties[c].bbox.left,
this.projectionProperties[c].bbox.bottom,this.projectionProperties[c].bbox.right,this.projectionProperties[c].bbox.top),a};this.display=function(a){this.enabled=a;for(a=0;a<this.parentMaps.length;a++)this.parentMaps[a].displayLayer(this,this.enabled)};a&&(this.getlegendgraphicURL=this.getfeatureinfoURL=this.getmapURL=this.service=a.service,this.name=a.name,a.getgraphinfoURL&&(this.getgraphinfoURL=a.getgraphinfoURL),a.style&&(this.currentStyle=a.style),this.format=a.format?a.format:"image/png",a.opacity&&
(this.opacity=a.opacity),a.title&&(this.title=a.title),this.abstract=I18n.not_available_message.text,!1===a.enabled&&(this.enabled=!1),1==a.keepOnTop&&(this.keepOnTop=!0),!0===a.transparent&&(this.transparent=!0),!1===a.transparent&&(this.transparent=!1),isDefined(a.onReady)&&(this.onReady=a.onReady,this.parseLayer(void 0,void 0,"WMJSLayer::configOptions")),isDefined(a.type)&&(this.type=a.type))};function WMJSBBOX(a,d,c,f){this.left=-180;this.bottom=-90;this.right=180;this.top=90;this.clone=function(a){void 0==a&&(a=this);var c=new WMJSBBOX;c.left=a.left;c.bottom=a.bottom;c.right=a.right;c.top=a.top;return c};this.copy=function(a){this.setBBOX(a)};this.setBBOX=function(a,c,d,f){if(void 0===a||null===a)this.left=-180,this.bottom=-90,this.right=180,this.top=90;else{if(!c)if("object"===typeof a){var n=a;void 0===n.length||null===n.length?(a=n.left,c=n.bottom,d=n.right,f=n.top):(a=parseFloat(n[0]),
c=parseFloat(n[1]),d=parseFloat(n[2]),f=parseFloat(n[3]))}else try{n=a.split(","),4!==n.length&&error("Invalid map bounding box: '"+a+"'"),a=parseFloat(n[0]),c=parseFloat(n[1]),d=parseFloat(n[2]),f=parseFloat(n[3])}catch(k){}if(void 0===a||void 0===c||void 0===d||void 0===f||null===a||null===c||null===d||null===f)void 0==a&&(a=-180),void 0==d&&(d=180),void 0==c&&(c=-90),void 0==f&&(f=90);this.left=a;this.bottom=c;this.right=d;this.top=f}};this.equals=function(b,c,d,f){if(!b)return!1;if(void 0!==c&&
this.left===b&&this.right===d&&this.top===f&&this.bottom===c)return!0;if("object"===typeof b){if(this.left===b.left&&this.right===b.right&&this.top===b.top&&this.bottom===b.bottom)return!0}else if(f=b.split(","),4!==f.length&&console.log("Invalid map bounding box: "+b),a=parseFloat(f[0]),c=parseFloat(f[1]),d=parseFloat(f[2]),f=parseFloat(f[3]),b=0,this.left===a&&b++,this.right===d&&b++,this.top===f&&b++,this.bottom===c&&b++,2<=b)return!0;return!1};this.toString=function(){return this.left+","+this.bottom+
","+this.right+","+this.top};this.setBBOX(a,d,c,f)};WMJSDateOutSideRange="outside range";WMJSDateTooEarlyString="date too early";WMJSDateTooLateString="date too late";
function WMJSDimension(a){var d=this;this.timeRangeDuration=this.parentLayer=this.defaultValue=this.currentValue=this.values=this.units=this.name=void 0;this.linked=!0;this.generateAllValues=function(){var a=[];if(5E3<d.size())throw"Error: Dimension too large to query all possible values at once";for(var b=0;b<d.size();b++)a.push(d.getValueForIndex(b));return a};var c=this;isDefined(a)&&(isDefined(a.name)&&(this.name=a.name),isDefined(a.units)&&(this.units=a.units),isDefined(a.values)&&(this.values=
a.values),isDefined(a.currentValue)&&(this.currentValue=a.currentValue),isDefined(a.defaultValue)&&(this.defaultValue=a.defaultValue),isDefined(a.parentLayer)&&(this.parentLayer=a.parentLayer),isDefined(a.linked)&&(this.linked=a.linked));var f=!1,b,e=[],l,m=[];this.setStartTime=function(a){f||n(this);if(a&&0!==a.length)if(a=parseISO8601DateToDate(a).toISO8601(),"timestartstopres"===l){var b=c.values;a+=b.substring(b.indexOf("/"));c.reInitializeValues(a);c.setClosestValue()}else{if("timevalues"===
l){var d=parseISO8601DateToDate(a);a=arr.filter(function(a){return e[m]>=d});for(var b="",m=0;m<a.length;m++)0<m&&(b+="/"),b+=a[m].toISO8601();c.reInitializeValues(b);c.setClosestValue()}}else c.reInitializeValues(c.values),timeDim.setClosestValue(!0),console.log("returning")};c.reInitializeValues=function(a){f=!1;n(c,a)};var n=function(a,c){if(1!=f){var d=a.values;c&&(d=c);if(isDefined(d)){m=[];f=!0;"ISO8601"==a.units?0<d.indexOf("/")?(l="timestartstopres",b=new parseISOTimeRangeDuration(d)):l="timevalues":
(l="anyvalue",a.linked=!1);if("timestartstopres"!=l){for(var d=d.split(","),n=0;n<d.length;n++){var q=d[n].split("/");if(3==q.length){var n=parseFloat(q[0]),u=parseFloat(q[1]),q=parseFloat(q[2]),u=u+q;n>u&&(u=n);for(0>=q&&(q=1);n<u;n+=q)m.push(n)}else m.push(d[n])}if("timevalues"==l)for(n=0;n<m.length;n++)e[n]=parseISO8601DateToDate(m[n])}isDefined(a.defaultValue)||(a.defaultValue=a.getValueForIndex(0));isDefined(a.currentValue)||(a.currentValue=a.getValueForIndex(0));a.dimMinValue=a.getValueForIndex(0);
a.dimMaxValue=a.getValueForIndex(a.size()-1)}}};this.getValue=function(){f||n(c);var a=c.defaultValue;isDefined(c.currentValue)&&(a=c.currentValue);return a=c.addTimeRangeDurationToValue(a)};this.setValue=function(a){f||n(c);a!=WMJSDateOutSideRange&&a!=WMJSDateTooEarlyString&&a!=WMJSDateTooLateString&&(c.currentValue=a)};this.setClosestValue=function(a,b){a||(a=this.getValue(),b=!0);this.currentValue=this.getClosestValue(a,b)};this.getNextClosestValue=function(a){var b=this.getClosestValue(a),b=this.getIndexForValue(b),
b=this.getValueForIndex(b+1);return!b||"date too early"===b||moment(a)>=moment(b)?null:b};this.addTimeRangeDurationToValue=function(a){if(a==WMJSDateOutSideRange||a==WMJSDateTooEarlyString||a==WMJSDateTooLateString)return a;if(c.timeRangeDuration&&0<c.timeRangeDuration.length){var b=parseISO8601IntervalToDateInterval(c.timeRangeDuration),d=parseISO8601DateToDate(a);d.add(b);b=d.toISO8601();return a+"/"+b}return a};this.setTimeRangeDuration=function(a){if((c.timeRangeDuration=a)&&0<a.length){c.reInitializeValues(c.values);
a=parseISO8601DateToDate(c.dimMinValue);var b=c.dimMaxValue,d=parseISO8601IntervalToDateInterval(c.timeRangeDuration);0!=d.second&&a.setUTCSeconds(0);0!=d.minute&&(a.setUTCSeconds(0),a.setUTCMinutes(0));0!=d.hour&&(a.setUTCSeconds(0),a.setUTCMinutes(0),a.setUTCSHours(0));0!=d.day&&(a.setUTCSeconds(0),a.setUTCMinutes(0),a.setUTCSHours(0),a.setUTCDate(0));0!=d.month&&(a.setUTCSeconds(0),a.setUTCMinutes(0),a.setUTCSHours(0),a.setUTCDate(0));c.reInitializeValues(a.toISO8601()+"/"+b+"/"+c.timeRangeDuration)}else console.log("reset"),
c.reInitializeValues(c.values)};this.getClosestValue=function(a,b){a&&-1!=a.indexOf("/")&&(a=a.split("/")[0]);b="undefined"!==typeof b?b:!1;var c=-1,d=WMJSDateOutSideRange;try{c=this.getIndexForValue(a),d=this.getValueForIndex(c)}catch(e){"number"===typeof e&&(d=0==e?WMJSDateTooEarlyString:WMJSDateTooLateString)}"current"==a||"default"==a||""==a?d=this.defaultValue:"latest"==a||b&&d===WMJSDateTooLateString?d=this.getValueForIndex(this.size()-1):"earliest"==a||b&&d===WMJSDateTooEarlyString?d=this.getValueForIndex(0):
"middle"==a&&(c=this.size()/2-1,0>c&&(c=0),d=this.getValueForIndex(c));return d};this.getValueForIndex=function(a){n(this);if(0>a)return-1==a?WMJSDateTooEarlyString:-2==a?WMJSDateTooLateString:-1;if("timestartstopres"==l){try{return b.getDateAtTimeStep(a).toISO8601()}catch(c){}return b.getDateAtTimeStep(a)}if("timevalues"==l||"anyvalue"==l)return m[a]};this.get=function(a){return this.getValueForIndex(a)};this.getIndexForValue=function(a,c){n(this);isDefined(c)||(c=!0);if("string"===typeof a&&"current"==
a&&"current"!=this.defaultValue)return this.getIndexForValue(this.defaultValue);if("timestartstopres"==l)try{return"string"===typeof a?b.getTimeStepFromISODate(a,c):b.getTimeStepFromDate(a,c)}catch(d){return 0==parseInt(d)?-1:-2}if("timevalues"==l)try{for(var f=parseISO8601DateToDate(a).getTime(),z,q=0,u=0;u<m.length;u++){var r=e[u].getTime()-f;0>r&&(r=-r);0==u&&(z=r);r<z&&(z=r,q=u)}return q}catch(d){return error("WMSJDimension::getIndexForValue,2: "+d),-1}if("anyvalue"==l)for(u=0;u<m.length;u++)if(m[u]==
a)return u;return-1};this.size=function(){n(this);if("timestartstopres"==l)return b.getTimeSteps();if("timevalues"==l||"anyvalue"==l)return m.length};this.clone=function(){var a=new WMJSDimension;a.name=c.name;a.units=c.units;a.values=c.values;a.initialize();a.currentValue=c.currentValue;a.defaultValue=c.defaultValue;a.parentLayer=c.parentLayer;a.linked=c.linked;return a};this.initialize=function(){n(this)}};var WMSVersion={version100:"1.0.0",version111:"1.1.1",version130:"1.3.0"};String.prototype.startsWith||(String.prototype.startsWith=function(a,d){d=d||0;return this.indexOf(a,d)===d});
var loadGetCapabilitiesViaProxy=function(a,d,c,f){var b=f+"request=",e=function(a){c(I18n.unable_to_do_getcapabilities.text+":\n"+b+"\n"+I18n.result.text+":\n"+a)};debug("<a target='_blank' href='"+a+"'>"+a+"</a>",!1);b+=URLEncode(a);console.log("loadGetCapabilitiesViaProxy wrapped",b);debug(b);debug(URLEncode(a));debug(a);try{$.ajax({url:b,crossDomain:!0,dataType:"jsonp"}).done(function(a){console.log("loadGetCapabilitiesViaProxy succesfully finished");d(a)}).fail(function(){e({error:"Request failed for "+
b})})}catch(l){console.log("catch: ",l),e({error:"Request failed for "+b})}},WMJSGetCapabilities=function(a,d,c,f){console.log(a);if(0==isDefined(a))console.log("Service not defined"),f(I18n.no_service_defined.text);else if(0==a.length)console.log("Service is empty"),f(I18n.service_url_empty.text);else if(a.startsWith("http://")||a.startsWith("https:")||a.startsWith("//")){-1==a.indexOf("?")&&(a+="?");debug("GetCapabilities:");var b=a+"&service=WMS&request=GetCapabilities";(new WMJSXMLParser).fetchXMLAndParseToJSON(b,
c,function(){console.log("Unable to use browser based XML reading, trying proxy");loadGetCapabilitiesViaProxy(b,c,function(){f("Request failed for "+b)},xml2jsonrequestURL)})}else console.log("Service does not start with HTTPS"),f(I18n.service_url_empty.text)},WMJSServiceStore=[],WMJSgetServiceFromStore=function(a){for(var d=0;d<WMJSServiceStore.length;d++)if(WMJSServiceStore[d].service==a)return WMJSServiceStore[d];a=new WMJSService({service:a});WMJSServiceStore.push(a);return a};
function WMJSService(a){function d(a,b){return a.sort(function(a,c){var d=a[b],e=c[b];return d<e?-1:d>e?1:0})}this.abstract=this.onlineresource=this.title=this.service=void 0;this.version=WMSVersion.version111;this.getcapabilitiesDoc=void 0;this.busy=!1;var c,f=this;a&&(this.service=a.service,this.title=a.title);this.getCapabilityElement=function(a){var b;try{b=a.WMT_MS_Capabilities.Capability}catch(c){try{b=a.WMS_Capabilities.Capability}catch(d){throw I18n.no_capability_element_found.text;}}if(!isDefined(b))throw I18n.no_capability_element_found.text;
return b};this.checkVersion=function(a){var b=null;try{WMSVersion.version100==a.WMT_MS_Capabilities.attr.version&&(b=WMSVersion.version100),WMSVersion.version111==a.WMT_MS_Capabilities.attr.version&&(b=WMSVersion.version111),WMSVersion.version130==a.WMT_MS_Capabilities.attr.version&&(b=WMSVersion.version130)}catch(c){try{WMSVersion.version100==a.WMS_Capabilities.attr.version&&(b=WMSVersion.version100),WMSVersion.version111==a.WMS_Capabilities.attr.version&&(b=WMSVersion.version111),WMSVersion.version130==
a.WMS_Capabilities.attr.version&&(b=WMSVersion.version130)}catch(d){console.log("165");if(a=f.checkException(a))throw console.log(a),Error(a);throw Error("Unable to determine WMS version");}}if(null===b)throw Error("Unable to determine WMS version");return b==WMSVersion.version111||b==WMSVersion.version130?b:WMSVersion.version111};var b=[];this.getCapabilities=function(a,d,f){c=void 0;var n=this;if(this.busy)a={callback:a,fail:d},b.push(a);else if(n.getcapabilitiesDoc&&1!=f)a(this.getcapabilitiesDoc);
else{n.busy=!0;var k=function(a){console.log("Failed");n.busy=!1;for(var c=0;c<b.length;c++)b[c].fail(a),b[c].fail=function(){};b=[]};a={callback:a,fail:d};b.push(a);WMJSGetCapabilities(this.service,!1,function(a){n.busy=!1;n.getcapabilitiesDoc=a;try{n.version=n.checkVersion(a)}catch(c){console.log("version error",c);k(c.message);return}var d=a.WMS_Capabilities;d||(d=a.WMT_MS_Capabilities);try{n.abstract=d.Service.Abstract.value}catch(c){this.abstract=I18n.not_available_message.text}try{n.title=d.Service.Title.value}catch(c){this.title=
I18n.not_available_message.text}try{n.onlineresource=d.Service.OnlineResource.value?d.Service.OnlineResource.value:d.Service.OnlineResource.attr["xlink:href"]}catch(c){n.onlineresource=I18n.not_available_message.text}for(d=0;d<b.length;d++)b[d].callback(a),b[d].callback=function(){};b=[];n.busy=!1},k)}};this.checkException=function(a){console.log("271");try{if(a.ServiceExceptionReport){var b="Undefined",c=b,d=a.ServiceExceptionReport.ServiceException;if(d){try{d.attr.code&&(b=d.attr.code)}catch(f){}if(d.value)return c=
d.value,"Exception: "+b+".\n"+c}return I18n.wms_service_exception_code.text+b}}catch(f){}};this.getNodes=function(a,b,c){this.nodeCache=void 0;b||(b=function(a){error(a)});var n=function(c){function p(a,b,c){for(var e=0;e<a.length;e++){var f=!1;a[e].Name&&(f=!0);try{a[e].Layer&&(f=!1)}catch(k){}a[e].Name?f={name:a[e].Name.value,text:a[e].Title.value,leaf:f,path:c}:(isNull(a[e].Title)&&(a[e].Title=[],a[e].Title.value="Layer"),f={text:a[e].Title.value,leaf:f});b.push(f);a[e].Layer&&(f.children=[],p(toArray(a[e].Layer),
f.children,c+a[e].Title.value))}d(b,"text")}var m={},n=f.getCapabilityElement(c).Layer;try{f.version=f.checkVersion(c)}catch(q){b(q);return}c=toArray(n.Layer);try{m.text=n.Title.value}catch(q){m.text=I18n.unnamed_service.text}m.leaf=!1;m.expanded=!0;m.children=[];p(c,m.children,"");a(m)};this.getCapabilities(function(a){n(a)},function(a){b(a)},c)};this.getLayerNames=function(a,b){this.getNodes(function(b){var c=[],d=function(a){for(var b=0;b<a.length;b++)a[b].name&&c.push(a[b].name),a[b].children&&
d(a[b].children)};d(b.children);a(c)},b)};this.getLayerObjectsFlat=function(a,b){isDefined(c)&&a(c);this.getNodes(function(b){var c=[],d=function(a){for(var b=0;b<a.length;b++)a[b].name&&c.push(a[b]),a[b].children&&d(a[b].children)};d(b.children);a(c)},b)}};function WMJSListener(){function a(){this.functionpointer=this.name=void 0;this.finished=0;this.keepOnCall=!1}var d=[],c=0,f=[],b=this;this.addToCallback=function(b,f,m){var n=-1;m||(m=!1);for(var k=0;k<c;k++){if(1===d[k].finished){n=k;break}if(d[k].name===b&&d[k].functionpointer===f)return d[k].keepOnCall=m,!1}-1===n&&(n=c,c++,d[n]=new a);d[n].name=b;d[n].functionpointer=f;d[n].finished=0;d[n].keepOnCall=m;return!0};this.removeEvents=function(a,b){for(var f=0;f<c;f++)0===d[f].finished&&d[f].name===
a&&(b?d[f].functionpointer===b&&(d[f].finished=1):d[f].finished=1)};this.suspendEvent=function(a){f[a]=!0};this.resumeEvent=function(a){f[a]=!1};this.triggerEvent=function(a,l){if(!0!==f[a]){for(var m=[],n=0,k=0;k<c;k++)if(0===d[k].finished&&d[k].name===a){!1===d[k].keepOnCall&&(d[k].finished=1);try{n++,m.push(d[k].functionpointer(l,b))}catch(p){console.log("Error for event ["+a+"]: ",l,p)}}return m}}};function WMJSTimer(){function a(){f&&clearTimeout(c);f=!1}function d(){0==e?(a(),""!=m&&m()):(--e,f=!0,c=self.setTimeout(function(){d()},b))}this.init=function(b,c){e=parseInt(b/10+.5);1>e&&(e=1);l=e;m=c;a();0<e&&d()};this.reset=function(){e=l};this.stop=function(){a()};var c=null,f=!1,b=10,e,l,m=""}var WMJSDebouncer=function(){var a=!1,d=10,c=!1;this.init=function(f,b){c=!1;d=f;10>d&&(d=10);!1===a&&(self.setTimeout(function(){a=!1;!1===c&&b()},d),a=!0)};this.stop=function(){c=!0}};var sliderTooltip=function(a){isDefined(a)?(a='<div class="slidertooltip"><div class="slidertooltip-inner">'+a+"</div></div>",$(".relativecontrol .ui-slider-handle").html(a)):$(".ui-slider-handle .relativecontrol").html("")},RelativeSlider=function(a){var d=this,c=a.renderTo;$('<input class="datetimepicker"/><br/><span class="relativeslider"/><span class="timeprevious"/><span class="timenext"/>').appendTo(c);var f=0,b=function(b){f+=b;NaN<f&&(f=NaN);0>f&&(f=0);isDefined(a.change)&&a.change(d,f)},
e=function(a){return parseInt(a-50)},l=c.find(".relativeslider").slider({min:0,max:100,value:50,animate:1E3,change:function(a,c){if(a.originalEvent){var d=e(c.value);b(d);50!=c.value&&l.slider("value",50)}},slide:function(b,c){var l=e(c.value),m=f,l=f+l;void 0<l&&(l=void 0);0>l&&(l=0);isDefined(a.slide)&&a.slide(d,l);f=m}});l.addClass("relativecontrol");c.find(".timeprevious").iconbutton({text:!1,icons:{primary:"ui-icon-circle-triangle-w"}});c.find(".timenext").iconbutton({text:!1,icons:{primary:"ui-icon-circle-triangle-e"}});
c.find(".timeprevious").click(function(){b(-1)});c.find(".timenext").click(function(){b(1)});var m=c.find(".datetimepicker").datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss",separator:"T",showOn:"button",buttonText:"",altFieldTimeOnly:!1,showAnim:"slideDown",changeMonth:!0,changeYear:!0,showTimezone:!1,onSelect:function(a,b){var c=d.setPositionByText(a);a!=c.dimvalue&&m.datetimepicker("setDate",c.dimvalue.replace("Z",""))},css:{zIndex:4E3}});this.setPosition=function(a){f=a};this.setPositionByText=
function(b){if(isDefined(a.textUpdate))return a.textUpdate(d,b)};this.setText=function(a,b){a=a.replace("Z","");c.find(".datetimepicker").val(a)};this.setMax=function(a,b,c){m.datetimepicker("option",{minDate:b.replace("Z",""),maxDate:c.replace("Z","")})}},TimeSlider=function(a){var d,c;this.setDimension=function(a,b,e){d=a;isDefined(void 0)&&(void 0).setMax(a.size(),a.getValueForIndex(0),a.getValueForIndex(a.size()-1));c="";this.setValue(a.name,a.getValue())};this.setValue=function(a,b){if(isDefined(d)&&
"time"==a&&c!=b){c=b;var e;try{e=d.getIndexForValue(b)}catch(l){e=d.size()-1,b=d.getValueForIndex(e),debug("Date "+b+" is outside range: "+e)}isDefined(void 0)&&((void 0).setText(b),(void 0).setPosition(e));return{index:e,dimvalue:b}}}};var WMJSProcessing=function(a){var d=a.url,c=!1;a.failure||(a.failure=function(a){alert(dump(a))});var f=function(b){var d;try{d=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessAccepted"].value}catch(f){}if(isDefined(d)){var l=b["wps:ExecuteResponse"].attr.statusLocation,m=new WMJSTimer,n=function(b){if(0!=c){var d,e,f,k,l;b.error&&(k=!0,l=b.error);try{k=!0,l=dump(b.ExceptionReport.Exception)}catch(m){}try{k=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessFailed"],l="Process failed",l=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessFailed"]["wps:ExceptionReport"]["ows:Exception"]["ows:ExceptionText"].value}catch(m){}if(isDefined(k))c=
!1,a.failure({message:l});else{try{d=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessSucceeded"].value}catch(m){}try{e=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessStarted"].attr.percentCompleted,f=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessStarted"].value,0==f.indexOf("processstarted")&&(f=f.substr(14))}catch(m){}isDefined(d)?(d=b["wps:ExecuteResponse"]["wps:ProcessOutputs"]["wps:Output"],a.progress(100,"completed"),a.success(d,b),c=!1):a.progress(parseFloat(e),f)}}},k=function(){$.ajax({dataType:"jsonp",
url:xml2jsonrequestURL+"request="+URLEncode(l),data:"",success:n}).fail(function(b){c=!1;a.failure({message:"<h1>Invalid JSON returned from server:</h1><hr/>"+b.responseText})});c&&m.init(1E3,k)};k()}else{d="";try{d=dump(b.ExceptionReport.Exception.attr),a.failure({message:"Process was not accepted, ExceptionReport:\n"+d})}catch(f){b.error?(b.message||(b.message=b.error),a.failure(b)):(d=dump(b),a.failure({message:"Process was not accepted (dump):\n"+d}))}}};this.execute=function(b,e){c=!0;var l=
d+"service=WPS&request=execute&identifier="+b+"&version=1.0.0&storeExecuteResponse=true&status=true&",l=l+"datainputs=",m="",n;for(n in e)if("object"===typeof e[n])for(var k in e[n])0<m.length&&(m+=";"),m+=n+"="+encodeURIComponent(e[n][k]);else 0<m.length&&(m+=";"),m+=n+"="+encodeURIComponent(e[n]);$.ajax({dataType:"jsonp",url:xml2jsonrequestURL,data:{request:l+m},success:f}).fail(function(b){a.failure({message:b.responseText})})}};var WMJSCoverage=function(a){this.service=this.name=void 0;this.dimensions=[];this.supportedProjections=[];this.nativeFormat=this.nativeCRS=this.originY=this.originX=this.cellsizeY=this.cellsizeX=this.height=this.width=void 0;this.formats=[];this.setDimension=function(a,c){this.dimensions.push({name:a,value:c,currentValue:c})};isDefined(a)&&(this.name=a.name,this.service=a.service)},WCJSRequest=function(a,d,c,f){var b=xml2jsonrequestURL+"request=";-1==a.indexOf("?")&&(a+="?");debug("GetCapabilities:");
var e=a+"&service=WCS&REQUEST=DescribeCoverage&COVERAGE="+d;debug("<a target='_blank' href='"+e+"'>"+e+"</a>",!1);b+=URLEncode(e);$.ajax({dataType:"jsonp",url:b,success:function(b){b.service=a;b.name=d;c(b)},error:function(a){f(I18n.unable_to_do_getcapabilities.text+":\n"+b+"\n"+I18n.result.text+":\n"+a)}})},parseDescribeCoverage=function(a,d){var c;c=d?d:new WMJSCoverage;c.service=a.service;try{c.name=a.CoverageDescription.CoverageOffering.name.value}catch(n){alert("This layer has no Web Coverage Service.");
return}c.title=a.CoverageDescription.CoverageOffering.label.value;c["abstract"]=a.CoverageDescription.CoverageOffering.description.value;var f=a.CoverageDescription.CoverageOffering.lonLatEnvelope["gml:pos"][0].value.replaceAll(" ",","),b=a.CoverageDescription.CoverageOffering.lonLatEnvelope["gml:pos"][1].value.replaceAll(" ",",");c.lonlatbox=new WMJSBBOX(f+","+b);for(var e=toArray(a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:Envelope"]),l=0;l<e.length;l++){var m=e[l].attr.srsName,
f=e[l]["gml:pos"][0].value.replaceAll(" ",","),b=e[l]["gml:pos"][1].value.replaceAll(" ",","),f=new WMJSBBOX(f+","+b);c.supportedProjections.push({srs:m,bbox:f.toString()})}l=a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:RectifiedGrid"]["gml:limits"]["gml:GridEnvelope"]["gml:high"].value.split(" ");c.width=parseInt(l[0])+1;c.height=parseInt(l[1])+1;c.cellsizeX=parseFloat(a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:RectifiedGrid"]["gml:offsetVector"][0].value.split(" ")[0]);
c.cellsizeY=parseFloat(a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:RectifiedGrid"]["gml:offsetVector"][1].value.split(" ")[1]);c.originX=a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:RectifiedGrid"]["gml:origin"]["gml:pos"].value.split(" ")[0];c.originY=a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:RectifiedGrid"]["gml:origin"]["gml:pos"].value.split(" ")[1];c.nativeCRS=a.CoverageDescription.CoverageOffering.supportedCRSs.nativeCRSs?
a.CoverageDescription.CoverageOffering.supportedCRSs.nativeCRSs.value:"EPSG:4326";c.nativeFormat=a.CoverageDescription.CoverageOffering.supportedFormats.attr.nativeFormat;e=toArray(a.CoverageDescription.CoverageOffering.supportedFormats.formats);for(l=0;l<e.length;l++)c.formats.push(e[l].value);return c};var WMJSImage=function(a,d,c,f){var b=this,e=!0;isDefined(f)&&isDefined(f.randomizer)&&!1===f.randomizer&&(e=!1);var l,m,n,k,p;b.init=function(){l="undefined image";k=n=m=!1;p=1};b.init();this.srcToLoad=a;b.isLoaded=function(){return n?!1:m};b.isLoading=function(){return n};b.checkIfThisSourceIsSet=function(a){return l==a||this.srcToLoad==a?!0:!1};b.setSource=function(a){n?console.log("-------------------------\x3e Source set while still loading!!! "):(this.srcToLoad=a,m=l==this.srcToLoad?!0:!1)};
b.clear=function(){b.init()};b.getSrc=function(){return this.srcToLoad};b.hasError=function(){return k};b.load=function(){k=!1;1==m?w(b,!1):(n=!0,this.srcToLoad?!1===this.srcToLoad.startsWith("http")&&!1===this.srcToLoad.startsWith("//")?(console.log("Source does not start with http"),w(b,!0)):this.srcToLoad==l?w(b,!1):(z.load(function(){w(b,!1)}),z.error(function(a){w(b,!0)}),e?z.attr("src",this.srcToLoad+"&"+Math.random()):z.attr("src",this.srcToLoad)):(console.log("Source not set"),w(b,!0)))};
var w=function(a,c){k=c;n=!1;m=!0;l=this.srcToLoad;isDefined(d)&&d(b)};b.setOpacity=function(a){p=parseFloat(a);z.css("opacity",p)};b.getOpacity=function(a){return p};b.setPosition=function(a,b){z.css({top:parseInt(b)+"px",left:parseInt(a)+"px",position:"absolute"})};b.setSize=function(a,b){a=parseInt(a);b=parseInt(b);0===a||0===b||isNaN(a)||isNaN(b)||(z.width(parseInt(a)+"px"),z.height(parseInt(b)+"px"))};b.setZIndex=function(a){z.zIndex=a};b.getElement=function(){return z};var z=$(document.createElement("img"));
z.onselectstart=function(){return!1};z.ondrag=function(){return!1};return b};function WMJSXMLParser(){this.fetchXMLAndParseToJSON=function(a,d,c){$.ajax({url:a,crossDomain:!0,xhrFields:{withCredentials:!0}}).done(function(a){if("object"!==typeof a&&(a=(new DOMParser).parseFromString(a,"text/xml"),"parseerror"===a.documentElement.nodeName))throw"Error while parsing: "+a;var b={},e=function(a,b,c){if(a.children&&a.children.length)for(var d=0;d<a.children.length;d++){var f=a.children[d],w=b+"->"+f.nodeName,z=null,q=f.nodeName;if(c[q]){z={attr:{}};if(!(c[q]instanceof Array)){var u=
Object.assign({},c[q]);c[q]=[];c[q].push(u)}c[q].push(z)}else c[q]={attr:{}},z=c[q];f.childNodes&&0<f.childNodes.length&&f.childNodes[0].nodeValue&&(q=f.childNodes[0].nodeValue.trim(),"\n"!==q&&0<q.length&&(z.value=q));if(f.attributes&&0<f.attributes.length)for(q=0;q<f.attributes.length;q++)z.attr[f.attributes[q].name]=f.attributes[q].value;e(f,w,z)}};e(a,"",b);try{console.log("WMJSXMLParser succesfully completed",b),d(b)}catch(l){c({error:"WMJSXMLParser: ready failed",exception:l})}}).fail(function(d){c({error:"WMJSXMLParser: Request failed for "+
a,exception:d})})}};var WMJSCanvasBuffer=function(a,d,c,f,b){var e=this;this.canvas=$("<canvas/>",{"class":"WMJSCanvasBuffer"}).width(f).height(b);var l=e.canvas[0].getContext("2d");l.canvas.width=f;l.canvas.height=b;this.hidden=this.ready=!0;this.layerstodisplay=[];this.layers=[];var m=f,n=b;"imagebuffer"===d&&this.canvas.addClass("wmjsimagebuffer");"legendbuffer"===d&&this.canvas.addClass("wmjslegendbuffer");this.canvas.addClass("WMJSCanvasBuffer-noselect");this.getCanvasContext=function(){return l};this.imageLoadComplete=
function(b){k();a.triggerEvent("onimageload");"imagebuffer"===d&&a.triggerEvent("onimagebufferimageload",b)};var k=function(){for(var a=0;a<e.layers.length;a++)if(!1===e.layers[a].isLoaded())return;e.finishedLoading()},p=new WMJSImage("webmapjs/img/stoploading.png",function(){console.log("fake image loaded");k()},d);this.hide=function(){e.hidden=!0;e.canvas.hide();e.layers=[]};this.display=function(b,c){var f=[];if(b&&!c)console.log("skipping WMJSCanvasBuffer:display because newbbox is undefined");
else{e.hidden=!1;l.globalAlpha=1;"legendbuffer"===d&&l.clearRect(0,0,m,n);"imagebuffer"===d&&(l.beginPath(),l.rect(0,0,m,n),l.fillStyle="white",l.fill(),a.triggerEvent("beforecanvasstartdraw",l));var k,p;b&&(k=w({x:c.left,y:c.top},b),p=w({x:c.right,y:c.bottom},b));for(var g=0,q=0;q<e.layerstodisplay.length;q++)if(e.layerstodisplay[q].setSize(m,n),!1===e.layerstodisplay[q].hasError()){var z=e.layerstodisplay[q].getOpacity();l.globalAlpha=z;z=e.layerstodisplay[q].getElement()[0];if("legendbuffer"===
d){var A=parseInt(z.width)+4,v=parseInt(z.height)+4,g=g+(A+4),S=m-g+2,K=n-v-2;l.beginPath();l.fillStyle="#FFFFFF";l.lineWidth=.3;l.globalAlpha=.5;l.strokeStyle="#000000";l.rect(parseInt(S)+.5,parseInt(K)+.5,A,v);l.fill();l.stroke();l.globalAlpha=1;l.drawImage(z,S,K)}else b?(A=parseInt(k.x+.5),v=parseInt(k.y+.5),S=parseInt(p.x-k.x+.5),K=parseInt(p.y-k.y+.5),S===parseInt(l.canvas.width)&&K===parseInt(l.canvas.height)?l.drawImage(z,A,v):l.drawImage(z,A,v,S,K)):l.drawImage(z,0,0,m,n)}else f.push(e.layerstodisplay[q]);
l.globalAlpha=1;"imagebuffer"===d&&0<f.length&&a.triggerEvent("canvasonerror",f);"imagebuffer"===d&&a.triggerEvent("beforecanvasdisplay",l);e.canvas.show();"imagebuffer"===d&&a.triggerEvent("aftercanvasdisplay",l)}};this.finishedLoading=function(){if(!e.ready){e.ready=!0;for(var a=0;a<e.layers.length;a++)e.layerstodisplay[a]=e.layers[a],e.layers[a].hasError()&&error("Unable to get image <a target='_blank' href='"+e.layerstodisplay[a].getSrc()+"'>"+e.layerstodisplay[a].getSrc()+"</a>",!1);try{if(isDefined(e.onLoadReadyFunction))e.onLoadReadyFunction(e)}catch(b){error("Exception in Divbuffer::finishedLoading: "+
b)}}};this.setPosition=function(a,b){console.log("setPosition is deprecated")};this.setSize=function(a,b){console.log("setSize is deprecated")};this.resize=function(a,b){a=parseInt(a);b=parseInt(b);if(m!==a||n!==b)m=a,n=b,e.canvas.width(a),e.canvas.height(b),l.canvas.height=b,l.canvas.width=a};this.load=function(a){if(!1!==e.ready){e.ready=!1;e.layerstodisplay=[];a?this.onLoadReadyFunction=a:e.onLoadReadyFunction=function(){};for(a=e.nrLoading=0;a<this.layers.length;a++)e.layers[a].loadThisOne=!1,
!1===e.layers[a].isLoaded()&&(e.layers[a].loadThisOne=!0,e.nrLoading++);if(0===this.nrLoading)k();else{"imagebuffer"===d&&debug("GetMap:");"legendbuffer"===d&&debug("GetLegendGraphic:");for(a=0;a<this.layers.length;a++)!0===this.layers[a].loadThisOne&&debug("<a target='_blank' href='"+this.layers[a].getSrc()+"'>"+this.layers[a].getSrc()+"</a>",!1);for(a=0;a<this.layers.length;a++)!0===this.layers[a].loadThisOne&&this.layers[a].load()}}};this.setSrc=function(a,b,d,f,e){if(isDefined(b)){for(;a>=this.layers.length;)this.layers.push(p);
b=c.getImage(b);b.setZIndex(a);b.linkedInfo=e;this.layers[a]=b}else console.log("undefined")};var w=function(a,b){return{x:m*(a.x-b.left)/(b.right-b.left),y:n*(a.y-b.top)/(b.bottom-b.top)}},z,q;this.setBBOX=function(a,b){if(z!==b+""||q!==a+"")z=b+"",q=a+"",!1===e.hidden&&e.display(a,b)};this.setOpacity=function(a,b){if(a>=this.layers.length)error("setOpacity :invalid id");else{var c=parseFloat(b);this.layers[a].getOpacity()!==c&&this.layers[a].setOpacity(c)}};this.getBuffer=function(){return e.canvas}};function WMJSTimeSelector(a,d,c){var f=function(){this.values=[]};f.prototype.add=function(a){if(!0===this[a])return!1;this[a]=!0;this.values.push(a);return!0};var b=this;this.element=a;this.webmapjs=void 0;this.values=[];var e=24;isDefined(c)&&(e=c);var l=$('<div class="WMJSTimeSelector-controlElement WMJSTimeSelector-noselect"/>',{}),m=$('<div class="WMJSTimeSelector-timeChooserElement WMJSTimeSelector-noselect"/>',{}),n=$('<div class="WMJSTimeSelector-timeinfo WMJSTimeSelector-noselect"/>',{}),
k=$('<div class=""WMJSTimeSelector-controlElementBottom WMJSTimeSelector-noselect"/>',{});this.element.append(n);this.element.append(l);this.element.append(m);this.element.append(k);a=$("<button>&lt;&lt;</button>").button().click(function(){var a=b.makeDateList(b.webmapjs,b.currentValue,e);t(a[0])});c=$("<button>&gt;&gt;</button>").button().click(function(){var a=b.makeDateList(b.webmapjs,b.currentValue,e);t(a[a.length-1])});var p=$("<button>&lt;</button>").button().click(function(){for(var a=b.makeDateList(b.webmapjs,
b.currentValue,e),c=1;c<a.length;c++)if(a[c]==b.currentValue){t(a[c-1]);return}t(a[0])}),w=$("<button>&gt;</button>").button().click(function(){for(var a=b.makeDateList(b.webmapjs,b.currentValue,e),c=0;c<a.length-1;c++)if(a[c]==b.currentValue){t(a[c+1]);return}t(a[a.length-1])});l.append("<table class='WMJSTimeSelector-table'><tr><th>"+I18n.year.text+"</th><th>"+I18n.month.text+"</th><th>"+I18n.day.text+"</th><th>"+I18n.hour.text+"</th><th>"+I18n.min.text+"</th></tr><tr><td><input class='WMJSTimeSelector_yearspinner'/></td><td><input class='WMJSTimeSelector_monthspinner'/></td><td><input class='WMJSTimeSelector_dayspinner'/></td><td><input class='WMJSTimeSelector_hourspinner'/></td><td><input class='WMJSTimeSelector_minutespinner'/></td></tr>");
var z=$("<button>"+I18n.load_all.text+"</button>").button().click(function(){for(var a=b.values,c=0;c<a.length;c++)Y(a[c])}),q=$("<button>"+I18n.play_animation.text+"</button>").button().click(function(){for(var a=b.values,c=[],d=0;d<a.length;d++)Y(a[d]),c.push({name:"time",value:a[d]});b.webmapjs.draw(c)}),u=$("<button>"+I18n.stop.text+"</button>").button().click(function(){b.webmapjs.stopAnimating()});k.append(z);k.append(q);k.append(u);var r=l.find(".WMJSTimeSelector_yearspinner"),J=l.find(".WMJSTimeSelector_monthspinner"),
D=l.find(".WMJSTimeSelector_dayspinner"),R=l.find(".WMJSTimeSelector_hourspinner"),g=l.find(".WMJSTimeSelector_minutespinner"),ea=l.find(".WMJSTimeSelector_secondspinner"),k=$('<div class="WMJSTimeSelector_timebuttons"/>',{});k.append(a);k.append(p);k.append(w);k.append(c);l.append(k);var I="",A=function(a,b){for(a=""+a;a.length<b;)a="0"+a;return a},v=function(a,c){var d=I;"year"==a&&(d=[A(c,4),d.slice(4)].join(""));"month"==a&&(d=[d.slice(0,5),A(c,2),d.slice(7)].join(""));"day"==a&&(d=[d.slice(0,
8),A(c,2),d.slice(10)].join(""));"hour"==a&&(d=[d.slice(0,11),A(c,2),d.slice(13)].join(""));"minute"==a&&(d=[d.slice(0,14),A(c,2),d.slice(16)].join(""));"second"==a&&(d=[d.slice(0,17),A(c,2),d.slice(19)].join(""));var f=parseISO8601DateToDate(d),d=f.toISO8601();if(d!=b.currentValue){var e=b.makeDateList(b.webmapjs,d,3);if(e[1]==b.currentValue){var g=parseISO8601DateToDate(e[1]);f>g?d=e[2]:f<g&&(d=e[0])}}d!=I&&(S(d),t(d));return!1},S=function(a){isDefined(a)&&(I=a,r.spinner("value",a.substring(0,4)),
J.spinner("value",a.substring(5,7)),D.spinner("value",a.substring(8,10)),R.spinner("value",a.substring(11,13)),g.spinner("value",a.substring(14,16)),ea.spinner("value",a.substring(17,19)))};r.spinner({spin:function(a,b){return v("year",b.value)},change:function(a,b){v("year",$(a.target).spinner("value"))},numberFormat:"d4"});J.spinner({spin:function(a,b){return v("month",b.value)},change:function(a,b){v("month",$(a.target).spinner("value"))},numberFormat:"d2"});D.spinner({spin:function(a,b){return v("day",
b.value)},change:function(a,b){v("day",$(a.target).spinner("value"))},numberFormat:"d2"});R.spinner({spin:function(a,b){return v("hour",b.value)},change:function(a,b){v("hour",$(a.target).spinner("value"))},numberFormat:"d2"});g.spinner({spin:function(a,b){return v("minute",b.value)},change:function(a,b){v("minute",$(a.target).spinner("value"))},numberFormat:"d2"});ea.spinner({spin:function(a,b){return v("second",b.value)},change:function(a,b){v("second",$(a.target).spinner("value"))},numberFormat:"d2"});
r.spinner().keyup(function(a,b){13==(a.keyCode||a.which)&&v("year",$(event.target).spinner("value"))});J.spinner().keyup(function(a,b){13==(a.keyCode||a.which)&&v("month",$(event.target).spinner("value"))});D.spinner().keyup(function(a,b){13==(a.keyCode||a.which)&&v("day",$(event.target).spinner("value"))});R.spinner().keyup(function(a,b){13==(a.keyCode||a.which)&&v("hour",$(event.target).spinner("value"))});g.spinner().keyup(function(a,b){13==(a.keyCode||a.which)&&v("minute",$(event.target).spinner("value"))});
ea.spinner().keyup(function(a,b){13==(a.keyCode||a.which)&&v("second",$(event.target).spinner("value"))});this.loadingComplete=function(a){this.generate(a,!1,!0)};this.dimensionUpdate=function(a){this.generate(a,!0,!0)};this.dimensionChange=function(a){this.generate(a,!1,!1)};var K=function(a){S(a);a=parseISO8601DateToDate(a);$(n).html(I18n.local_time.text+":<br/><b>"+a.toString().replace(/GMT.*/g,"")+"</b>")},t=function(a){b.webmapjs.stopAnimating();K(a);d(a)};this.makeDateList=function(a,b,c){var d=
[];a=a.getLayers();for(var e=0;e<a.length;e++)if(1==a[e].enabled){var g=a[e].getDimension("time");g&&d.push(g)}a=new f;for(e=0;e<c;e++)for(var k=0;k<d.length;k++){var l=d[k],g=l.getIndexForValue(b,!1),m=e+g;0>m&&(m=0);m>l.size()-1&&(m=l.size()-1);0<=m&&m<l.size()&&a.add(l.getValueForIndex(m));m=-e+g;0>m&&(m=0);m>l.size()-1&&(m=l.size()-1);0<=m&&m<l.size()&&a.add(l.getValueForIndex(m))}a.values.sort();for(e=d=0;e<a.values.length;e++)if(b==a.values[e]){d=e;break}k=0;b=new f;for(e=0;e<c;e++){g=d+e;if(0<
g&&g<a.values.length&&1==b.add(a.values[g])&&(k++,k>c))break;g=d-e;if(0<g&&g<a.values.length&&1==b.add(a.values[g])&&(k++,k>c))break}b.values.sort();c=[];for(e=0;e<b.values.length;e++)c.push(b.values[e]);return c};var B=function(a){if(!b.webmapjs)return!1;var c=b.webmapjs.getDimension("time");if(!isDefined(c))return!1;c=c.currentValue;b.webmapjs.suspendEvent("ondimchange");b.webmapjs.suspendEvent("ondimupdate");b.webmapjs.setDimension("time",a);a=function(){var a=b.webmapjs.getWMSRequests();if(0==
a.length)return!1;for(var c=0;c<a.length;c++)if(0==b.webmapjs.isThisRequestLoaded(a[c]))return!1;return!0}();b.webmapjs.setDimension("time",c);b.webmapjs.resumeEvent("ondimchange");b.webmapjs.resumeEvent("ondimupdate");return a},Y=function(a){if(!b.webmapjs)return!1;var c=b.webmapjs.getDimension("time");if(!isDefined(c))return!1;c=c.currentValue;b.webmapjs.suspendEvent("ondimchange");b.webmapjs.suspendEvent("ondimupdate");b.webmapjs.setDimension("time",a);a=[];var d=b.webmapjs.getWMSRequests();if(0==
d.length)a=!1;else for(var e=0;e<d.length;e++)0==b.webmapjs.isThisRequestLoaded(d[e])&&a.push(d[e]);b.webmapjs.prefetch(a);b.webmapjs.setDimension("time",c);b.webmapjs.resumeEvent("ondimchange");b.webmapjs.resumeEvent("ondimupdate");return a};this.generate=function(a,c,d){this.webmapjs=a;if(a.getDimension("time")){l.show();n.show();var f=a.getDimension("time").currentValue;if("current"==f)for(var g=a.getLayers(),k=0;k<g.length;k++){var p=g[k].getDimension("time");p&&(f=p.getValueForIndex(p.getIndexForValue(f,
!1)))}b.currentValue=f;K(b.currentValue);if(0==c){c=!1;if(isDefined(b.values))for($(b.element).find(".WMJSTimeSelector-tr").removeClass("WMJSTimeSelector-col-selected"),k=0;k<b.values.length;k++)g=!1,p=$(b.element).find(".WMJSTimeSelector-tr:eq("+k+")"),!0===d&&(g=!1,p.hasClass("WMJSTimeSelector-col-loaded")&&(g=!0),g||(g=1==B(b.values[k])),g?p.addClass("WMJSTimeSelector-col-loaded"):p.removeClass("WMJSTimeSelector-col-loaded")),b.currentValue==b.values[k]&&(b.currentValue=f,p.addClass("WMJSTimeSelector-col-selected"),
c=!0);if(1==c)return}b.values=b.makeDateList(a,f,e);a="<table class='WMJSTimeSelector-table WMJSTimeSelector-noselect'>";d=function(a){var b="WMJSTimeSelector-tr";1==a.isLoaded&&(b+=" WMJSTimeSelector-col-loaded");a.value==f&&(b+=" WMJSTimeSelector-col-selected");return"<tr class='"+b+"'>"+("<td class='WMJSTimeSelector-colindex'>"+a.index+"</td><td class='WMJSTimeSelector-col'>"+a.textdate+"</td><td class='WMJSTimeSelector-colindex'>"+a.index+"</td><td class='WMJSTimeSelector-col'>"+a.texttime+"</td>")+
"</tr>"};c={};for(k=0;k<b.values.length;k++)c.index=k,c.value=b.values[k],c.text=c.value.replace(/T/g," | "),c.text=c.text.replace(/Z/g," "),c.textdate=c.value.split("T")[0],c.texttime=c.value.split("T")[1],c.texttime=c.texttime.split(":")[0]+":"+c.texttime.split(":")[1]+"z",c.isLoaded=B(c.value),a+=d(c);k=""+(a+"</table>");$(m).html(k);var q=function(a){a=$(a.target).parent().find("td").first().html();t(b.values[a])};$(b.element).find(".WMJSTimeSelector-tr").mouseover(function(a){0!=fa&&q(a)});$(b.element).find(".WMJSTimeSelector-tr").mousedown(q)}else $(m).html(I18n.no_dimensions_available.text),
l.hide(),n.hide(),b.currentValue="",b.values=[]};var fa=!1;$(document).mousedown(function(){fa=!0}).mouseup(function(){fa=!1});$(b.element).bind("mousewheel",function(a){var b=0;try{isDefined(a.originalEvent.deltaY)&&(b=a.originalEvent.deltaY)}catch(c){}0==b&&(b=0<a.originalEvent.wheelDelta/120?-1:1);0>b?p.click():w.click()})};var GFITimeElevationWindow=function(a){this.t=function(){return 123};var d;this.setSize=function(c,b){c-=80;b-=70;a.width(c);a.height(b);var e=a.find(".timeaxis").get(0).getContext("2d");e.canvas.height=50;e.canvas.width=c;e=a.find(".heightaxis").get(0).getContext("2d");e.canvas.height=b;e.canvas.width=60;d.setSize(c,b);d.draw()};a.html('<table class="gfi_table"><tr class="gfi_table_tr"><td class="gfi_table_td"><canvas class="heightaxis" class="gfi_nomarginpadding"  ></canvas></td><td class="gfi_table_td"><div class="gfi_nomarginpadding gfi_mainmap" style="width:1200px;height:600px;"></div></td><td><div class="legend"></div></td></tr><tr class="gfi_table_tr"><td class="gfi_table_td"></td><td><canvas class="timeaxis"  class="gfi_nomarginpadding"   ></canvas><td class="gfi_table_td"></td></tr></table>');
var c=a.find(".gfi_mainmap").get(0);d=new WMJSMap(c);d.hideScaleBar();d.displayLegendInMap(!1);d.getOverlayElement().css("border","1px solid black");this.setSize(a.width(),a.height());this.updateBBOX=function(c){var b=a.find(".timeaxis").get(0).getContext("2d");b.fillStyle="#FFF";b.font="10px Arial";b.fillRect(0,0,d.getWidth(),50);for(var e=-1,l=Math.round(c.left);l<Math.round(c.right);l+=1E4){var m=new Date(l);-1==e&&(e=m.getUTCHours());if(e!=m.getUTCHours()){b.fillStyle="#000000";var n=(l-c.left)/
(c.right-c.left)*d.getWidth();b.beginPath();b.moveTo(n-1,0);b.lineTo(n-1,10);b.stroke();e=m.getUTCHours();b.fillText(e,n-b.measureText(e).width/2-1,20);e=m.getUTCHours()}}b.font="14px Arial";b.fillText("time UTC (h)",d.getWidth()/2-100,38);b=a.find(".heightaxis").get(0).getContext("2d");b.font="10px Arial";b.fillStyle="#FFF";b.fillRect(0,0,60,d.getHeight());b.textAlign="right";e=-1.1;if(!(100<Math.abs(Math.round(c.top)-Math.round(c.bottom))/1E3)){for(l=Math.round(c.bottom);l<Math.round(c.top);l+=
1)m=Math.floor(l/1E3),-1.1==e&&(e=m),e!=m&&(b.fillStyle="#000000",n=(l-c.top)/(c.bottom-c.top)*d.getHeight(),b.beginPath(),b.moveTo(50,n),b.lineTo(60,n),b.stroke(),e=l,b.fillText(e,48,n+3),e=m);b.save();b.translate(5,d.getHeight()/2-50);b.rotate(-Math.PI/2);b.font="14px Arial";b.fillText("height (m)",5,6);b.restore()}};this.drawLegend=function(){var c=d.getLayers()[0],c=d.getLegendGraphicURLForLayer(c);a.find(".legend").html('<img class="legendimg" src="'+c+'&TRANSPARENT=TRUE"/>')};d.addListener("onupdatebbox",
this.updateBBOX,!0);d.setProjection("GFI:TIME_ELEVATION",[(new Date("2016-04-01T00:00:00Z")).getTime(),0,(new Date("2016-04-02T00:00:00Z")).getTime(),15270]);this.updateBBOX(d.getProjection().bbox);this.getWebMapJS=function(){return d}};var WMJSAnimate=function(a){a.animationDelay=100;var d=a.getListener(),c=a.getImageStore(),f=this,b=document.createElement("div");$(b).mouseout(function(){a.mouseHoverAnimationBox=!1});var e=0,l=function(){if(0==a.isAnimating)a.isAnimatingLoopRunning=!1;else if(a.animationTimer.init(50,l),f.checkAnimation(),e--,!(0<e)){var b=a.animationDelay;0==a.currentAnimationStep&&(b*=3);a.currentAnimationStep==a.animationList.length-1&&(b*=5);e=b/50;if(!1===a.mouseHoverAnimationBox){0!=a.isAnimating&&1!=a.animateBusy&&
((b=a.animationList[a.currentAnimationStep])?(a.setDimension(b.name,b.value,!1),d.triggerEvent("ondimchange"),d.triggerEvent("onnextanimationstep",a),a._pdraw(),a.animateBusy=!1):error("No animation step for "+a.currentAnimationStep));b=a.currentAnimationStep+1;b>=a.animationList.length&&(b=0);var c=!1,k=0,p=a.animationList[b];a.setDimension(p.name,p.value,!1);a.animationList[b].requests=a.getWMSRequests();p=a.animationList[a.currentAnimationStep];a.setDimension(p.name,p.value,!1);for(p=0;p<a.animationList[b].requests.length;p++){var w=
a.animationList[b].requests[p];(w=a.getImageStore().getImageForSrc(w))&&w.isLoaded()?k++:e=0}k==a.animationList[b].requests.length&&(c=!0);c&&(a.currentAnimationStep=b)}}};a.isAnimatingLoopRunning=!1;f.checkAnimation=function(){if(0==a.isAnimating)a.isAnimatingLoopRunning=!1;else{a.animationTimer||(a.animationTimer=new WMJSTimer);if(!1===a.mouseHoverAnimationBox){var b=c.getNumImagesLoading();if(4>b){var d=a.animationList.length;if(0<a.animationList.length)for(var e=0;e<d;e++){for(var f=e+a.currentAnimationStep;0>
f;)f+=a.animationList.length;for(;f>=a.animationList.length;)f-=a.animationList.length;0>f&&(f=0);if(0<=f){var w=a.animationList[f];a.setDimension(w.name,w.value,!1);a.animationList[f].requests=a.getWMSRequests();w=a.animationList[a.currentAnimationStep];a.setDimension(w.name,w.value,!1);a.animationList[f].imagesInPrefetch=a.prefetch(a.animationList[f].requests);b+=a.animationList[f].imagesInPrefetch.length;if(3<b)break}}}}0==a.isAnimatingLoopRunning&&(a.isAnimatingLoopRunning=!0,l())}};a.stopAnimating=
function(){0!=a.isAnimating&&(b.style.display="none",a.isAnimating=!1,a.animateBusy=!1,a.rebuildMapDimensions(),d.triggerEvent("onstopanimation",a))};a.currentAnimationStep=0;a.animationList=void 0;a.isAnimating=!1;a.setAnimationDelay=function(b){1>b&&(b=1);a.animationDelay=b};b.style.zIndex=1E4;b.style.background="none";b.style.position="absolute";b.style.border="none";b.style.margin="0px";b.style.padding="0px";b.style.lineHeight="14px";b.style.fontFamily='"Courier New", "Lucida Console", Monospace';
b.style.fontSize="10px";a.getBaseElement().append(b)};var WMJSDialog={},WMJSDialogsCreated=0;WMJSDialog.closeAllDialogs=function(a){for(var d=0;d<a.length;d++)a[d].remove()};
WMJSDialog.createDialog=function(a,d,c){WMJSDialogsCreated++;var f=0,b=0,e=!0,l=!0;isDefined(a.id);isDefined(a.show)&&(e=a.show);isDefined(a.x)&&(f=a.x);isDefined(a.y)&&(b=a.y);isDefined(a.autoDestroy)&&(l=a.autoDestroy);var m=jQuery("<div />",{css:{minHeight:"20px",height:180,width:320,zIndex:1E3,border:"1px solid #01405e",borderRadius:"3px",position:"absolute",boxShadow:"0.06rem 0.125rem 0.125rem rgba(0, 0, 0, 0.3)",margin:0,padding:"0px",backgroundColor:"#01547d",display:"inline-block"},mousedown:function(a){a.stopPropagation();
preventdefault_event(a)},mousewheel:function(a){a.stopPropagation()}});e&&m.appendTo(d);m.hasBeenDragged=!1;m.on("drag",function(a,b){m.hasBeenDragged=!0});m.resizable();m.draggable();m.closeDialog=function(){0==l?(m.hide(),m.trigger("hide")):(m.remove(),dialogClosed(m))};m.keyup(function(a){27==a.keyCode&&m.closeDialog()});jQuery("<div/>",{css:{color:"white",fontWeight:"bold",textColor:"white",width:"16px",height:"16px",lineHeight:"14px",margin:"1px",padding:"1px !important",zIndex:1200},click:function(){m.closeDialog()}}).appendTo(m).iconbutton({label:"X"}).addClass("wmjsdialog-closebutton");
var n=jQuery("<div/>",{css:{position:"absolute",right:"0px",top:"18px",background:"#FFF",borderTop:"1px solid #01405e",width:"100%",height:"100%",overflow:"auto",fontSize:"10px",lineHeight:"12px"},mousedown:function(a){a.stopPropagation();preventdefault_event(a)}}).appendTo(m);m.resize(function(){n.css({width:m.width()+"px",height:m.height()-18+"px"})});m.resize();m.setLoading=function(){n.html('<img style="margin-left:10px;margin-top:10px;" src="'+loadingImageSrc+'"/>')};m.setXY=function(a,b){m.hasBeenDragged=
!1;m.css({left:a+"px",top:b+"px"});var d=c.getGeoCoordFromPixelCoord({x:a,y:b});m.geoPosX=d.x;m.geoPosY=d.y;m.x=a;m.y=b};m.setXY(f,b);m.origX=f;m.origY=b;m.setLoading();m.setHTML=function(a){n.html(a)};isDefined(a.dataURL)&&(d=function(a){n.html(a)},MakeHTTPRequest(a.dataURL,d,d));return m};
