'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,d){a!=Array.prototype&&a!=Object.prototype&&(a[c]=d.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,c,d,k){if(c){d=$jscomp.global;a=a.split(".");for(k=0;k<a.length-1;k++){var b=a[k];b in d||(d[b]={});d=d[b]}a=a[a.length-1];k=d[a];c=c(k);c!=k&&null!=c&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:c})}};$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,d,k){var b=this.length||0;0>d&&(d=Math.max(0,b+d));if(null==k||k>b)k=b;k=Number(k);0>k&&(k=Math.max(0,b+k));for(d=Number(d||0);d<k;d++)this[d]=a;return this}},"es6-impl","es3");
$jscomp.polyfill("Math.log10",function(a){return a?a:function(a){return Math.log(a)/Math.LN10}},"es6-impl","es3");$jscomp.findInternal=function(a,c,d){a instanceof String&&(a=String(a));for(var k=a.length,b=0;b<k;b++){var f=a[b];if(c.call(d,f,b,a))return{i:b,v:f}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,d){return $jscomp.findInternal(this,a,d).v}},"es6-impl","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var c=0;return $jscomp.iteratorPrototype(function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,c){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var d=0,k={next:function(){if(d<a.length){var b=d++;return{value:c(b,a[b]),done:!1}}k.next=function(){return{done:!0,value:void 0}};return k.next()}};k[Symbol.iterator]=function(){return k};return k};
$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,d){return d})}},"es6","es3");$jscomp.checkStringArgs=function(a,c,d){if(null==a)throw new TypeError("The 'this' value for String.prototype."+d+" must not be null or undefined");if(c instanceof RegExp)throw new TypeError("First argument to String.prototype."+d+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,d){var c=$jscomp.checkStringArgs(this,a,"startsWith");a+="";var b=c.length,f=a.length;d=Math.max(0,Math.min(d|0,c.length));for(var n=0;n<f&&d<b;)if(c[d++]!=a[n++])return!1;return n>=f}},"es6-impl","es3");$jscomp.owns=function(a,c){return Object.prototype.hasOwnProperty.call(a,c)};
$jscomp.polyfill("Object.assign",function(a){return a?a:function(a,d){for(var c=1;c<arguments.length;c++){var b=arguments[c];if(b)for(var f in b)$jscomp.owns(b,f)&&(a[f]=b[f])}return a}},"es6-impl","es3");
function Console(a){function c(a){a=(a+"").replace(/&/g,"&amp;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");a=a.replace(/\"/g,"&quot;");return a=a.replace(/\n/g,"<br>")}var d=a,k="";this.println=function(a,f){k=0==f?k+("<p class='stdoutmessage'>"+a+"</p>"):k+("<p class='stdoutmessage'>"+c(a)+"</p>");isDefined(d)&&(d.innerHTML=k,d.scrollTop=d.scrollHeight);17824<k.length&&(k=k.substring(k.length-13368))};this.errprintln=function(a,f){k=0==f?k+("<p class='stderrmessage'>"+a+"</p>"):k+("<p class='stderrmessage'>"+
c(a)+"</p>");isDefined(d)&&(d.innerHTML=k,d.scrollTop=d.scrollHeight)};this.cls=function(){k="";isDefined(d)&&(d.innerHTML=k)};this.setSize=function(a,c){isDefined(d)&&(d.scrollTop=d.scrollHeight,d.style.width=a+"px",d.style.height=c+"px",d.width=a+"px",d.height=c+"px")};this.setElement=function(a){d=a;isDefined(d)&&(d.style.overflow="scroll",d.style.display="inline-block",d.style.position="absolute",d.style.width="100%",d.style.height="100%",d.style.font="normal 12px courier",d.noWrap=!0,d.style.whiteSpace=
"nowrap",d.innerHTML=k,d.scrollTop=d.scrollHeight)};this.setElement(a)}function isDefined(a){return"undefined"===typeof a?!1:!0}function isNull(a){return null===a?!0:!1}function toArray(a){if(!a)return[];if(a.length)return a;var c=[];c[0]=a;return c}var WMJSSet=function(){};WMJSSet.prototype.add=function(a){this[a]=!0};WMJSSet.prototype.remove=function(a){delete this[a]};
function WMJSKVP(a){var c=[];this._parse=function(a){var c=[];if(a=a.split("&"))for(var b in a){var d=a[b].split("=");if(2==d.length){var n=d[0],d=d[1];c[n]instanceof Array||(c[n]=[]);c[n].push(d)}}return c};this.getKeys=function(){var a=new WMJSSet;for(key in c)a.add(key);return a};this.getValues=function(a){return c[a]};this.getKeyValues=function(){return c};return c=this._parse(a)}
var preventdefault_event=function(a){a=a||window.event;a.preventDefault?a.preventDefault():a.returnValue=!1},attach_event=function(a,c,d){if("mousewheel"==c){var k=function(a,c){var b=0;a||(a=window.event,window.event.cancelBubble=!0,window.event.returnValue=!1);a.wheelDelta?b=a.wheelDelta/120:a.detail&&(b=-a.detail/3);b&&c(b);a.preventDefault&&a.preventDefault();a.returnValue=!1};a.addEventListener&&a.addEventListener("DOMMouseScroll",function(a){k(a,d)},!1);a.onmousewheel=document.onmousewheel=
function(a){k(a,d)}}else browser.isNS?a.addEventListener(c,d,!0):(a.attachEvent("on"+c,d),void 0!=window.event&&(window.event.cancelBubble=!0,window.event.returnValue=!1))},del_event=function(a,c,d){var k=!0;browser.isOP&&(k=!1);a.removeEventListener?a.removeEventListener(c,d,k):a.detachEvent&&(a.detachEvent(c,d),a.detachEvent("on"+c,d))},getClick_X=function(a){return browser.isNS?a.clientX+window.scrollX:window.event.clientX+document.documentElement.scrollLeft+document.body.scrollLeft},getClick_Y=
function(a){return browser.isNS?a.clientY+window.scrollY:window.event.clientY+document.documentElement.scrollTop+document.body.scrollTop},findElementPos=function(a){for(var c=a,d=curtop=0;a;)d+=a.offsetLeft,curtop+=a.offsetTop,a=a.offsetParent;return[d,curtop,parseInt(c.style.width+d),parseInt(c.style.height+curtop)]};
function Browser(){this.isKonqueror=this.isOP=this.isNS=this.isIE=!1;this.name=navigator.appName;this.version=null;-1!=navigator.userAgent.indexOf("Opera")?this.isOP=!0:"Netscape"==navigator.appName||"Konqueror"==navigator.appName?this.isKonqueror=this.isNS=!0:-1!=navigator.appName.indexOf("Microsoft")&&(this.isIE=!0)}var browser=new Browser;function IsNumeric(a){var c=!0;for(i=0;i<a.length&&1==c;i++){var d=a.charAt(i);-1=="0123456789.".indexOf(d)&&(c=!1)}return c}
function dump(a,c,d){var k="";d||(d="");c||(c=0);if("object"===typeof a)for(var b in a){var f=a[b];if(IsNumeric(b)){b="["+b+"]";var n=d.substr(0,d.length-1)+b}else n=d+b;k="object"===typeof f?k+dump(f,c+1,n+"."):k+(n+'="'+f+'"<br>\n')}else k="===>"+a+"<===("+typeof a+")";return k}
var Url={encode:function(a){return escape(this._utf8_encode(a))},decode:function(a){alert("Deprecated function !!! WMJSTools line 325 with ["+a+"]");return this._utf8_decode(unescape(a))},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var c="",d=0;d<a.length;d++){var k=a.charCodeAt(d);128>k?c+=String.fromCharCode(k):(127<k&&2048>k?c+=String.fromCharCode(k>>6|192):(c+=String.fromCharCode(k>>12|224),c+=String.fromCharCode(k>>6&63|128)),c+=String.fromCharCode(k&63|128))}return c},_utf8_decode:function(a){var c=
"",d=0;for(c1=c2=0;d<a.length;){var k=a.charCodeAt(d);128>k?(c+=String.fromCharCode(k),d++):191<k&&224>k?(c2=a.charCodeAt(d+1),c+=String.fromCharCode((k&31)<<6|c2&63),d+=2):(c2=a.charCodeAt(d+1),c3=a.charCodeAt(d+2),c+=String.fromCharCode((k&15)<<12|(c2&63)<<6|c3&63),d+=3)}return c}};Array.indexOf||(Array.prototype.indexOf=function(a){for(var c=0;c<this.length;c++)if(this[c]==a)return c;return-1});
function createXHR(){try{return new XMLHttpRequest}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(a){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){}return!1}
function MakeJSONRequest(a,c,d,k,b){function f(a){d?d(a,k):c(void 0,k)}function n(){0==b?(a=requestProxy+"REQUEST="+URLEncode(a),MakeJSONRequest(a,c,d,k,!0)):f("status("+g.status+") to "+a)}a=-1==a.indexOf("?")?a+"?":a+"&";a+="rand="+Math.random();b||(b=!1);try{var g=createXHR();g.open("GET",a,!0);g.onreadystatechange=function(){if(4==g.readyState)if(200==g.status){try{var b=eval("("+g.responseText+")")}catch(w){f("Invalid JSON: '"+g.responseText+"'");return}void 0==b?f("request returned no data:"+
a):c(b,k)}else n()};g.send(null)}catch(e){n()}}
function MakeHTTPRequest(a,c,d,k,b){function f(a){d?d(a,k):c(void 0,k)}function n(){0==b?(a=requestProxy+"REQUEST="+URLEncode(a),MakeHTTPRequest(a,c,d,k,!0)):f("status("+g.status+") to "+a)}a=-1==a.indexOf("?")?a+"?":a+"&";a+="rand="+Math.random();b||(b=!1);try{var g=createXHR();g.open("GET",a,!0);g.onreadystatechange=function(){if(4==g.readyState)if(200==g.status){try{var a=g.responseText}catch(w){f("Exception occured:"+w);return}void 0==a||""==a?f("request returned no data"):c(a,k)}else n()};g.send(null)}catch(e){n()}}
var URLDecode=function(a){if(!isDefined(a))return"";a=a.replaceAll("+"," ");a=a.replaceAll("%2B","+");a=a.replaceAll("%20"," ");a=a.replaceAll("%5E","^");a=a.replaceAll("%26","&");a=a.replaceAll("%3F","?");a=a.replaceAll("%3E",">");a=a.replaceAll("%3C","<");a=a.replaceAll("%5C","\\");a=a.replaceAll("%2F","/");a=a.replaceAll("%25","%");a=a.replaceAll("%3A",":");a=a.replaceAll("%27","'");return a=a.replaceAll("%24","$")},URLEncode=function(a){if(!a||void 0==a||""==a||"string"!==typeof a)return a;a=
a.replace(/\%/g,"%25");a=a.replace(/\+/g,"%2B");a=a.replace(/\ /g,"%20");a=a.replace(/\^/g,"%5E");a=a.replace(/\&/g,"%26");a=a.replace(/\?/g,"%3F");a=a.replace(/\>/g,"%3E");a=a.replace(/\</g,"%3C");a=a.replace(/\\/g,"%5C");for(var c="",d=0;d<a.length;d++){var k=a.charAt(d);if(" "==k)c+="%20";else if(-1!="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz%-_.!~*'()".indexOf(k))c+=k;else{var b=k.charCodeAt(0);255<b?(alert("Unicode Character '"+k+"' cannot be encoded using standard URL encoding.\n(URL encoding only supports 8-bit characters.)\nA space (+) will be substituted."),
c+="+"):(c+="%",c+="0123456789ABCDEF".charAt(b>>4&15),c+="0123456789ABCDEF".charAt(b&15))}}return c};String.prototype.replaceAll=function(a,c){for(var d=this,k=d.indexOf(a);-1!=k;)d=d.replace(a,c),k=d.indexOf(a);return d};String.prototype.trim=function(){var a=this.replace(/^\s+/,"");return a=a.replace(/\s+$/,"")};function checkValidInputTokens(a){var c=/^([a-zA-Z'_:~%?\$,\.\0-9 \-=/&])+$/;return c.test(a)&&(a=URLDecode(a),c.test(a))?!0:!1}
function getUrlVars(){for(var a=[],c,d=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),k=0;k<d.length;k++)c=d[k].split("="),c[1]=URLDecode(c[1]),0!=checkValidInputTokens(c[0])&&0!=checkValidInputTokens(c[1])&&(a[c[0]]=c[1]+"");return a}
function getUrlVarsFromHashTag(){var a=[];var c=window.location.hash.indexOf("#");"?"==window.location.hash[c+1]&&c++;for(var d=window.location.hash.slice(c+1).split("&"),k=0;k<d.length;k++)c=d[k].split("="),c[1]=URLDecode(c[1]),0!=checkValidInputTokens(c[0])&&0!=checkValidInputTokens(c[1])&&(a[c[0]]=c[1]+"");return a}
var composeUrlObjectFromURL=function(a){var c=[];if(!isDefined(a))return c;var d="";a=a.split("?");1<a.length?(d=a[0],a=a[1].split("&")):a=a[0].split("&");for(var k=0;k<a.length;k++)hash=a[k].split("="),isDefined(hash[1])?(hash[1]=URLDecode(hash[1]),0!=checkValidInputTokens(hash[0])&&0!=checkValidInputTokens(hash[1])&&isDefined(hash[1])&&0<hash[1].length&&(c[hash[0].toLowerCase()]=hash[1]+"")):(hash=a[k].split("%3D"),isDefined(hash[1])&&(hash[1]=URLDecode(hash[1]),0!=checkValidInputTokens(hash[0])&&
0!=checkValidInputTokens(hash[1])&&isDefined(hash[1])&&0<hash[1].length&&(c[hash[0].toLowerCase()]=hash[1]+"")));a[0].indexOf("=");return{location:d,kvp:c}},currentLocationHash="",hashTagCheckerInUse=!1,_checkIfHashTagChanged=function(a){var c=window.location.hash;currentLocationHash!=c&&0<c.length&&(currentLocationHash=c,-1!=window.location.href.indexOf("#")&&(c=window.location.href.split("#")[1],c=c.replaceAll("%27","'"),urlVars=getUrlVarsFromHashTag(),isDefined(urlVars.clearhash)&&"1"==urlVars.clearhash&&
(currentLocationHash=window.location.hash=""),a(c,urlVars)));setTimeout(function(){_checkIfHashTagChanged(a)},100)},checkIfHashTagChanged=function(a){isDefined(a)&&(1==hashTagCheckerInUse?alert("checkIfHashTagChanged is in use"):(hashTagCheckerInUse=!0,_checkIfHashTagChanged(a)))},decodeBase64=function(a){var c={},d,k=0,b,f=0,n,g="",e=String.fromCharCode,w=a.length;for(d=0;64>d;d++)c["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d)]=d;for(b=0;b<w;b++)for(d=c[a.charAt(b)],
k=(k<<6)+d,f+=6;8<=f;)((n=k>>>(f-=8)&255)||b<w-2)&&(g+=e(n));return g};function DateInterval(a,c,d,k,b,f){this.year=parseInt(a);this.month=parseInt(c);this.day=parseInt(d);this.hour=parseInt(k);this.minute=parseInt(b);this.second=parseInt(f);this.isRegularInterval=!1;0==this.month&&0==this.year&&(this.isRegularInterval=!0);this.getTime=function(){if(0!=this.month)throw"month != 0";if(0!=this.year)throw"year != 0";var a=0+86400*this.day;a+=3600*this.hour;a+=60*this.minute;a+=this.second;return 1E3*a};this.toISO8601=function(){var a="P";0!=this.year&&(a+=this.year+"Y");
0!=this.month&&(a+=this.month+"M");0!=this.day&&(a+=this.day+"D");0!=this.hour&&0!=this.minute&&0!=this.second&&(a+="T");0!=this.hour&&(a+=this.hour+"H");0!=this.minute&&(a+=this.minute+"M");0!=this.second&&(a+=this.second+"S");return a}}
function parseISO8601DateToDate(a){if(a){var c=a.split("T");c[0]=c[0].replace(/-/g,":");c[0]=c[0].replace(/::/g,":-");a=c[0].split(":");var c=c[1].split(":"),d=new Date(Date.UTC(a[0],a[1]-1,a[2],c[0],c[1],c[2].split("Z")[0]));d.add=function(a){0==a.isRegularInterval?(0!=a.year&&this.setUTCFullYear(this.getUTCFullYear()+a.year),0!=a.month&&this.setUTCMonth(this.getUTCMonth()+a.month),0!=a.day&&this.setUTCDate(this.getUTCDate()+a.day),0!=a.hour&&this.setUTCHours(this.getUTCHours()+a.hour),0!=a.minute&&
this.setUTCMinutes(this.getUTCMinutes()+a.minute),0!=a.second&&this.setUTCSeconds(this.getUTCSeconds()+a.second)):this.setTime(this.getTime()+a.getTime())};d.substract=function(a){0==a.isRegularInterval?(0!=a.year&&this.setUTCFullYear(this.getUTCFullYear()-a.year),0!=a.month&&this.setUTCMonth(this.getUTCMonth()-a.month),0!=a.day&&this.setUTCDate(this.getUTCDate()-a.day),0!=a.hour&&this.setUTCHours(this.getUTCHours()-a.hour),0!=a.minute&&this.setUTCMinutes(this.getUTCMinutes()-a.minute),0!=a.second&&
this.setUTCSeconds(this.getUTCSeconds()-a.second)):this.setTime(this.getTime()-a.getTime())};d.addMultipleTimes=function(a,b){0==a.isRegularInterval?(0!=a.year&&this.setUTCFullYear(this.getUTCFullYear()+a.year*b),0!=a.month&&this.setUTCMonth(this.getUTCMonth()+a.month*b),0!=a.day&&this.setUTCDate(this.getUTCDate()+a.day*b),0!=a.hour&&this.setUTCHours(this.getUTCHours()+a.hour*b),0!=a.minute&&this.setUTCMinutes(this.getUTCMinutes()+a.minute*b),0!=a.second&&this.setUTCSeconds(this.getUTCSeconds()+a.second*
b)):this.setTime(this.getTime()+a.getTime()*b)};d.substractMultipleTimes=function(a,b){0==a.isRegularInterval?(0!=a.year&&this.setUTCFullYear(this.getUTCFullYear()-a.year*b),0!=a.month&&this.setUTCMonth(this.getUTCMonth()-a.month*b),0!=a.day&&this.setUTCDate(this.getUTCDate()-a.day*b),0!=a.hour&&this.setUTCHours(this.getUTCHours()-a.hour*b),0!=a.minute&&this.setUTCMinutes(this.getUTCMinutes()-a.minute*b),0!=a.second&&this.setUTCSeconds(this.getUTCSeconds()-a.second*b)):this.setTime(this.getTime()-
a.getTime()*b)};d.toISO8601=function(){function a(a,c){a+="";c-=a.length;var b,d="";for(b=0;b<c;b++)d+="0"+d;return d+a}return a(this.getUTCFullYear(),4)+"-"+a(this.getUTCMonth()+1,2)+"-"+a(this.getUTCDate(),2)+"T"+a(this.getUTCHours(),2)+":"+a(this.getUTCMinutes(),2)+":"+a(this.getUTCSeconds(),2)+"Z"};d.clone=function(){return parseISO8601DateToDate(d.toISO8601())};return d}console.log("Warning: no date given to parseISO8601DateToDate")}
function parseISO8601IntervalToDateInterval(a){if("P"==a.charAt(0)){var c=a.split("T"),d=a=0,k=0,b=0;seconds=minutes=0;var f=c[0].split("P")[1];if(f){var n=f.indexOf("Y");var g=f.indexOf("M"),e=f.indexOf("D");-1!=n&&(a=f.substring(0,n));-1!=g&&(d=f.substring(n+1,g));-1!=e&&(-1!=g&&(n=g),k=f.substring(n+1,e))}0<c.length&&isDefined(c[1])&&(c=c[1])&&(n=c.indexOf("H"),f=c.indexOf("M"),g=c.indexOf("S"),-1!=n&&(b=c.substring(0,n)),-1!=f&&(minutes=c.substring(n+1,f)),-1!=g&&(-1!=f&&(n=f),seconds=c.substring(n+
1,g)));return new DateInterval(a,d,k,b,minutes,seconds)}}function getNumberOfTimeSteps(a,c,d){var k=0;if(0!=d.month||0!=d.year){a=a.clone();for(c=c.getTime();a.getTime()<c;)a.add(d),k++;k++}else k=parseInt((c.getTime()-a.getTime())/d.getTime()+.5)+1;return k}
function parseISOTimeRangeDuration(a){a=a.split("/");void 0==a[2]&&(a[2]="PT1M");void 0==a[1]&&(a[1]=a[0],a[2]="PT1M");this.startTime=parseISO8601DateToDate(a[0]);this.stopTime=parseISO8601DateToDate(a[1]);this.timeInterval=parseISO8601IntervalToDateInterval(a[2]);this.timeSteps=getNumberOfTimeSteps(this.startTime,this.stopTime,this.timeInterval);this.getTimeSteps=function(){return this.timeSteps};this.getDateAtTimeStep=function(a){if(0==this.timeInterval.isRegularInterval){var c=this.startTime.clone();
c.addMultipleTimes(this.timeInterval,a)}else{c=this.startTime.clone();var k=this.timeInterval.getTime(),k=k*a;c.setTime(c.getTime()+k)}return c};this.getTimeStepFromISODate=function(a,d){try{currentDate=parseISO8601DateToDate(a)}catch(k){throw"The date '"+a+"' is not a valid date";}return this.getTimeStepFromDate(currentDate,d)};this.getTimeStepFromDate=function(a,d){d||(d=!1);var c=a.getTime();if(c<this.startTime.getTime()){if(1==d)throw 0;return 0}var b=this.stopTime.clone();b.add(this.timeInterval);
if(c>b.getTime()){if(1==d)throw this.timeSteps-1;return this.timeSteps-1}if(c>this.stopTime.getTime())return this.timeSteps-1;if(0==this.timeInterval.isRegularInterval){d=this.startTime.clone();for(j=0;j<this.timeSteps;j++){b=d.getTime();d.add(this.timeInterval);var f=d.getTime();if(c>=b&&c<f)return j}throw"Date "+a.toISO8601()+" not found!";}a=(a.getTime()-this.startTime.getTime())/this.timeInterval.getTime();return a=parseInt(a);throw"Date "+a.toISO8601()+" not found";};this.getTimeStepFromDate_WithinRange=
function(a){return this.getTimeStepFromDate(a,!0)};this.getTimeStepFromDate_Clipped=function(a){return this.getTimeStepFromDate(a,!1)}}function getCurrentDateIso8601(){return parseISO8601DateToDate((new Date).toISOString().substring(0,19)+"Z")};Proj4js.defs["EPSG:3575"]="+proj=laea +lat_0=90 +lon_0=10 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs";Proj4js.defs["EPSG:3785"]="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs";Proj4js.defs["EPSG:3857"]="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs";Proj4js.defs["EPSG:3411"]="+proj=stere +lat_0=90 +lat_ts=70 +lon_0=-45 +k=1 +x_0=0 +y_0=0 +a=6378273 +b=6356889.449 +units=m +no_defs";
Proj4js.defs["EPSG:3412"]="+proj=stere +lat_0=-90 +lat_ts=-70 +lon_0=0 +k=1 +x_0=0 +y_0=0 +a=6378273 +b=6356889.449 +units=m +no_defs";Proj4js.defs["EPSG:4326"]="+proj=longlat +datum=WGS84 +no_defs";Proj4js.defs["EPSG:28992"]="+proj=sterea +lat_0=52.15616055555555 +lon_0=5.38763888888889 +k=0.9999079 +x_0=155000 +y_0=463000 +ellps=bessel +units=m +no_defs  <>";Proj4js.defs["EPSG:32661"]="+proj=stere +lat_0=90 +lat_ts=90 +lon_0=0 +k=0.994 +x_0=2000000 +y_0=2000000 +ellps=WGS84 +datum=WGS84 +units=m +no_defs";
Proj4js.defs["EPSG:102100"]=Proj4js.defs["EPSG:3857"];var epsgDescriptionLookup=[];epsgDescriptionLookup["EPSG:3411"]="NSIDC Sea Ice Polar Stereographic North";epsgDescriptionLookup["EPSG:3412"]="NSIDC Sea Ice Polar Stereographic South";epsgDescriptionLookup["EPSG:3575"]="Lambert azimuthal equal-area projection Europe";epsgDescriptionLookup["EPSG:3785"]="Mercator (deprecated)";epsgDescriptionLookup["EPSG:3857"]="Mercator";epsgDescriptionLookup["EPSG:4258"]="ETRS89";
epsgDescriptionLookup["EPSG:4326"]="World Lat lon WGS84";epsgDescriptionLookup["CRS:84"]="World Lat lon WGS84";epsgDescriptionLookup["EPSG:25831"]="ETRS89 / UTM zone 31N";epsgDescriptionLookup["EPSG:25832"]="ETRS89 / UTM zone 32N";epsgDescriptionLookup["EPSG:28992"]="Dutch Amersfoort / RD New";epsgDescriptionLookup["EPSG:32661"]="Polar Stereographic WGS 84 / UPS North";$.widget("ui.iconbutton",$.extend({},$.ui.button.prototype,{_init:function(){$.ui.button.prototype._init.call(this);this.element.removeClass("ui-corner-all").addClass("ui-iconbutton").unbind(".button")}}));var WMJSTileRenderer=function(a,c,d,k,b,f,n,g,e){if(e){"streetmap"===e&&(e="OSM");"pdok"===e&&(e="OSM");"naturalearth2"===e&&(e="NaturalEarth2");var w=g[e];if(w){var p=w[d];if(!p)for(var q in g)if(g.hasOwnProperty(q))for(var v in g[q])g[q].hasOwnProperty(v)&&v===d&&(p=g[q][v]);g=Math.PI;var M=256,B=12756274*g/M,A=-12756274*g/2,r=12756274*g/2;p.tileSize&&(M=p.tileSize);p.resolution&&(B=p.resolution);p.origX&&(A=p.origX);p.origY&&(r=p.origY);g=B*M+A;var I=r-B*M,E=g-A,T=r-I;(function(e){var g=p.home,
l=p.tileServerType;e<p.minLevel&&(e=p.minLevel);e>p.maxLevel&&(e=p.maxLevel);var w=Math.pow(2,e),q=E/(B/w*M),v=T/(B/w*M),w=parseInt(Math.round((a.left-A)/E*q/1+.5)),P=parseInt(Math.round((a.right-A)/E*q/1+.5)),t=parseInt(Math.round(v-(a.bottom-I)/T*v+.5)),D=parseInt(Math.round(v-(a.top-I)/T*v+.5)),ca=function(a,b,c){a=B/Math.pow(2,a);return{x:b*a+A,y:r-c*a}},sa=function(a,b,c,e){e=e*(a.y-b.top)/(b.bottom-b.top);return{x:parseFloat(c*(a.x-b.left)/(b.right-b.left)),y:parseFloat(e)}},S=function(a,e,
d,f){var p=ca(e,d*M,f*M);var w=ca(e,(d+1)*M,(f+1)*M);var q=p.x;var B=p.y;p=w.x;w=w.y;q=sa({x:q,y:B},c,k,b);p=sa({x:p,y:w},c,k,b);var S;"osm"===l&&(S=g+e+"/"+d+"/"+f+".png");if("arcgisonline"===l||"wmst"===l)S=g+e+"/"+f+"/"+d;e=n.getImage(S);!1===e.isLoaded()&&!1===e.hasError()&&!1===e.isLoading()&&e.load();if(e.isLoaded())try{a.drawImage(e.getElement()[0],parseInt(q.x),parseInt(q.y),parseInt(p.x-q.x)+1,parseInt(p.y-q.y)+1)}catch(Pa){}};if("EPSG:4326"===d||"EPSG:4258"===d)q*=2;1>D&&(D=1);D>v&&(D=v);
1>w&&(w=1);w>q&&(w=q);1>t&&(t=1);t>v&&(t=v);1>P&&(P=1);P>q&&(P=q);if(!(10<t-D||10<P-w))for(q=D-1;q<t;q++)for(v=w-1;v<P;v++)S(f,e,v,q)})(parseInt(Math.log(Math.abs(g-A)/((a.right-a.left)/k*M))/Math.log(2)))}else console.error("Tiled layer with name "+e+" not found")}else console.error("layerName not defined")};var WMJSImageStore=function(a,c,d){this.imagesbysrc={};var k=this.imageLife=0,b=this,f=[],n=function(a,b){for(b=0;b<f.length;b++)f[b](a)};b.getImageForSrc=function(a){if(b.imagesbysrc[a])return b.imagesbysrc[a]};b.clear=function(){for(var a in b.imagesbysrc)b.imagesbysrc.hasOwnProperty(a)&&b.imagesbysrc[a].clear()};b.addLoadEventCallback=function(a){f.push(a)};b.getNumImagesLoading=function(){var a=0,c;for(c in b.imagesbysrc)b.imagesbysrc.hasOwnProperty(c)&&b.imagesbysrc[c].isLoading()&&a++;return a};
b.getImage=function(g){var e=b.getImageForSrc(g);if(void 0!==e)return e.imageLife=k++,e;e=b.imagesbysrc;if(Object.keys)var f=Object.keys(e);else{var p=[];for(f in e)Object.prototype.hasOwnProperty.call(e,f)&&p.push(f);f=p}if(f.length<a)e=new WMJSImage(g,n,c,d);else{f=-1;var e=k,q;for(q in b.imagesbysrc)b.imagesbysrc.hasOwnProperty(q)&&(p=b.imagesbysrc[q],!1===p.isLoading()&&!0===p.isLoaded()&&e>=p.imageLife&&(e=p.imageLife,f=q));console.log("Reusing image "+f+" with lifetime "+e);if(-1===f){console.error("not enough cache for "+
c);return}e=b.imagesbysrc[f];delete b.imagesbysrc[f];e.clear()}e.setSource(g);e.KVP=WMJSKVP(g);b.imagesbysrc[g]=e;e.imageLife=k++;return e}};var WebMapJSMapNo=0,WebMapJSMapVersion="3.0.3",logging=!1,base="./",noimage,showDialog=!0,loadingImageSrc,WMSControlsImageSrc,mapPinImageSrc,scaleBarURL,enableConsoleDebugging=!1,enableConsoleErrors=!0,debug=function(a){enableConsoleDebugging&&console.log(a)},error=function(a){enableConsoleErrors&&console.log("WebMapJS warning: ",a)},WMJScheckURL=function(a){if(!isDefined(a))return"?";a=a.trim();-1==a.indexOf("?")&&(a+="?");return a};
function WMJSProjection(){this.bbox=new WMJSBBOX;this.srs="EPSG:4326"}var legendImageStore,getMapImageStore,bgMapImageStore,maxAnimationSteps=1E3;legendImageStore=new WMJSImageStore(5*maxAnimationSteps,"wmjslegendbuffer");getMapImageStore=new WMJSImageStore(5*maxAnimationSteps,"wmjsimagebuffer");bgMapImageStore=new WMJSImageStore(5E3,"wmjsimagebuffer",{randomizer:!1});
var setBaseURL=function(a){base=a;noimage=base+"/img/blank.gif?";loadingImageSrc=base+"/img/ajax-loader.gif";WMSControlsImageSrc=base+"/img/mapcontrols.gif";mapPinImageSrc=base+"/img/dot.gif";isDefined(scaleBarURL)||(scaleBarURL=base+"/php/makeScaleBar.php?");xml2jsonrequestURL=base+"/php/xml2jsonrequest.php?"},showDialogs=function(a){showDialog=a};
function WMJSMap(a,c){var d,k,b,f;function n(a){function m(ga){ga.currentTarget.removeEventListener("load",m,!1);c(a)}function b(m){(m=(m||event).srcElement)&&/^(complete|loaded)$/i.test(m.readyState)&&(m.detachEvent("onreadystatechange",b),c(a))}function c(a){1!=a.loadEventDone&&(a.loadEventDone=!0,a.loadEvent&&a.loadEvent(a))}a.style.left="0px";a.style.top="0px";a.loadEventDone=!1;a.failed=!1;a.addEventListener?a.addEventListener("load",m,!1):a.attachEvent("onreadystatechange",b);a.onerror=function(){a.src&&
a.src!=noimage&&(error(a.src),a.failed=!0,a.loadEvent&&a.loadEvent(a))}}function g(a){if(a){for(var m=0;m<r.length;m++)if(r[m]==a)return m;return-1}}function e(a){if(isDefined(a.name)&&(a.format||(a.format="image/png",error("layer format missing!")),!(1>a.name.length))){if("GFI:TIME_ELEVATION"==q){var m=a.getmapURL;m+="&SERVICE=WMS&REQUEST=GetFeatureInfo&VERSION="+a.version;m+="&LAYERS="+URLEncode(a.name);var b=a.name.split(",");m+="&QUERY_LAYERS="+URLEncode(b[b.length-1]);m=m+"&BBOX=29109.947643979103,6500000,1190890.052356021,7200000"+
("&CRS="+URLEncode("EPSG:3857")+"&");m+="WIDTH="+B;m+="&HEIGHT="+A;if(a.version==WMSVersion.version100||a.version==WMSVersion.version111)m+="&X=707&Y=557";a.version==WMSVersion.version130&&(m+="&I=707&J=557");m+="&FORMAT=image/gif&INFO_FORMAT=image/png&STYLES=";a=l.dateToISO8601(new Date(t.left));b=l.dateToISO8601(new Date(t.right));return m=m+("&time="+a+"/"+b)+("&elevation="+t.bottom+"/"+t.top)}m=a.getmapURL;m+="&SERVICE=WMS&";m+="VERSION="+a.version+"&";m+="REQUEST=GetMap&";m+="LAYERS="+URLEncode(a.name)+
"&";m+="WIDTH="+B+"&";m+="HEIGHT="+A+"&";m+=l.getBBOXandProjString(a);m+="STYLES="+URLEncode(a.currentStyle)+"&";m+="FORMAT="+a.format+"&";m=!0===a.transparent?m+"TRANSPARENT=TRUE&":m+"TRANSPARENT=FALSE&";try{m+=ta(a)}catch(Fa){return}return m+=a.wmsextensions.url}}function w(){p.mousedown(l.mouseDownEvent);p.mousewheel(l.mouseWheelEvent);attach_event(document,"mouseup",l.mouseUpEvent);attach_event(document,"mousemove",l.mouseMoveEvent);if(l.isTouchDevice()){l.enableInlineGetFeatureInfo(!1);var a=
new Hammer.Manager(document.body);a.add(new Hammer.Pan);a.add(new Hammer.Pinch);a.get("pan").set({direction:Hammer.DIRECTION_ALL});a.add(new Hammer.Swipe).recognizeWith(a.get("pan"));a.on("panstart",function(a){a.preventDefault();l.mouseDown(a.center.x,a.center.y,a)});a.on("panmove",function(a){a.preventDefault();l.mouseMove(a.center.x,a.center.y,a)});a.on("panend",function(a){a.preventDefault();l.mouseUp(a.center.x,a.center.y,a)});a.on("pinchstart",function(a){a.preventDefault();l.pinchStart(a.center.x,
a.center.y,a)});a.on("pinchmove",function(a){a.preventDefault();l.pinchMove(a.center.x,a.center.y,a)});a.on("pinchend",function(a){a.preventDefault();l.pinchEnd(a.center.x,a.center.y,a)});l.hideControls()}l.setMapModePan()}this.setBaseURL=function(a){base=a;noimage=base+"/img/blank.gif?";loadingImageSrc=base+"/img/ajax-loader.gif";WMSControlsImageSrc=base+"/img/mapcontrols.gif";mapPinImageSrc=base+"/img/dot.gif";isDefined(scaleBarURL)||(scaleBarURL=base+"/php/makeScaleBar.php?")};this.showDialogs=
function(a){showDialog=a};this.setBaseURL(base);this.setXML2JSONURL=function(a){xml2jsonrequest=a};this.setWMJSTileRendererTileSettings=function(a){tileRenderSettings=a};try{isDefined(c)&&(xml2jsonrequestURL=c)}catch(m){xml2jsonrequestURL=base+"/php/xml2jsonrequest.php?"}try{isDefined(requestProxy)}catch(m){requestProxy=base+"/php/MakeRequest.php?"}try{isDefined(scaleBarURL)}catch(m){scaleBarURL=base+"/php/makeScaleBar.php?"}var p,q,v=new WMJSBBOX,M=new WMJSBBOX,B=2,A=2,r=[],I=[],E="",T=0,l=this;
l.renderer="WMJSCanvasBuffer";var ea=!1,F=document.createElement("div"),u=document.createElement("div"),z=document.createElement("div"),ba=document.createElement("div"),P=!0,t=new WMJSBBOX,D=new WMJSBBOX,ca=new WMJSBBOX,sa=new WMJSBBOX,S=new WMJSBBOX,Q=[];l.getLegendStore=function(){return legendImageStore};var J=[],ra=!1,ab="default",Ea=!1,Na="default",bb=!1,cb=!1,Oa=$('<div class="WMJSDivBuffer-loading"/>',{}),Pa=0,da=0,fa=1,Ga,ua=0,V=0,Qa=0,Ra=0,X=Array(3),Sa=Array(3);for(j=0;3>j;j++)X[j]=new WMJSProjection,
Sa[j]=new WMJSProjection;var db=!0,C=new WMJSListener;this.getGraphingData=function(){return this.graphingData};this.setGraphingData=function(a){this.graphingData=a};var Ta=function(m){a.id||(a.id="WebMapJSMapNo_"+WebMapJSMapNo,WebMapJSMapNo++);return a.id+"_"+m};this.enableInlineGetFeatureInfo=function(a){db=a};this.closeAllGFIDialogs=function(){WMJSDialog.closeAllDialogs(U)};var U=[],eb=function(){enableConsoleDebugging&&console.log("onlegendready called");ha()},va=[],Ha=0,wa=!1,ha=function(a){if(!(2>
Q.length)){try{0==isDefined(a)&&(a=!1);if(1==wa&&isDefined(eb)){1==C.addToCallback("onlegendready",eb)&&enableConsoleDebugging&&console.log("Suspending on onlegendready");return}wa=!0;if(1==P){if(va.length!=r.length)a=!0;else for(var m=0;m<r.length;m++){var b=l.getLegendGraphicURLForLayer(r[m]);isDefined(b)&&va[m]!==b&&(va[m]=b,a=!0)}if(a){va=[];for(m=0;m<r.length;m++)!1!==r[m].enabled&&(b=l.getLegendGraphicURLForLayer(r[m]),isDefined(b)&&(va[m]=b,Q[Ha].setSrc(m,b)));var c=Ha;Ha=1-Ha;try{Q[c].load(function(){enableConsoleDebugging&&
console.log("Legend buffer nr"+c);try{for(var a=0,m=0;m<Q[c].layers.length;m++){Q[c].layers[m].getElement();var b=Q[c].layers[m].getElement()[0].height;a<b&&(a=b)}Q[c].display();Q[1-c].hide()}catch(rb){console.error(rb)}wa=!1;C.triggerEvent("onlegendready")})}catch(la){console.error(la),Q[0].hide(),Q[1].hide(),wa=!1,C.triggerEvent("onlegendready")}return}}else Q[0].hide(),Q[1].hide()}catch(la){console.log(la)}wa=!1;C.triggerEvent("onlegendready")}},Ua="",Va="";this.setMessage=function(a){Va=a&&""!==
a?a:""};this.setTimeOffset=function(a){Ua=a&&""!==a?a:""};this.canvasErrors=[];this.getCapabilitiesJSON=function(a,b){WMJSGetCapabilities(a,!0,b,function(a){error(a);b(a)})};this.rebuildMapDimensions=function(){for(var a=0;a<I.length;a++)I[a].used=!1;for(i=0;i<r.length;i++)for(a=0;a<r[i].dimensions.length;a++){var b=r[i].dimensions[a],c=l.getDimension(b.name);isDefined(c)?c.used=!0:(b=b.clone(),b.used=!0,I.push(b))}for(a=0;a<I.length;a++)0==I[a].used&&(I.splice(a,1),a--);C.triggerEvent("onmapdimupdate")};
this.getLayerByServiceAndName=function(a,b){for(var m=0;m<r.length;m++){var c=r[r.length-m-1];if(c.name==b&&c.service==a)return c}};this.getLayers=function(){for(var a=[],b=0;b<r.length;b++)a.push(r[r.length-b-1]);return a};this.setLayer=function(a,b){return l.addLayer(a,b,a)};this.setActive=function(a){bb=a;cb=!0};this.setActiveLayer=function(a){Ga=a;ha();C.triggerEvent("onchangeactivelayer")};this.calculateNumBaseLayers=function(){T=0;if(E)for(var a=0;a<E.length;a++)E[a].enabled&&0==E[a].keepOnTop&&
T++};this.enableLayer=function(a){a.enabled=!0;l.calculateNumBaseLayers();l.rebuildMapDimensions();ha(!0)};this.disableLayer=function(a){a.enabled=!1;l.calculateNumBaseLayers();l.rebuildMapDimensions();ha(!0)};this.toggleLayer=function(a){a.enabled=1==a.enabled?!1:!0;l.calculateNumBaseLayers();l.rebuildMapDimensions();ha(!0)};this.displayLayer=function(a,b){a.enabled=b;l.calculateNumBaseLayers();l.rebuildMapDimensions();ha(!0)};this.removeAllLayers=function(){for(var a=0;a<r.length;++a)r[a].setAutoUpdate(!1);
r=[];I=[];C.triggerEvent("onlayeradd")};this.deleteLayer=function(a){if(!(0>=r.length)){a.setAutoUpdate(!1);a=g(a);if(0<=a){for(var m=a;m<r.length-1;m++)r[m]=r[m+1];r.length--;Ga=void 0;0<=a&&a<r.length?(l.rebuildMapDimensions(),l.setActiveLayer(r[a])):0<r.length&&(l.rebuildMapDimensions(),l.setActiveLayer(r[r.length-1]))}C.triggerEvent("onlayerchange");l.rebuildMapDimensions()}};this.moveLayerDown=function(a){var m=g(a);if(0<m){a=r[m-1];var b=r[m];a&&b&&(r[m]=a,r[m-1]=b)}else try{error("moveLayerDown: layer '"+
a.name+"' not found.")}catch(Fa){error("moveLayerDown: layer invalid.")}};this.moveLayerUp=function(a){var m=g(a);if(m<r.length-1){a=r[m+1];var b=r[m];a&&b&&(r[m]=a,r[m+1]=b)}else try{error("moveLayerUp: layer '"+a.name+"' not found.")}catch(Fa){error("moveLayerUp: layer invalid.")}};this.addLayer=function(a){isDefined(a)&&(a.parentMaps.push(l),r.push(a),a.parseLayer(function(a){for(var m=0;m<a.dimensions.length;m++){var b=l.getDimension(a.dimensions[m].name);isDefined(b)&&isDefined(b.currentValue)&&
1==a.dimensions[m].linked&&a.dimensions[m].setClosestValue(b.currentValue)}l.rebuildMapDimensions();C.triggerEvent("onlayeradd")},void 0,"WMJSLayer::addLayer"))};this.getActiveLayer=function(){return Ga};this.setProjection=function(a,b){l.hideMapPin();a||(a="EPSG:4326");"object"===typeof a&&(b=a.bbox,a=a.srs);q=a;l.proj4.srs==q&&isDefined(this.proj4.projection)||(l.proj4.projection=new Proj4js.Proj(q),l.proj4.srs=q);l.setBBOX(b);M.setBBOX(b);l.updateMouseCursorCoordinates();C.triggerEvent("onsetprojection",
[q,t])};this.getBBOX=function(){return t};this.getProjection=function(a){return{srs:q,bbox:t}};this.getSize=function(){return{width:B,height:A}};this.getWidth=function(){return B};this.getHeight=function(){return A};this.repositionLegendGraphic=function(a){P?ha(a):(Q[0].hide(),Q[1].hide())};this.resizeHeight=this.resizeWidth=-1;var Wa=!1,sb=new WMJSTimer;this.setSize=function(a,b){enableConsoleDebugging&&console.log("setSize",a,b);4>parseInt(a)||4>parseInt(b)?console.log("Skipping setSize",a,b):(this.resizeWidth=
parseInt(a),this.resizeHeight=parseInt(b),!1===Wa?(Wa=!0,l._setSize(l.resizeWidth,l.resizeHeight)):sb.init(200,function(){Wa=!1;l._setSize(l.resizeWidth,l.resizeHeight);l.draw("resizeTimer")}))};this._setSize=function(m,b){if(m&&b&&!(4>parseInt(m)||4>parseInt(b))){enableConsoleDebugging&&console.log("setSize("+m+","+b+")");var c=this.getProjection();B=parseInt(m);A=parseInt(b);if(4>B||isNaN(B))B=4;if(4>A||isNaN(A))A=4;c.srs&&c.bbox||(error("this.setSize: Setting default projection (EPSG:4326 with (-180,-90,180,90)"),
c.srs="EPSG:4326",c.bbox.left=-180,c.bbox.bottom=-90,c.bbox.right=180,c.bbox.top=90,l.setProjection(c.srs,c.bbox));p.css({width:B,height:A});a.style.width=B+"px";a.style.height=A+"px";l.setBBOX(v);l.repositionMapPin();l.showBoundingBox();1<J.length&&(J[0].resize(l.getWidth(),l.getHeight()),J[1].resize(l.getWidth(),l.getHeight()));1<Q.length&&(Q[0].resize(l.getWidth(),l.getHeight()),Q[1].resize(l.getWidth(),l.getHeight()));l.repositionLegendGraphic(!0);J[fa]&&J[fa].display();C.triggerEvent("onresize",
[B,A])}};this.getBBOXandProjString=function(a){var m="";if(a.version==WMSVersion.version100||a.version==WMSVersion.version111)m+="SRS="+URLEncode(q)+"&",m+="BBOX="+t.left+","+t.bottom+","+t.right+","+t.top+"&";a.version==WMSVersion.version130&&(m+="CRS="+URLEncode(q)+"&",m="EPSG:4326"==q&&0==a.wms130bboxcompatibilitymode?m+("BBOX="+t.bottom+","+t.left+","+t.top+","+t.right+"&"):m+("BBOX="+t.left+","+t.bottom+","+t.right+","+t.top+"&"));return m};this.isTouchDevice=function(){return"undefined"!==typeof window.ontouchstart};
this.getDimensionRequestString=function(a){return ta(a)};this.dateToISO8601=function(a){function m(a,m){a+="";m-=a.length;var b,c="";for(b=0;b<m;b++)c+="0"+c;return c+a}return m(a.getUTCFullYear(),4)+"-"+m(a.getUTCMonth()+1,2)+"-"+m(a.getUTCDate(),2)+"T"+m(a.getUTCHours(),2)+":"+m(a.getUTCMinutes(),2)+":"+m(a.getUTCSeconds(),2)+"Z"};this.abort=function(){C.triggerEvent("onmapready");ea=!1;C.triggerEvent("onloadingcomplete")};this.isBusy=function(){return ea||0==J[0].ready||0==J[1].ready?!0:!1};this.getLegendGraphicURLForLayer=
function(a){if(a){var m=a.legendGraphic;if(m){m+="&layers="+URLEncode(a.name)+"&";try{1==a.legendIsDimensionDependant&&(m+=l.getDimensionRequestString(a)+"&")}catch(ma){return}return m=m+"&transparent=true&width=90&height=250&"+a.wmsextensions.url}}};var Xa=!0;this.showScaleBar=function(){Xa=!0;console.log("todo showScaleBar")};this.hideScaleBar=function(){Xa=!1;console.log("todo hideScaleBar")};this.getMaxNumberOfAnimations=function(){return maxAnimationSteps};this.drawLastTimes=function(a,b){b||
(b="hours");if(0!==r.length){var m=this.getActiveLayer();if(m&&(m=m.getDimension("time"))){var c=m.size()-1,e=[],d=moment.utc(m.getValueForIndex(c));for(a=d.subtract(a,b);0<c;){d=m.getValueForIndex(c--);if(!d||d===WMJSDateTooEarlyString||a.isAfter(moment.utc(d)))break;e.unshift({name:"time",value:d})}this.draw(e)}}};this.drawAutomatic=function(a,b){if(0!==r.length){a=a.format("YYYY-MM-DDTHH:mm:ss");for(var m=[],c=0;moment(a)<b&&1E3>c;){c++;for(var e=null,d=r.length-1;0<=d;d--){var ga=r[d].getDimension("time");
ga&&(ga=ga.getNextClosestValue(a))&&"date too early"!==ga&&(null===e||moment(ga)<moment(e))&&(e=ga)}if(null===e)break;m.push({name:"time",value:e});a=e}if(0<m.length)m.pop(),this.draw(m);else if(b=r[0].getDimension("time")){a=b.size();c=Math.min(b.size(),100);m=[];for(c=a-c;c<a;++c)m.push({name:b.name,value:b.getValueForIndex(c)});this.draw(m)}}};new WMJSDebouncer;this.display=function(){J[fa].display(D,ca);enableConsoleDebugging&&console.log("drawnBBOX.setBBOX(bbox)");S.setBBOX(t)};this.draw=function(a){l.isAnimating?
enableConsoleDebugging&&console.log("ANIMATING: Skipping draw:"+a):l._draw(a)};this._draw=function(a){enableConsoleDebugging&&console.log("draw:"+a);enableConsoleDebugging&&console.log("drawnBBOX.setBBOX(bbox)");S.setBBOX(t);a:if(!(4>B||4>A)){C.triggerEvent("beforedraw");if(!1===l.isAnimating&&void 0!==a&&"object"===typeof a&&0<a.length){if(a.length>maxAnimationSteps){alert("Too many animations given, max is "+maxAnimationSteps);l.draw("self");break a}l.isAnimating=!0;C.triggerEvent("onstartanimation",
l);l.currentAnimationStep=0;l.animationList=[];l.mouseHoverAnimationBox=!1;for(var b=0;b<a.length;b++){var m={name:a[b].name,value:a[b].value};l.setDimension(a[b].name,a[b].value,!1);m.requests=l.getWMSRequests();l.animationList.push(m)}l.setDimension(l.animationList[l.currentAnimationStep].name,l.animationList[l.currentAnimationStep].value,!1);fb.checkAnimation()}4>B||4>A?console.log("map too small, skipping"):l._pdraw()}};var tb=function(){debug("--\x3e onmapready event called");l.draw("onmapready callback")};
this.getWMSRequests=function(){var a=[],b=l.getNumLayers();for(j=0;j<b;j++)if(r[j].service&&r[j].enabled){var c=e(r[j]);c&&a.push(c)}return a};this.prefetch=function(a){var b=[];for(j=0;j<a.length;j++){var m=getMapImageStore.getImage(a[j]);0==m.isLoaded()&&0==m.isLoading()&&(b.push(m),m.load())}return b};this.getImageStore=function(){return getMapImageStore};this.isThisRequestLoaded=function(a){a=getMapImageStore.getImageForSrc(a);if(void 0==a)return 0;if(a.isLoaded())return 2;if(a.isLoading())return 1};
this.mouseHoverAnimationBox=!1;this._pdraw=function(){if(0!=Pa)if(ea)1==C.addToCallback("onmapready",tb)&&debug("Suspending on onmapready");else{enableConsoleDebugging&&console.log("loadLayers");var a,b=0;T=0;if(E)for(var c=0;c<E.length;c++)E[c].enabled&&!1===E[c].keepOnTop&&(!E[c].type||"twms"!==E[c].type)&&(T++,a=e(E[c]))&&(J[da].setSrc(b,a,l.getWidth(),l.getHeight(),{layer:E[c]}),J[da].setOpacity(b,E[c].opacity),b++);for(c=0;c<l.getNumLayers();c++)r[c].service&&r[c].enabled&&(a=e(r[c],r[c].dimensions))&&
(J[da].setSrc(b,a,l.getWidth(),l.getHeight(),{layer:r[c]}),J[da].setOpacity(b,r[c].opacity),r[c].image=J[da].layers[b],b++);if(E)for(c=0;c<E.length;c++)E[c].enabled&&1==E[c].keepOnTop&&(a=e(E[c]))&&(J[da].setSrc(b,a,l.getWidth(),l.getHeight(),{layer:E[c]}),J[da].setOpacity(b,E[c].opacity),b++);l.flipBuffers();C.triggerEvent("ondrawready",l);ha()}};var fb,na=function(a){if(0!=J.length){var b=t;isDefined(a)&&(b=a);D.copy(b);J[fa].setBBOX(D,ca);J[fa].mapbbox=D;l.showBoundingBox(u.bbox,D);C.triggerEvent("onupdatebbox",
D);l.repositionMapPin(a)}},gb=new WMJSTimer;l.flipBuffers=function(){enableConsoleDebugging&&console.log("flipBuffers");var a=fa,b=da;C.triggerEvent("onmapstartloading");ea=!0;gb.init(500,function(){Oa.show()});sa.setBBOX(t);J[b]&&J[b].load(function(){enableConsoleDebugging&&console.log("flipBuffers loadcomplete");try{J[a].srs=q,J[b].bbox=t.clone(),J[b].srs=q,enableConsoleDebugging&&console.log("loadedBBOX.setBBOX(bbox)"),ca.setBBOX(sa),enableConsoleDebugging&&console.log("-----------------------"),
J[b].display(D,ca),z.oldx=z.exactX,z.oldy=z.exactY,J[a].hide(),fa=b,da=a}catch(ma){console.log(ma)}ea=!1;C.triggerEvent("onmaploadingcomplete",l);C.triggerEvent("onloadingcomplete",l);C.triggerEvent("onmapready",l);Oa.hide();gb.stop()})};l.getBackBufferCanvasContext=function(){return J[da].getCanvasContext()};l.getFrontBufferCanvasContext=function(){return J[fa].getCanvasContext()};l.redrawBuffer=function(){J[fa].display();enableConsoleDebugging&&console.log("drawnBBOX.setBBOX(bbox)");S.setBBOX(t)};
this.addBaseLayers=function(a){if(a){T=0;a=toArray(a);E.push(a);for(j=0;j<E.length;j++)1==E.keepOnTop&&T++;C.triggerEvent("onlayeradd")}else E=void 0};this.setBaseLayers=function(a){if(a){T=0;E=a;for(j=0;j<E.length;j++)1==E.keepOnTop&&T++;C.triggerEvent("onlayerchange")}else E=void 0};this.getBaseLayers=function(){return E};this.getNumLayers=function(){return r.length};this.getBaseElement=function(){return p};var xa=0,ya,hb=new WMJSDebouncer,oa=0,za=new WMJSBBOX,ia=new WMJSBBOX,Aa=new WMJSBBOX,ib=
new WMJSBBOX,ja=0,pa=0,kb=function(){oa=ya/1;var a=1-oa;ia.left=za.left*a+Aa.left*oa;ia.bottom=za.bottom*a+Aa.bottom*oa;ia.right=za.right*a+Aa.right*oa;ia.top=za.top*a+Aa.top*oa;na(ia);ya+=1;1<ya?(ya=1,l.setBBOX(ia),l.display(),0===pa?(ja=pa=0,l.draw("flyZoomToBBOXTimerFunc")):(ja=pa=0,jb(D,ib))):hb.init(10,kb)},jb=function(a,b){1===ja?(ib.copy(b),pa=1):(za.copy(a),Aa.copy(b),ya=1,pa=0,0===ja&&(ja=1,kb()))},lb=new WMJSBBOX,Ba=new WMJSBBOX;this.mouseWheelEvent=function(a,b,c,e){a.stopPropagation();
preventdefault_event(a);if(1!=xa){xa=1;var m=D.right-D.left,d=D.bottom-D.top;a=l.getGeoCoordFromPixelCoord({x:G,y:H},S);e=(a.x-D.left)/m;c=(a.y-D.top)/d;if(0>b){m*=-.15;var g=-.15*d}else m*=.1,g=.1*d;b=D.left+m;d=D.top+g;m=D.right-m;g=D.bottom-g;e=e*(m-b)+b-a.x;a=c*(g-d)+d-a.y;b-=e;m-=e;d-=a;g-=a;lb.copy(D);Ba.left=b;Ba.bottom=g;Ba.right=m;Ba.top=d;xa=0;jb(lb,Ba)}};var N;this.pinchStart=function(a,c,e){b=e.pointers[0].clientX;f=e.pointers[0].clientY;d=e.pointers[1].clientX;k=e.pointers[1].clientY;
N=t.clone();W=0;xa=aa=1};this.pinchMove=function(a,c,e){W=0;pinchMove1={x:e.pointers[0].clientX,y:e.pointers[0].clientY};pinchMove2={x:e.pointers[1].clientX,y:e.pointers[1].clientY};a=pinchMove2.x-pinchMove1.x;c=d-b;e=pinchMove2.y-pinchMove1.y;var m=k-f;0==c&&(c=1);0==m&&(m=1);a*a>e*e?(a/=c,c=b-pinchMove1.x/a,t.right=((B-pinchMove1.x)/a+b)/B*(N.right-N.left)+N.left,t.left=c/B*(N.right-N.left)+N.left,a=(N.right-N.left)/(N.top-N.bottom),c=(t.top+t.bottom)/2,a=(t.left-t.right)/2/a,t.bottom=c+a,t.top=
c-a):(a=e/m,c=f-pinchMove1.y/a,t.bottom=((A-pinchMove1.y)/a+f)/A*(N.bottom-N.top)+N.top,t.top=c/A*(N.bottom-N.top)+N.top,a=(N.right-N.left)/(N.top-N.bottom),c=(t.right+t.left)/2,a*=(t.bottom-t.top)/2,t.left=c+a,t.right=c-a);na(t)};this.pinchEnd=function(a,b,c){xa=aa=W=0;l.zoomTo(t);l.draw("pinchEnd")};l.destroy=function(){l.stopAnimating();for(var a=r.length-1;0<=a;a--)r[a].setAutoUpdate(!1);console.log("Detaching...");p.off("mousedown");p.off("mousewheel");del_event(document,"mouseup",l.mouseUpEvent);
del_event(document,"mousemove",l.mouseMoveEvent)};var mb=function(a){return"TIME"==a.toUpperCase()||"ELEVATION"==a.toUpperCase()?a:"DIM_"+a},ta=function(a){for(var b="",c=0;c<a.dimensions.length;c++)if(b+="&"+mb(a.dimensions[c].name),b+="="+URLEncode(a.dimensions[c].currentValue),a.dimensions[c].currentValue==WMJSDateOutSideRange||a.dimensions[c].currentValue==WMJSDateTooEarlyString||a.dimensions[c].currentValue==WMJSDateTooLateString)throw WMJSDateOutSideRange;return b},G=0,H=0,K=-1E4,L=-1E4,Y=1E4,
Z=1E4,aa=0,W=0,O="pan";this.getMapMode=function(){return O};this.getWMSMetaDataRequestURL=function(a){var b=a.service,b=b+("&SERVICE=WMS&REQUEST=GetMetaData&VERSION="+a.version),b=b+("&LAYER="+URLEncode(a.name)),b=b+"&FORMAT=text/html";try{b+="&"+ta(a)}catch(ma){return}debug("<a target='_blank' href='"+b+"'>"+b+"</a>",!1);return b};var ka=0,Ya=[],Za=function(a,b){this.layer=a;this.data=b},ub=function(a,b,c,e,d){e=e+("&GRAPHSTYLE="+d)+("&"+l.getBBOXandProjString(a));e+="&LAYERS="+URLEncode(a.name);
e+="WIDTH="+B;e+="&HEIGHT="+A;e+="&X="+b;e+="&Y="+c;e+="&FORMAT=image/png";e+="&INFO_FORMAT=text/html";e+="&STYLES=";try{e+="&"+ta(a)}catch(Ia){return}debug("<a target='_blank' href='"+e+"'>"+e+"</a>",!1);return e};this.getWMSGetFeatureInfoRequestURL=function(a,b,c){var m=WMJScheckURL(a.service),m=m+("&SERVICE=WMS&REQUEST=GetFeatureInfo&VERSION="+a.version),m=m+("&LAYERS="+URLEncode(a.name)),e=a.name.split(","),m=m+("&QUERY_LAYERS="+URLEncode(e[e.length-1])),m=m+("&"+l.getBBOXandProjString(a)),m=
m+("WIDTH="+B),m=m+("&HEIGHT="+A);if(a.version==WMSVersion.version100||a.version==WMSVersion.version111)m=m+("&X="+b)+("&Y="+c);a.version==WMSVersion.version130&&(m=m+("&I="+b)+("&J="+c));m+="&FORMAT=image/gif&INFO_FORMAT=text/html&STYLES=";try{m+="&"+ta(a)}catch(Ia){return}debug("<a target='_blank' href='"+m+"'>"+m+"</a>",!1);return m};var Ja=function(a,b){ka--;a=b?1==b.queryable?new Za(b,a):new Za(b,"not queryable"):new Za(b,"Query failed...");Ya.push(a);0>=ka&&(ka=0,C.triggerEvent("ongetfeatureinfoready",
Ya))},vb=function(){debug("resuming on ongetpointinfoready");l.getPointInfo(K,L)},Ka=!1;this.getPointInfo=function(a,b){if(Ka)debug("suspending on ongetpointinfoready"),l.addListener("ongetpointinfoready",vb,!1);else{Ka=!0;C.triggerEvent("beforegetpointinfo");var c=l.getGraphingData();if(void 0==c)error("getPointInfo getGraphingData is undefined"),Ka=!1;else{debug("getPointInfo("+a+","+b+") "+c.layer.name);var m=ub(c.layer,a,b,c.service,c.style);debug("GetPointInfo: "+m);var e=new Image;e.loadEvent=
function(){Ka=!1;var a={};a.url=m;a.layer=c.layer;a.img=e;C.triggerEvent("ongetpointinfoready",a)};n(e);e.src=m}}};var wb=function(){debug("resuming on ongetfeatureinfoready");C.triggerEvent("beforegetfeatureinfo");l.getFeatureInfo(K,L)};this.getFeatureInfo=function(a,b){if(0<ka)debug("suspending on ongetfeatureinfoready"),l.addListener("ongetfeatureinfoready",wb,!1);else{debug("GetFeatureInfo:");Ya=[];for(var c=ka=0;c<r.length;c++){var m=r[r.length-c-1];m.getFeatureInfoUrl="";m.service&&m.enabled&&
1==m.queryable&&(m.getFeatureInfoUrl=l.getWMSGetFeatureInfoRequestURL(m,a,b),isDefined(m.getFeatureInfoUrl)?ka++:m.getFeatureInfoUrl="")}0==ka&&C.triggerEvent("ongetfeatureinfoready",["No layers to query"]);for(c=0;c<r.length;c++)if(a=r[r.length-c-1],""!=a.getFeatureInfoUrl)if(0==a.queryable)Ja("Layer is not queryable.",a);else try{MakeHTTPRequest(a.getFeatureInfoUrl,Ja,function(a,b){Ja(a,b);error(a)},a)}catch(la){Ja("Exception: "+la,a)}}};this.getGetFeatureInfoObjectAsHTML=function(a){var b="";try{for(var b=
b+'<div class="getfeatureinfo">',c=0;c<r.length;c++)for(var m=0;m<a.length;m++)a[m].layer==r[c]&&(b+='<div class="getfeatureinfolayer">',b+="<b><a target='_blank' href='"+a[m].layer.getFeatureInfoUrl+"'>"+a[m].layer.title+"</a></b><br/>",b+=a[m].data,b+="</div>");b+="</div>"}catch(la){b="No layers to query."}return b};this.getMapPinXY=function(){return[z.exactX,z.exactY]};this.positionMapPinByLatLon=function(a){debug("positionMapPinByLatLon at "+a.x+","+a.y);a=l.getPixelCoordFromLatLong(a);l.setMapPin(a.x,
a.y);l.showMapPin()};this.repositionMapPin=function(a){var b=t;isDefined(a)&&(b=a);a=l.getPixelCoordFromGeoCoord({x:z.geoPosX,y:z.geoPosY},b);l.setMapPin(a.x,a.y,b)};this.setMapPin=function(a,b,c){var m=a;"object"===typeof a&&(m=a.x,b=a.y);m&&b&&(z.x=parseInt(m),z.y=parseInt(b),z.exactX=parseFloat(m),z.exactY=parseFloat(b),a=l.getGeoCoordFromPixelCoord({x:z.exactX,y:z.exactY},c),z.geoPosX=a.x,z.geoPosY=a.y,z.style.left=z.x-5+"px",z.style.top=z.y-7+"px")};this.isMapPinVisible=function(){return"none"==
z.style.display?!1:!0};this.showMapPin=function(){z.innerHTML="<img src='"+mapPinImageSrc+"'>";z.style.display=""};this.hideMapPin=function(){z.style.display="none"};this.setMapModeGetInfo=function(){O="info";p.css("cursor","default")};this.setMapModeZoomBoxIn=function(a){O="zoom";p.css("cursor","default")};this.setMapModeZoomOut=function(a){O="zoomout";p.css("cursor","default")};this.setMapModePan=function(a){O="pan";p.css("cursor","default")};this.setMapModePoint=function(a,b){O="point";p.css("cursor",
"url(webmapjs/img/aero_pen.cur), default")};var Ca;this.setMapModeNone=function(a){O="none";p.css("cursor","default")};this.getMouseCoordinatesForDocument=function(b){if(isDefined(b.changedTouches))return{x:parseInt(b.changedTouches[0].screenX),y:parseInt(b.changedTouches[0].screenY)};var c=$(a).parent().offset(),m=b.pageX,e=b.pageY;void 0==m&&(m=getClick_X(b));void 0==e&&(e=getClick_Y(b));return{x:m-c.left,y:e-c.top}};this.getMouseCoordinatesForElement=function(b){if(isDefined(b.changedTouches))return{x:parseInt(b.changedTouches[0].screenX),
y:parseInt(b.changedTouches[0].screenY)};var c=$(a).parent().offset(),m=b.pageX,e=b.pageY;void 0==m&&(m=getClick_X(b));void 0==e&&(e=getClick_Y(b));return{x:m-c.left,y:e-c.top}};this.mouseDown=function(a,b,c){var m=!1;c&&1==c.shiftKey&&(m=!0);K=a;L=b;W=1;if(0===aa&&0===(0>L|0>K|K>B|L>A?-1:0))for(a=C.triggerEvent("beforemousedown",{mouseX:a,mouseY:b,mouseDown:!0,event:c}),b=0;b<a.length;b++)if(!1===a[b])return;m?(void 0==Ca&&(Ca=O),O="zoom"):void 0!=Ca&&(O=Ca,Ca=void 0);C.triggerEvent("mousedown",
{map:l,x:K,y:L});"info"==O?(debug("GetFeatureInfo"),l.setMapPin(K,L),l.showMapPin(),C.triggerEvent("beforegetfeatureinfo",{map:l,x:K,y:L}),l.getFeatureInfo(K,L)):"point"==O&&(l.setMapPin(K,L),l.showMapPin(),l.getPointInfo(K,L))};var nb=!1,R=!1,La,$a;this.updateMouseCursorCoordinates=function(a){$a=a;La=l.getGeoCoordFromPixelCoord(a);l.display("updateMouseCursorCoordinates")};this.mouseDownEvent=function(a){preventdefault_event(a);var b=l.getMouseCoordinatesForDocument(a);ra&&0>b.y||l.mouseDown(b.x,
b.y,a)};this.mouseMoveEvent=function(a){preventdefault_event(a);var b=l.getMouseCoordinatesForDocument(a);0===W&&0<=b.y&&0>b.y&&0<=b.x&&b.x<=B?!1===ra&&(ra=!0,ab=Na,Ea=!0,l.setCursor("pointer"),l.draw("mouseMoveEvent")):!0===ra&&(Ea=ra=!1,l.setCursor(ab),l.draw("mouseMoveEvent"));l.mouseMove(b.x,b.y,a)};this.mouseUpEvent=function(a){preventdefault_event(a);var b=l.getMouseCoordinatesForDocument(a);l.mouseUp(b.x,b.y,a)};this.mouseMove=function(b,c){G=b;H=c;if(0===aa)for(b=C.triggerEvent("beforemousemove",
{mouseX:G,mouseY:H,mouseDown:1===W?!0:!1}),c=0;c<b.length;c++)if(!1===b[c])return;if(1==u.displayed&&0==qa){b=l.getPixelCoordFromGeoCoord({x:u.bbox.left,y:u.bbox.top});c=l.getPixelCoordFromGeoCoord({x:u.bbox.right,y:u.bbox.bottom});var e=!1;0==W&&(!1===R&&(nb=p.css("cursor")),6>Math.abs(G-b.x)&&H>b.y&&H<c.y&&(e=!0,p.css("cursor","col-resize"),R="left"),6>Math.abs(H-b.y)&&G>b.x&&G<c.x&&(e=!0,p.css("cursor","row-resize"),R="top"),6>Math.abs(G-c.x)&&H>b.y&&H<c.y&&(e=!0,p.css("cursor","col-resize"),R=
"right"),6>Math.abs(H-c.y)&&G>b.x&&G<c.x&&(e=!0,p.css("cursor","row-resize"),R="bottom"),6>Math.abs(G-b.x)&&6>Math.abs(H-b.y)&&(e=!0,p.css("cursor","nw-resize"),R="topleft"),6>Math.abs(G-c.x)&&6>Math.abs(H-b.y)&&(e=!0,p.css("cursor","ne-resize"),R="topright"),6>Math.abs(G-b.x)&&6>Math.abs(H-c.y)&&(e=!0,p.css("cursor","sw-resize"),R="bottomleft"),6>Math.abs(G-c.x)&&6>Math.abs(H-c.y)&&(e=!0,p.css("cursor","se-resize"),R="bottomright"));if(1==e||!1!==R&&1==W){1==W&&("left"==R&&(b.x=G),"top"==R&&(b.y=
H),"right"==R&&(c.x=G),"bottom"==R&&(c.y=H),"topleft"==R&&(b.x=G,b.y=H),"topright"==R&&(c.x=G,b.y=H),"bottomleft"==R&&(b.x=G,c.y=H),"bottomright"==R&&(c.x=G,c.y=H),b=l.getGeoCoordFromPixelCoord(b),c=l.getGeoCoordFromPixelCoord(c),u.bbox.left=b.x,u.bbox.top=b.y,u.bbox.right=c.x,u.bbox.bottom=c.y,l.showBoundingBox(u.bbox),C.triggerEvent("bboxchanged",{map:l,bbox:u.bbox}));return}R=!1;p.css("cursor",nb)}if(-1==(0>H|0>G|G>B|H>A?-1:0)){try{C.triggerEvent("onmousemove",[void 0,void 0]),l.updateMouseCursorCoordinates(void 0)}catch(Ia){console.log(Ia)}Y=
G;Z=H;0!=qa&&(1==W&&"zoomout"==O&&l.zoomOut(),W=0,1==aa&&ob(Y,Z))}else{if(1==W&&!(3>Math.abs(K-G)&&3>Math.abs(L-H))){c=G;b=H;if(0==aa){if("pan"==O){ja&&l.setBBOX(ia);ja=pa=0;hb.stop();p.css("cursor","move");var e=parseInt(c),m=parseInt(b);z.oldx=z.exactX;z.oldy=z.exactY;for(var d=0;d<U.length;d++)U[d].origX=U[d].x,U[d].origY=U[d].y;qa=1;enableConsoleDebugging&&console.log("updateBBOX.setBBOX(drawnBBOX)");D.setBBOX(S);Da=l.getGeoCoordFromPixelCoord({x:e,y:m},t)}"zoom"==O&&(p.css("cursor","crosshair"),
Ma=1);aa=1}"pan"==O&&0!=qa&&(c=parseInt(c),b=parseInt(b),0>G||0>H||G>parseInt(a.clientWidth)||H>parseInt(a.clientHeight)?pb(c,b):(c=l.getGeoCoordFromPixelCoord({x:c,y:b},D),b=c.x-Da.x,c=c.y-Da.y,D.left-=b,D.bottom-=c,D.right-=b,D.top-=c,na(D)));"zoom"==O&&0!=Ma&&(c=G-K,b=H-L,0>c&&0>b?p.css("cursor","not-allowed"):p.css("cursor","crosshair"),h=b,F.style.display="",0>c?(c=-c,F.style.left=G+"px"):F.style.left=K+"px",0>h?(h=-h,F.style.top=H+"px"):F.style.top=L+"px",F.style.width=c+"px",F.style.height=
h+"px")}C.triggerEvent("onmousemove",[G,H]);l.updateMouseCursorCoordinates({x:G,y:H})}};this.mouseUp=function(a,b,c){Y=a;Z=b;if(0===aa&&0===(0>Z|0>Y|Y>B|Z>A?-1:0))for(a=C.triggerEvent("beforemouseup",{mouseX:a,mouseY:b,mouseDown:!1,event:c}),b=0;b<a.length;b++)if(!1===a[b]){W=0;return}if(1==W){"zoomout"==O&&l.zoomOut();if(0==aa&&3>Math.abs(K-Y)&&3>Math.abs(L-Z))if(isDefined(c)&&C.triggerEvent("mouseclicked",{map:l,x:Y,y:Z,shiftKeyPressed:1==c.shiftKey}),1==db){if(0==U.length){var e=WMJSDialog.createDialog({show:showDialog,
x:Y,y:Z,autoDestroy:!1},p,l);U.push(e)}else e=U[0];0==e.hasBeenDragged&&(1==e.moveToMouseCursor?e.setXY(Y,Z):e.setXY(5,45));e.on("hide",function(a,b){e.hasBeenDragged=!1});e.setLoading();e.show();l.addListener("ongetfeatureinfoready",function(a){e.setHTML(l.getGetFeatureInfoObjectAsHTML(a))},!0);l.setMapPin(K,L);l.showMapPin();C.triggerEvent("beforegetfeatureinfo");l.getFeatureInfo(K,L)}else l.setMapPin(K,L),l.showMapPin();C.triggerEvent("mouseup",{map:l,x:Y,y:Z})}W=0;1==aa&&ob(Y,Z)};var ob=function(a,
b){if(0!=aa){aa=0;"pan"==O&&pb(a,b);if("zoom"==O){b=Y-K;var c=Z-L;p.css("cursor","default");0!=Ma&&(Ma=0,F.style.display="none",0>b&&0>c||(a=new WMJSBBOX,0>b?(a.left=K+b,a.right=K):(a.left=K,a.right=K+b),0>c?(a.top=L+c,a.bottom=L):(a.top=L,a.bottom=L+c),b=l.pixelCoordinatesToXY({x:a.left,y:a.bottom}),c=l.pixelCoordinatesToXY({x:a.right,y:a.top}),a.left=b.x,a.bottom=b.y,a.right=c.x,a.top=c.y,l.zoomTo(a),l.draw("mapZoomEnd")))}C.triggerEvent("mapdragend",{map:l,x:Y,y:Z})}},qa=0,Da,pb=function(a,b){p.css("cursor",
"default");a=parseInt(a);b=parseInt(b);0!=qa&&(qa=0,a=l.getGeoCoordFromPixelCoord({x:a,y:b},S),b=a.x-Da.x,a=a.y-Da.y,D.left=S.left-b,D.bottom=S.bottom-a,D.right=S.right-b,D.top=S.top-a,na(D),l.zoomTo(D),l.draw("mapPanEnd"))},Ma=0;this.setCursor=function(a){Na=a?a:"default";p.css("cursor",Na)};this.zoomTo=function(a){enableConsoleDebugging&&console.log("zoomTo");var b=!1;a=new WMJSBBOX(a);try{var c=(v.left-v.right)/(v.bottom-v.top)}catch(Fa){b=!0}isNaN(c)&&(b=!0);1==b&&(error("Invalid bbox: setting ratio to 1"),
c=1);0>c&&(c=-c);c>B/A?(b=(a.top+a.bottom)/2,c=(a.left-a.right)/2/c,a.bottom=b+c,a.top=b-c):(b=(a.right+a.left)/2,c*=(a.bottom-a.top)/2,a.left=b+c,a.right=b-c);l.setBBOX(a);na(t);S.setBBOX(t);l.getPixelCoordFromGeoCoord({x:z.geoPosX,y:z.geoPosY});for(a=0;a<U.length;a++)l.getPixelCoordFromGeoCoord({x:U[a].geoPosX,y:U[a].geoPosY}),0==U[a].hasBeenDragged&&1==U[a].moveToMouseCursor&&U[a].setXY(U[a].origX+x,U[a].origY+y)};this.pixelCoordinatesToXY=function(a){return l.getGeoCoordFromPixelCoord(a)};this.getGeoCoordFromPixelCoord=
function(a,b){var c=t;b&&(c=b);if(isDefined(a)){try{var e=a.x/B*(c.right-c.left)+c.left;var d=a.y/A*(c.bottom-c.top)+c.top}catch(Ia){return}return{x:e,y:d}}};this.proj4={};this.proj4.srs="empty";this.proj4.projection=void 0;var qb=new Proj4js.Proj("EPSG:4326");this.getPixelCoordFromLatLong=function(a){var b=new Proj4js.Point;try{b.x=parseFloat(a.x),b.y=parseFloat(a.y),l.proj4.srs==q&&isDefined(this.proj4.projection)||(l.proj4.projection=new Proj4js.Proj(q),l.proj4.srs=q),Proj4js.transform(qb,l.proj4.projection,
b)}catch(ma){alert(debug("error in getPixelCoordFromLatLong "+ma));return}return l.getPixelCoordFromGeoCoord(b)};this.WCJSSearchRequest=function(a){console.log(a);a.trim().match(/^(-?(?:[1-8]?\d(?:\.\d+)?|90(?:\.0+)?),-?(?:180(?:\.0+)?|(?:(?:1[0-7]\d)|(?:[1-9]?\d))(?:\.\d+)?))$/)?(splitted=a.split(","),lat=splitted[0],lng=splitted[1],l.calculateBoundingBoxAndZoom(lat,lng)):"undefined"===typeof geoNamesURL&&"undefined"===typeof knmiGeoNamesURL?error(I18n.no_urls_in_config.text):a.trim()?(searchDef=
a.trim().match(/^[a-zA-Z0-9 ]*$/))?"undefined"!==typeof knmiGeoNamesURL?(a=knmiGeoNamesURL.replace("{searchTerm}",searchDef),debug(I18n.debug_searching_location.text),debug("<a target='_blank' href='"+a+"'>"+a+"</a>",!1),$.ajax({dataType:"jsonp",contentType:"application/jsonp",jsonpCallback:"resultGeo",crossDomain:!0,type:"GET",url:a,success:function(a){if(0===$(a).length){var b=geoNamesURL.replace("{searchTerm}",searchDef).replace("{username}",defaultUsernameSearch);console.log("urlApiGeonames",
b);l.WCJSSearchRequestGeoNames(b)}else b=parseFloat($(a)[0].lat),a=parseFloat($(a)[0].lon),l.calculateBoundingBoxAndZoom(b,a)},error:function(a,b,c){error(I18n.geonames_api_call_failed.text)}})):(a=geoNamesURL.replace("{searchTerm}",searchDef).replace("{username}",defaultUsernameSearch),console.log("urlApiGeonames",a),l.WCJSSearchRequestGeoNames(a)):(debug(I18n.only_alpha_num_allowed.text),$("#searchtextfield").attr("value","")):(debug(I18n.no_search_definition.text),$("#searchtextfield").attr("value",
""))};this.WCJSSearchRequestGeoNames=function(a){debug(I18n.debug_searching_sqlite_location.text);debug("<a target='_blank' href='"+a+"'>"+a+"</a>",!1);$.ajax({dataType:"xml",type:"GET",url:a,success:function(a){if("0"===$(a).find("totalResultsCount").text())error(I18n.no_results_search.text);else{var b=parseFloat($(a).find("geoname").find("lat").text());a=parseFloat($(a).find("geoname").find("lng").text());l.calculateBoundingBoxAndZoom(b,a)}},error:function(a,b,c){error(I18n.geonames_sqlite_call_failed.text)}})};
this.calculateBoundingBoxAndZoom=function(a,b){var c=5E5;if("EPSG:4326"===l.proj4.projection.srsCode||"EPSG:50001"===l.proj4.projection.srsCode)c=5;var e=l.getPixelCoordFromLatLong({x:b,y:a}),e=l.getGeoCoordFromPixelCoord(e),d=new WMJSBBOX;d.left=e.x-c;d.bottom=e.y-c;d.right=e.x+c;d.top=e.y+c;l.zoomTo(d);l.positionMapPinByLatLon({x:b,y:a});l.draw("zoomIn")};this.getLatLongFromPixelCoord=function(a){var b=new Proj4js.Point;try{b.x=a.x/B*(t.right-t.left)+t.left,b.y=a.y/A*(t.bottom-t.top)+t.top,this.proj4.srs!=
q&&(this.proj4.projection=new Proj4js.Proj(q),this.proj4.srs=q),Proj4js.transform(this.proj4.projection,qb,b)}catch(ma){return}return{x:b.x,y:b.y}};this.getPixelCoordFromGeoCoord=function(a,b,c,e){var d=B,g=A,f=D;isDefined(c)&&(d=c);isDefined(e)&&(g=e);isDefined(b)&&(f=b);b=g*(a.y-f.top)/(f.bottom-f.top);return{x:parseFloat(d*(a.x-f.left)/(f.right-f.left)),y:parseFloat(b)}};this.addListener=function(a,b,c){return C.addToCallback(a,b,c)};this.removeListener=function(a,b){return C.removeEvents(a,b)};
this.getListener=function(a){return C};this.suspendEvent=function(a){C.suspendEvent(a)};this.resumeEvent=function(a){C.resumeEvent(a)};this.getDimensionList=function(){return I};this.getDimension=function(a){for(var b=0;b<I.length;b++)if(I[b].name==a)return I[b]};this.setDimension=function(a,b,c){if(isDefined(a)&&isDefined(b)){for(var e,d=0;d<I.length;d++)if(I[d].name==a){e=I[d];break}0==isDefined(e)&&(e={name:a,currentValue:b},I.push(e));if(isDefined(e)){if(isDefined(void 0)&&(void 0).setValue(a,
b),e.currentValue!=b){e.currentValue=b;if(1==l.buildLayerDimsBusy)alert("b");else for(b=0;b<I.length;b++)for(e=I[b],d=0;d<r.length;d++)for(var g=0;g<r[d].dimensions.length;g++){var f=r[d].dimensions[g];if(1==f.linked&&f.name==e.name){if("current"==e.currentValue||"default"==e.currentValue||""==e.currentValue||"earliest"==e.currentValue||"middle"==e.currentValue||"latest"==e.currentValue)e.currentValue=f.getClosestValue(e.currentValue);l.buildLayerDimsBusy=!0;f.setClosestValue(e.currentValue);l.buildLayerDimsBusy=
!1}}!1!==c&&(c=!0);!0===c&&C.triggerEvent("ondimchange",a)}}else error("WebMapJS::setDimension: Dimension "+a+" not found")}else error("Unable to set dimension with undefined value or name")};this.setLayerOpacity=function(a,b){if(a){a.opacity=b;var c=T;for(j=0;j<l.getNumLayers();j++)if(r[j].service&&r[j].enabled){if(a==r[j]){l.setBufferImageOpacity(da,c,b);break}c++}}};this.zoomToLayer=function(a){var b=a;b||(b=Ga);if(b){for(var c=0;c<b.projectionProperties.length;c++)if(b.projectionProperties[c].srs==
q){a=b.projectionProperties[c].bbox.right-b.projectionProperties[c].bbox.left;var e=b.projectionProperties[c].bbox.top-b.projectionProperties[c].bbox.bottom,b=b.projectionProperties[c].bbox.clone();b.left-=a/100;b.right+=a/100;b.bottom-=e/100;b.top+=e/100;l.zoomTo(b);l.draw("zoomTolayer");return}error("Unable to find the correct bbox with current map projection "+q+" for layer "+b.title+". Using default bbox instead.")}l.zoomTo(M);l.draw("zoomTolayer")};this.setPreviousExtent=function(){Qa=1;V++;
V>=ua&&(V=ua-1);l.setProjection(X[V].srs,X[V].bbox);l.draw("setPreviousExtent")};this.setNextExtent=function(){Ra=1;V--;0>V&&(V=0);l.setProjection(X[V].srs,X[V].bbox);l.draw("setNextExtent")};this.setBBOX=function(a,b,c,e){enableConsoleDebugging&&console.log("setBBOX");t.setBBOX(a,b,c,e);v.setBBOX(t);if("GFI:TIME_ELEVATION"!==q){var d=B/A;if((t.right-t.left)/(t.top-t.bottom)>d){var g=(t.top+t.bottom)/2,d=(t.left-t.right)/2/d;t.bottom=g+d;t.top=g-d}else g=(t.right+t.left)/2,d*=(t.bottom-t.top)/2,t.left=
g+d,t.right=g-d}D.setBBOX(t);S.setBBOX(t);if(0==Ra&&0==Qa){if(0!=V){for(j=0;j<=V;j++)Sa[j]=X[j];for(j=0;j<=V;j++)X[j]=Sa[V-j];V=0}for(j=2;0<j;j--)X[j].bbox.setBBOX(X[j-1].bbox),X[j].srs=X[j-1].srs;X[0].bbox.setBBOX(t);X[0].srs=q;ua++;3<ua&&(ua=3)}Qa=Ra=0;if(!0===t.equals(a,b,c,e))return!1;C.triggerEvent("aftersetbbox",l);return!0};this.zoomOut=function(){var a=(v.right-v.left)/6;this.zoomTo(new WMJSBBOX(v.left-a,v.bottom-a,v.right+a,v.top+a));l.draw("zoomOut")};this.zoomIn=function(a){var b=(v.left-
v.right)/8;if(0==isDefined(a))a=1;else if(0==a)return;b*=a;this.zoomTo(new WMJSBBOX(v.left-b,v.bottom-b,v.right+b,v.top+b));l.draw("zoomIn")};this.searchForLocation=function(a){l.WCJSSearchRequest(a)};this.displayLegendInMap=function(a){P=a;l.repositionLegendGraphic()};this.showBoundingBox=function(a,b){isDefined(a)&&(u.bbox=a,u.style.display="",u.displayed=!0);!0===u.displayed&&(a=t,isDefined(b)&&(a=b),b=this.getPixelCoordFromGeoCoord({x:u.bbox.left,y:u.bbox.top},a),a=this.getPixelCoordFromGeoCoord({x:u.bbox.right,
y:u.bbox.bottom},a),u.style.left=b.x-1+"px",u.style.top=b.y-2+"px",u.style.width=a.x-b.x+"px",u.style.height=a.y-b.y-1+"px")};this.hideBoundingBox=function(){u.style.display="none";u.displayed=!1};this.setDebugFunction=function(a){debug=a};this.setErrorFunction=function(a){error=a};(function(){try{tileRenderSettings=WMJSTileRendererTileSettings}catch(Fa){}a.style.height||(a.style.height="1px");a.style.width||(a.style.width="1px");var b=Ta("baseDiv");jQuery("<div/>",{id:b,css:{position:"relative",
overflow:"hidden",width:a.clientWidth,height:a.clientHeight,border:"0px  solid black",margin:0,padding:0,clear:"both",left:"0px",top:"0px"}}).appendTo(a);p=$("#"+b);p.css("cursor","default");a.style.margin="0px";a.style.padding="0px";a.style.border="none";a.style.lineHeight="0px";a.style.display="inline-block";F.style.position="absolute";F.style.display="none";F.style.border="2px dashed #000000";F.style.margin="0px";F.style.padding="0px";F.style.lineHeight="0";F.style.background="#AFFFFF";F.style.opacity=
"0.3";F.style.filter="alpha(opacity=30)";F.style.left="0px";F.style.top="0px";F.style.width="100px";F.style.height="100px";F.style.zIndex=1E3;F.oncontextmenu=function(){return!1};p.append(F);u.style.position="absolute";u.style.display="none";u.style.border="3px solid #6060FF";u.style.margin="0px";u.style.padding="0px";u.style.lineHeight="0";u.style.left="0px";u.style.top="0px";u.style.width="100px";u.style.height="100px";u.style.zIndex=1E3;u.oncontextmenu=function(){return!1};p.append(u);z.style.position=
"absolute";z.style.display="none";z.style.border="none";z.style.margin="0px";z.style.padding="0px";z.style.lineHeight="0";z.style.background="none";z.style.opacity="1.0";z.style.filter="alpha(opacity=100)";z.style.left="0px";z.style.top="0px";z.style.width="100px";z.style.height="100px";z.style.zIndex=1E3;z.oncontextmenu=function(){return!1};z.innerHTML="<img src='"+mapPinImageSrc+"'>";z.style.display="";p.append(z);ba.style.position="absolute";ba.style.zIndex=1E3;ba.style.width="auto";ba.style.height=
"auto";ba.style.background="none";ba.oncontextmenu=function(){return!1};ba.innerHTML="";p.append(ba);p.append(Oa);"undefined"!==typeof defaultUsernameSearch&&(jQuery("<div/>",{id:Ta("searchboxdiv"),mousedown:function(a){a.stopPropagation()}}).addClass("webmapjs_searchboxdiv").html("<input class='webmapjs_locationfield' type='text' name='searchtextfield' id='searchtextfield' placeholder="+I18n.place_search_term.text+" />",{mousedown:function(a){a.stopPropagation();preventdefault_event(a)}}).appendTo(p),
jQuery("<button/>",{id:Ta("searchboxbutton"),mousedown:function(a){a.stopPropagation()},click:function(){var a=$("#searchtextfield").val();l.searchForLocation(a)}}).addClass("webmapjs_locationbutton").appendTo(p),$("#searchtextfield").keypress(function(a){if(13==a.which)return a=$("#searchtextfield").val(),l.searchForLocation(a),!1}));w();t.left=-180;t.bottom=-90;t.right=180;t.top=90;q="EPSG:4326";l.setSize(a.clientWidth,a.clientHeight);for(b=0;2>b;b++){var c=new WMJSCanvasBuffer(C,"imagebuffer",
getMapImageStore,l.getWidth(),l.getHeight());getMapImageStore.addLoadEventCallback(c.imageLoadComplete);p.append(c.getBuffer());J.push(c)}for(b=0;2>b;b++)c=new WMJSCanvasBuffer(C,"legendbuffer",legendImageStore,l.getWidth(),l.getHeight()),legendImageStore.addLoadEventCallback(c.imageLoadComplete),p.append(c.getBuffer()),Q.push(c);C.addToCallback("display",l.display,!0);C.addToCallback("draw",function(){console.log("draw event triggered externally, skipping")},!0);fb=new WMJSAnimate(l);bgMapImageStore.addLoadEventCallback(function(a){l.draw("bgMapImageStore loaded")});
l.addListener("beforecanvasstartdraw",function(a){if(E)for(var b=0;b<E.length;b++)!E[b].enabled||!1!==E[b].keepOnTop||E[b].type&&"twms"!==E[b].type||WMJSTileRenderer(t,D,q,B,A,a,bgMapImageStore,tileRenderSettings,E[b].name)},!0);var e=function(a,b,c,e,d){a.textBaseline="top";a.fillStyle="#FFF";a.globalAlpha=.75;var g=a.measureText(b).width;a.fillRect(c-8,e-8,g+16,parseInt(d)+14);a.fillStyle="#444";a.globalAlpha=1;a.fillText(b,c,e+2)};l.addListener("beforecanvasdisplay",function(a){cb&&(a.beginPath(),
a.rect(0,0,B,0),!1===bb?(a.globalAlpha=Ea?.9:.4,a.fillStyle=Ea?"#017daf":"#EEE"):(a.globalAlpha=1,a.fillStyle="#017daf"),a.fill(),a.globalAlpha=1);for(i=0;i<r.length;i++)for(var b="",c=0;c<r[i].dimensions.length;c++)b+="&"+mb(r[i].dimensions[c].name),b+="="+URLEncode(r[i].dimensions[c].currentValue),r[i].dimensions[c].currentValue==WMJSDateOutSideRange?l.canvasErrors.push({linkedInfo:{layer:r[i],message:"Time outside range"}}):r[i].dimensions[c].currentValue==WMJSDateTooEarlyString?l.canvasErrors.push({linkedInfo:{layer:r[i],
message:"Time too early"}}):r[i].dimensions[c].currentValue==WMJSDateTooLateString&&l.canvasErrors.push({linkedInfo:{layer:r[i],message:"Time too late"}});if(l.canvasErrors&&0<l.canvasErrors.length){var c=B/2,d=6+15*l.canvasErrors.length,b=B-c;a.beginPath();a.rect(b,0,b+c,0+d);a.fillStyle="white";a.globalAlpha=.9;a.fill();a.globalAlpha=1;a.fillStyle="black";a.font="10pt Helvetica";for(c=0;c<l.canvasErrors.length;c++)l.canvasErrors[c].linkedInfo?a.fillText("Layer with title "+l.canvasErrors[c].linkedInfo.layer.title+
" failed to load"+(l.canvasErrors[c].linkedInfo.message?", "+l.canvasErrors[c].linkedInfo.message:""),b+5,11+15*c):a.fillText("Layer failed to load.",b+5,11+15*c);l.canvasErrors=[]}""!==Ua&&(a.font="20px Helvetica",e(a,Ua,B/2-70,A-26,20));""!==Va&&(a.font="15px Helvetica",e(a,Va,B/2-70,2,15));if(!0===Xa&&(b=function(){var a=1E-7,b=B/(D.right-D.left);if(!(0>=b)){var c=25/b;do{a*=10;var e=c/a;if(0===e)return;e=25/e}while(25>e);do{a/=2;e=c/a;if(0===e)return;e=25/e}while(25<e);do{a*=1.2;e=c/a;if(0===
e)return;e=25/e}while(25>e);c=Math.pow(10,Math.round(Math.log10(a)+.5)-1);a=Math.round(a/c);2.5>a&&(a=2.5);2.5<a&&7.5>a&&(a=5);7.5<a&&(a=10);a*=c;return{width:parseInt(25/(25/b/a)),mapunits:a}}}())){c=A-25.5;a.beginPath();a.lineWidth=2.5;a.fillStyle="#000";a.strokeStyle="#000";a.font="9px Helvetica";a.textBaseline="middle";for(d=0;2>d;d++)a.moveTo(7.5,21-d+c),a.lineTo(2*b.width+8.5,21-d+c);d=parseInt(Math.round(b.width/5));a.lineWidth=.5;for(var g=1;5>g;g++)a.moveTo(7.5+d*g,21+c),a.lineTo(7.5+d*g,
16+c);a.lineWidth=1;a.moveTo(7.5,21+c);a.lineTo(7.5,14+c);a.moveTo(7.5+b.width,21+c);a.lineTo(7.5+b.width,14+c);a.moveTo(2*b.width+8.5,21+c);a.lineTo(2*b.width+8.5,14+c);d="";"EPSG:3411"===q&&(d="meter");"EPSG:3412"===q&&(d="meter");"EPSG:3575"===q&&(d="meter");"EPSG:4326"===q&&(d="degrees");"EPSG:28992"===q&&(d="meter");"EPSG:32661"===q&&(d="meter");"EPSG:3857"===q&&(d="meter");"EPSG:900913"===q&&(d="meter");"EPSG:102100"===q&&(d="meter");"meter"===d&&1E3<b.mapunits&&(b.mapunits/=1E3,d="km");a.fillText("0",
4.5,12+c);g=b.mapunits.toPrecision()+"";a.fillText(g,7.5+b.width-2.5*g.length+0,12+c);g=(2*b.mapunits).toPrecision()+"";a.fillText(g,7.5+2*b.width-2.5*g.length+0,12+c);a.fillText(d,2*b.width+17.5,18+c);a.stroke()}a.font="10px Helvetica";a.textBaseline="middle";isDefined(La)&&(c=1/Math.pow(10,parseInt(Math.log((t.right-t.left)/B)/Math.log(10))-2),1>c&&(c=1),a.fillStyle="#000000",b=Math.round(La.x*c)/c,c=Math.round(La.y*c)/c,d="","EPSG:3857"===q&&(d="meter"),a.fillText("CoordYX: ("+c+", "+b+") "+d,
5,A-50));isDefined($a)&&(b=l.getLatLongFromPixelCoord($a),isDefined(b)&&(a.fillStyle="#000000",c=Math.round(100*b.x)/100,a.fillText("Lat/Lon: ("+(Math.round(100*b.y)/100).toFixed(2)+", "+c.toFixed(2)+")  degrees",5,A-38)));a.fillStyle="#000000";a.fillText("Map projection: "+q,5,A-26);a.font="7px Helvetica";a.fillText("ADAGUC webmapjs "+WebMapJSMapVersion,B-85,A-5)},!0);l.addListener("canvasonerror",function(a){l.canvasErrors=a},!0);Pa=1})();na(t)};WMJSEmptyLayerName="empty_layer";WMJSEmptyLayerTitle="empty layer";
function WMJSLayer(a){this.autoupdate=!1;this.getlegendgraphicURL=this.getfeatureinfoURL=this.getmapURL=this.WMJSService=this.service=this.timer=void 0;this.keepOnTop=!1;this.transparent=!0;this.hasError=!1;this.legendIsDimensionDependant=!0;this.wms130bboxcompatibilitymode=!1;this.version=WMSVersion.version111;this.path="";this.type="wms";this.objectpath=[];this.wmsextensions=function(a){this.wmsextensions.colorscalerange="";isDefined(a.colorscalerange)&&(this.wmsextensions.colorscalerange=a.colorscalerange);
this.wmsextensions.url="";2<this.wmsextensions.colorscalerange.length&&(this.wmsextensions.url+="&COLORSCALERANGE="+this.wmsextensions.colorscalerange)};this.wmsextensions.url="";this.name=this.jsonlayer_v1_1_1=void 0;this.title=WMJSEmptyLayerTitle;this.abstract=void 0;this.dimensions=[];this.legendGraphic="";this.projectionProperties=[];this.queryable=!1;this.enabled=!0;this.styles=void 0;this.currentStyle="";this.id=-1;this.opacity=1;this.getCapabilitiesDoc=this.image=void 0;this.serviceTitle="not defined";
this.onReady=function(a){};this.parentMaps=[];this.getLayerName=function(){return this.name};this.toggleAutoUpdate=function(){(this.autoupdate=!this.autoupdate)?this.timer=setInterval(function(a){return function(){a.parseLayer(void 0,!0,"WMJSLayer::autoupdate")}}(this),6E4):clearInterval(this.timer)};this.setAutoUpdate=function(a,d,k){a!==this.autoupdate&&((this.autoupdate=a)?this.timer=setInterval(function(a){return function(){a.parseLayer(k,!0,"WMJSLayer::autoupdate")}}(this),d):clearInterval(this.timer))};
this.setOpacity=function(a){this.opacity=a;this.image&&(this.image.setOpacity(this.opacity),this.parentMaps[0].redrawBuffer())};this.remove=function(){for(var a=0;a<this.parentMaps.length;a++)this.parentMaps[a].deleteLayer(this),this.parentMaps[a].draw("WMJSLayer::remove");clearInterval(this.timer)};this.moveUp=function(){for(var a=0;a<this.parentMaps.length;a++)this.parentMaps[a].moveLayerUp(this),this.parentMaps[a].draw("WMJSLayer::moveUp")};this.moveDown=function(){for(var a=0;a<this.parentMaps.length;a++)this.parentMaps[a].moveLayerDown(this),
this.parentMaps[a].draw("WMJSLayer::moveDown")};this.zoomToLayer=function(){for(var a=0;a<this.parentMaps.length;a++)this.parentMaps[a].zoomToLayer(this)};this.draw=function(a){for(var c=0;c<this.parentMaps.length;c++)this.parentMaps[c].draw("WMJSLayer::draw::"+a)};this.setDimension=function(a,d){for(var c,b=0;b<this.dimensions.length;b++)this.dimensions[b].name==a&&(c=this.dimensions[b]);if(0!=isDefined(c)&&0!=isDefined(d)&&(c.setValue(d),1==c.linked))for(b=0;b<this.parentMaps.length;b++)this.parentMaps[b].setDimension(a,
c.getValue())};this.configureDimensions=function(){var a=this.jsonlayer_v1_1_1;if(a){for(var d=toArray(a.Dimension),k=this.objectpath.length-1;0<=k;k--){var b=this.objectpath[k].Dimension;if(!isNull(b)&&isDefined(b))for(var f=0;f<b.length;f++){var n=b[f];if(!isNull(n)&&isDefined(n)){for(var g=!1,e=0;e<d.length;e++)if(n.attr.name.toLowerCase()===d[k].attr.name.toLowerCase()){g=!0;break}g||d.push(n)}}}a=toArray(a.Extent);this.dimensions=[];for(k=0;k<d.length;k++){b=new WMJSDimension;b.name=d[k].attr.name.toLowerCase();
b.units=d[k].attr.units;for(e=0;e<a.length;e++)a[e].attr.name.toLowerCase()==b.name&&(b.values=a[e].value?a[e].value.trim():"",a[e].attr["default"]?b.defaultValue=a[e].attr["default"].trim():(f=b.values.split("/"),1<f.length?b.defaultValue=f[1]:0<f.length&&(b.defaultValue=f[0])),a[e].value||(error("No extent defined for dim "+b.name+" in layer "+this.title),error("Using default value "+b.defaultValue),b.values=b.defaultValue));this.version==WMSVersion.version130&&(b.values=d[k].value,b.defaultValue=
d[k].attr["default"]);e=b.defaultValue;0<this.parentMaps.length?(f=this.parentMaps[0].getDimension(b.name),isDefined(f)&&(isDefined(f.currentValue)?(e=b.getClosestValue(f.currentValue),debug("WMJSLayer::configureDimensions Dimension "+b.name+" default value ["+e+"] is based on map value ["+f.currentValue+"]")):debug("WMJSLayer::configureDimensions Map dimension currentValue for "+b.name+" does not exist."))):debug("WMJSLayer::configureDimensions Layer has no parentmaps");b.currentValue=e;b.parentLayer=
this;isDefined(b.values)?this.dimensions.push(b):error("Skipping dimension "+b.name)}}};this.parseLayer=function(c,d,k){var b=this;b.hasError=!1;var f=function(a){isDefined(c)&&c(a)},n=function(c,e){b.hasError=!0;b.lastError=e;b.title=I18n.service_has_error.text;error(e);f(c);isDefined(a.failure)&&a.failure(c,e)};b.WMJSService=WMJSgetServiceFromStore(this.service);b.WMJSService.getCapabilities(function(a){(function(a,b){function c(b,d,e){for(var g=[],f=0;f<e.length;f++)g.push(e[f]);g.push(b);for(e=
0;e<b.length;e++)if(b[e].Layer){f=d;try{f+=b[e].Title.value+"/"}catch(F){}c(toArray(b[e].Layer),f,g)}else if(b[e].Name&&b[e].Name.value==a.name){r(b[e],d,g);break}}if(0==b||void 0==b)a.title=I18n.service_has_error.text,a.abstract=I18n.not_available_message.text,n(a,I18n.unable_to_connect_server.text);else{try{var d=a.WMJSService.getCapabilityElement(b)}catch(I){n(a,I);return}a.version=a.WMJSService.version;var e=d.Layer;if(isDefined(e)){try{a.serviceTitle=e.Title.value}catch(I){a.serviceTitle="Unnamed service"}try{for(var g=
d.Request.GetMap.Format,k=0;k<g.length;k++)g[k].value.indexOf("24"),g[k].value.indexOf("32")}catch(I){error("This WMS service has no getmap formats listed: using image/png")}if(void 0==a.name||1>a.name.length)a.title=WMJSEmptyLayerTitle,a.abstract=I18n.not_available_message.text,f(a);else{var w=0,r=function(c,g,f){a.jsonlayer_v1_1_1=c;a.getmapURL=void 0;try{a.getmapURL=d.Request.GetMap.DCPType.HTTP.Get.OnlineResource.attr["xlink:href"]}catch(u){}isDefined(a.getmapURL)||(a.getmapURL=a.service,error("GetMap OnlineResource is not specified. Using default."));
a.getfeatureinfoURL=void 0;try{a.getfeatureinfoURL=d.Request.GetFeatureInfo.DCPType.HTTP.Get.OnlineResource.attr["xlink:href"]}catch(u){}isDefined(a.getfeatureinfoURL)||(a.getfeatureinfoURL=a.service,error("GetFeatureInfo OnlineResource is not specified. Using default."));a.getlegendgraphicURL=void 0;try{a.getlegendgraphicURL=d.Request.GetLegendGraphic.DCPType.HTTP.Get.OnlineResource.attr["xlink:href"]}catch(u){}isDefined(a.getlegendgraphicURL)||(a.getlegendgraphicURL=a.service,error("GetLegendGraphic OnlineResource is not specified. Using default."));
a.getmapURL=WMJScheckURL(a.getmapURL);a.getfeatureinfoURL=WMJScheckURL(a.getfeatureinfoURL);a.getlegendgraphicURL=WMJScheckURL(a.getlegendgraphicURL);a.getCapabilitiesDoc=b;a.title=c.Title.value;try{a.abstract=c.Abstract.value}catch(u){a.abstract=I18n.not_available_message.text}a.path=g;a.objectpath=f;a.styles=void 0;a.jsonlayer=a;try{g="";c.Style&&(g=toArray(c.Style));a.styles=g;for(var l=0;l<a.styles.length;l++){var k=a.styles[l];k.index=l;k.nrOfStyles=a.styles.length;k.title="default";k.name="default";
k.legendURL="";k.abstracttext="No abstract available";try{k.title=k.Title.value}catch(u){}try{k.name=k.Name.value}catch(u){}try{k.legendURL=k.LegendURL.OnlineResource.attr["xlink:href"]}catch(u){}try{k.abstracttext=k.Abstract.value}catch(u){}}""==a.currentStyle&&(a.currentStyle=a.styles[0].Name.value);a.setStyle(a.currentStyle)}catch(u){a.currentStyle="",a.styles="",error("No styles found for layer "+a.title)}a.configureDimensions();k=toArray(c.SRS);isDefined(c.CRS)&&(k=toArray(c.CRS));a.projectionProperties=
[];var n=[];g=function(b){if(isDefined(b.BoundingBox))for(b=toArray(b.BoundingBox),l=0;l<b.length;l++){var c=b[l].attr.SRS;isDefined(b[l].attr.CRS)&&(c=b[l].attr.CRS);c&&0<c.length&&(c=decodeURIComponent(c));for(var d=!1,e=0;e<a.projectionProperties.length;e++)if(c==a.projectionProperties[e].srs){d=!0;break}0==d&&(d=new WMJSProjection,d.srs=c,c=!1,a.version==WMSVersion.version130&&"EPSG:4326"==d.srs&&0==a.wms130bboxcompatibilitymode&&(c=!0),0==c?(d.bbox.left=parseFloat(b[l].attr.minx),d.bbox.bottom=
parseFloat(b[l].attr.miny),d.bbox.right=parseFloat(b[l].attr.maxx),d.bbox.top=parseFloat(b[l].attr.maxy)):(d.bbox.left=parseFloat(b[l].attr.miny),d.bbox.bottom=parseFloat(b[l].attr.minx),d.bbox.right=parseFloat(b[l].attr.maxy),d.bbox.top=parseFloat(b[l].attr.maxx)),a.projectionProperties.push(d),n.push(d.srs))}};g(c);g(e);for(l=0;l<k.length;l++)-1==n.indexOf(k[l].value)&&(g=new WMJSProjection,error("Warning: BoundingBOX missing for SRS "+k[l].value),g.bbox.left=-180,g.bbox.bottom=-90,g.bbox.right=
180,g.bbox.top=90,g.srs=k[l].value,a.projectionProperties.push(g));n="";a.queryable=!1;try{1==parseInt(c.attr.queryable)?a.queryable=!0:a.queryable=!1}catch(u){error("Unable to detect whether this layer is queryable (for layer "+a.title+")")}w=1},g=toArray(e.Layer),k=[];k.push(e);c(g,"",k);if(0==w)return g="",g=a.name?"Unable to find layer '"+a.name+"' in service '"+a.service+"'":"Unable to find layer '"+a.title+"' in service '"+a.service+"'",a.title="--- layer not found in service ---",a.abstract=
I18n.not_available_message.text,n(a,g),a;if(a.onReady)a.onReady(a);f(a);return a}}else n(a,"No Layer element in service")}})(b,a)},function(a){n(b,a)},d)};this.cloneLayer=function(){var a=new WMJSLayer;for(i in this)a[i]=this[i];return a};this.setName=function(a){this.name=a;this.parseLayer(void 0,void 0,"WMJSLayer::setName")};this.getLayerRelative=function(a,d,k){isDefined(k)||(k=0);var b=this;b.WMJSService.getLayerObjectsFlat(function(c){for(var f=-1,g=0;g<c.length;g++)if(c[g].name==b.name){f=g;
break}-1==f?d("Current layer ["+b.name+"] not in this service"):(-1===k&&f--,1===k&&f++,f>c.length-1&&(f=0),0>f&&(f=c.length-1),a(c[f],f,c.length))},d)};this.autoSelectLayer=function(a,d){this.WMJSService.getLayerObjectsFlat(function(c){for(var b=0;b<c.length;b++)if(isDefined(c[b].name)&&-1==c[b].name.indexOf("baselayer")&&-1==c[b].path.indexOf("baselayer")){a(c[b]);break}},d)};this.getNextLayer=function(a,d){this.getLayerRelative(a,d,1)};this.getPreviousLayer=function(a,d){this.getLayerRelative(a,
d,-1)};this.setStyle=function(a){debug("WMJSLayer::setStyle: "+a);if(0==this.styles.length)this.legendGraphic=this.currentStyle="",debug("Layer has no styles.");else{for(var c=0;c<this.styles.length;c++)if(this.styles[c].name==a){this.legendGraphic=this.styles[c].legendURL;this.currentStyle=this.styles[c].name;return}debug("WMJSLayer::setStyle: Style "+a+" not found, setting style "+this.styles[0].name);this.currentStyle=this.styles[0].name;this.legendGraphic=this.styles[0].legendURL}};this.getStyleObject=
function(a,d){if(0!=isDefined(this.styles))for(var c=0;c<this.styles.length;c++)if(this.styles[c].name==a)return-1===d&&c--,1===d&&c++,0>c&&(c=this.styles.length-1),c>this.styles.length-1&&(c=0),this.styles[c].nrOfStyles=this.styles.length,this.styles[c].index=c,this.styles[c]};this.getStyle=function(){return this.currentStyle};this.setService=function(a){this.getgraphinfoURL=this.getlegendgraphicURL=this.getfeatureinfoURL=this.getmapURL=this.service=a};this.getDimension=function(a){for(var c=0;c<
this.dimensions.length;c++)if(this.dimensions[c].name==a)return this.dimensions[c]};this.getProjection=function(a){for(var c=0;c<this.projectionProperties.length;c++)if(this.projectionProperties[c].srs==a)return a=[],a.srs=this.projectionProperties[c].srs+"",a.bbox=new WMJSBBOX(this.projectionProperties[c].bbox.left,this.projectionProperties[c].bbox.bottom,this.projectionProperties[c].bbox.right,this.projectionProperties[c].bbox.top),a};this.display=function(a){this.enabled=a;for(a=0;a<this.parentMaps.length;a++)this.parentMaps[a].displayLayer(this,
this.enabled)};a&&(this.getlegendgraphicURL=this.getfeatureinfoURL=this.getmapURL=this.service=a.service,this.name=a.name,a.getgraphinfoURL&&(this.getgraphinfoURL=a.getgraphinfoURL),a.style&&(this.currentStyle=a.style),this.format=a.format?a.format:"image/png",a.opacity&&(this.opacity=a.opacity),a.title&&(this.title=a.title),this.abstract=I18n.not_available_message.text,!1===a.enabled&&(this.enabled=!1),1==a.keepOnTop&&(this.keepOnTop=!0),!0===a.transparent&&(this.transparent=!0),!1===a.transparent&&
(this.transparent=!1),isDefined(a.onReady)&&(this.onReady=a.onReady,this.parseLayer(void 0,void 0,"WMJSLayer::configOptions")),isDefined(a.type)&&(this.type=a.type))};function WMJSBBOX(a,c,d,k){this.left=-180;this.bottom=-90;this.right=180;this.top=90;this.clone=function(a){void 0==a&&(a=this);var b=new WMJSBBOX;b.left=a.left;b.bottom=a.bottom;b.right=a.right;b.top=a.top;return b};this.copy=function(a){this.setBBOX(a)};this.setBBOX=function(a,c,d,g){if(void 0===a||null===a)this.left=-180,this.bottom=-90,this.right=180,this.top=90;else{if(!c)if("object"===typeof a){var b=a;void 0===b.length||null===b.length?(a=b.left,c=b.bottom,d=b.right,g=b.top):(a=parseFloat(b[0]),
c=parseFloat(b[1]),d=parseFloat(b[2]),g=parseFloat(b[3]))}else try{b=a.split(","),4!==b.length&&error("Invalid map bounding box: '"+a+"'"),a=parseFloat(b[0]),c=parseFloat(b[1]),d=parseFloat(b[2]),g=parseFloat(b[3])}catch(w){}if(void 0===a||void 0===c||void 0===d||void 0===g||null===a||null===c||null===d||null===g)void 0==a&&(a=-180),void 0==d&&(d=180),void 0==c&&(c=-90),void 0==g&&(g=90);this.left=a;this.bottom=c;this.right=d;this.top=g}};this.equals=function(b,c,d,g){if(!b)return!1;if(void 0!==c&&
this.left===b&&this.right===d&&this.top===g&&this.bottom===c)return!0;if("object"===typeof b){if(this.left===b.left&&this.right===b.right&&this.top===b.top&&this.bottom===b.bottom)return!0}else if(g=b.split(","),4!==g.length&&console.log("Invalid map bounding box: "+b),a=parseFloat(g[0]),c=parseFloat(g[1]),d=parseFloat(g[2]),g=parseFloat(g[3]),b=0,this.left===a&&b++,this.right===d&&b++,this.top===g&&b++,this.bottom===c&&b++,2<=b)return!0;return!1};this.toString=function(){return this.left+","+this.bottom+
","+this.right+","+this.top};this.setBBOX(a,c,d,k)};WMJSDateOutSideRange="outside range";WMJSDateTooEarlyString="date too early";WMJSDateTooLateString="date too late";
function WMJSDimension(a){this.parentLayer=this.defaultValue=this.currentValue=this.values=this.units=this.name=void 0;this.linked=!0;isDefined(a)&&(isDefined(a.name)&&(this.name=a.name),isDefined(a.units)&&(this.units=a.units),isDefined(a.values)&&(this.values=a.values),isDefined(a.currentValue)&&(this.currentValue=a.currentValue),isDefined(a.defaultValue)&&(this.defaultValue=a.defaultValue),isDefined(a.parentLayer)&&(this.parentLayer=a.parentLayer),isDefined(a.linked)&&(this.linked=a.linked));var c=
!1,d,k=[],b,f=[],n=function(a){if(1!=c&&isDefined(a.values)){c=!0;"ISO8601"==a.units?0<a.values.indexOf("/")?(b="timestartstopres",d=new parseISOTimeRangeDuration(a.values)):b="timevalues":(b="anyvalue",a.linked=!1);if("timestartstopres"!=b){for(var e=a.values.split(","),g=0;g<e.length;g++){var n=e[g].split("/");if(3==n.length){var g=parseFloat(n[0]),q=parseFloat(n[1]),n=parseFloat(n[2]),q=q+n;g>q&&(q=g);for(0>=n&&(n=1);g<q;g+=n)f.push(g)}else f.push(e[g])}if("timevalues"==b)for(g=0;g<f.length;g++)k[g]=
parseISO8601DateToDate(f[g])}isDefined(a.defaultValue)||(a.defaultValue=a.getValueForIndex(0));isDefined(a.currentValue)||(a.currentValue=a.getValueForIndex(0))}};this.getValue=function(){return isDefined(this.currentValue)?this.currentValue:this.defaultValue};this.setValue=function(a){a!=WMJSDateOutSideRange&&a!=WMJSDateTooEarlyString&&a!=WMJSDateTooLateString&&(this.currentValue=a)};this.setClosestValue=function(a){this.currentValue=this.getClosestValue(a)};this.getNextClosestValue=function(a){var b=
this.getClosestValue(a),b=this.getIndexForValue(b),b=this.getValueForIndex(b+1);return!b||"date too early"===b||moment(a)>=moment(b)?null:b};this.getClosestValue=function(a,b){b="undefined"!==typeof b?b:!1;var c=-1,d=WMJSDateOutSideRange;try{c=this.getIndexForValue(a),d=this.getValueForIndex(c)}catch(q){"number"===typeof q&&(d=0==q?WMJSDateTooEarlyString:WMJSDateTooLateString)}"current"==a||"default"==a||""==a?d=this.defaultValue:"latest"==a||b&&d===WMJSDateTooLateString?d=this.getValueForIndex(this.size()-
1):"earliest"==a||b&&d===WMJSDateTooEarlyString?d=this.getValueForIndex(0):"middle"==a&&(a=this.size()/2-1,0>a&&(a=0),d=this.getValueForIndex(a));return d};this.getValueForIndex=function(a){n(this);if(0>a)return-1==a?WMJSDateTooEarlyString:-2==a?WMJSDateTooLateString:-1;if("timestartstopres"==b){try{return d.getDateAtTimeStep(a).toISO8601()}catch(e){}return d.getDateAtTimeStep(a)}if("timevalues"==b||"anyvalue"==b)return f[a]};this.get=function(a){return this.getValueForIndex(a)};this.getIndexForValue=
function(a,c){n(this);isDefined(c)||(c=!0);if("string"===typeof a&&"current"==a&&"current"!=this.defaultValue)return this.getIndexForValue(this.defaultValue);if("timestartstopres"==b)try{return"string"===typeof a?d.getTimeStepFromISODate(a,c):d.getTimeStepFromDate(a,c)}catch(v){return 0==parseInt(v)?-1:-2}if("timevalues"==b)try{var e=parseISO8601DateToDate(a).getTime(),g;for(c=a=0;c<f.length;c++){var q=k[c].getTime()-e;0>q&&(q=-q);0==c&&(g=q);q<g&&(g=q,a=c)}return a}catch(v){return error("WMSJDimension::getIndexForValue,2: "+
v),-1}if("anyvalue"==b)for(c=0;c<f.length;c++)if(f[c]==a)return c;return-1};this.size=function(){n(this);if("timestartstopres"==b)return d.getTimeSteps();if("timevalues"==b||"anyvalue"==b)return f.length};this.clone=function(){var a=new WMJSDimension;a.name=this.name;a.units=this.units;a.values=this.values;a.currentValue=this.currentValue;a.defaultValue=this.defaultValue;a.parentLayer=this.parentLayer;a.linked=this.linked;return a};n(this)};var WMSVersion={version100:"1.0.0",version111:"1.1.1",version130:"1.3.0"},loadGetCapabilitiesViaProxy=function(a,c,d,k){var b=k+"request=",f=function(a){d(I18n.unable_to_do_getcapabilities.text+":\n"+b+"\n"+I18n.result.text+":\n"+a)};debug("<a target='_blank' href='"+a+"'>"+a+"</a>",!1);b+=URLEncode(a);console.log("loadGetCapabilitiesViaProxy wrapped",b);debug(b);debug(URLEncode(a));debug(a);try{$.ajax({url:b,crossDomain:!0,dataType:"jsonp"}).done(function(a){console.log("loadGetCapabilitiesViaProxy succesfully finished");
c(a)}).fail(function(){f({error:"Request failed for "+b})})}catch(n){console.log("catch: ",n),f({error:"Request failed for "+b})}},WMJSGetCapabilities=function(a,c,d,k){console.log(a);if(0==isDefined(a))console.log("Service not defined"),k(I18n.no_service_defined.text);else if(0==a.length)console.log("Service is empty"),k(I18n.service_url_empty.text);else if(a.startsWith("http://")||a.startsWith("https:")){-1==a.indexOf("?")&&(a+="?");debug("GetCapabilities:");var b=a+"&service=WMS&request=GetCapabilities";
(new WMJSXMLParser).fetchXMLAndParseToJSON(b,d,function(){console.log("Unable to use browser based XML reading, trying proxy");loadGetCapabilitiesViaProxy(b,d,function(){k("Request failed for "+b)},xml2jsonrequestURL)})}else console.log("Service does not start with HTTPS"),k(I18n.service_url_empty.text)},WMJSServiceStore=[],WMJSgetServiceFromStore=function(a){for(var c=0;c<WMJSServiceStore.length;c++)if(WMJSServiceStore[c].service==a)return WMJSServiceStore[c];a=new WMJSService({service:a});WMJSServiceStore.push(a);
return a};
function WMJSService(a){function c(a,b){return a.sort(function(a,c){a=a[b];c=c[b];return a<c?-1:a>c?1:0})}this.abstract=this.onlineresource=this.title=this.service=void 0;this.version=WMSVersion.version111;this.getcapabilitiesDoc=void 0;this.busy=!1;var d,k=this;a&&(this.service=a.service,this.title=a.title);this.getCapabilityElement=function(a){try{var b=a.WMT_MS_Capabilities.Capability}catch(g){try{b=a.WMS_Capabilities.Capability}catch(e){throw I18n.no_capability_element_found.text;}}if(!isDefined(b))throw I18n.no_capability_element_found.text;return b};
this.checkVersion=function(a){var b=null;try{WMSVersion.version100==a.WMT_MS_Capabilities.attr.version&&(b=WMSVersion.version100),WMSVersion.version111==a.WMT_MS_Capabilities.attr.version&&(b=WMSVersion.version111),WMSVersion.version130==a.WMT_MS_Capabilities.attr.version&&(b=WMSVersion.version130)}catch(g){try{WMSVersion.version100==a.WMS_Capabilities.attr.version&&(b=WMSVersion.version100),WMSVersion.version111==a.WMS_Capabilities.attr.version&&(b=WMSVersion.version111),WMSVersion.version130==a.WMS_Capabilities.attr.version&&
(b=WMSVersion.version130)}catch(e){console.log("165");if(a=k.checkException(a))throw console.log(a),Error(a);throw Error("Unable to determine WMS version");}}if(null===b)throw Error("Unable to determine WMS version");return b==WMSVersion.version111||b==WMSVersion.version130?b:WMSVersion.version111};var b=[];this.getCapabilities=function(a,c,g){d=void 0;var e=this;if(this.busy)a={callback:a,fail:c},b.push(a);else if(e.getcapabilitiesDoc&&1!=g)a(this.getcapabilitiesDoc);else{e.busy=!0;var f=function(a){console.log("Failed");
e.busy=!1;for(var c=0;c<b.length;c++)b[c].fail(a),b[c].fail=function(){};b=[]};a={callback:a,fail:c};b.push(a);WMJSGetCapabilities(this.service,!1,function(a){e.busy=!1;e.getcapabilitiesDoc=a;try{e.version=e.checkVersion(a)}catch(v){console.log("version error",v);f(v.message);return}var c=a.WMS_Capabilities;c||(c=a.WMT_MS_Capabilities);try{e.abstract=c.Service.Abstract.value}catch(v){this.abstract=I18n.not_available_message.text}try{e.title=c.Service.Title.value}catch(v){this.title=I18n.not_available_message.text}try{e.onlineresource=
c.Service.OnlineResource.value?c.Service.OnlineResource.value:c.Service.OnlineResource.attr["xlink:href"]}catch(v){e.onlineresource=I18n.not_available_message.text}for(c=0;c<b.length;c++)b[c].callback(a),b[c].callback=function(){};b=[];e.busy=!1},f)}};this.checkException=function(a){console.log("271");try{if(a.ServiceExceptionReport){var b="Undefined",c=b,d=a.ServiceExceptionReport.ServiceException;if(d){try{d.attr.code&&(b=d.attr.code)}catch(w){}if(d.value)return c=d.value,"Exception: "+b+".\n"+
c}return I18n.wms_service_exception_code.text+b}}catch(w){}};this.getNodes=function(a,b,d){this.nodeCache=void 0;b||(b=function(a){error(a)});var e=function(d){function e(a,b,d){for(var g=0;g<a.length;g++){var f=!1;a[g].Name&&(f=!0);try{a[g].Layer&&(f=!1)}catch(E){}a[g].Name?f={name:a[g].Name.value,text:a[g].Title.value,leaf:f,path:d}:(isNull(a[g].Title)&&(a[g].Title=[],a[g].Title.value="Layer"),f={text:a[g].Title.value,leaf:f});b.push(f);a[g].Layer&&(f.children=[],e(toArray(a[g].Layer),f.children,
d+a[g].Title.value))}c(b,"text")}var g={},f=k.getCapabilityElement(d).Layer;try{k.version=k.checkVersion(d)}catch(M){b(M);return}d=toArray(f.Layer);try{g.text=f.Title.value}catch(M){g.text=I18n.unnamed_service.text}g.leaf=!1;g.expanded=!0;g.children=[];e(d,g.children,"");a(g)};this.getCapabilities(function(a){e(a)},function(a){b(a)},d)};this.getLayerNames=function(a,b){this.getNodes(function(b){var c=[],d=function(a){for(var b=0;b<a.length;b++)a[b].name&&c.push(a[b].name),a[b].children&&d(a[b].children)};
d(b.children);a(c)},b)};this.getLayerObjectsFlat=function(a,b){isDefined(d)&&a(d);this.getNodes(function(b){var c=[],d=function(a){for(var b=0;b<a.length;b++)a[b].name&&c.push(a[b]),a[b].children&&d(a[b].children)};d(b.children);a(c)},b)}};function WMJSListener(){function a(){this.functionpointer=this.name=void 0;this.finished=0;this.keepOnCall=!1}var c=[],d=0,k=[],b=this;this.addToCallback=function(b,k,g){var e=-1;g||(g=!1);for(var f=0;f<d;f++){if(1===c[f].finished){e=f;break}if(c[f].name===b&&c[f].functionpointer===k)return c[f].keepOnCall=g,!1}-1===e&&(e=d,d++,c[e]=new a);c[e].name=b;c[e].functionpointer=k;c[e].finished=0;c[e].keepOnCall=g;return!0};this.removeEvents=function(a,b){for(var g=0;g<d;g++)0===c[g].finished&&c[g].name===
a&&(b?c[g].functionpointer===b&&(c[g].finished=1):c[g].finished=1)};this.suspendEvent=function(a){k[a]=!0};this.resumeEvent=function(a){k[a]=!1};this.triggerEvent=function(a,n){if(!0!==k[a]){for(var g=[],e=0,f=0;f<d;f++)if(0===c[f].finished&&c[f].name===a){!1===c[f].keepOnCall&&(c[f].finished=1);try{e++,g.push(c[f].functionpointer(n,b))}catch(p){console.log("Error for event ["+a+"]: ",n,p)}}return g}}};function WMJSTimer(){function a(){k&&clearTimeout(d);k=!1}function c(){0==f?(a(),""!=g&&g()):(--f,k=!0,d=self.setTimeout(function(){c()},b))}this.init=function(b,d){f=parseInt(b/10+.5);1>f&&(f=1);n=f;g=d;a();0<f&&c()};this.reset=function(){f=n};this.stop=function(){a()};var d=null,k=!1,b=10,f,n,g=""}var WMJSDebouncer=function(){var a=!1,c=10,d=!1;this.init=function(k,b){d=!1;c=k;10>c&&(c=10);!1===a&&(self.setTimeout(function(){a=!1;!1===d&&b()},c),a=!0)};this.stop=function(){d=!0}};var sliderTooltip=function(a){isDefined(a)?(a='<div class="slidertooltip"><div class="slidertooltip-inner">'+a+"</div></div>",$(".relativecontrol .ui-slider-handle").html(a)):$(".ui-slider-handle .relativecontrol").html("")},RelativeSlider=function(a){var c=this,d=a.renderTo;$('<input class="datetimepicker"/><br/><span class="relativeslider"/><span class="timeprevious"/><span class="timenext"/>').appendTo(d);var k=0,b=function(b){k+=b;NaN<k&&(k=NaN);0>k&&(k=0);isDefined(a.change)&&a.change(c,k)},
f=d.find(".relativeslider").slider({min:0,max:100,value:50,animate:1E3,change:function(a,c){a.originalEvent&&(a=parseInt(c.value-50),b(a),50!=c.value&&f.slider("value",50))},slide:function(b,d){d=parseInt(d.value-50);b=k;d=k+d;void 0<d&&(d=void 0);0>d&&(d=0);isDefined(a.slide)&&a.slide(c,d);k=b}});f.addClass("relativecontrol");d.find(".timeprevious").iconbutton({text:!1,icons:{primary:"ui-icon-circle-triangle-w"}});d.find(".timenext").iconbutton({text:!1,icons:{primary:"ui-icon-circle-triangle-e"}});
d.find(".timeprevious").click(function(){b(-1)});d.find(".timenext").click(function(){b(1)});var n=d.find(".datetimepicker").datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss",separator:"T",showOn:"button",buttonText:"",altFieldTimeOnly:!1,showAnim:"slideDown",changeMonth:!0,changeYear:!0,showTimezone:!1,onSelect:function(a,b){b=c.setPositionByText(a);a!=b.dimvalue&&n.datetimepicker("setDate",b.dimvalue.replace("Z",""))},css:{zIndex:4E3}});this.setPosition=function(a){k=a};this.setPositionByText=
function(b){if(isDefined(a.textUpdate))return a.textUpdate(c,b)};this.setText=function(a,b){a=a.replace("Z","");d.find(".datetimepicker").val(a)};this.setMax=function(a,b,c){n.datetimepicker("option",{minDate:b.replace("Z",""),maxDate:c.replace("Z","")})}},TimeSlider=function(a){var c,d;this.setDimension=function(a,b,f){c=a;isDefined(void 0)&&(void 0).setMax(a.size(),a.getValueForIndex(0),a.getValueForIndex(a.size()-1));d="";this.setValue(a.name,a.getValue())};this.setValue=function(a,b){if(isDefined(c)&&
"time"==a&&d!=b){d=b;try{var f=c.getIndexForValue(b)}catch(n){f=c.size()-1,b=c.getValueForIndex(f),debug("Date "+b+" is outside range: "+f)}isDefined(void 0)&&((void 0).setText(b),(void 0).setPosition(f));return{index:f,dimvalue:b}}}};var WMJSProcessing=function(a){var c=a.url,d=!1;a.failure||(a.failure=function(a){alert(dump(a))});var k=function(b){try{var c=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessAccepted"].value}catch(p){}if(isDefined(c)){var k=b["wps:ExecuteResponse"].attr.statusLocation,g=new WMJSTimer,e=function(b){if(0!=d){if(b.error){var c=!0;var e=b.error}try{c=!0,e=dump(b.ExceptionReport.Exception)}catch(r){}try{c=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessFailed"],e="Process failed",e=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessFailed"]["wps:ExceptionReport"]["ows:Exception"]["ows:ExceptionText"].value}catch(r){}if(isDefined(c))d=
!1,a.failure({message:e});else{try{var g=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessSucceeded"].value}catch(r){}try{var f=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessStarted"].attr.percentCompleted;var k=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessStarted"].value;0==k.indexOf("processstarted")&&(k=k.substr(14))}catch(r){}isDefined(g)?(g=b["wps:ExecuteResponse"]["wps:ProcessOutputs"]["wps:Output"],a.progress(100,"completed"),a.success(g,b),d=!1):a.progress(parseFloat(f),k)}}},
w=function(){$.ajax({dataType:"jsonp",url:xml2jsonrequestURL+"request="+URLEncode(k),data:"",success:e}).fail(function(b){d=!1;a.failure({message:"<h1>Invalid JSON returned from server:</h1><hr/>"+b.responseText})});d&&g.init(1E3,w)};w()}else{c="";try{c=dump(b.ExceptionReport.Exception.attr),a.failure({message:"Process was not accepted, ExceptionReport:\n"+c})}catch(p){b.error?(b.message||(b.message=b.error),a.failure(b)):(c=dump(b),a.failure({message:"Process was not accepted (dump):\n"+c}))}}};
this.execute=function(b,f){d=!0;b=c+"service=WPS&request=execute&identifier="+b+"&version=1.0.0&storeExecuteResponse=true&status=true&";b+="datainputs=";var n="",g;for(g in f)if("object"===typeof f[g])for(var e in f[g])0<n.length&&(n+=";"),n+=g+"="+encodeURIComponent(f[g][e]);else 0<n.length&&(n+=";"),n+=g+"="+encodeURIComponent(f[g]);$.ajax({dataType:"jsonp",url:xml2jsonrequestURL,data:{request:b+n},success:k}).fail(function(b){a.failure({message:b.responseText})})}};var WMJSCoverage=function(a){this.service=this.name=void 0;this.dimensions=[];this.supportedProjections=[];this.nativeFormat=this.nativeCRS=this.originY=this.originX=this.cellsizeY=this.cellsizeX=this.height=this.width=void 0;this.formats=[];this.setDimension=function(a,d){this.dimensions.push({name:a,value:d,currentValue:d})};isDefined(a)&&(this.name=a.name,this.service=a.service)},WCJSRequest=function(a,c,d,k){var b=xml2jsonrequestURL+"request=";-1==a.indexOf("?")&&(a+="?");debug("GetCapabilities:");
var f=a+"&service=WCS&REQUEST=DescribeCoverage&COVERAGE="+c;debug("<a target='_blank' href='"+f+"'>"+f+"</a>",!1);b+=URLEncode(f);$.ajax({dataType:"jsonp",url:b,success:function(b){b.service=a;b.name=c;d(b)},error:function(a){k(I18n.unable_to_do_getcapabilities.text+":\n"+b+"\n"+I18n.result.text+":\n"+a)}})},parseDescribeCoverage=function(a,c){c=c?c:new WMJSCoverage;c.service=a.service;try{c.name=a.CoverageDescription.CoverageOffering.name.value}catch(g){alert("This layer has no Web Coverage Service.");
return}c.title=a.CoverageDescription.CoverageOffering.label.value;c["abstract"]=a.CoverageDescription.CoverageOffering.description.value;var d=a.CoverageDescription.CoverageOffering.lonLatEnvelope["gml:pos"][0].value.replaceAll(" ",",");var k=a.CoverageDescription.CoverageOffering.lonLatEnvelope["gml:pos"][1].value.replaceAll(" ",",");c.lonlatbox=new WMJSBBOX(d+","+k);for(var b=toArray(a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:Envelope"]),f=0;f<b.length;f++){var n=b[f].attr.srsName;
d=b[f]["gml:pos"][0].value.replaceAll(" ",",");k=b[f]["gml:pos"][1].value.replaceAll(" ",",");k=new WMJSBBOX(d+","+k);c.supportedProjections.push({srs:n,bbox:k.toString()})}f=a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:RectifiedGrid"]["gml:limits"]["gml:GridEnvelope"]["gml:high"].value.split(" ");c.width=parseInt(f[0])+1;c.height=parseInt(f[1])+1;c.cellsizeX=parseFloat(a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:RectifiedGrid"]["gml:offsetVector"][0].value.split(" ")[0]);
c.cellsizeY=parseFloat(a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:RectifiedGrid"]["gml:offsetVector"][1].value.split(" ")[1]);c.originX=a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:RectifiedGrid"]["gml:origin"]["gml:pos"].value.split(" ")[0];c.originY=a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:RectifiedGrid"]["gml:origin"]["gml:pos"].value.split(" ")[1];c.nativeCRS=a.CoverageDescription.CoverageOffering.supportedCRSs.nativeCRSs?
a.CoverageDescription.CoverageOffering.supportedCRSs.nativeCRSs.value:"EPSG:4326";c.nativeFormat=a.CoverageDescription.CoverageOffering.supportedFormats.attr.nativeFormat;a=toArray(a.CoverageDescription.CoverageOffering.supportedFormats.formats);for(f=0;f<a.length;f++)c.formats.push(a[f].value);return c};var WMJSImage=function(a,c,d,k){var b=this,f=!0;isDefined(k)&&isDefined(k.randomizer)&&!1===k.randomizer&&(f=!1);var n,g,e,w,p;b.init=function(){n="undefined image";w=e=g=!1;p=1};b.init();this.srcToLoad=a;b.isLoaded=function(){return e?!1:g};b.isLoading=function(){return e};b.checkIfThisSourceIsSet=function(a){return n==a||this.srcToLoad==a?!0:!1};b.setSource=function(a){e?console.log("-------------------------\x3e Source set while still loading!!! "):(this.srcToLoad=a,g=n==this.srcToLoad?!0:!1)};
b.clear=function(){b.init()};b.getSrc=function(){return this.srcToLoad};b.hasError=function(){return w};b.load=function(){w=!1;1==g?q(b,!1):(e=!0,this.srcToLoad?!1===this.srcToLoad.startsWith("http")?(console.log("Source does not start with http"),q(b,!0)):this.srcToLoad==n?q(b,!1):(v.load(function(){q(b,!1)}),v.error(function(a){q(b,!0)}),f?v.attr("src",this.srcToLoad+"&"+Math.random()):v.attr("src",this.srcToLoad)):(console.log("Source not set"),q(b,!0)))};var q=function(a,d){w=d;e=!1;g=!0;n=this.srcToLoad;
isDefined(c)&&c(b)};b.setOpacity=function(a){p=parseFloat(a);v.css("opacity",p)};b.getOpacity=function(a){return p};b.setPosition=function(a,b){v.css({top:parseInt(b)+"px",left:parseInt(a)+"px",position:"absolute"})};b.setSize=function(a,b){a=parseInt(a);b=parseInt(b);0===a||0===b||isNaN(a)||isNaN(b)||(v.width(parseInt(a)+"px"),v.height(parseInt(b)+"px"))};b.setZIndex=function(a){v.zIndex=a};b.getElement=function(){return v};var v=$(document.createElement("img"));v.onselectstart=function(){return!1};
v.ondrag=function(){return!1};return b};function WMJSXMLParser(){this.fetchXMLAndParseToJSON=function(a,c,d){$.ajax({url:a,crossDomain:!0}).done(function(a){var b={},f=function(a,b,c){for(var d=0;d<a.children.length;d++){var e=a.children[d],g=b+"->"+e.nodeName,k=e.nodeName;if(c[k]){var n={attr:{}};if(!(c[k]instanceof Array)){var B=Object.assign({},c[k]);c[k]=[];c[k].push(B)}c[k].push(n)}else c[k]={attr:{}},n=c[k];if(e.childNodes&&0<e.childNodes.length&&e.childNodes[0].nodeValue&&(k=e.childNodes[0].nodeValue.trim(),"\n"!==k&&0<k.length&&
(n.value=k),e.attributes&&0<e.attributes.length))for(n.attr={},k=0;k<e.attributes.length;k++)n.attr[e.attributes[k].name]=e.attributes[k].value;f(e,g,n)}};f(a,"",b);try{console.log("WMJSXMLParser succesfully completed"),c(b)}catch(n){d({error:"WMJSXMLParser: ready failed",exception:n})}}).fail(function(c){d({error:"WMJSXMLParser: Request failed for "+a,exception:c})})}};var WMJSCanvasBuffer=function(a,c,d,k,b){var f=this;this.canvas=$("<canvas/>",{"class":"WMJSCanvasBuffer"}).width(k).height(b);var n=f.canvas[0].getContext("2d");n.canvas.width=k;n.canvas.height=b;this.hidden=this.ready=!0;this.layerstodisplay=[];this.layers=[];var g=k,e=b;"imagebuffer"===c&&this.canvas.addClass("wmjsimagebuffer");"legendbuffer"===c&&this.canvas.addClass("wmjslegendbuffer");this.canvas.addClass("WMJSCanvasBuffer-noselect");this.getCanvasContext=function(){return n};this.imageLoadComplete=
function(b){w();a.triggerEvent("onimageload")};var w=function(){for(var a=0;a<f.layers.length;a++)if(!1===f.layers[a].isLoaded())return;f.finishedLoading()},p=new WMJSImage("webmapjs/img/stoploading.png",function(){console.log("fake image loaded");w()},c);this.hide=function(){f.hidden=!0;f.canvas.hide();f.layers=[]};this.display=function(b,d){var k=[];if(b&&!d)console.log("skipping WMJSCanvasBuffer:display because newbbox is undefined");else{f.hidden=!1;n.globalAlpha=1;"legendbuffer"===c&&n.clearRect(0,
0,g,e);"imagebuffer"===c&&(n.beginPath(),n.rect(0,0,g,e),n.fillStyle="white",n.fill(),a.triggerEvent("beforecanvasstartdraw",n));if(b){var p=q({x:d.left,y:d.top},b);var B=q({x:d.right,y:d.bottom},b)}for(var w=d=0;w<f.layerstodisplay.length;w++)if(f.layerstodisplay[w].setSize(g,e),!1===f.layerstodisplay[w].hasError()){var l=f.layerstodisplay[w].getOpacity();n.globalAlpha=l;l=f.layerstodisplay[w].getElement()[0];if("legendbuffer"===c){var A=parseInt(l.width)+4,v=parseInt(l.height)+4;d+=A+4;var u=g-
d+2,z=e-v-2;n.beginPath();n.fillStyle="#FFFFFF";n.lineWidth=.3;n.globalAlpha=.5;n.strokeStyle="#000000";n.rect(parseInt(u)+.5,parseInt(z)+.5,A,v);n.fill();n.stroke();n.globalAlpha=1;n.drawImage(l,u,z)}else b?(A=parseInt(p.x+.5),v=parseInt(p.y+.5),u=parseInt(B.x-p.x+.5),z=parseInt(B.y-p.y+.5),u===parseInt(n.canvas.width)&&z===parseInt(n.canvas.height)?n.drawImage(l,A,v):n.drawImage(l,A,v,u,z)):n.drawImage(l,0,0,g,e)}else k.push(f.layerstodisplay[w]);n.globalAlpha=1;"imagebuffer"===c&&0<k.length&&a.triggerEvent("canvasonerror",
k);"imagebuffer"===c&&a.triggerEvent("beforecanvasdisplay",n);f.canvas.show();"imagebuffer"===c&&a.triggerEvent("aftercanvasdisplay",n)}};this.finishedLoading=function(){if(!f.ready){f.ready=!0;for(var a=0;a<f.layers.length;a++)f.layerstodisplay[a]=f.layers[a],f.layers[a].hasError()&&error("Unable to get image <a target='_blank' href='"+f.layerstodisplay[a].getSrc()+"'>"+f.layerstodisplay[a].getSrc()+"</a>",!1);try{if(isDefined(f.onLoadReadyFunction))f.onLoadReadyFunction(f)}catch(A){error("Exception in Divbuffer::finishedLoading: "+
A)}}};this.setPosition=function(a,b){console.log("setPosition is deprecated")};this.setSize=function(a,b){console.log("setSize is deprecated")};this.resize=function(a,b){a=parseInt(a);b=parseInt(b);if(g!==a||e!==b)g=a,e=b,f.canvas.width(a),f.canvas.height(b),n.canvas.height=b,n.canvas.width=a};this.load=function(a){if(!1!==f.ready){f.ready=!1;f.layerstodisplay=[];a?this.onLoadReadyFunction=a:f.onLoadReadyFunction=function(){};for(a=f.nrLoading=0;a<this.layers.length;a++)f.layers[a].loadThisOne=!1,
!1===f.layers[a].isLoaded()&&(f.layers[a].loadThisOne=!0,f.nrLoading++);if(0===this.nrLoading)w();else{"imagebuffer"===c&&debug("GetMap:");"legendbuffer"===c&&debug("GetLegendGraphic:");for(a=0;a<this.layers.length;a++)!0===this.layers[a].loadThisOne&&debug("<a target='_blank' href='"+this.layers[a].getSrc()+"'>"+this.layers[a].getSrc()+"</a>",!1);for(a=0;a<this.layers.length;a++)!0===this.layers[a].loadThisOne&&this.layers[a].load()}}};this.setSrc=function(a,b,c,e,g){if(isDefined(b)){for(;a>=this.layers.length;)this.layers.push(p);
b=d.getImage(b);b.setZIndex(a);b.linkedInfo=g;this.layers[a]=b}else console.log("undefined")};var q=function(a,b){return{x:g*(a.x-b.left)/(b.right-b.left),y:e*(a.y-b.top)/(b.bottom-b.top)}},v,M;this.setBBOX=function(a,b){if(v!==b+""||M!==a+"")v=b+"",M=a+"",!1===f.hidden&&f.display(a,b)};this.setOpacity=function(a,b){a>=this.layers.length?error("setOpacity :invalid id"):(b=parseFloat(b),this.layers[a].getOpacity()!==b&&this.layers[a].setOpacity(b))};this.getBuffer=function(){return f.canvas}};function WMJSTimeSelector(a,c,d){var k=function(){this.values=[]};k.prototype.add=function(a){if(!0===this[a])return!1;this[a]=!0;this.values.push(a);return!0};var b=this;this.element=a;this.webmapjs=void 0;this.values=[];var f=24;isDefined(d)&&(f=d);var n=$('<div class="WMJSTimeSelector-controlElement WMJSTimeSelector-noselect"/>',{}),g=$('<div class="WMJSTimeSelector-timeChooserElement WMJSTimeSelector-noselect"/>',{}),e=$('<div class="WMJSTimeSelector-timeinfo WMJSTimeSelector-noselect"/>',{}),
w=$('<div class=""WMJSTimeSelector-controlElementBottom WMJSTimeSelector-noselect"/>',{});this.element.append(e);this.element.append(n);this.element.append(g);this.element.append(w);a=$("<button>&lt;&lt;</button>").button().click(function(){var a=b.makeDateList(b.webmapjs,b.currentValue,f);P(a[0])});d=$("<button>&gt;&gt;</button>").button().click(function(){var a=b.makeDateList(b.webmapjs,b.currentValue,f);P(a[a.length-1])});var p=$("<button>&lt;</button>").button().click(function(){for(var a=b.makeDateList(b.webmapjs,
b.currentValue,f),c=1;c<a.length;c++)if(a[c]==b.currentValue){P(a[c-1]);return}P(a[0])}),q=$("<button>&gt;</button>").button().click(function(){for(var a=b.makeDateList(b.webmapjs,b.currentValue,f),c=0;c<a.length-1;c++)if(a[c]==b.currentValue){P(a[c+1]);return}P(a[a.length-1])});n.append("<table class='WMJSTimeSelector-table'><tr><th>"+I18n.year.text+"</th><th>"+I18n.month.text+"</th><th>"+I18n.day.text+"</th><th>"+I18n.hour.text+"</th><th>"+I18n.min.text+"</th></tr><tr><td><input class='WMJSTimeSelector_yearspinner'/></td><td><input class='WMJSTimeSelector_monthspinner'/></td><td><input class='WMJSTimeSelector_dayspinner'/></td><td><input class='WMJSTimeSelector_hourspinner'/></td><td><input class='WMJSTimeSelector_minutespinner'/></td></tr>");
var v=$("<button>"+I18n.load_all.text+"</button>").button().click(function(){for(var a=b.values,c=0;c<a.length;c++)D(a[c])}),M=$("<button>"+I18n.play_animation.text+"</button>").button().click(function(){for(var a=b.values,c=[],d=0;d<a.length;d++)D(a[d]),c.push({name:"time",value:a[d]});b.webmapjs.draw(c)}),B=$("<button>"+I18n.stop.text+"</button>").button().click(function(){b.webmapjs.stopAnimating()});w.append(v);w.append(M);w.append(B);var A=n.find(".WMJSTimeSelector_yearspinner"),r=n.find(".WMJSTimeSelector_monthspinner"),
I=n.find(".WMJSTimeSelector_dayspinner"),E=n.find(".WMJSTimeSelector_hourspinner"),T=n.find(".WMJSTimeSelector_minutespinner"),l=n.find(".WMJSTimeSelector_secondspinner"),w=$('<div class="WMJSTimeSelector_timebuttons"/>',{});w.append(a);w.append(p);w.append(q);w.append(d);n.append(w);var ea="",F=function(a,b){for(a=""+a;a.length<b;)a="0"+a;return a},u=function(a,c){var d=ea;"year"==a&&(d=[F(c,4),d.slice(4)].join(""));"month"==a&&(d=[d.slice(0,5),F(c,2),d.slice(7)].join(""));"day"==a&&(d=[d.slice(0,
8),F(c,2),d.slice(10)].join(""));"hour"==a&&(d=[d.slice(0,11),F(c,2),d.slice(13)].join(""));"minute"==a&&(d=[d.slice(0,14),F(c,2),d.slice(16)].join(""));"second"==a&&(d=[d.slice(0,17),F(c,2),d.slice(19)].join(""));a=parseISO8601DateToDate(d);d=a.toISO8601();if(d!=b.currentValue&&(c=b.makeDateList(b.webmapjs,d,3),c[1]==b.currentValue)){var e=parseISO8601DateToDate(c[1]);a>e?d=c[2]:a<e&&(d=c[0])}d!=ea&&(z(d),P(d));return!1},z=function(a){isDefined(a)&&(ea=a,A.spinner("value",a.substring(0,4)),r.spinner("value",
a.substring(5,7)),I.spinner("value",a.substring(8,10)),E.spinner("value",a.substring(11,13)),T.spinner("value",a.substring(14,16)),l.spinner("value",a.substring(17,19)))};A.spinner({spin:function(a,b){return u("year",b.value)},change:function(a,b){u("year",$(a.target).spinner("value"))},numberFormat:"d4"});r.spinner({spin:function(a,b){return u("month",b.value)},change:function(a,b){u("month",$(a.target).spinner("value"))},numberFormat:"d2"});I.spinner({spin:function(a,b){return u("day",b.value)},
change:function(a,b){u("day",$(a.target).spinner("value"))},numberFormat:"d2"});E.spinner({spin:function(a,b){return u("hour",b.value)},change:function(a,b){u("hour",$(a.target).spinner("value"))},numberFormat:"d2"});T.spinner({spin:function(a,b){return u("minute",b.value)},change:function(a,b){u("minute",$(a.target).spinner("value"))},numberFormat:"d2"});l.spinner({spin:function(a,b){return u("second",b.value)},change:function(a,b){u("second",$(a.target).spinner("value"))},numberFormat:"d2"});A.spinner().keyup(function(a,
b){13==(a.keyCode||a.which)&&u("year",$(event.target).spinner("value"))});r.spinner().keyup(function(a,b){13==(a.keyCode||a.which)&&u("month",$(event.target).spinner("value"))});I.spinner().keyup(function(a,b){13==(a.keyCode||a.which)&&u("day",$(event.target).spinner("value"))});E.spinner().keyup(function(a,b){13==(a.keyCode||a.which)&&u("hour",$(event.target).spinner("value"))});T.spinner().keyup(function(a,b){13==(a.keyCode||a.which)&&u("minute",$(event.target).spinner("value"))});l.spinner().keyup(function(a,
b){13==(a.keyCode||a.which)&&u("second",$(event.target).spinner("value"))});this.loadingComplete=function(a){this.generate(a,!1,!0)};this.dimensionUpdate=function(a){this.generate(a,!0,!0)};this.dimensionChange=function(a){this.generate(a,!1,!1)};var ba=function(a){z(a);a=parseISO8601DateToDate(a);$(e).html(I18n.local_time.text+":<br/><b>"+a.toString().replace(/GMT.*/g,"")+"</b>")},P=function(a){b.webmapjs.stopAnimating();ba(a);c(a)};this.makeDateList=function(a,b,c){var d=[];a=a.getLayers();for(var e=
0;e<a.length;e++)if(1==a[e].enabled){var g=a[e].getDimension("time");g&&d.push(g)}g=new k;for(e=0;e<c;e++)for(var f=0;f<d.length;f++){var l=d[f];a=l.getIndexForValue(b,!1);var n=e+a;0>n&&(n=0);n>l.size()-1&&(n=l.size()-1);0<=n&&n<l.size()&&g.add(l.getValueForIndex(n));n=-e+a;0>n&&(n=0);n>l.size()-1&&(n=l.size()-1);0<=n&&n<l.size()&&g.add(l.getValueForIndex(n))}g.values.sort();for(e=d=0;e<g.values.length;e++)if(b==g.values[e]){d=e;break}f=0;b=new k;for(e=0;e<c;e++){a=d+e;if(0<a&&a<g.values.length&&
1==b.add(g.values[a])&&(f++,f>c))break;a=d-e;if(0<a&&a<g.values.length&&1==b.add(g.values[a])&&(f++,f>c))break}b.values.sort();c=[];for(e=0;e<b.values.length;e++)c.push(b.values[e]);return c};var t=function(a){if(!b.webmapjs)return!1;var c=b.webmapjs.getDimension("time");if(!isDefined(c))return!1;c=c.currentValue;b.webmapjs.suspendEvent("ondimchange");b.webmapjs.suspendEvent("ondimupdate");b.webmapjs.setDimension("time",a);a=function(){var a=b.webmapjs.getWMSRequests();if(0==a.length)return!1;for(var c=
0;c<a.length;c++)if(0==b.webmapjs.isThisRequestLoaded(a[c]))return!1;return!0}();b.webmapjs.setDimension("time",c);b.webmapjs.resumeEvent("ondimchange");b.webmapjs.resumeEvent("ondimupdate");return a},D=function(a){if(!b.webmapjs)return!1;var c=b.webmapjs.getDimension("time");if(!isDefined(c))return!1;c=c.currentValue;b.webmapjs.suspendEvent("ondimchange");b.webmapjs.suspendEvent("ondimupdate");b.webmapjs.setDimension("time",a);a=[];var d=b.webmapjs.getWMSRequests();if(0==d.length)a=!1;else for(var e=
0;e<d.length;e++)0==b.webmapjs.isThisRequestLoaded(d[e])&&a.push(d[e]);b.webmapjs.prefetch(a);b.webmapjs.setDimension("time",c);b.webmapjs.resumeEvent("ondimchange");b.webmapjs.resumeEvent("ondimupdate");return a};this.generate=function(a,c,d){this.webmapjs=a;if(a.getDimension("time")){n.show();e.show();var k=a.getDimension("time").currentValue;if("current"==k)for(var l=a.getLayers(),p=0;p<l.length;p++){var q=l[p].getDimension("time");q&&(k=q.getValueForIndex(q.getIndexForValue(k,!1)))}b.currentValue=
k;ba(b.currentValue);if(0==c){l=!1;if(isDefined(b.values))for($(b.element).find(".WMJSTimeSelector-tr").removeClass("WMJSTimeSelector-col-selected"),p=0;p<b.values.length;p++)c=!1,q=$(b.element).find(".WMJSTimeSelector-tr:eq("+p+")"),!0===d&&(c=!1,q.hasClass("WMJSTimeSelector-col-loaded")&&(c=!0),c||(c=1==t(b.values[p])),c?q.addClass("WMJSTimeSelector-col-loaded"):q.removeClass("WMJSTimeSelector-col-loaded")),b.currentValue==b.values[p]&&(b.currentValue=k,q.addClass("WMJSTimeSelector-col-selected"),
l=!0);if(1==l)return}b.values=b.makeDateList(a,k,f);a="<table class='WMJSTimeSelector-table WMJSTimeSelector-noselect'>";d=function(a){var b="WMJSTimeSelector-tr";1==a.isLoaded&&(b+=" WMJSTimeSelector-col-loaded");a.value==k&&(b+=" WMJSTimeSelector-col-selected");return"<tr class='"+b+"'>"+("<td class='WMJSTimeSelector-colindex'>"+a.index+"</td><td class='WMJSTimeSelector-col'>"+a.textdate+"</td><td class='WMJSTimeSelector-colindex'>"+a.index+"</td><td class='WMJSTimeSelector-col'>"+a.texttime+"</td>")+
"</tr>"};c={};for(p=0;p<b.values.length;p++)c.index=p,c.value=b.values[p],c.text=c.value.replace(/T/g," | "),c.text=c.text.replace(/Z/g," "),c.textdate=c.value.split("T")[0],c.texttime=c.value.split("T")[1],c.texttime=c.texttime.split(":")[0]+":"+c.texttime.split(":")[1]+"z",c.isLoaded=t(c.value),a+=d(c);p=""+(a+"</table>");$(g).html(p);var w=function(a){a=$(a.target).parent().find("td").first().html();P(b.values[a])};$(b.element).find(".WMJSTimeSelector-tr").mouseover(function(a){0!=ca&&w(a)});$(b.element).find(".WMJSTimeSelector-tr").mousedown(w)}else $(g).html(I18n.no_dimensions_available.text),
n.hide(),e.hide(),b.currentValue="",b.values=[]};var ca=!1;$(document).mousedown(function(){ca=!0}).mouseup(function(){ca=!1});$(b.element).bind("mousewheel",function(a){var b=0;try{isDefined(a.originalEvent.deltaY)&&(b=a.originalEvent.deltaY)}catch(Q){}0==b&&(b=0<a.originalEvent.wheelDelta/120?-1:1);0>b?p.click():q.click()})};var GFITimeElevationWindow=function(a){this.t=function(){return 123};this.setSize=function(c,b){c-=80;b-=70;a.width(c);a.height(b);var f=a.find(".timeaxis").get(0).getContext("2d");f.canvas.height=50;f.canvas.width=c;f=a.find(".heightaxis").get(0).getContext("2d");f.canvas.height=b;f.canvas.width=60;d.setSize(c,b);d.draw()};a.html('<table class="gfi_table"><tr class="gfi_table_tr"><td class="gfi_table_td"><canvas class="heightaxis" class="gfi_nomarginpadding"  ></canvas></td><td class="gfi_table_td"><div class="gfi_nomarginpadding gfi_mainmap" style="width:1200px;height:600px;"></div></td><td><div class="legend"></div></td></tr><tr class="gfi_table_tr"><td class="gfi_table_td"></td><td><canvas class="timeaxis"  class="gfi_nomarginpadding"   ></canvas><td class="gfi_table_td"></td></tr></table>');
var c=a.find(".gfi_mainmap").get(0);var d=new WMJSMap(c);d.hideScaleBar();d.displayLegendInMap(!1);d.getOverlayElement().css("border","1px solid black");this.setSize(a.width(),a.height());this.updateBBOX=function(c){var b=a.find(".timeaxis").get(0).getContext("2d");b.fillStyle="#FFF";b.font="10px Arial";b.fillRect(0,0,d.getWidth(),50);var f=-1;for(var k=Math.round(c.left);k<Math.round(c.right);k+=1E4){var g=new Date(k);-1==f&&(f=g.getUTCHours());if(f!=g.getUTCHours()){b.fillStyle="#000000";var e=
(k-c.left)/(c.right-c.left)*d.getWidth();b.beginPath();b.moveTo(e-1,0);b.lineTo(e-1,10);b.stroke();f=g.getUTCHours();b.fillText(f,e-b.measureText(f).width/2-1,20);f=g.getUTCHours()}}b.font="14px Arial";b.fillText("time UTC (h)",d.getWidth()/2-100,38);b=a.find(".heightaxis").get(0).getContext("2d");b.font="10px Arial";b.fillStyle="#FFF";b.fillRect(0,0,60,d.getHeight());b.textAlign="right";f=-1.1;if(!(100<Math.abs(Math.round(c.top)-Math.round(c.bottom))/1E3)){for(k=Math.round(c.bottom);k<Math.round(c.top);k+=
1)g=Math.floor(k/1E3),-1.1==f&&(f=g),f!=g&&(b.fillStyle="#000000",e=(k-c.top)/(c.bottom-c.top)*d.getHeight(),b.beginPath(),b.moveTo(50,e),b.lineTo(60,e),b.stroke(),f=k,b.fillText(f,48,e+3),f=g);b.save();b.translate(5,d.getHeight()/2-50);b.rotate(-Math.PI/2);b.font="14px Arial";b.fillText("height (m)",5,6);b.restore()}};this.drawLegend=function(){var c=d.getLayers()[0],c=d.getLegendGraphicURLForLayer(c);a.find(".legend").html('<img class="legendimg" src="'+c+'&TRANSPARENT=TRUE"/>')};d.addListener("onupdatebbox",
this.updateBBOX,!0);d.setProjection("GFI:TIME_ELEVATION",[(new Date("2016-04-01T00:00:00Z")).getTime(),0,(new Date("2016-04-02T00:00:00Z")).getTime(),15270]);this.updateBBOX(d.getProjection().bbox);this.getWebMapJS=function(){return d}};var WMJSAnimate=function(a){a.animationDelay=100;var c=a.getListener(),d=a.getImageStore(),k=this,b=document.createElement("div");$(b).mouseout(function(){a.mouseHoverAnimationBox=!1});var f=0,n=function(){if(0==a.isAnimating)a.isAnimatingLoopRunning=!1;else if(a.animationTimer.init(50,n),k.checkAnimation(),f--,!(0<f)){var b=a.animationDelay;0==a.currentAnimationStep&&(b*=3);a.currentAnimationStep==a.animationList.length-1&&(b*=5);f=b/50;if(!1===a.mouseHoverAnimationBox){0!=a.isAnimating&&1!=a.animateBusy&&
((b=a.animationList[a.currentAnimationStep])?(a.setDimension(b.name,b.value,!1),c.triggerEvent("ondimchange"),c.triggerEvent("onnextanimationstep",a),a._pdraw(),a.animateBusy=!1):error("No animation step for "+a.currentAnimationStep));b=a.currentAnimationStep+1;b>=a.animationList.length&&(b=0);var d=!1,w=0,p=a.animationList[b];a.setDimension(p.name,p.value,!1);a.animationList[b].requests=a.getWMSRequests();p=a.animationList[a.currentAnimationStep];a.setDimension(p.name,p.value,!1);for(p=0;p<a.animationList[b].requests.length;p++){var q=
a.animationList[b].requests[p];(q=a.getImageStore().getImageForSrc(q))&&q.isLoaded()?w++:f=0}w==a.animationList[b].requests.length&&(d=!0);d&&(a.currentAnimationStep=b)}}};a.isAnimatingLoopRunning=!1;k.checkAnimation=function(){if(0==a.isAnimating)a.isAnimatingLoopRunning=!1;else{a.animationTimer||(a.animationTimer=new WMJSTimer);if(!1===a.mouseHoverAnimationBox){var b=d.getNumImagesLoading();if(2>b&&0<a.animationList.length)for(var c=0;6>c;c++){for(var f=c+a.currentAnimationStep;0>f;)f+=a.animationList.length;
for(;f>=a.animationList.length;)f-=a.animationList.length;0>f&&(f=0);if(0<=f){var k=a.animationList[f];a.setDimension(k.name,k.value,!1);a.animationList[f].requests=a.getWMSRequests();k=a.animationList[a.currentAnimationStep];a.setDimension(k.name,k.value,!1);a.animationList[f].imagesInPrefetch=a.prefetch(a.animationList[f].requests);b+=a.animationList[f].imagesInPrefetch.length;if(1<b)break}}}0==a.isAnimatingLoopRunning&&(a.isAnimatingLoopRunning=!0,n())}};a.stopAnimating=function(){0!=a.isAnimating&&
(b.style.display="none",a.isAnimating=!1,a.animateBusy=!1,a.rebuildMapDimensions(),c.triggerEvent("onstopanimation",a))};a.currentAnimationStep=0;a.animationList=void 0;a.isAnimating=!1;a.setAnimationDelay=function(b){1>b&&(b=1);a.animationDelay=b};b.style.zIndex=1E4;b.style.background="none";b.style.position="absolute";b.style.border="none";b.style.margin="0px";b.style.padding="0px";b.style.lineHeight="14px";b.style.fontFamily='"Courier New", "Lucida Console", Monospace';b.style.fontSize="10px";
a.getBaseElement().append(b)};var WMJSDialog={},WMJSDialogsCreated=0;WMJSDialog.closeAllDialogs=function(a){for(var c=0;c<a.length;c++)a[c].remove()};
WMJSDialog.createDialog=function(a,c,d){WMJSDialogsCreated++;var k=0,b=0,f=!0,n=!0;isDefined(a.id);isDefined(a.show)&&(f=a.show);isDefined(a.x)&&(k=a.x);isDefined(a.y)&&(b=a.y);isDefined(a.autoDestroy)&&(n=a.autoDestroy);var g=jQuery("<div />",{css:{minHeight:"20px",height:180,width:320,zIndex:1E3,border:"1px solid #01405e",borderRadius:"3px",position:"absolute",boxShadow:"0.06rem 0.125rem 0.125rem rgba(0, 0, 0, 0.3)",margin:0,padding:"0px",backgroundColor:"#01547d",display:"inline-block"},mousedown:function(a){a.stopPropagation();
preventdefault_event(a)},mousewheel:function(a){a.stopPropagation()}});f&&g.appendTo(c);g.hasBeenDragged=!1;g.on("drag",function(a,b){g.hasBeenDragged=!0});g.resizable();g.draggable();g.closeDialog=function(){0==n?(g.hide(),g.trigger("hide")):(g.remove(),dialogClosed(g))};g.keyup(function(a){27==a.keyCode&&g.closeDialog()});jQuery("<div/>",{css:{color:"white",fontWeight:"bold",textColor:"white",width:"16px",height:"16px",lineHeight:"14px",margin:"1px",padding:"1px !important",zIndex:1200},click:function(){g.closeDialog()}}).appendTo(g).iconbutton({label:"X"}).addClass("wmjsdialog-closebutton");
var e=jQuery("<div/>",{css:{position:"absolute",right:"0px",top:"18px",background:"#FFF",borderTop:"1px solid #01405e",width:"100%",height:"100%",overflow:"auto",fontSize:"10px",lineHeight:"12px"},mousedown:function(a){a.stopPropagation();preventdefault_event(a)}}).appendTo(g);g.resize(function(){e.css({width:g.width()+"px",height:g.height()-18+"px"})});g.resize();g.setLoading=function(){e.html('<img style="margin-left:10px;margin-top:10px;" src="'+loadingImageSrc+'"/>')};g.setXY=function(a,b){g.hasBeenDragged=
!1;g.css({left:a+"px",top:b+"px"});var c=d.getGeoCoordFromPixelCoord({x:a,y:b});g.geoPosX=c.x;g.geoPosY=c.y;g.x=a;g.y=b};g.setXY(k,b);g.origX=k;g.origY=b;g.setLoading();g.setHTML=function(a){e.html(a)};isDefined(a.dataURL)&&(c=function(a){e.html(a)},MakeHTTPRequest(a.dataURL,c,c));return g};
