'use strict';function Console(a){function c(a){a=(a+"").replace(/&/g,"&amp;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");a=a.replace(/\"/g,"&quot;");return a=a.replace(/\n/g,"<br>")}var f=a,g="";this.println=function(a,d){g=0==d?g+("<p class='stdoutmessage'>"+a+"</p>"):g+("<p class='stdoutmessage'>"+c(a)+"</p>");isDefined(f)&&(f.innerHTML=g,f.scrollTop=f.scrollHeight);17824<g.length&&(g=g.substring(g.length-13368))};this.errprintln=function(a,d){g=0==d?g+("<p class='stderrmessage'>"+a+"</p>"):
g+("<p class='stderrmessage'>"+c(a)+"</p>");isDefined(f)&&(f.innerHTML=g,f.scrollTop=f.scrollHeight)};this.cls=function(){g="";isDefined(f)&&(f.innerHTML=g)};this.setSize=function(a,c){isDefined(f)&&(f.scrollTop=f.scrollHeight,f.style.width=a+"px",f.style.height=c+"px",f.width=a+"px",f.height=c+"px")};this.setElement=function(a){f=a;isDefined(f)&&(f.style.overflow="scroll",f.style.display="inline-block",f.style.position="absolute",f.style.width="100%",f.style.height="100%",f.style.font="normal 12px courier",
f.noWrap=!0,f.style.whiteSpace="nowrap",f.innerHTML=g,f.scrollTop=f.scrollHeight)};this.setElement(a)}function isDefined(a){return"undefined"===typeof a?!1:!0}function isNull(a){return null===a?!0:!1}function toArray(a){if(!a)return[];if(a.length)return a;var c=[];c[0]=a;return c}var WMJSSet=function(){};WMJSSet.prototype.add=function(a){this[a]=!0};WMJSSet.prototype.remove=function(a){delete this[a]};
function WMJSKVP(a){var c=[];this._parse=function(a){var c=[];if(a=a.split("&"))for(var b in a){var d=a[b].split("=");if(2==d.length){var l=d[0],d=d[1];c[l]instanceof Array||(c[l]=[]);c[l].push(d)}}return c};this.getKeys=function(){var a=new WMJSSet;for(key in c)a.add(key);return a};this.getValues=function(a){return c[a]};this.getKeyValues=function(){return c};return c=this._parse(a)}
var preventdefault_event=function(a){a=a||window.event;a.preventDefault?a.preventDefault():a.returnValue=!1},attach_event=function(a,c,f){if("mousewheel"==c){var g=function(a,c){var g=0;a||(a=window.event,window.event.cancelBubble=!0,window.event.returnValue=!1);a.wheelDelta?g=a.wheelDelta/120:a.detail&&(g=-a.detail/3);g&&c(g);a.preventDefault&&a.preventDefault();a.returnValue=!1};a.addEventListener&&a.addEventListener("DOMMouseScroll",function(a){g(a,f)},!1);a.onmousewheel=document.onmousewheel=
function(a){g(a,f)}}else browser.isNS?a.addEventListener(c,f,!0):(a.attachEvent("on"+c,f),void 0!=window.event&&(window.event.cancelBubble=!0,window.event.returnValue=!1))},del_event=function(a,c,f){var g=!0;browser.isOP&&(g=!1);a.removeEventListener?a.removeEventListener(c,f,g):a.detachEvent&&(a.detachEvent(c,f),a.detachEvent("on"+c,f))},getClick_X=function(a){return browser.isNS?a.clientX+window.scrollX:window.event.clientX+document.documentElement.scrollLeft+document.body.scrollLeft},getClick_Y=
function(a){return browser.isNS?a.clientY+window.scrollY:window.event.clientY+document.documentElement.scrollTop+document.body.scrollTop},findElementPos=function(a){for(var c=a,f=curtop=0;a;)f+=a.offsetLeft,curtop+=a.offsetTop,a=a.offsetParent;return[f,curtop,parseInt(c.style.width+f),parseInt(c.style.height+curtop)]};
function Browser(){this.isKonqueror=this.isOP=this.isNS=this.isIE=!1;this.name=navigator.appName;this.version=null;-1!=navigator.userAgent.indexOf("Opera")?this.isOP=!0:"Netscape"==navigator.appName||"Konqueror"==navigator.appName?this.isKonqueror=this.isNS=!0:-1!=navigator.appName.indexOf("Microsoft")&&(this.isIE=!0)}var browser=new Browser;function IsNumeric(a){var c=!0,f;for(i=0;i<a.length&&1==c;i++)f=a.charAt(i),-1=="0123456789.".indexOf(f)&&(c=!1);return c}
function dump(a,c,f){var g="";f||(f="");c||(c=0);if("object"===typeof a)for(var b in a){var d=a[b],l=f;IsNumeric(b)?(b="["+b+"]",l=f.substr(0,f.length-1)+b):l=f+b;g="object"===typeof d?g+dump(d,c+1,l+"."):g+(l+'="'+d+'"<br>\n')}else g="===>"+a+"<===("+typeof a+")";return g}
var Url={encode:function(a){return escape(this._utf8_encode(a))},decode:function(a){alert("Deprecated function !!! WMJSTools line 325 with ["+a+"]");return this._utf8_decode(unescape(a))},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var c="",f=0;f<a.length;f++){var g=a.charCodeAt(f);128>g?c+=String.fromCharCode(g):(127<g&&2048>g?c+=String.fromCharCode(g>>6|192):(c+=String.fromCharCode(g>>12|224),c+=String.fromCharCode(g>>6&63|128)),c+=String.fromCharCode(g&63|128))}return c},_utf8_decode:function(a){for(var c=
"",f=0,g=c1=c2=0;f<a.length;)g=a.charCodeAt(f),128>g?(c+=String.fromCharCode(g),f++):191<g&&224>g?(c2=a.charCodeAt(f+1),c+=String.fromCharCode((g&31)<<6|c2&63),f+=2):(c2=a.charCodeAt(f+1),c3=a.charCodeAt(f+2),c+=String.fromCharCode((g&15)<<12|(c2&63)<<6|c3&63),f+=3);return c}};Array.indexOf||(Array.prototype.indexOf=function(a){for(var c=0;c<this.length;c++)if(this[c]==a)return c;return-1});
function createXHR(){try{return new XMLHttpRequest}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(a){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){}return!1}
function MakeJSONRequest(a,c,f,g,b){function d(a){f?f(a,g):c(void 0,g)}function l(){0==b?(a=requestProxy+"REQUEST="+URLEncode(a),MakeJSONRequest(a,c,f,g,!0)):d("status("+m.status+") to "+a)}a=-1==a.indexOf("?")?a+"?":a+"&";a+="rand="+Math.random();b||(b=!1);try{var m=createXHR();m.open("GET",a,!0);m.onreadystatechange=function(){if(4==m.readyState)if(200==m.status){try{var b=eval("("+m.responseText+")")}catch(f){d("Invalid JSON: '"+m.responseText+"'");return}void 0==b?d("request returned no data:"+
a):c(b,g)}else l()};m.send(null)}catch(e){l()}}
function MakeHTTPRequest(a,c,f,g,b){function d(a){f?f(a,g):c(void 0,g)}function l(){0==b?(a=requestProxy+"REQUEST="+URLEncode(a),MakeHTTPRequest(a,c,f,g,!0)):d("status("+m.status+") to "+a)}a=-1==a.indexOf("?")?a+"?":a+"&";a+="rand="+Math.random();b||(b=!1);try{var m=createXHR();m.open("GET",a,!0);m.onreadystatechange=function(){if(4==m.readyState)if(200==m.status){try{var a=m.responseText}catch(b){d("Exception occured:"+b);return}void 0==a||""==a?d("request returned no data"):c(a,g)}else l()};m.send(null)}catch(e){l()}}
var URLDecode=function(a){if(!isDefined(a))return"";a=a.replaceAll("+"," ");a=a.replaceAll("%2B","+");a=a.replaceAll("%20"," ");a=a.replaceAll("%5E","^");a=a.replaceAll("%26","&");a=a.replaceAll("%3F","?");a=a.replaceAll("%3E",">");a=a.replaceAll("%3C","<");a=a.replaceAll("%5C","\\");a=a.replaceAll("%2F","/");a=a.replaceAll("%25","%");a=a.replaceAll("%3A",":");a=a.replaceAll("%27","'");return a=a.replaceAll("%24","$")},URLEncode=function(a){if(!a||void 0==a||""==a||"string"!==typeof a)return a;a=
a.replace(/\%/g,"%25");a=a.replace(/\+/g,"%2B");a=a.replace(/\ /g,"%20");a=a.replace(/\^/g,"%5E");a=a.replace(/\&/g,"%26");a=a.replace(/\?/g,"%3F");a=a.replace(/\>/g,"%3E");a=a.replace(/\</g,"%3C");a=a.replace(/\\/g,"%5C");for(var c="",f=0;f<a.length;f++){var g=a.charAt(f);if(" "==g)c+="%20";else if(-1!="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz%-_.!~*'()".indexOf(g))c+=g;else{var b=g.charCodeAt(0);255<b?(alert("Unicode Character '"+g+"' cannot be encoded using standard URL encoding.\n(URL encoding only supports 8-bit characters.)\nA space (+) will be substituted."),
c+="+"):(c+="%",c+="0123456789ABCDEF".charAt(b>>4&15),c+="0123456789ABCDEF".charAt(b&15))}}return c};String.prototype.replaceAll=function(a,c){for(var f=this,g=f.indexOf(a);-1!=g;)f=f.replace(a,c),g=f.indexOf(a);return f};String.prototype.trim=function(){var a;a=this.replace(/^\s+/,"");return a=a.replace(/\s+$/,"")};function checkValidInputTokens(a){var c=/^([a-zA-Z'_:~%?\$,\.\0-9 \-=/&])+$/;return c.test(a)&&(a=URLDecode(a),c.test(a))?!0:!1}
function getUrlVars(){for(var a=[],c,f=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),g=0;g<f.length;g++)c=f[g].split("="),c[1]=URLDecode(c[1]),0!=checkValidInputTokens(c[0])&&0!=checkValidInputTokens(c[1])&&(a[c[0]]=c[1]+"");return a}
function getUrlVarsFromHashTag(){var a=[],c;c=window.location.hash.indexOf("#");"?"==window.location.hash[c+1]&&c++;for(var f=window.location.hash.slice(c+1).split("&"),g=0;g<f.length;g++)c=f[g].split("="),c[1]=URLDecode(c[1]),0!=checkValidInputTokens(c[0])&&0!=checkValidInputTokens(c[1])&&(a[c[0]]=c[1]+"");return a}
var composeUrlObjectFromURL=function(a){var c=[];if(!isDefined(a))return c;var f="",g=[],g=a.split("?");1<g.length?(f=g[0],g=g[1].split("&")):g=g[0].split("&");for(a=0;a<g.length;a++)hash=g[a].split("="),isDefined(hash[1])?(hash[1]=URLDecode(hash[1]),0!=checkValidInputTokens(hash[0])&&0!=checkValidInputTokens(hash[1])&&isDefined(hash[1])&&0<hash[1].length&&(c[hash[0].toLowerCase()]=hash[1]+"")):(hash=g[a].split("%3D"),isDefined(hash[1])&&(hash[1]=URLDecode(hash[1]),0!=checkValidInputTokens(hash[0])&&
0!=checkValidInputTokens(hash[1])&&isDefined(hash[1])&&0<hash[1].length&&(c[hash[0].toLowerCase()]=hash[1]+"")));g[0].indexOf("=");return{location:f,kvp:c}},currentLocationHash="",hashTagCheckerInUse=!1,_checkIfHashTagChanged=function(a){var c=window.location.hash;currentLocationHash!=c&&0<c.length&&(currentLocationHash=c,-1!=window.location.href.indexOf("#")&&(c=window.location.href.split("#")[1],c=c.replaceAll("%27","'"),urlVars=getUrlVarsFromHashTag(),isDefined(urlVars.clearhash)&&"1"==urlVars.clearhash&&
(currentLocationHash=window.location.hash=""),a(c,urlVars)));setTimeout(function(){_checkIfHashTagChanged(a)},100)},checkIfHashTagChanged=function(a){isDefined(a)&&(1==hashTagCheckerInUse?alert("checkIfHashTagChanged is in use"):(hashTagCheckerInUse=!0,_checkIfHashTagChanged(a)))},decodeBase64=function(a){var c={},f,g=0,b,d=0,l,m="",e=String.fromCharCode,r=a.length;for(f=0;64>f;f++)c["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f)]=f;for(b=0;b<r;b++)for(f=c[a.charAt(b)],
g=(g<<6)+f,d+=6;8<=d;)((l=g>>>(d-=8)&255)||b<r-2)&&(m+=e(l));return m};function DateInterval(a,c,f,g,b,d){this.year=parseInt(a);this.month=parseInt(c);this.day=parseInt(f);this.hour=parseInt(g);this.minute=parseInt(b);this.second=parseInt(d);this.isRegularInterval=!1;0==this.month&&0==this.year&&(this.isRegularInterval=!0);this.getTime=function(){var a;if(0!=this.month)throw"month != 0";if(0!=this.year)throw"year != 0";a=0+86400*this.day;a+=3600*this.hour;a+=60*this.minute;a+=this.second;return 1E3*a};this.toISO8601=function(){var a="P";0!=this.year&&(a+=this.year+"Y");
0!=this.month&&(a+=this.month+"M");0!=this.day&&(a+=this.day+"D");0!=this.hour&&0!=this.minute&&0!=this.second&&(a+="T");0!=this.hour&&(a+=this.hour+"H");0!=this.minute&&(a+=this.minute+"M");0!=this.second&&(a+=this.second+"S");return a}}
function parseISO8601DateToDate(a){if(a){var c=a.split("T");c[0]=c[0].replace(/-/g,":");c[0]=c[0].replace(/::/g,":-");a=c[0].split(":");var c=c[1].split(":"),f=new Date(Date.UTC(a[0],a[1]-1,a[2],c[0],c[1],c[2].split("Z")[0]));f.add=function(a){0==a.isRegularInterval?(0!=a.year&&this.setUTCFullYear(this.getUTCFullYear()+a.year),0!=a.month&&this.setUTCMonth(this.getUTCMonth()+a.month),0!=a.day&&this.setUTCDate(this.getUTCDate()+a.day),0!=a.hour&&this.setUTCHours(this.getUTCHours()+a.hour),0!=a.minute&&
this.setUTCMinutes(this.getUTCMinutes()+a.minute),0!=a.second&&this.setUTCSeconds(this.getUTCSeconds()+a.second)):this.setTime(this.getTime()+a.getTime())};f.substract=function(a){0==a.isRegularInterval?(0!=a.year&&this.setUTCFullYear(this.getUTCFullYear()-a.year),0!=a.month&&this.setUTCMonth(this.getUTCMonth()-a.month),0!=a.day&&this.setUTCDate(this.getUTCDate()-a.day),0!=a.hour&&this.setUTCHours(this.getUTCHours()-a.hour),0!=a.minute&&this.setUTCMinutes(this.getUTCMinutes()-a.minute),0!=a.second&&
this.setUTCSeconds(this.getUTCSeconds()-a.second)):this.setTime(this.getTime()-a.getTime())};f.addMultipleTimes=function(a,b){0==a.isRegularInterval?(0!=a.year&&this.setUTCFullYear(this.getUTCFullYear()+a.year*b),0!=a.month&&this.setUTCMonth(this.getUTCMonth()+a.month*b),0!=a.day&&this.setUTCDate(this.getUTCDate()+a.day*b),0!=a.hour&&this.setUTCHours(this.getUTCHours()+a.hour*b),0!=a.minute&&this.setUTCMinutes(this.getUTCMinutes()+a.minute*b),0!=a.second&&this.setUTCSeconds(this.getUTCSeconds()+a.second*
b)):this.setTime(this.getTime()+a.getTime()*b)};f.substractMultipleTimes=function(a,b){0==a.isRegularInterval?(0!=a.year&&this.setUTCFullYear(this.getUTCFullYear()-a.year*b),0!=a.month&&this.setUTCMonth(this.getUTCMonth()-a.month*b),0!=a.day&&this.setUTCDate(this.getUTCDate()-a.day*b),0!=a.hour&&this.setUTCHours(this.getUTCHours()-a.hour*b),0!=a.minute&&this.setUTCMinutes(this.getUTCMinutes()-a.minute*b),0!=a.second&&this.setUTCSeconds(this.getUTCSeconds()-a.second*b)):this.setTime(this.getTime()-
a.getTime()*b)};f.toISO8601=function(){function a(b,c){var f=b+"",m=c-f.length,e,g="";for(e=0;e<m;e++)g+="0"+g;return g+f}return a(this.getUTCFullYear(),4)+"-"+a(this.getUTCMonth()+1,2)+"-"+a(this.getUTCDate(),2)+"T"+a(this.getUTCHours(),2)+":"+a(this.getUTCMinutes(),2)+":"+a(this.getUTCSeconds(),2)+"Z"};f.clone=function(){return parseISO8601DateToDate(f.toISO8601())};return f}console.log("Warning: no date given to parseISO8601DateToDate")}
function parseISO8601IntervalToDateInterval(a){if("P"==a.charAt(0)){var c=a.split("T"),f=a=0,g=0,b=0;seconds=minutes=0;var d=c[0].split("P")[1];if(d){var l=d.indexOf("Y"),m=d.indexOf("M"),e=d.indexOf("D");-1!=l&&(a=d.substring(0,l));-1!=m&&(f=d.substring(l+1,m));-1!=e&&(-1!=m&&(l=m),g=d.substring(l+1,e))}0<c.length&&isDefined(c[1])&&(c=c[1])&&(l=c.indexOf("H"),d=c.indexOf("M"),m=c.indexOf("S"),-1!=l&&(b=c.substring(0,l)),-1!=d&&(minutes=c.substring(l+1,d)),-1!=m&&(-1!=d&&(l=d),seconds=c.substring(l+
1,m)));return new DateInterval(a,f,g,b,minutes,seconds)}}function getNumberOfTimeSteps(a,c,f){var g=0;if(0!=f.month||0!=f.year){a=a.clone();for(c=c.getTime();a.getTime()<c;)a.add(f),g++;g++}else g=parseInt((c.getTime()-a.getTime())/f.getTime()+.5)+1;return g}
function parseISOTimeRangeDuration(a){a=a.split("/");void 0==a[2]&&(a[2]="PT1M");void 0==a[1]&&(a[1]=a[0],a[2]="PT1M");this.startTime=parseISO8601DateToDate(a[0]);this.stopTime=parseISO8601DateToDate(a[1]);this.timeInterval=parseISO8601IntervalToDateInterval(a[2]);this.timeSteps=getNumberOfTimeSteps(this.startTime,this.stopTime,this.timeInterval);this.getTimeSteps=function(){return this.timeSteps};this.getDateAtTimeStep=function(a){if(0==this.timeInterval.isRegularInterval){var f=this.startTime.clone();
f.addMultipleTimes(this.timeInterval,a)}else{var f=this.startTime.clone(),g=this.timeInterval.getTime(),g=g*a;f.setTime(f.getTime()+g)}return f};this.getTimeStepFromISODate=function(a,f){try{currentDate=parseISO8601DateToDate(a)}catch(g){throw"The date '"+a+"' is not a valid date";}return this.getTimeStepFromDate(currentDate,f)};this.getTimeStepFromDate=function(a,f){f||(f=!1);var g=a.getTime();if(g<this.startTime.getTime()){if(1==f)throw 0;return 0}var b=this.stopTime.clone();b.add(this.timeInterval);
if(g>b.getTime()){if(1==f)throw this.timeSteps-1;return this.timeSteps-1}if(g>this.stopTime.getTime())return this.timeSteps-1;b=0;if(0==this.timeInterval.isRegularInterval){b=this.startTime.clone();for(j=0;j<this.timeSteps;j++){var d=b.getTime();b.add(this.timeInterval);var l=b.getTime();if(g>=d&&g<l)return j}throw"Date "+a.toISO8601()+" not found!";}b=(a.getTime()-this.startTime.getTime())/this.timeInterval.getTime();return b=parseInt(b);throw"Date "+a.toISO8601()+" not found";};this.getTimeStepFromDate_WithinRange=
function(a){return this.getTimeStepFromDate(a,!0)};this.getTimeStepFromDate_Clipped=function(a){return this.getTimeStepFromDate(a,!1)}}function getCurrentDateIso8601(){return parseISO8601DateToDate((new Date).toISOString().substring(0,19)+"Z")};Proj4js.defs["EPSG:3575"]="+proj=laea +lat_0=90 +lon_0=10 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs";Proj4js.defs["EPSG:3785"]="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs";Proj4js.defs["EPSG:3857"]="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs";Proj4js.defs["EPSG:3411"]="+proj=stere +lat_0=90 +lat_ts=70 +lon_0=-45 +k=1 +x_0=0 +y_0=0 +a=6378273 +b=6356889.449 +units=m +no_defs";
Proj4js.defs["EPSG:3412"]="+proj=stere +lat_0=-90 +lat_ts=-70 +lon_0=0 +k=1 +x_0=0 +y_0=0 +a=6378273 +b=6356889.449 +units=m +no_defs";Proj4js.defs["EPSG:4326"]="+proj=longlat +datum=WGS84 +no_defs";Proj4js.defs["EPSG:28992"]="+proj=sterea +lat_0=52.15616055555555 +lon_0=5.38763888888889 +k=0.9999079 +x_0=155000 +y_0=463000 +ellps=bessel +units=m +no_defs  <>";Proj4js.defs["EPSG:32661"]="+proj=stere +lat_0=90 +lat_ts=90 +lon_0=0 +k=0.994 +x_0=2000000 +y_0=2000000 +ellps=WGS84 +datum=WGS84 +units=m +no_defs";
Proj4js.defs["EPSG:102100"]=Proj4js.defs["EPSG:3857"];var epsgDescriptionLookup=[];epsgDescriptionLookup["EPSG:3411"]="NSIDC Sea Ice Polar Stereographic North";epsgDescriptionLookup["EPSG:3412"]="NSIDC Sea Ice Polar Stereographic South";epsgDescriptionLookup["EPSG:3575"]="Lambert azimuthal equal-area projection Europe";epsgDescriptionLookup["EPSG:3785"]="Mercator (deprecated)";epsgDescriptionLookup["EPSG:3857"]="Mercator";epsgDescriptionLookup["EPSG:4258"]="ETRS89";
epsgDescriptionLookup["EPSG:4326"]="World Lat lon WGS84";epsgDescriptionLookup["CRS:84"]="World Lat lon WGS84";epsgDescriptionLookup["EPSG:25831"]="ETRS89 / UTM zone 31N";epsgDescriptionLookup["EPSG:25832"]="ETRS89 / UTM zone 32N";epsgDescriptionLookup["EPSG:28992"]="Dutch Amersfoort / RD New";epsgDescriptionLookup["EPSG:32661"]="Polar Stereographic WGS 84 / UPS North";$.widget("ui.iconbutton",$.extend({},$.ui.button.prototype,{_init:function(){$.ui.button.prototype._init.call(this);this.element.removeClass("ui-corner-all").addClass("ui-iconbutton").unbind(".button")}}));var WMJSTileRenderer=function(a,c,f,g,b,d,l,m,e){if(e){"streetmap"===e&&(e="OSM");"pdok"===e&&(e="OSM");"naturalearth2"===e&&(e="NaturalEarth2");var r=m[e];if(r){var n=r[f];if(!n)for(var q in m)if(m.hasOwnProperty(q))for(var u in m[q])m[q].hasOwnProperty(u)&&u===f&&(console.log("Projection not supported by tileserver: Falling back to ",q,u),n=m[q][u]);m=Math.PI;var E=256,z=12756274*m/E,C=-12756274*m/2,t=12756274*m/2;n.tileSize&&(E=n.tileSize);n.resolution&&(z=n.resolution);n.origX&&(C=n.origX);n.origY&&
(t=n.origY);m=z*E+C;var K=t-z*E,F=m-C,T=t-K;(function(e){var m=n.home,r=n.tileServerType;e<n.minLevel&&(e=n.minLevel);e>n.maxLevel&&(e=n.maxLevel);var q=Math.pow(2,e),w=F/(z/q*E),u=T/(z/q*E),q=parseInt(Math.round((a.left-C)/F*w/1+.5)),Q=parseInt(Math.round((a.right-C)/F*w/1+.5)),p=parseInt(Math.round(u-(a.bottom-K)/T*u+.5)),D=parseInt(Math.round(u-(a.top-K)/T*u+.5)),ea=function(a,b,c){a=z/Math.pow(2,a);return{x:b*a+C,y:t-c*a}},pa=function(a,b,c,e){e=e*(a.y-b.top)/(b.bottom-b.top);return{x:parseFloat(c*
(a.x-b.left)/(b.right-b.left)),y:parseFloat(e)}},O=function(a,e,d,f){var k,n,q,z;q=ea(e,d*E,f*E);z=ea(e,(d+1)*E,(f+1)*E);k=q.x;n=q.y;q=z.x;z=z.y;k=pa({x:k,y:n},c,g,b);q=pa({x:q,y:z},c,g,b);n=void 0;"osm"===r&&(n=m+e+"/"+d+"/"+f+".png");if("arcgisonline"===r||"wmst"===r)n=m+e+"/"+f+"/"+d;e=l.getImage(n);!1===e.isLoaded()&&!1===e.hasError()&&!1===e.isLoading()&&e.load();if(e.isLoaded())try{a.drawImage(e.getElement()[0],parseInt(k.x),parseInt(k.y),parseInt(q.x-k.x)+1,parseInt(q.y-k.y)+1)}catch(O){}};
if("EPSG:4326"===f||"EPSG:4258"===f)w*=2;1>D&&(D=1);D>u&&(D=u);1>q&&(q=1);q>w&&(q=w);1>p&&(p=1);p>u&&(p=u);1>Q&&(Q=1);Q>w&&(Q=w);if(!(10<p-D||10<Q-q))for(w=D-1;w<p;w++)for(u=q-1;u<Q;u++)O(d,e,u,w)})(parseInt(Math.log(Math.abs(m-C)/((a.right-a.left)/g*E))/Math.log(2)))}else console.error("Tiled layer with name "+e+" not found")}else console.error("layerName not defined")},WMJSTileRendererTileSettings={arcGisCanvas:{"EPSG:3857":{home:"http://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/",
minLevel:1,maxLevel:16,tileServerType:"arcgisonline",copyRight:"Basemap copyright: 2013 Esri, DeLorme, NAVTEQ"},"EPSG:28992":{home:"http://services.arcgisonline.nl/arcgis/rest/services/Basiskaarten/Canvas/MapServer/tile/",minLevel:1,maxLevel:12,origX:-285401.92,origY:903401.92,resolution:3440.64,tileServerType:"arcgisonline",copyRight:"Basiskaart bronnen: Esri Nederland, Esri, Kadaster, CBS en Rijkswaterstaat"}},arcGisTopo:{"EPSG:3857":{home:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/",
minLevel:1,maxLevel:19,tileServerType:"arcgisonline",copyRight:"Basemap sources: Esri, DeLorme, NAVTEQ, TomTom, Intermap, increment P Corp., GEBCO, USGS, FAO, NPS, NRCAN, GeoBase, IGN, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community"},"EPSG:28992":{home:"http://services.arcgisonline.nl/arcgis/rest/services/Basiskaarten/Topo/MapServer/tile/",minLevel:1,maxLevel:12,origX:-285401.92,origY:903401.92,resolution:3440.64,tileServerType:"arcgisonline",copyRight:"Basiskaart bronnen: Esri Nederland, Esri, Kadaster, CBS, Min VROM, Rijkswaterstaat en gemeenten: Rotterdam, Breda, Tilburg"}},
arcGisOceanBaseMap:{home:"http://services.arcgisonline.com/ArcGIS/rest/services/Ocean_Basemap/MapServer/tile/",minLevel:1,maxLevel:19,tileServerType:"arcgisonline",copyRight:"Basemap sources: Esri, GEBCO, NOAA, National Geographic, DeLorme, NAVTEQ, Geonames.org, and other contributors"},arcGisSat:{"EPSG:4326":{home:"http://services.arcgisonline.com/ArcGIS/rest/services/ESRI_Imagery_World_2D/MapServer/tile/",minLevel:1,maxLevel:15,tileServerType:"arcgisonline",origX:-180,origY:90,resolution:.3515625,
tileSize:512},"EPSG:3857":{home:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/",minLevel:1,maxLevel:18,tileServerType:"arcgisonline"}},OSM:{"EPSG:3857":{home:"http://b.tile.openstreetmap.org/",minLevel:1,maxLevel:16,tileServerType:"osm"},"EPSG:28992":{home:"http://services.arcgisonline.nl/ArcGIS/rest/services/Basiskaarten/PDOK_BRT/MapServer/tile/",minLevel:1,maxLevel:12,origX:-285401.92,origY:903401.92,resolution:3440.64,tileServerType:"arcgisonline",copyRight:"Basiskaart bronnen: PDOK, Kadaster, OpenStreetMap"}},
NaturalEarth2:{"EPSG:3411":{home:"http://geoservices.knmi.nl/tiledbasemaps/NaturalEarth2/EPSG3411/",minLevel:1,maxLevel:6,origX:-124E5,origY:124E5,resolution:96875,tileServerType:"wmst",copyRight:"NPS - Natural Earth II"},"EPSG:3412":{home:"http://geoservices.knmi.nl/tiledbasemaps/NaturalEarth2/EPSG3412/",minLevel:1,maxLevel:6,origX:-124E5,origY:124E5,resolution:96875,tileServerType:"wmst",copyRight:"NPS - Natural Earth II"},"EPSG:3575":{home:"http://geoservices.knmi.nl/tiledbasemaps/NaturalEarth2/EPSG3575/",
minLevel:1,maxLevel:6,origX:-13E6,origY:13E6,resolution:101562.5,tileServerType:"wmst",copyRight:"NPS - Natural Earth II"},"EPSG:3857":{home:"http://geoservices.knmi.nl/tiledbasemaps/NaturalEarth2/EPSG3857/",minLevel:1,maxLevel:7,tileServerType:"wmst",copyRight:"NPS - Natural Earth II"},"EPSG:4258":{home:"http://geoservices.knmi.nl/tiledbasemaps/NaturalEarth2/EPSG4326/",minLevel:1,maxLevel:6,origX:-180,origY:90,resolution:.703125,tileServerType:"wmst",copyRight:"NPS - Natural Earth II"},"EPSG:4326":{home:"http://geoservices.knmi.nl/tiledbasemaps/NaturalEarth2/EPSG4326/",
minLevel:1,maxLevel:6,origX:-180,origY:90,resolution:.703125,tileServerType:"wmst",copyRight:"NPS - Natural Earth II"},"EPSG:28992":{home:"http://geoservices.knmi.nl/tiledbasemaps/NaturalEarth2/EPSG28992/",minLevel:1,maxLevel:5,origX:-2999E3,origY:2995500,resolution:23437,tileServerType:"wmst",copyRight:"NPS - Natural Earth II"},"EPSG:32661":{home:"http://geoservices.knmi.nl/tiledbasemaps/NaturalEarth2/EPSG32661/",minLevel:1,maxLevel:7,origX:-5E6,origY:4E6,resolution:58593.75,tileServerType:"wmst",
copyRight:"NPS - Natural Earth II"},"EPSG:54030":{home:"http://geoservices.knmi.nl/tiledbasemaps/NaturalEarth2/EPSG54030/",minLevel:1,maxLevel:7,origX:-17E6,origY:8625830,resolution:132812.5,tileServerType:"wmst",copyRight:"NPS - Natural Earth II"}}};var WMJSImageStore=function(a,c,f){this.imagesbysrc={};var g=this.imageLife=0,b=this,d=[],l=function(a){for(var b=0;b<d.length;b++)d[b](a)};b.getImageForSrc=function(a){if(b.imagesbysrc[a])return b.imagesbysrc[a]};b.clear=function(){for(var a in b.imagesbysrc)b.imagesbysrc.hasOwnProperty(a)&&b.imagesbysrc[a].clear()};b.addLoadEventCallback=function(a){d.push(a)};b.getNumImagesLoading=function(){var a=0,c;for(c in b.imagesbysrc)b.imagesbysrc.hasOwnProperty(c)&&b.imagesbysrc[c].isLoading()&&a++;return a};
b.getImage=function(d){var e=b.getImageForSrc(d);if(void 0!==e)return e.imageLife=g++,e;var r;e=b.imagesbysrc;if(Object.keys)r=Object.keys(e);else{var n=[];for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.push(r);r=n}if(r.length<a)return e=new WMJSImage(d,l,c,f),e.setSource(d),e.KVP=WMJSKVP(d),b.imagesbysrc[d]=e,e.imageLife=g++,e;r=-1;var e=g,q;for(q in b.imagesbysrc)b.imagesbysrc.hasOwnProperty(q)&&(n=b.imagesbysrc[q],!1===n.isLoading()&&!0===n.isLoaded()&&e>=n.imageLife&&(e=n.imageLife,r=
q));console.log("Reusing image "+r+" with lifetime "+e);if(-1===r)console.error("not enough cache for "+c);else return e=b.imagesbysrc[r],delete b.imagesbysrc[r],e.clear(),e.setSource(d),e.KVP=WMJSKVP(d),b.imagesbysrc[d]=e,e.imageLife=g++,e}};var WebMapJSMapNo=0,logging=!1,base="./",noimage,loadingImageSrc,WMSControlsImageSrc,mapPinImageSrc,scaleBarURL,enableConsoleDebugging=!1,enableConsoleErrors=!1,debug=function(a){enableConsoleDebugging&&console.log(a)},error=function(a){enableConsoleErrors&&console.log("WebMapJS warning: ",a)},WMJScheckURL=function(a){if(!isDefined(a))return"?";a=a.trim();-1==a.indexOf("?")&&(a+="?");return a};function WMJSProjection(){this.bbox=new WMJSBBOX;this.srs="EPSG:4326"}
var legendImageStore,getMapImageStore,bgMapImageStore,maxAnimationSteps=1E3;legendImageStore=new WMJSImageStore(5*maxAnimationSteps,"wmjslegendbuffer");getMapImageStore=new WMJSImageStore(5*maxAnimationSteps,"wmjsimagebuffer");bgMapImageStore=new WMJSImageStore(5E3,"wmjsimagebuffer",{randomizer:!1});
function WMJSMap(a,c){var f,g,b,d;function l(a){function v(b){b.currentTarget.removeEventListener("load",v,!1);c(a)}function b(v){(v=(v||event).srcElement)&&/^(complete|loaded)$/i.test(v.readyState)&&(v.detachEvent("onreadystatechange",b),c(a))}function c(a){1!=a.loadEventDone&&(a.loadEventDone=!0,a.loadEvent&&a.loadEvent(a))}a.style.left="0px";a.style.top="0px";a.loadEventDone=!1;a.failed=!1;a.addEventListener?a.addEventListener("load",v,!1):a.attachEvent("onreadystatechange",b);a.onerror=function(){a.src&&
a.src!=noimage&&(error(a.src),a.failed=!0,a.loadEvent&&a.loadEvent(a))}}function m(a){if(a){for(var v=0;v<t.length;v++)if(t[v]==a)return v;return-1}}function e(a){if(isDefined(a.name)&&(a.format||(a.format="image/png",error("layer format missing!")),!(1>a.name.length))){if("GFI:TIME_ELEVATION"==q){var v=a.getmapURL,v=v+("&SERVICE=WMS&REQUEST=GetFeatureInfo&VERSION="+a.version),v=v+("&LAYERS="+URLEncode(a.name)),b=a.name.split(","),v=v+("&QUERY_LAYERS="+URLEncode(b[b.length-1])),v=v+"&BBOX=29109.947643979103,6500000,1190890.052356021,7200000"+
("&CRS="+URLEncode("EPSG:3857")+"&"),v=v+("WIDTH="+z),v=v+("&HEIGHT="+C);if(a.version==WMSVersion.version100||a.version==WMSVersion.version111)v+="&X=707",v+="&Y=557";a.version==WMSVersion.version130&&(v+="&I=707",v+="&J=557");v+="&FORMAT=image/gif";v+="&INFO_FORMAT=image/png";v+="&STYLES=";a=k.dateToISO8601(new Date(p.left));b=k.dateToISO8601(new Date(p.right));v+="&time="+a+"/"+b;return v+="&elevation="+p.bottom+"/"+p.top}v=a.getmapURL;v+="&SERVICE=WMS&";v+="VERSION="+a.version+"&";v+="REQUEST=GetMap&";
v+="LAYERS="+URLEncode(a.name)+"&";v+="WIDTH="+z+"&";v+="HEIGHT="+C+"&";v+=k.getBBOXandProjString(a);v+="STYLES="+URLEncode(a.currentStyle)+"&";v+="FORMAT="+a.format+"&";v=!0===a.transparent?v+"TRANSPARENT=TRUE&":v+"TRANSPARENT=FALSE&";try{v+=qa(a)}catch(c){return}return v+=a.wmsextensions.url}}function r(){n.mousedown(k.mouseDownEvent);n.mousewheel(k.mouseWheelEvent);attach_event(document,"mouseup",k.mouseUpEvent);attach_event(document,"mousemove",k.mouseMoveEvent);if(k.isTouchDevice()){k.enableInlineGetFeatureInfo(!1);
var a=new Hammer.Manager(document.body);a.add(new Hammer.Pan);a.add(new Hammer.Pinch);a.get("pan").set({direction:Hammer.DIRECTION_ALL});a.add(new Hammer.Swipe).recognizeWith(a.get("pan"));a.on("panstart",function(a){a.preventDefault();k.mouseDown(a.center.x,a.center.y,a)});a.on("panmove",function(a){a.preventDefault();k.mouseMove(a.center.x,a.center.y,a)});a.on("panend",function(a){a.preventDefault();k.mouseUp(a.center.x,a.center.y,a)});a.on("pinchstart",function(a){a.preventDefault();k.pinchStart(a.center.x,
a.center.y,a)});a.on("pinchmove",function(a){a.preventDefault();k.pinchMove(a.center.x,a.center.y,a)});a.on("pinchend",function(a){a.preventDefault();k.pinchEnd(a.center.x,a.center.y,a)});k.hideControls()}k.setMapModePan()}this.setBaseURL=function(a){base=a;noimage=base+"/img/blank.gif?";loadingImageSrc=base+"/img/ajax-loader.gif";WMSControlsImageSrc=base+"/img/mapcontrols.gif";mapPinImageSrc=base+"/img/dot.gif";isDefined(scaleBarURL)||(scaleBarURL=base+"/php/makeScaleBar.php?")};this.setBaseURL(base);
this.setXML2JSONURL=function(a){xml2jsonrequest=a};try{isDefined(c)&&(xml2jsonrequestURL=c)}catch(ca){xml2jsonrequestURL=base+"/php/xml2jsonrequest.php?"}try{isDefined(requestProxy)}catch(ca){requestProxy=base+"/php/MakeRequest.php?"}try{isDefined(scaleBarURL)}catch(ca){scaleBarURL=base+"/php/makeScaleBar.php?"}var n,q,u=new WMJSBBOX,E=new WMJSBBOX,z=2,C=2,t=[],K=[],F="",T=0,k=this;k.renderer="WMJSCanvasBuffer";var fa=!1,G=document.createElement("div"),A=document.createElement("div"),w=document.createElement("div"),
ba=document.createElement("div"),Q=!0,p=new WMJSBBOX,D=new WMJSBBOX,ea=new WMJSBBOX,pa=new WMJSBBOX,O=new WMJSBBOX,S=[];k.getLegendStore=function(){return legendImageStore};var J=[],oa=!1,Ya="default",Ba=!1,Ja="default",Za=!1,Ka=$('<div class="WMJSDivBuffer-loading"/>',{}),$a=0,da=0,ia=1,Ca,ra=0,V=0,Ma=0,Na=0,X=Array(3),Oa=Array(3);for(j=0;3>j;j++)X[j]=new WMJSProjection,Oa[j]=new WMJSProjection;var ab=!0,B=new WMJSListener;this.getGraphingData=function(){return this.graphingData};this.setGraphingData=
function(a){this.graphingData=a};var ga=function(ca){a.id||(a.id="WebMapJSMapNo_"+WebMapJSMapNo,WebMapJSMapNo++);return a.id+"_"+ca};this.enableInlineGetFeatureInfo=function(a){ab=a};this.closeAllGFIDialogs=function(){WMJSDialog.closeAllDialogs(U)};var U=[],bb=function(){enableConsoleDebugging&&console.log("onlegendready called");ja()},sa=[],Da=0,ta=!1,ja=function(a){if(!(2>S.length)){try{0==isDefined(a)&&(a=!1);if(1==ta&&isDefined(bb)){1==B.addToCallback("onlegendready",bb)&&enableConsoleDebugging&&
console.log("Suspending on onlegendready");return}ta=!0;if(1==Q){if(sa.length!=t.length)a=!0;else for(var b=0;b<t.length;b++){var c=k.getLegendGraphicURLForLayer(t[b]);isDefined(c)&&sa[b]!==c&&(sa[b]=c,a=!0)}if(a){sa=[];for(b=0;b<t.length;b++)!1!==t[b].enabled&&(c=k.getLegendGraphicURLForLayer(t[b]),isDefined(c)&&(sa[b]=c,S[Da].setSrc(b,c)));var e=Da;Da=1-Da;try{S[e].load(function(){enableConsoleDebugging&&console.log("Legend buffer nr"+e);try{for(var a=0,ca=0;ca<S[e].layers.length;ca++){S[e].layers[ca].getElement();
var b=S[e].layers[ca].getElement()[0].height;a<b&&(a=b)}S[e].display();S[1-e].hide()}catch(v){console.error(v)}ta=!1;B.triggerEvent("onlegendready")})}catch(d){console.error(d),S[0].hide(),S[1].hide(),ta=!1,B.triggerEvent("onlegendready")}return}}else S[0].hide(),S[1].hide()}catch(d){console.log(d)}ta=!1;B.triggerEvent("onlegendready")}},Pa="",Qa="";this.setMessage=function(a){Qa=a&&""!==a?a:""};this.setTimeOffset=function(a){Pa=a&&""!==a?a:""};this.getCapabilitiesJSON=function(a,b){WMJSGetCapabilities(a,
!0,b,function(a){error(a);b(a)})};this.rebuildMapDimensions=function(){for(var a=0;a<K.length;a++)K[a].used=!1;for(i=0;i<t.length;i++)for(a=0;a<t[i].dimensions.length;a++){var b=t[i].dimensions[a],c=k.getDimension(b.name);isDefined(c)?c.used=!0:(b=b.clone(),b.used=!0,K.push(b))}for(a=0;a<K.length;a++)0==K[a].used&&(K.splice(a,1),a--);B.triggerEvent("onmapdimupdate")};this.getLayerByServiceAndName=function(a,b){for(var c=0;c<t.length;c++){var e=t[t.length-c-1];if(e.name==b&&e.service==a)return e}};
this.getLayers=function(){for(var a=[],b=0;b<t.length;b++)a.push(t[t.length-b-1]);return a};this.setLayer=function(a,b){return k.addLayer(a,b,a)};this.setActive=function(a){Za=a};this.setActiveLayer=function(a){Ca=a;ja();B.triggerEvent("onchangeactivelayer")};this.calculateNumBaseLayers=function(){T=0;if(F)for(var a=0;a<F.length;a++)F[a].enabled&&0==F[a].keepOnTop&&T++};this.enableLayer=function(a){a.enabled=!0;k.calculateNumBaseLayers();k.rebuildMapDimensions();ja(!0)};this.disableLayer=function(a){a.enabled=
!1;k.calculateNumBaseLayers();k.rebuildMapDimensions();ja(!0)};this.toggleLayer=function(a){a.enabled=1==a.enabled?!1:!0;k.calculateNumBaseLayers();k.rebuildMapDimensions();ja(!0)};this.displayLayer=function(a,b){a.enabled=b;k.calculateNumBaseLayers();k.rebuildMapDimensions();ja(!0)};this.removeAllLayers=function(){for(var a=0;a<t.length;++a)t[a].setAutoUpdate(!1);t=[];K=[];B.triggerEvent("onlayeradd")};this.deleteLayer=function(a){if(!(0>=t.length)){a.setAutoUpdate(!1);a=m(a);if(0<=a){for(var b=
a;b<t.length-1;b++)t[b]=t[b+1];t.length--;Ca=void 0;0<=a&&a<t.length?(k.rebuildMapDimensions(),k.setActiveLayer(t[a])):0<t.length&&(k.rebuildMapDimensions(),k.setActiveLayer(t[t.length-1]))}B.triggerEvent("onlayerchange");k.rebuildMapDimensions()}};this.moveLayerDown=function(a){var b=m(a);if(0<b){a=t[b-1];var c=t[b];a&&c&&(t[b]=a,t[b-1]=c)}else try{error("moveLayerDown: layer '"+a.name+"' not found.")}catch(e){error("moveLayerDown: layer invalid.")}};this.moveLayerUp=function(a){var b=m(a);if(b<
t.length-1){a=t[b+1];var c=t[b];a&&c&&(t[b]=a,t[b+1]=c)}else try{error("moveLayerUp: layer '"+a.name+"' not found.")}catch(e){error("moveLayerUp: layer invalid.")}};this.addLayer=function(a){isDefined(a)&&(a.parentMaps.push(k),t.push(a),a.parseLayer(function(a){for(var b=0;b<a.dimensions.length;b++){var c=k.getDimension(a.dimensions[b].name);isDefined(c)&&isDefined(c.currentValue)&&1==a.dimensions[b].linked&&a.dimensions[b].setClosestValue(c.currentValue)}k.rebuildMapDimensions();B.triggerEvent("onlayeradd")},
void 0,"WMJSLayer::addLayer"))};this.getActiveLayer=function(){return Ca};this.setProjection=function(a,b){k.hideMapPin();a||(a="EPSG:4326");"object"===typeof a&&(b=a.bbox,a=a.srs);q=a;k.proj4.srs==q&&isDefined(this.proj4.projection)||(k.proj4.projection=new Proj4js.Proj(q),k.proj4.srs=q);k.setBBOX(b);E.setBBOX(b);k.updateMouseCursorCoordinates();B.triggerEvent("onsetprojection",[q,p])};this.getBBOX=function(){return p};this.getProjection=function(a){return{srs:q,bbox:p}};this.getSize=function(){return{width:z,
height:C}};this.getWidth=function(){return z};this.getHeight=function(){return C};this.repositionLegendGraphic=function(a){Q?ja(a):(S[0].hide(),S[1].hide())};this.resizeHeight=this.resizeWidth=-1;this.setSize=function(a,b){enableConsoleDebugging&&console.log("setSize",a,b);4>parseInt(a)||4>parseInt(b)?console.log("Skipping setSize",a,b):(this.resizeWidth=a,this.resizeHeight=b,this.resizeTimer?this.resizeTimer.reset():(this.resizeTimer=new WMJSTimer,this.resizeTimer.init(200,function(){k._setSize(k.resizeWidth|
0,k.resizeHeight|0);k.resizeTimer=null;k.draw("resizeTimer")})))};this._setSize=function(b,c){if(b&&c&&!(4>parseInt(b)||4>parseInt(c))){enableConsoleDebugging&&console.log("setSize("+b+","+c+")");var e=this.getProjection();z=parseInt(b);C=parseInt(c);if(4>z||isNaN(z))z=4;if(4>C||isNaN(C))C=4;e.srs&&e.bbox||(error("this.setSize: Setting default projection (EPSG:4326 with (-180,-90,180,90)"),e.srs="EPSG:4326",e.bbox.left=-180,e.bbox.bottom=-90,e.bbox.right=180,e.bbox.top=90,k.setProjection(e.srs,e.bbox));
n.css({width:z,height:C});a.style.width=z+"px";a.style.height=C+"px";k.setBBOX(u);k.repositionMapPin();k.showBoundingBox();1<J.length&&(J[0].resize(k.getWidth(),k.getHeight()),J[1].resize(k.getWidth(),k.getHeight()));1<S.length&&(S[0].resize(k.getWidth(),k.getHeight()),S[1].resize(k.getWidth(),k.getHeight()));k.repositionLegendGraphic(!0);J[ia]&&J[ia].display();B.triggerEvent("onresize",[z,C])}};this.getBBOXandProjString=function(a){var b="";if(a.version==WMSVersion.version100||a.version==WMSVersion.version111)b+=
"SRS="+URLEncode(q)+"&",b+="BBOX="+p.left+","+p.bottom+","+p.right+","+p.top+"&";a.version==WMSVersion.version130&&(b+="CRS="+URLEncode(q)+"&",b="EPSG:4326"==q&&0==a.wms130bboxcompatibilitymode?b+("BBOX="+p.bottom+","+p.left+","+p.top+","+p.right+"&"):b+("BBOX="+p.left+","+p.bottom+","+p.right+","+p.top+"&"));return b};this.isTouchDevice=function(){return"undefined"!==typeof window.ontouchstart};this.getDimensionRequestString=function(a){return qa(a)};this.dateToISO8601=function(a){function b(a,c){var e=
a+"",ca=c-e.length,v,d="";for(v=0;v<ca;v++)d+="0"+d;return d+e}return b(a.getUTCFullYear(),4)+"-"+b(a.getUTCMonth()+1,2)+"-"+b(a.getUTCDate(),2)+"T"+b(a.getUTCHours(),2)+":"+b(a.getUTCMinutes(),2)+":"+b(a.getUTCSeconds(),2)+"Z"};this.abort=function(){B.triggerEvent("onmapready");fa=!1;B.triggerEvent("onloadingcomplete")};this.isBusy=function(){return fa||0==J[0].ready||0==J[1].ready?!0:!1};this.getLegendGraphicURLForLayer=function(a){if(a){var b=a.legendGraphic;if(b){b+="&layers="+URLEncode(a.name)+
"&";try{1==a.legendIsDimensionDependant&&(b+=k.getDimensionRequestString(a)+"&")}catch(c){return}return b=b+"&transparent=true&width=90&height=250&"+a.wmsextensions.url}}};var Ra=!0;this.showScaleBar=function(){Ra=!0;console.log("todo showScaleBar")};this.hideScaleBar=function(){Ra=!1;console.log("todo hideScaleBar")};this.getMaxNumberOfAnimations=function(){return maxAnimationSteps};this.drawAutomatic=function(a,b){if(0!==t.length){for(var c=a.format("YYYY-MM-DDTHH:mm:ss"),e=[],d=0;moment(c)<b&&
1E3>d;){d++;for(var f=null,k=t.length-1;0<=k;k--){var g=t[k].getDimension("time");g&&(g=g.getNextClosestValue(c))&&"date too early"!==g&&(null===f||moment(g)<moment(f))&&(f=g)}if(null===f)break;e.push({name:"time",value:f});c=f}if(0<e.length)e.pop(),this.draw(e);else if(c=t[0].getDimension("time")){e=c.size();f=Math.min(c.size(),100);d=[];for(f=e-f;f<e;++f)d.push({name:c.name,value:c.getValueForIndex(f)});this.draw(d)}}};var mb=new WMJSDebouncer,Sa=!1,Ta=!1,Ua;this.draw=function(a){Ua=a;!0===Sa?!0!==
Ta&&(Ta=!0,mb.init(10,function(){Ta=Sa=!1;k._draw(Ua)})):(Sa=!0,k._draw(Ua))};this._draw=function(a){enableConsoleDebugging&&console.log("draw:"+a);if(k.isAnimating)enableConsoleDebugging&&console.log("ANIMATING: Skipping draw:"+a);else a:if(enableConsoleDebugging&&console.log("drawnBBOX.setBBOX(bbox)"),O.setBBOX(p),4>z||4>C)console.log("map too small, skipping");else{B.triggerEvent("beforedraw");if(!1===k.isAnimating&&void 0!==a&&"object"===typeof a&&0<a.length){if(a.length>maxAnimationSteps){alert("Too many animations given, max is "+
maxAnimationSteps);k.draw("self");break a}k.isAnimating=!0;B.triggerEvent("onstartanimation",k);k.currentAnimationStep=0;k.animationList=[];k.mouseHoverAnimationBox=!1;for(var b=0;b<a.length;b++){var c={name:a[b].name,value:a[b].value};k.setDimension(a[b].name,a[b].value,!1);c.requests=k.getWMSRequests();k.animationList.push(c)}k.setDimension(k.animationList[k.currentAnimationStep].name,k.animationList[k.currentAnimationStep].value,!1);cb.checkAnimation()}k._pdraw()}};var nb=function(){debug("--\x3e onmapready event called");
k.draw("onmapready callback")};this.getWMSRequests=function(){var a=[],b=k.getNumLayers();for(j=0;j<b;j++)if(t[j].service&&t[j].enabled){var c=e(t[j]);c&&a.push(c)}return a};this.prefetch=function(a){var b=[];for(j=0;j<a.length;j++){var c=getMapImageStore.getImage(a[j]);0==c.isLoaded()&&0==c.isLoading()&&(b.push(c),c.load())}return b};this.getImageStore=function(){return getMapImageStore};this.isThisRequestLoaded=function(a){a=getMapImageStore.getImageForSrc(a);if(void 0==a)return 0;if(a.isLoaded())return 2;
if(a.isLoading())return 1};this.mouseHoverAnimationBox=!1;this._pdraw=function(){if(0!=$a)if(fa)1==B.addToCallback("onmapready",nb)&&debug("Suspending on onmapready");else{enableConsoleDebugging&&console.log("loadLayers");var a,b=0;T=0;if(F)for(var c=0;c<F.length;c++)F[c].enabled&&!1===F[c].keepOnTop&&(!F[c].type||"twms"!==F[c].type)&&(T++,a=e(F[c]))&&(J[da].setSrc(b,a,k.getWidth(),k.getHeight()),J[da].setOpacity(b,F[c].opacity),b++);for(c=c=0;c<k.getNumLayers();c++)t[c].service&&t[c].enabled&&(a=
e(t[c],t[c].dimensions))&&(J[da].setSrc(b,a),J[da].setOpacity(b,t[c].opacity),t[c].image=J[da].layers[b],b++);if(F)for(c=0;c<F.length;c++)F[c].enabled&&1==F[c].keepOnTop&&(a=e(F[c]))&&(J[da].setSrc(b,a),J[da].setOpacity(b,F[c].opacity),b++);k.flipBuffers();B.triggerEvent("ondrawready",k);ja()}};var cb,la=function(a){if(0!=J.length){var b=p;isDefined(a)&&(b=a);D.copy(b);J[ia].setBBOX(D,ea);J[ia].mapbbox=D;k.showBoundingBox(A.bbox,D);B.triggerEvent("onupdatebbox",D)}},db=new WMJSTimer;k.flipBuffers=
function(){enableConsoleDebugging&&console.log("flipBuffers");var a=ia,b=da;B.triggerEvent("onmapstartloading");fa=!0;db.init(500,function(){Ka.show()});pa.setBBOX(p);J[b]&&J[b].load(function(){enableConsoleDebugging&&console.log("flipBuffers loadcomplete");try{J[a].srs=q,J[b].bbox=p.clone(),J[b].srs=q,enableConsoleDebugging&&console.log("loadedBBOX.setBBOX(bbox)"),ea.setBBOX(pa),enableConsoleDebugging&&console.log("-----------------------"),J[b].display(D,ea),w.oldx=w.exactX,w.oldy=w.exactY,J[a].hide(),
ia=b,da=a}catch(c){console.log(c)}fa=!1;B.triggerEvent("onmaploadingcomplete",k);B.triggerEvent("onloadingcomplete",k);B.triggerEvent("onmapready",k);Ka.hide();db.stop()})};k.getBackBufferCanvasContext=function(){return J[da].getCanvasContext()};k.getFrontBufferCanvasContext=function(){return J[ia].getCanvasContext()};k.redrawBuffer=function(){J[ia].display()};this.addBaseLayers=function(a){if(a){T=0;a=toArray(a);F.push(a);for(j=0;j<F.length;j++)1==F.keepOnTop&&T++;B.triggerEvent("onlayeradd")}else F=
void 0};this.setBaseLayers=function(a){if(a){T=0;F=a;for(j=0;j<F.length;j++)1==F.keepOnTop&&T++;B.triggerEvent("onlayerchange")}else F=void 0};this.getBaseLayers=function(){return F};this.getNumLayers=function(){return t.length};this.getBaseElement=function(){return n};var ua=0;new WMJSTimer;var va=0,ob=new WMJSTimer,ha=0,wa=new WMJSBBOX,xa=new WMJSBBOX,eb=new WMJSBBOX,ya=0,Ea=0,gb=function(){var a=1-ha,a=new WMJSBBOX(wa.left*a+xa.left*ha,wa.bottom*a+xa.bottom*ha,wa.right*a+xa.right*ha,wa.top*a+xa.top*
ha);la(a);va+=1;ha+=1/6;5<va?(ha=va=0,k.zoomTo(a),0===Ea?(ya=Ea=0,k.draw("flyZoomToBBOXTimerFunc")):(ya=Ea=0,fb(D,eb))):ob.init(10,gb)},fb=function(a,b){1===ya?(eb.copy(b),Ea=1):(wa.copy(a),xa.copy(b),ha=va=0,0===ya&&(ya=1,gb()))},hb=new WMJSBBOX,za=new WMJSBBOX;this.mouseWheelEvent=function(a,b,c,e){a.stopPropagation();preventdefault_event(a);if(1!=ua){ua=1;var d=D.right-D.left,f=D.bottom-D.top;a=k.getGeoCoordFromPixelCoord({x:H,y:I},O);e=(a.x-D.left)/d;c=(a.y-D.top)/f;var g;0>b?(d*=-.3,g=-.3*f):
(d*=.2,g=.2*f);b=D.left+d;f=D.top+g;d=D.right-d;g=D.bottom-g;e=e*(d-b)+b-a.x;a=c*(g-f)+f-a.y;b-=e;d-=e;f-=a;g-=a;hb.copy(D);za.left=b;za.bottom=g;za.right=d;za.top=f;fb(hb,za);ua=0}};var N;this.pinchStart=function(a,c,e){b=e.pointers[0].clientX;d=e.pointers[0].clientY;f=e.pointers[1].clientX;g=e.pointers[1].clientY;N=p.clone();W=0;ua=aa=1};this.pinchMove=function(a,c,e){W=0;pinchMove1={x:e.pointers[0].clientX,y:e.pointers[0].clientY};pinchMove2={x:e.pointers[1].clientX,y:e.pointers[1].clientY};a=
pinchMove2.x-pinchMove1.x;c=f-b;e=pinchMove2.y-pinchMove1.y;var La=g-d;0==c&&(c=1);0==La&&(La=1);a*a>e*e?(a/=c,c=b-pinchMove1.x/a,p.right=((z-pinchMove1.x)/a+b)/z*(N.right-N.left)+N.left,p.left=c/z*(N.right-N.left)+N.left,a=(N.right-N.left)/(N.top-N.bottom),c=(p.top+p.bottom)/2,a=(p.left-p.right)/2/a,p.bottom=c+a,p.top=c-a):(a=e/La,c=d-pinchMove1.y/a,p.bottom=((C-pinchMove1.y)/a+d)/C*(N.bottom-N.top)+N.top,p.top=c/C*(N.bottom-N.top)+N.top,a=(N.right-N.left)/(N.top-N.bottom),c=(p.right+p.left)/2,a*=
(p.bottom-p.top)/2,p.left=c+a,p.right=c-a);la(p)};this.pinchEnd=function(a,b,c){ua=aa=W=0;k.zoomTo(p);k.draw("pinchEnd")};k.destroy=function(){k.stopAnimating();for(var a=t.length-1;0<=a;a--)t[a].setAutoUpdate(!1);console.log("Detaching...");n.off("mousedown");n.off("mousewheel");del_event(document,"mouseup",k.mouseUpEvent);del_event(document,"mousemove",k.mouseMoveEvent)};var qa=function(a){a=a.dimensions;for(var b="",c=0;c<a.length;c++){var e;e=a[c].name;e="TIME"==e.toUpperCase()?e:"ELEVATION"==
e.toUpperCase()?e:"DIM_"+e;b+="&"+e;b+="="+URLEncode(a[c].currentValue);if(a[c].currentValue==WMJSDateOutSideRange||a[c].currentValue==WMJSDateTooEarlyString||a[c].currentValue==WMJSDateTooLateString)throw WMJSDateOutSideRange;}return b},H=0,I=0,L=-1E4,M=-1E4,Y=1E4,Z=1E4,aa=0,W=0,P="pan";this.getMapMode=function(){return P};this.getWMSMetaDataRequestURL=function(a){var b=a.service,b=b+("&SERVICE=WMS&REQUEST=GetMetaData&VERSION="+a.version),b=b+("&LAYER="+URLEncode(a.name)),b=b+"&FORMAT=text/html";
try{b+="&"+qa(a)}catch(c){return}debug("<a target='_blank' href='"+b+"'>"+b+"</a>",!1);return b};var ka=0,Va=[],Wa=function(a,b){this.layer=a;this.data=b},pb=function(a,b,c,e,d){e+="&GRAPHSTYLE="+d;e+="&"+k.getBBOXandProjString(a);e+="&LAYERS="+URLEncode(a.name);e+="WIDTH="+z;e+="&HEIGHT="+C;e+="&X="+b;e+="&Y="+c;e+="&FORMAT=image/png";e+="&INFO_FORMAT=text/html";e+="&STYLES=";try{e+="&"+qa(a)}catch(f){return}debug("<a target='_blank' href='"+e+"'>"+e+"</a>",!1);return e};this.getWMSGetFeatureInfoRequestURL=
function(a,b,c){var e=WMJScheckURL(a.service),e=e+("&SERVICE=WMS&REQUEST=GetFeatureInfo&VERSION="+a.version),e=e+("&LAYERS="+URLEncode(a.name)),d=a.name.split(","),e=e+("&QUERY_LAYERS="+URLEncode(d[d.length-1])),e=e+("&"+k.getBBOXandProjString(a)),e=e+("WIDTH="+z),e=e+("&HEIGHT="+C);if(a.version==WMSVersion.version100||a.version==WMSVersion.version111)e=e+("&X="+b)+("&Y="+c);a.version==WMSVersion.version130&&(e+="&I="+b,e+="&J="+c);e+="&FORMAT=image/gif";e+="&INFO_FORMAT=text/html";e+="&STYLES=";
try{e+="&"+qa(a)}catch(f){return}debug("<a target='_blank' href='"+e+"'>"+e+"</a>",!1);return e};var Fa=function(a,b){ka--;var c;c=b?1==b.queryable?new Wa(b,a):new Wa(b,"not queryable"):new Wa(b,"Query failed...");Va.push(c);0>=ka&&(ka=0,B.triggerEvent("ongetfeatureinfoready",Va))},qb=function(){debug("resuming on ongetpointinfoready");k.getPointInfo(L,M)},Ga=!1;this.getPointInfo=function(a,b){if(Ga)debug("suspending on ongetpointinfoready"),k.addListener("ongetpointinfoready",qb,!1);else{Ga=!0;B.triggerEvent("beforegetpointinfo");
var c=k.getGraphingData();if(void 0==c)error("getPointInfo getGraphingData is undefined"),Ga=!1;else{debug("getPointInfo("+a+","+b+") "+c.layer.name);var e=pb(c.layer,a,b,c.service,c.style);debug("GetPointInfo: "+e);var d=new Image;d.loadEvent=function(){Ga=!1;var a={};a.url=e;a.layer=c.layer;a.img=d;B.triggerEvent("ongetpointinfoready",a)};l(d);d.src=e}}};var rb=function(){debug("resuming on ongetfeatureinfoready");B.triggerEvent("beforegetfeatureinfo");k.getFeatureInfo(L,M)};this.getFeatureInfo=
function(a,b){if(0<ka)debug("suspending on ongetfeatureinfoready"),k.addListener("ongetfeatureinfoready",rb,!1);else{debug("GetFeatureInfo:");Va=[];for(var c=ka=0;c<t.length;c++){var e=t[t.length-c-1];e.getFeatureInfoUrl="";e.service&&e.enabled&&1==e.queryable&&(e.getFeatureInfoUrl=k.getWMSGetFeatureInfoRequestURL(e,a,b),isDefined(e.getFeatureInfoUrl)?ka++:e.getFeatureInfoUrl="")}0==ka&&B.triggerEvent("ongetfeatureinfoready",["No layers to query"]);for(c=0;c<t.length;c++)if(e=t[t.length-c-1],""!=
e.getFeatureInfoUrl)if(0==e.queryable)Fa("Layer is not queryable.",e);else try{MakeHTTPRequest(e.getFeatureInfoUrl,Fa,function(a,b){Fa(a,b);error(a)},e)}catch(d){Fa("Exception: "+d,e)}}};this.getGetFeatureInfoObjectAsHTML=function(a){var b="";try{for(var b=b+'<div class="getfeatureinfo">',c=0;c<t.length;c++)for(var e=0;e<a.length;e++)a[e].layer==t[c]&&(b+='<div class="getfeatureinfolayer">',b+="<b><a target='_blank' href='"+a[e].layer.getFeatureInfoUrl+"'>"+a[e].layer.title+"</a></b><br/>",b+=a[e].data,
b+="</div>");b+="</div>"}catch(d){b="No layers to query."}return b};this.getMapPinXY=function(){return[w.exactX,w.exactY]};this.positionMapPinByLatLon=function(a){debug("positionMapPinByLatLon at "+a.x+","+a.y);a=k.getPixelCoordFromLatLong(a);k.setMapPin(a.x,a.y);k.showMapPin()};this.repositionMapPin=function(){var a=k.getPixelCoordFromGeoCoord({x:w.geoPosX,y:w.geoPosY});k.setMapPin(a.x,a.y)};this.setMapPin=function(a,b){var c=a,e=b;"object"===typeof a&&(c=a.x,e=a.y);c&&e&&(debug("setMapPin ("+c+
";"+e+")"),w.x=parseInt(c),w.y=parseInt(e),w.exactX=parseFloat(c),w.exactY=parseFloat(e),debug("Input coords: "+a+", "+b),debug("Exact coords: "+w.exactX+", "+w.exactY),c=k.getGeoCoordFromPixelCoord({x:w.exactX,y:w.exactY}),w.geoPosX=c.x,w.geoPosY=c.y,w.style.left=w.x-5+"px",w.style.top=w.y-7+"px")};this.isMapPinVisible=function(){return"none"==w.style.display?!1:!0};this.showMapPin=function(){w.innerHTML="<img src='"+mapPinImageSrc+"'>";w.style.display=""};this.hideMapPin=function(){w.style.display=
"none"};this.setMapModeGetInfo=function(){P="info";n.css("cursor","default")};this.setMapModeZoomBoxIn=function(a){P="zoom";n.css("cursor","default")};this.setMapModeZoomOut=function(a){P="zoomout";n.css("cursor","default")};this.setMapModePan=function(a){P="pan";n.css("cursor","default")};this.setMapModePoint=function(a,b){P="point";n.css("cursor","url(webmapjs/img/aero_pen.cur), default")};var Aa;this.setMapModeNone=function(a){P="none";n.css("cursor","default")};this.getMouseCoordinatesForDocument=
function(b){if(isDefined(b.changedTouches))return{x:parseInt(b.changedTouches[0].screenX),y:parseInt(b.changedTouches[0].screenY)};var c=$(a).parent().offset(),e=b.pageX,d=b.pageY;void 0==e&&(e=getClick_X(b));void 0==d&&(d=getClick_Y(b));return{x:e-c.left,y:d-c.top}};this.getMouseCoordinatesForElement=function(b){if(isDefined(b.changedTouches))return{x:parseInt(b.changedTouches[0].screenX),y:parseInt(b.changedTouches[0].screenY)};var c=$(a).parent().offset(),e=b.pageX,d=b.pageY;void 0==e&&(e=getClick_X(b));
void 0==d&&(d=getClick_Y(b));return{x:e-c.left,y:d-c.top}};this.mouseDown=function(a,b,c){var e=!1;c&&1==c.shiftKey&&(e=!0);L=a;M=b;W=1;if(0===aa&&0===(0>M|0>L|L>z|M>C?-1:0))for(a=B.triggerEvent("beforemousedown",{mouseX:a,mouseY:b,mouseDown:!0,event:c}),b=0;b<a.length;b++)if(!1===a[b])return;e?(void 0==Aa&&(Aa=P),P="zoom"):void 0!=Aa&&(P=Aa,Aa=void 0);B.triggerEvent("mousedown",{map:k,x:L,y:M});"info"==P?(debug("GetFeatureInfo"),k.setMapPin(L,M),k.showMapPin(),B.triggerEvent("beforegetfeatureinfo",
{map:k,x:L,y:M}),k.getFeatureInfo(L,M)):"point"==P&&(k.setMapPin(L,M),k.showMapPin(),k.getPointInfo(L,M))};var ib=!1,R=!1,Ha,Xa;this.updateMouseCursorCoordinates=function(a){Xa=a;Ha=k.getGeoCoordFromPixelCoord(a);k.draw("updateMouseCursorCoordinates")};this.mouseDownEvent=function(a){preventdefault_event(a);var b=k.getMouseCoordinatesForDocument(a);oa&&30>b.y||k.mouseDown(b.x,b.y,a)};this.mouseMoveEvent=function(a){preventdefault_event(a);var b=k.getMouseCoordinatesForDocument(a);0===W&&0<=b.y&&30>
b.y&&0<=b.x&&b.x<=z?!1===oa&&(oa=!0,Ya=Ja,Ba=!0,k.setCursor("pointer"),k.draw("mouseMoveEvent")):!0===oa&&(Ba=oa=!1,k.setCursor(Ya),k.draw("mouseMoveEvent"));k.mouseMove(b.x,b.y,a)};this.mouseUpEvent=function(a){preventdefault_event(a);var b=k.getMouseCoordinatesForDocument(a);k.mouseUp(b.x,b.y,a)};this.mouseMove=function(b,c){H=b;I=c;if(0===aa)for(var e=B.triggerEvent("beforemousemove",{mouseX:H,mouseY:I,mouseDown:1===W?!0:!1}),d=0;d<e.length;d++)if(!1===e[d])return;if(1==A.displayed&&0==ma){var e=
k.getPixelCoordFromGeoCoord({x:A.bbox.left,y:A.bbox.top}),d=k.getPixelCoordFromGeoCoord({x:A.bbox.right,y:A.bbox.bottom}),f=!1;0==W&&(!1===R&&(ib=n.css("cursor")),6>Math.abs(H-e.x)&&I>e.y&&I<d.y&&(f=!0,n.css("cursor","col-resize"),R="left"),6>Math.abs(I-e.y)&&H>e.x&&H<d.x&&(f=!0,n.css("cursor","row-resize"),R="top"),6>Math.abs(H-d.x)&&I>e.y&&I<d.y&&(f=!0,n.css("cursor","col-resize"),R="right"),6>Math.abs(I-d.y)&&H>e.x&&H<d.x&&(f=!0,n.css("cursor","row-resize"),R="bottom"),6>Math.abs(H-e.x)&&6>Math.abs(I-
e.y)&&(f=!0,n.css("cursor","nw-resize"),R="topleft"),6>Math.abs(H-d.x)&&6>Math.abs(I-e.y)&&(f=!0,n.css("cursor","ne-resize"),R="topright"),6>Math.abs(H-e.x)&&6>Math.abs(I-d.y)&&(f=!0,n.css("cursor","sw-resize"),R="bottomleft"),6>Math.abs(H-d.x)&&6>Math.abs(I-d.y)&&(f=!0,n.css("cursor","se-resize"),R="bottomright"));if(1==f||!1!==R&&1==W){1==W&&("left"==R&&(e.x=H),"top"==R&&(e.y=I),"right"==R&&(d.x=H),"bottom"==R&&(d.y=I),"topleft"==R&&(e.x=H,e.y=I),"topright"==R&&(d.x=H,e.y=I),"bottomleft"==R&&(e.x=
H,d.y=I),"bottomright"==R&&(d.x=H,d.y=I),e=k.getGeoCoordFromPixelCoord(e),d=k.getGeoCoordFromPixelCoord(d),A.bbox.left=e.x,A.bbox.top=e.y,A.bbox.right=d.x,A.bbox.bottom=d.y,k.showBoundingBox(A.bbox),B.triggerEvent("bboxchanged",{map:k,bbox:A.bbox}));return}R=!1;n.css("cursor",ib)}if(-1==(0>I|0>H|H>z|I>C?-1:0)){try{B.triggerEvent("onmousemove",[void 0,void 0]),k.updateMouseCursorCoordinates(void 0)}catch(g){console.log(g)}Y=H;Z=I;0!=ma&&(1==W&&"zoomout"==P&&k.zoomOut(),W=0,1==aa&&jb(Y,Z))}else{if(1==
W&&!(3>Math.abs(L-H)&&3>Math.abs(M-I))){d=H;e=I;if(0==aa){if("pan"==P){n.css("cursor","move");var f=parseInt(d),m=parseInt(e);w.oldx=w.exactX;w.oldy=w.exactY;for(var l=0;l<U.length;l++)U[l].origX=U[l].x,U[l].origY=U[l].y;ma=1;enableConsoleDebugging&&console.log("updateBBOX.setBBOX(drawnBBOX)");D.setBBOX(O);na=k.getGeoCoordFromPixelCoord({x:f,y:m},O)}"zoom"==P&&(n.css("cursor","crosshair"),Ia=1);aa=1}"pan"==P&&0!=ma&&(f=parseInt(d),m=parseInt(e),0>H||0>I||H>parseInt(a.style.width)||I>parseInt(a.style.height)?
kb(f,m):(m=k.getGeoCoordFromPixelCoord({x:f,y:m},O),f=m.x-na.x,m=m.y-na.y,k.setMapPin(w.oldx+f/(p.right-p.left)*z,w.oldy+m/(p.bottom-p.top)*C),D.left=O.left-f,D.bottom=O.bottom-m,D.right=O.right-f,D.top=O.top-m,la(D)));"zoom"==P&&0!=Ia&&(d=H-L,e=I-M,0>d&&0>e?n.css("cursor","not-allowed"):n.css("cursor","crosshair"),h=e,G.style.display="",0>d?(d=-d,G.style.left=H+"px"):G.style.left=L+"px",0>h?(h=-h,G.style.top=I+"px"):G.style.top=M+"px",G.style.width=d+"px",G.style.height=h+"px")}B.triggerEvent("onmousemove",
[H,I]);k.updateMouseCursorCoordinates({x:H,y:I})}};this.mouseUp=function(a,b,e){Y=a;Z=b;if(0===aa&&0===(0>Z|0>Y|Y>z|Z>C?-1:0))for(a=B.triggerEvent("beforemouseup",{mouseX:a,mouseY:b,mouseDown:!1,event:e}),b=0;b<a.length;b++)if(!1===a[b]){W=0;return}if(1==W){"zoomout"==P&&k.zoomOut();if(0==aa&&3>Math.abs(L-Y)&&3>Math.abs(M-Z)&&(isDefined(e)&&B.triggerEvent("mouseclicked",{map:k,x:Y,y:Z,shiftKeyPressed:1==e.shiftKey}),1==ab)){var c;0==U.length?(c=WMJSDialog.createDialog({x:Y,y:Z,autoDestroy:!1},n,k),
U.push(c)):c=U[0];0==c.hasBeenDragged&&(1==c.moveToMouseCursor?c.setXY(Y,Z):c.setXY(5,35));c.on("hide",function(a,b){c.hasBeenDragged=!1});c.setLoading();c.show();k.addListener("ongetfeatureinfoready",function(a){c.setHTML(k.getGetFeatureInfoObjectAsHTML(a))},!0);k.setMapPin(L,M);k.showMapPin();B.triggerEvent("beforegetfeatureinfo");k.getFeatureInfo(L,M)}B.triggerEvent("mouseup",{map:k,x:Y,y:Z})}W=0;1==aa&&jb(Y,Z)};var jb=function(a,b){if(0!=aa){aa=0;"pan"==P&&kb(a,b);if("zoom"==P){var c=a,e=b,c=
Y-L,e=Z-M;n.css("cursor","default");if(0!=Ia&&(Ia=0,G.style.display="none",!(0>c&&0>e))){var d=new WMJSBBOX;0>c?(d.left=L+c,d.right=L):(d.left=L,d.right=L+c);0>e?(d.top=M+e,d.bottom=M):(d.top=M,d.bottom=M+e);c=k.pixelCoordinatesToXY({x:d.left,y:d.bottom});e=k.pixelCoordinatesToXY({x:d.right,y:d.top});d.left=c.x;d.bottom=c.y;d.right=e.x;d.top=e.y;k.zoomTo(d);k.draw("mapZoomEnd")}}B.triggerEvent("mapdragend",{map:k,x:Y,y:Z})}},ma=0,na,kb=function(a,b){n.css("cursor","default");var c=parseInt(a),e=parseInt(b);
if(0!=ma){ma=0;var d=k.getGeoCoordFromPixelCoord({x:c,y:e},O),f=d.x-na.x,d=d.y-na.y;na=k.getGeoCoordFromPixelCoord({x:c,y:e},O);k.setMapPin(w.oldx+f/(p.right-p.left)*z,w.oldy+d/(p.bottom-p.top)*C);D.left=O.left-f;D.bottom=O.bottom-d;D.right=O.right-f;D.top=O.top-d;la(D);k.zoomTo(D);k.draw("mapPanEnd")}},Ia=0;this.setCursor=function(a){Ja=a?a:"default";n.css("cursor",Ja)};this.zoomTo=function(a){enableConsoleDebugging&&console.log("zoomTo");var b=!1;a=new WMJSBBOX(a);try{var c=(u.left-u.right)/(u.bottom-
u.top)}catch(e){b=!0}isNaN(c)&&(b=!0);1==b&&(error("Invalid bbox: setting ratio to 1"),c=1);0>c&&(c=-c);c>z/C?(b=(a.top+a.bottom)/2,c=(a.left-a.right)/2/c,a.bottom=b+c,a.top=b-c):(b=(a.right+a.left)/2,c*=(a.bottom-a.top)/2,a.left=b+c,a.right=b-c);k.setBBOX(a);la(p);O.setBBOX(p);a=k.getPixelCoordFromGeoCoord({x:w.geoPosX,y:w.geoPosY});k.setMapPin(a.x,a.y);for(a=0;a<U.length;a++)k.getPixelCoordFromGeoCoord({x:U[a].geoPosX,y:U[a].geoPosY}),0==U[a].hasBeenDragged&&1==U[a].moveToMouseCursor&&U[a].setXY(U[a].origX+
x,U[a].origY+y)};this.pixelCoordinatesToXY=function(a){return k.getGeoCoordFromPixelCoord(a)};this.getGeoCoordFromPixelCoord=function(a,b){var c=p;b&&(c=b);if(isDefined(a)){try{var e=a.x/z*(c.right-c.left)+c.left,d=a.y/C*(c.bottom-c.top)+c.top}catch(f){return}return{x:e,y:d}}};this.proj4={};this.proj4.srs="empty";this.proj4.projection=void 0;var lb=new Proj4js.Proj("EPSG:4326");this.getPixelCoordFromLatLong=function(a){var b=new Proj4js.Point;try{b.x=parseFloat(a.x),b.y=parseFloat(a.y),k.proj4.srs==
q&&isDefined(this.proj4.projection)||(k.proj4.projection=new Proj4js.Proj(q),k.proj4.srs=q),Proj4js.transform(lb,k.proj4.projection,b)}catch(c){alert(debug("error in getPixelCoordFromLatLong "+c));return}return k.getPixelCoordFromGeoCoord(b)};this.WCJSSearchRequest=function(a){function b(a,c,e){error(I18n.geonames_api_call_failed.text)}function c(a){if(0===$(a).length){var b=geoNamesURL.replace("{searchTerm}",searchDef).replace("{username}",defaultUsernameSearch);k.WCJSSearchRequestGeoNames(b)}else b=
parseFloat($(a)[0].lat),a=parseFloat($(a)[0].lon),k.calculateBoundingBoxAndZoom(b,a)}a.trim().match(/^(-?(?:[1-8]?\d(?:\.\d+)?|90(?:\.0+)?),-?(?:180(?:\.0+)?|(?:(?:1[0-7]\d)|(?:[1-9]?\d))(?:\.\d+)?))$/)?(splitted=a.split(","),lat=splitted[0],lng=splitted[1],k.calculateBoundingBoxAndZoom(lat,lng)):"undefined"===typeof geoNamesURL||"undefined"===typeof knmiGeoNamesURL?error(I18n.no_urls_in_config.text):a.trim()?(searchDef=a.trim().match(/^[a-zA-Z0-9 ]*$/))?(a=knmiGeoNamesURL.replace("{searchTerm}",
searchDef),debug(I18n.debug_searching_location.text),debug("<a target='_blank' href='"+a+"'>"+a+"</a>",!1),$.ajax({dataType:"jsonp",contentType:"application/jsonp",jsonpCallback:"resultGeo",crossDomain:!0,type:"GET",url:a,success:c,error:b})):(debug(I18n.only_alpha_num_allowed.text),$("#searchtextfield").attr("value","")):(debug(I18n.no_search_definition.text),$("#searchtextfield").attr("value",""))};this.WCJSSearchRequestGeoNames=function(a){debug(I18n.debug_searching_sqlite_location.text);debug("<a target='_blank' href='"+
a+"'>"+a+"</a>",!1);$.ajax({dataType:"xml",type:"GET",url:a,success:function(a){if("0"===$(a).find("totalResultsCount").text())error(I18n.no_results_search.text);else{var b=parseFloat($(a).find("geoname").find("lat").text());a=parseFloat($(a).find("geoname").find("lng").text());k.calculateBoundingBoxAndZoom(b,a)}},error:function(a,b,c){error(I18n.geonames_sqlite_call_failed.text)}})};this.calculateBoundingBoxAndZoom=function(a,b){var c=5E5;if("EPSG:4326"===k.proj4.projection.srsCode||"EPSG:50001"===
k.proj4.projection.srsCode)c=5;var e=k.getPixelCoordFromLatLong({x:b,y:a}),e=k.getGeoCoordFromPixelCoord(e),d=new WMJSBBOX;d.left=e.x-c;d.bottom=e.y-c;d.right=e.x+c;d.top=e.y+c;k.zoomTo(d);k.positionMapPinByLatLon({x:b,y:a});k.draw("zoomIn")};this.getLatLongFromPixelCoord=function(a){var b=new Proj4js.Point;try{b.x=a.x/z*(p.right-p.left)+p.left,b.y=a.y/C*(p.bottom-p.top)+p.top,this.proj4.srs!=q&&(this.proj4.projection=new Proj4js.Proj(q),this.proj4.srs=q),Proj4js.transform(this.proj4.projection,lb,
b)}catch(c){return}return{x:b.x,y:b.y}};this.getPixelCoordFromGeoCoord=function(a,b,c,e){var d=z,f=C,g=D;isDefined(c)&&(d=c);isDefined(e)&&(f=e);isDefined(b)&&(g=b);b=f*(a.y-g.top)/(g.bottom-g.top);return{x:parseFloat(d*(a.x-g.left)/(g.right-g.left)),y:parseFloat(b)}};this.addListener=function(a,b,c){return B.addToCallback(a,b,c)};this.removeListener=function(a,b){return B.removeEvents(a,b)};this.getListener=function(a){return B};this.suspendEvent=function(a){B.suspendEvent(a)};this.resumeEvent=function(a){B.resumeEvent(a)};
this.getDimensionList=function(){return K};this.getDimension=function(a){for(var b=0;b<K.length;b++)if(K[b].name==a)return K[b]};this.setDimension=function(a,b,c){if(isDefined(a)&&isDefined(b)){for(var e,d=0;d<K.length;d++)if(K[d].name==a){e=K[d];break}0==isDefined(e)&&(e={name:a,currentValue:b},K.push(e));if(isDefined(e)){if(isDefined(void 0)&&(void 0).setValue(a,b),e.currentValue!=b){e.currentValue=b;if(1==k.buildLayerDimsBusy)alert("b");else for(b=0;b<K.length;b++)for(e=K[b],d=0;d<t.length;d++)for(var f=
0;f<t[d].dimensions.length;f++){var g=t[d].dimensions[f];if(1==g.linked&&g.name==e.name){if("current"==e.currentValue||"default"==e.currentValue||""==e.currentValue||"earliest"==e.currentValue||"middle"==e.currentValue||"latest"==e.currentValue)e.currentValue=g.getClosestValue(e.currentValue);k.buildLayerDimsBusy=!0;g.setClosestValue(e.currentValue);k.buildLayerDimsBusy=!1}}!1!==c&&(c=!0);!0===c&&B.triggerEvent("ondimchange",a)}}else error("WebMapJS::setDimension: Dimension "+a+" not found")}else error("Unable to set dimension with undefined value or name")};
this.setLayerOpacity=function(a,b){if(a){a.opacity=b;var c=T;for(j=0;j<k.getNumLayers();j++)if(t[j].service&&t[j].enabled){if(a==t[j]){k.setBufferImageOpacity(da,c,b);break}c++}}};this.zoomToLayer=function(a){var b=a;b||(b=Ca);if(b){for(var c=0;c<b.projectionProperties.length;c++)if(b.projectionProperties[c].srs==q){a=b.projectionProperties[c].bbox.right-b.projectionProperties[c].bbox.left;var e=b.projectionProperties[c].bbox.top-b.projectionProperties[c].bbox.bottom,b=b.projectionProperties[c].bbox.clone();
b.left-=a/100;b.right+=a/100;b.bottom-=e/100;b.top+=e/100;k.zoomTo(b);k.draw("zoomTolayer");return}error("Unable to find the correct bbox with current map projection "+q+" for layer "+b.title+". Using default bbox instead.")}k.zoomTo(E);k.draw("zoomTolayer")};this.setPreviousExtent=function(){Ma=1;V++;V>=ra&&(V=ra-1);k.setProjection(X[V].srs,X[V].bbox);k.draw("setPreviousExtent")};this.setNextExtent=function(){Na=1;V--;0>V&&(V=0);k.setProjection(X[V].srs,X[V].bbox);k.draw("setNextExtent")};this.setBBOX=
function(a,b,c,e){enableConsoleDebugging&&console.log("setBBOX");p.setBBOX(a,b,c,e);u.setBBOX(p);if("GFI:TIME_ELEVATION"!==q){var d=z/C;if((p.right-p.left)/(p.top-p.bottom)>d){var f=(p.top+p.bottom)/2,d=(p.left-p.right)/2/d;p.bottom=f+d;p.top=f-d}else f=(p.right+p.left)/2,d*=(p.bottom-p.top)/2,p.left=f+d,p.right=f-d}D.setBBOX(p);O.setBBOX(p);if(0==Na&&0==Ma){if(0!=V){for(j=0;j<=V;j++)Oa[j]=X[j];for(j=0;j<=V;j++)X[j]=Oa[V-j];V=0}for(j=2;0<j;j--)X[j].bbox.setBBOX(X[j-1].bbox),X[j].srs=X[j-1].srs;X[0].bbox.setBBOX(p);
X[0].srs=q;ra++;3<ra&&(ra=3)}Ma=Na=0;if(!0===p.equals(a,b,c,e))return!1;B.triggerEvent("aftersetbbox",k);return!0};this.zoomOut=function(){var a=(u.right-u.left)/6;this.zoomTo(new WMJSBBOX(u.left-a,u.bottom-a,u.right+a,u.top+a));k.draw("zoomOut")};this.zoomIn=function(a){var b=(u.left-u.right)/8;if(0==isDefined(a))a=1;else if(0==a)return;b*=a;this.zoomTo(new WMJSBBOX(u.left-b,u.bottom-b,u.right+b,u.top+b));k.draw("zoomIn")};this.searchForLocation=function(a){k.WCJSSearchRequest(a)};this.displayLegendInMap=
function(a){Q=a;k.repositionLegendGraphic()};this.showBoundingBox=function(a,b){isDefined(a)&&(A.bbox=a,A.style.display="",A.displayed=!0);if(!0===A.displayed){var c=p;isDefined(b)&&(c=b);var e=this.getPixelCoordFromGeoCoord({x:A.bbox.left,y:A.bbox.top},c),c=this.getPixelCoordFromGeoCoord({x:A.bbox.right,y:A.bbox.bottom},c);A.style.left=e.x-1+"px";A.style.top=e.y-2+"px";A.style.width=c.x-e.x+"px";A.style.height=c.y-e.y-1+"px"}};this.hideBoundingBox=function(){A.style.display="none";A.displayed=!1};
this.setDebugFunction=function(a){debug=a};this.setErrorFunction=function(a){error=a};(function(){var b=ga("baseDiv");jQuery("<div/>",{id:b,css:{position:"relative",overflow:"hidden",width:a.style.width,height:a.style.height,border:"0px  solid black",margin:0,padding:0,clear:"both",left:"0px",top:"0px"}}).appendTo(a);n=$("#"+b);n.css("cursor","default");a.style.margin="0px";a.style.padding="0px";a.style.border="none";a.style.lineHeight="0px";a.style.display="inline-block";G.style.position="absolute";
G.style.display="none";G.style.border="2px dashed #000000";G.style.margin="0px";G.style.padding="0px";G.style.lineHeight="0";G.style.background="#AFFFFF";G.style.opacity="0.3";G.style.filter="alpha(opacity=30)";G.style.left="0px";G.style.top="0px";G.style.width="100px";G.style.height="100px";G.style.zIndex=1E3;G.oncontextmenu=function(){return!1};n.append(G);A.style.position="absolute";A.style.display="none";A.style.border="3px solid #6060FF";A.style.margin="0px";A.style.padding="0px";A.style.lineHeight=
"0";A.style.left="0px";A.style.top="0px";A.style.width="100px";A.style.height="100px";A.style.zIndex=1E3;A.oncontextmenu=function(){return!1};n.append(A);w.style.position="absolute";w.style.display="none";w.style.border="none";w.style.margin="0px";w.style.padding="0px";w.style.lineHeight="0";w.style.background="none";w.style.opacity="1.0";w.style.filter="alpha(opacity=100)";w.style.left="0px";w.style.top="0px";w.style.width="100px";w.style.height="100px";w.style.zIndex=1E3;w.oncontextmenu=function(){return!1};
n.append(w);ba.style.position="absolute";ba.style.zIndex=1E3;ba.style.width="auto";ba.style.height="auto";ba.style.background="none";ba.oncontextmenu=function(){return!1};ba.innerHTML="";n.append(ba);n.append(Ka);"undefined"!==typeof defaultUsernameSearch&&(jQuery("<div/>",{id:ga("searchboxdiv"),mousedown:function(a){a.stopPropagation()}}).addClass("webmapjs_searchboxdiv").html("<input class='webmapjs_locationfield' type='text' name='searchtextfield' id='searchtextfield' placeholder="+I18n.place_search_term.text+
" />",{mousedown:function(a){a.stopPropagation();preventdefault_event(a)}}).appendTo(n),jQuery("<button/>",{id:ga("searchboxbutton"),mousedown:function(a){a.stopPropagation()},click:function(){var a=$("#searchtextfield").attr("value");k.searchForLocation(a)}}).addClass("webmapjs_locationbutton").appendTo(n),$("#searchtextfield").keypress(function(a){if(13==a.which)return a=$("#searchtextfield").attr("value"),k.searchForLocation(a),!1}));$("#"+ga("buttonzoomout")).click(function(a){a.stopPropagation()});
$("#"+ga("buttonzoomin")).iconbutton({text:!1,icons:{primary:"wmjs-icon-zoomin"}});$("#"+ga("buttonzoomhome")).iconbutton({text:!1,icons:{primary:"wmjs-icon-zoomhome"}});$("#"+ga("buttonzoombox")).iconbutton({text:!1,icons:{primary:"wmjs-icon-zoombox"}});$("#"+ga("buttondragmap")).iconbutton({text:!1,icons:{primary:"wmjs-icon-dragpan-activated"}});$("#"+ga("buttonzoomout")).iconbutton({text:!1,icons:{primary:"wmjs-icon-zoomout"}});r();p.left=-180;p.bottom=-90;p.right=180;p.top=90;q="EPSG:4326";k.setSize(a.style.width,
a.style.height);for(b=0;2>b;b++){var c=new WMJSCanvasBuffer(B,"imagebuffer",getMapImageStore,k.getWidth(),k.getHeight());getMapImageStore.addLoadEventCallback(c.imageLoadComplete);n.append(c.getBuffer());J.push(c)}for(b=0;2>b;b++)c=new WMJSCanvasBuffer(B,"legendbuffer",legendImageStore,k.getWidth(),k.getHeight()),legendImageStore.addLoadEventCallback(c.imageLoadComplete),n.append(c.getBuffer()),S.push(c);B.addToCallback("draw",k.draw,!0);cb=new WMJSAnimate(k);bgMapImageStore.addLoadEventCallback(k.draw);
k.addListener("beforecanvasstartdraw",function(a){if(F)for(var b=0;b<F.length;b++)!F[b].enabled||!1!==F[b].keepOnTop||F[b].type&&"twms"!==F[b].type||WMJSTileRenderer(p,D,q,z,C,a,bgMapImageStore,WMJSTileRendererTileSettings,F[b].name)},!0);var e=function(a,b,c,e,d){a.textBaseline="top";a.fillStyle="#FFF";a.globalAlpha=.75;var f=a.measureText(b).width;a.fillRect(c-8,e-8,f+16,parseInt(d)+14);a.fillStyle="#444";a.globalAlpha=1;a.fillText(b,c,e+2)};k.addListener("beforecanvasdisplay",function(a){a.beginPath();
a.rect(0,0,z,30);!1===Za?(a.globalAlpha=Ba?.9:.4,a.fillStyle=Ba?"#017daf":"#EEE"):(a.globalAlpha=1,a.fillStyle="#017daf");a.fill();a.globalAlpha=1;""!==Pa&&(a.font="20px Helvetica",e(a,Pa,z/2-70,C-26,20));""!==Qa&&(a.font="15px Helvetica",e(a,Qa,z/2-70,2,15));if(!0===Ra){var b=function(){var a=0,b=1E-7,c=z/(D.right-D.left);if(!(0>=c)){var e=25/c,a=0;do{b*=10;a=e/b;if(0===a)return;a=25/a}while(25>a);do{b/=2;a=e/b;if(0===a)return;a=25/a}while(25<a);do{b*=1.2;a=e/b;if(0===a)return;a=25/a}while(25>a);
e=Math.pow(10,Math.round(Math.log10(b)+.5)-1);b=Math.round(b/e);2.5>b&&(b=2.5);2.5<b&&7.5>b&&(b=5);7.5<b&&(b=10);b*=e;a=25/c/b;return{width:parseInt(25/a),mapunits:b}}}();if(b){var c=C-25.5;a.beginPath();a.lineWidth=2.5;a.fillStyle="#000";a.strokeStyle="#000";a.font="9px Helvetica";a.textBaseline="middle";for(var d=0;2>d;d++)a.moveTo(7.5,21-d+c),a.lineTo(2*b.width+8.5,21-d+c);d=parseInt(Math.round(b.width/5));a.lineWidth=.5;for(var f=1;5>f;f++)a.moveTo(7.5+d*f,21+c),a.lineTo(7.5+d*f,16+c);a.lineWidth=
1;a.moveTo(7.5,21+c);a.lineTo(7.5,14+c);a.moveTo(7.5+b.width,21+c);a.lineTo(7.5+b.width,14+c);a.moveTo(2*b.width+8.5,21+c);a.lineTo(2*b.width+8.5,14+c);d="";"EPSG:3411"===q&&(d="meter");"EPSG:3412"===q&&(d="meter");"EPSG:3575"===q&&(d="meter");"EPSG:4326"===q&&(d="degrees");"EPSG:28992"===q&&(d="meter");"EPSG:32661"===q&&(d="meter");"EPSG:3857"===q&&(d="meter");"EPSG:900913"===q&&(d="meter");"EPSG:102100"===q&&(d="meter");"meter"===d&&1E3<b.mapunits&&(b.mapunits/=1E3,d="km");a.fillText("0",4.5,12+
c);f=b.mapunits.toPrecision()+"";a.fillText(f,7.5+b.width-2.5*f.length+0,12+c);f=(2*b.mapunits).toPrecision()+"";a.fillText(f,7.5+2*b.width-2.5*f.length+0,12+c);a.fillText(d,2*b.width+17.5,18+c);a.stroke()}}a.font="10px Helvetica";a.textBaseline="middle";isDefined(Ha)&&(c=1/Math.pow(10,parseInt(Math.log((p.right-p.left)/z)/Math.log(10))-2),1>c&&(c=1),a.fillStyle="#000000",b=Math.round(Ha.x*c)/c,c=Math.round(Ha.y*c)/c,d="","EPSG:3857"===q&&(d="meter"),a.fillText("CoordXY: ("+b+", "+c+") "+d,5,C-50));
isDefined(Xa)&&(b=k.getLatLongFromPixelCoord(Xa),isDefined(b)&&(a.fillStyle="#000000",c=Math.round(100*b.x)/100,a.fillText("Lat/Lon: ("+(Math.round(100*b.y)/100).toFixed(2)+", "+c.toFixed(2)+")  degrees",5,C-38)));a.fillStyle="#000000";a.fillText("Map projection: "+q,5,C-26)},!0);$a=1})();la(p)};WMJSEmptyLayerName="empty_layer";WMJSEmptyLayerTitle="empty layer";
function WMJSLayer(a){this.autoupdate=!1;this.getlegendgraphicURL=this.getfeatureinfoURL=this.getmapURL=this.WMJSService=this.service=this.timer=void 0;this.keepOnTop=!1;this.transparent=!0;this.hasError=!1;this.legendIsDimensionDependant=!0;this.wms130bboxcompatibilitymode=!1;this.version=WMSVersion.version111;this.path="";this.type="wms";this.objectpath=[];this.wmsextensions=function(a){this.wmsextensions.colorscalerange="";isDefined(a.colorscalerange)&&(this.wmsextensions.colorscalerange=a.colorscalerange);
this.wmsextensions.url="";2<this.wmsextensions.colorscalerange.length&&(this.wmsextensions.url+="&COLORSCALERANGE="+this.wmsextensions.colorscalerange)};this.wmsextensions.url="";this.name=this.jsonlayer_v1_1_1=void 0;this.title=WMJSEmptyLayerTitle;this.abstract=void 0;this.dimensions=[];this.legendGraphic="";this.projectionProperties=[];this.queryable=!1;this.enabled=!0;this.styles=void 0;this.currentStyle="";this.id=-1;this.opacity=1;this.getCapabilitiesDoc=this.image=void 0;this.serviceTitle="not defined";
this.onReady=function(a){};this.parentMaps=[];this.getLayerName=function(){return this.name};this.toggleAutoUpdate=function(){(this.autoupdate=!this.autoupdate)?this.timer=setInterval(function(a){return function(){a.parseLayer(void 0,!0,"WMJSLayer::autoupdate")}}(this),6E4):clearInterval(this.timer)};this.setAutoUpdate=function(a,f,g){a!==this.autoupdate&&((this.autoupdate=a)?this.timer=setInterval(function(a){return function(){a.parseLayer(g,!0,"WMJSLayer::autoupdate")}}(this),f):clearInterval(this.timer))};
this.setOpacity=function(a){this.opacity=a;this.image&&(this.image.setOpacity(this.opacity),this.parentMaps[0].redrawBuffer())};this.remove=function(){for(var a=0;a<this.parentMaps.length;a++)this.parentMaps[a].deleteLayer(this),this.parentMaps[a].draw("WMJSLayer::remove");clearInterval(this.timer)};this.moveUp=function(){for(var a=0;a<this.parentMaps.length;a++)this.parentMaps[a].moveLayerUp(this),this.parentMaps[a].draw("WMJSLayer::moveUp")};this.moveDown=function(){for(var a=0;a<this.parentMaps.length;a++)this.parentMaps[a].moveLayerDown(this),
this.parentMaps[a].draw("WMJSLayer::moveDown")};this.zoomToLayer=function(){for(var a=0;a<this.parentMaps.length;a++)this.parentMaps[a].zoomToLayer(this)};this.draw=function(a){for(var f=0;f<this.parentMaps.length;f++)this.parentMaps[f].draw("WMJSLayer::draw::"+a)};this.setDimension=function(a,f){for(var g,b=0;b<this.dimensions.length;b++)this.dimensions[b].name==a&&(g=this.dimensions[b]);if(0!=isDefined(g)&&0!=isDefined(f)&&(g.setValue(f),1==g.linked))for(b=0;b<this.parentMaps.length;b++)this.parentMaps[b].setDimension(a,
g.getValue())};this.configureDimensions=function(){var a=this.jsonlayer_v1_1_1;if(a){for(var f=toArray(a.Dimension),g=this.objectpath.length-1;0<=g;g--){var b=this.objectpath[g].Dimension;if(!isNull(b)&&isDefined(b))for(var d=0;d<b.length;d++){var l=b[d];if(!isNull(l)&&isDefined(l)){for(var m=!1,e=0;e<f.length;e++)if(l.attr.name.toLowerCase()===f[g].attr.name.toLowerCase()){m=!0;break}m||f.push(l)}}}a=toArray(a.Extent);this.dimensions=[];for(g=0;g<f.length;g++){b=new WMJSDimension;b.name=f[g].attr.name.toLowerCase();
b.units=f[g].attr.units;for(e=0;e<a.length;e++)a[e].attr.name.toLowerCase()==b.name&&(b.values=a[e].value?a[e].value.trim():"",a[e].attr["default"]?b.defaultValue=a[e].attr["default"].trim():(d=b.values.split("/"),1<d.length?b.defaultValue=d[1]:0<d.length&&(b.defaultValue=d[0])),a[e].value||(error("No extent defined for dim "+b.name+" in layer "+this.title),error("Using default value "+b.defaultValue),b.values=b.defaultValue));this.version==WMSVersion.version130&&(b.values=f[g].value,b.defaultValue=
f[g].attr["default"]);e=b.defaultValue;0<this.parentMaps.length?(d=this.parentMaps[0].getDimension(b.name),isDefined(d)&&(isDefined(d.currentValue)?(e=b.getClosestValue(d.currentValue),debug("WMJSLayer::configureDimensions Dimension "+b.name+" default value ["+e+"] is based on map value ["+d.currentValue+"]")):debug("WMJSLayer::configureDimensions Map dimension currentValue for "+b.name+" does not exist."))):debug("WMJSLayer::configureDimensions Layer has no parentmaps");b.currentValue=e;b.parentLayer=
this;isDefined(b.values)?this.dimensions.push(b):error("Skipping dimension "+b.name)}}};this.parseLayer=function(c,f,g){var b=this;b.hasError=!1;var d=function(a){isDefined(c)&&c(a)},l=function(c,e){b.hasError=!0;b.lastError=e;b.title=I18n.service_has_error.text;error(e);d(c);isDefined(a.failure)&&a.failure(c,e)};b.WMJSService=WMJSgetServiceFromStore(this.service);b.WMJSService.getCapabilities(function(a){(function(a,b){function c(b,d,f){for(var g=[],m=0;m<f.length;m++)g.push(f[m]);g.push(b);for(f=
0;f<b.length;f++)if(b[f].Layer){m=d;try{m+=b[f].Title.value+"/"}catch(l){}c(toArray(b[f].Layer),m,g)}else if(b[f].Name&&b[f].Name.value==a.name){t(b[f],d,g);break}}if(0==b||void 0==b)a.title=I18n.service_has_error.text,a.abstract=I18n.not_available_message.text,l(a,I18n.unable_to_connect_server.text);else{var f;try{f=a.WMJSService.getCapabilityElement(b)}catch(g){l(a,g);return}a.version=a.WMJSService.version;var m=f.Layer;if(isDefined(m)){try{a.serviceTitle=m.Title.value}catch(g){a.serviceTitle="Unnamed service"}try{for(var E=
f.Request.GetMap.Format,z=0;z<E.length;z++)E[z].value.indexOf("24"),E[z].value.indexOf("32")}catch(g){error("This WMS service has no getmap formats listed: using image/png")}if(void 0==a.name||1>a.name.length)a.title=WMJSEmptyLayerTitle,a.abstract=I18n.not_available_message.text,d(a);else{var C=0,t=function(c,d,g){a.jsonlayer_v1_1_1=c;a.getmapURL=void 0;try{a.getmapURL=f.Request.GetMap.DCPType.HTTP.Get.OnlineResource.attr["xlink:href"]}catch(l){}isDefined(a.getmapURL)||(a.getmapURL=a.service,error("GetMap OnlineResource is not specified. Using default."));
a.getfeatureinfoURL=void 0;try{a.getfeatureinfoURL=f.Request.GetFeatureInfo.DCPType.HTTP.Get.OnlineResource.attr["xlink:href"]}catch(l){}isDefined(a.getfeatureinfoURL)||(a.getfeatureinfoURL=a.service,error("GetFeatureInfo OnlineResource is not specified. Using default."));a.getlegendgraphicURL=void 0;try{a.getlegendgraphicURL=f.Request.GetLegendGraphic.DCPType.HTTP.Get.OnlineResource.attr["xlink:href"]}catch(l){}isDefined(a.getlegendgraphicURL)||(a.getlegendgraphicURL=a.service,error("GetLegendGraphic OnlineResource is not specified. Using default."));
a.getmapURL=WMJScheckURL(a.getmapURL);a.getfeatureinfoURL=WMJScheckURL(a.getfeatureinfoURL);a.getlegendgraphicURL=WMJScheckURL(a.getlegendgraphicURL);a.getCapabilitiesDoc=b;a.title=c.Title.value;try{a.abstract=c.Abstract.value}catch(l){a.abstract=I18n.not_available_message.text}a.path=d;a.objectpath=g;a.styles=void 0;a.jsonlayer=a;try{d="";c.Style&&(d=toArray(c.Style));a.styles=d;for(var k=0;k<a.styles.length;k++){var n=a.styles[k];n.index=k;n.nrOfStyles=a.styles.length;n.title="default";n.name="default";
n.legendURL="";n.abstracttext="No abstract available";try{n.title=n.Title.value}catch(l){}try{n.name=n.Name.value}catch(l){}try{n.legendURL=n.LegendURL.OnlineResource.attr["xlink:href"]}catch(l){}try{n.abstracttext=n.Abstract.value}catch(l){}}""==a.currentStyle&&(a.currentStyle=a.styles[0].Name.value);a.setStyle(a.currentStyle)}catch(l){a.currentStyle="",a.styles="",error("No styles found for layer "+a.title)}a.configureDimensions();n=toArray(c.SRS);isDefined(c.CRS)&&(n=toArray(c.CRS));a.projectionProperties=
[];var z=[];d=function(b){if(isDefined(b.BoundingBox))for(b=toArray(b.BoundingBox),k=0;k<b.length;k++){var c;c=b[k].attr.SRS;isDefined(b[k].attr.CRS)&&(c=b[k].attr.CRS);c&&0<c.length&&(c=decodeURIComponent(c));for(var d=!1,f=0;f<a.projectionProperties.length;f++)if(c==a.projectionProperties[f].srs){d=!0;break}0==d&&(d=new WMJSProjection,d.srs=c,c=!1,a.version==WMSVersion.version130&&"EPSG:4326"==d.srs&&0==a.wms130bboxcompatibilitymode&&(c=!0),0==c?(d.bbox.left=parseFloat(b[k].attr.minx),d.bbox.bottom=
parseFloat(b[k].attr.miny),d.bbox.right=parseFloat(b[k].attr.maxx),d.bbox.top=parseFloat(b[k].attr.maxy)):(d.bbox.left=parseFloat(b[k].attr.miny),d.bbox.bottom=parseFloat(b[k].attr.minx),d.bbox.right=parseFloat(b[k].attr.maxy),d.bbox.top=parseFloat(b[k].attr.maxx)),a.projectionProperties.push(d),z.push(d.srs))}};d(c);d(m);for(k=0;k<n.length;k++)-1==z.indexOf(n[k].value)&&(d=new WMJSProjection,error("Warning: BoundingBOX missing for SRS "+n[k].value),d.bbox.left=-180,d.bbox.bottom=-90,d.bbox.right=
180,d.bbox.top=90,d.srs=n[k].value,a.projectionProperties.push(d));z="";a.queryable=!1;try{1==parseInt(c.attr.queryable)?a.queryable=!0:a.queryable=!1}catch(l){error("Unable to detect whether this layer is queryable (for layer "+a.title+")")}C=1},E=toArray(m.Layer),z=[];z.push(m);c(E,"",z);if(0==C)return E="",E=a.name?"Unable to find layer '"+a.name+"' in service '"+a.service+"'":"Unable to find layer '"+a.title+"' in service '"+a.service+"'",a.title="--- layer not found in service ---",a.abstract=
I18n.not_available_message.text,l(a,E),a;if(a.onReady)a.onReady(a);d(a);return a}}else l(a,"No Layer element in service")}})(b,a)},function(a){l(b,a)},f)};this.cloneLayer=function(){var a=new WMJSLayer;for(i in this)a[i]=this[i];return a};this.setName=function(a){this.name=a;this.parseLayer(void 0,void 0,"WMJSLayer::setName")};this.getLayerRelative=function(a,f,g){isDefined(g)||(g=0);var b=this;b.WMJSService.getLayerObjectsFlat(function(d){for(var l=-1,m=0;m<d.length;m++)if(d[m].name==b.name){l=m;
break}-1==l?f("Current layer ["+b.name+"] not in this service"):(-1===g&&l--,1===g&&l++,l>d.length-1&&(l=0),0>l&&(l=d.length-1),a(d[l],l,d.length))},f)};this.autoSelectLayer=function(a,f){this.WMJSService.getLayerObjectsFlat(function(f){for(var b=0;b<f.length;b++)if(isDefined(f[b].name)&&-1==f[b].name.indexOf("baselayer")&&-1==f[b].path.indexOf("baselayer")){a(f[b]);break}},f)};this.getNextLayer=function(a,f){this.getLayerRelative(a,f,1)};this.getPreviousLayer=function(a,f){this.getLayerRelative(a,
f,-1)};this.setStyle=function(a){debug("WMJSLayer::setStyle: "+a);if(0==this.styles.length)this.legendGraphic=this.currentStyle="",debug("Layer has no styles.");else{for(var f=0;f<this.styles.length;f++)if(this.styles[f].name==a){this.legendGraphic=this.styles[f].legendURL;this.currentStyle=this.styles[f].name;return}debug("WMJSLayer::setStyle: Style "+a+" not found, setting style "+this.styles[0].name);this.currentStyle=this.styles[0].name;this.legendGraphic=this.styles[0].legendURL}};this.getStyleObject=
function(a,f){if(0!=isDefined(this.styles))for(var g=0;g<this.styles.length;g++)if(this.styles[g].name==a)return-1===f&&g--,1===f&&g++,0>g&&(g=this.styles.length-1),g>this.styles.length-1&&(g=0),this.styles[g].nrOfStyles=this.styles.length,this.styles[g].index=g,this.styles[g]};this.getStyle=function(){return this.currentStyle};this.setService=function(a){this.getgraphinfoURL=this.getlegendgraphicURL=this.getfeatureinfoURL=this.getmapURL=this.service=a};this.getDimension=function(a){for(var f=0;f<
this.dimensions.length;f++)if(this.dimensions[f].name==a)return this.dimensions[f]};this.getProjection=function(a){for(var f=0;f<this.projectionProperties.length;f++)if(this.projectionProperties[f].srs==a)return a=[],a.srs=this.projectionProperties[f].srs+"",a.bbox=new WMJSBBOX(this.projectionProperties[f].bbox.left,this.projectionProperties[f].bbox.bottom,this.projectionProperties[f].bbox.right,this.projectionProperties[f].bbox.top),a};this.display=function(a){this.enabled=a;for(a=0;a<this.parentMaps.length;a++)this.parentMaps[a].displayLayer(this,
this.enabled)};a&&(this.getlegendgraphicURL=this.getfeatureinfoURL=this.getmapURL=this.service=a.service,this.name=a.name,a.getgraphinfoURL&&(this.getgraphinfoURL=a.getgraphinfoURL),a.style&&(this.currentStyle=a.style),this.format=a.format?a.format:"image/png",a.opacity&&(this.opacity=a.opacity),a.title&&(this.title=a.title),this.abstract=I18n.not_available_message.text,!1===a.enabled&&(this.enabled=!1),1==a.keepOnTop&&(this.keepOnTop=!0),!0===a.transparent&&(this.transparent=!0),!1===a.transparent&&
(this.transparent=!1),isDefined(a.onReady)&&(this.onReady=a.onReady,this.parseLayer(void 0,void 0,"WMJSLayer::configOptions")),isDefined(a.type)&&(this.type=a.type))};function WMJSBBOX(a,c,f,g){this.left=-180;this.bottom=-90;this.right=180;this.top=90;this.clone=function(a){void 0==a&&(a=this);var c=new WMJSBBOX;c.left=a.left;c.bottom=a.bottom;c.right=a.right;c.top=a.top;return c};this.copy=function(a){this.setBBOX(a)};this.setBBOX=function(a,c,f,g){if(void 0===a||null===a)this.left=-180,this.bottom=-90,this.right=180,this.top=90;else{if(!c)if("object"===typeof a){var e=a;void 0===e.length||null===e.length?(a=e.left,c=e.bottom,f=e.right,g=e.top):(a=parseFloat(e[0]),
c=parseFloat(e[1]),f=parseFloat(e[2]),g=parseFloat(e[3]))}else try{e=a.split(","),4!==e.length&&error("Invalid map bounding box: '"+a+"'"),a=parseFloat(e[0]),c=parseFloat(e[1]),f=parseFloat(e[2]),g=parseFloat(e[3])}catch(r){}if(void 0===a||void 0===c||void 0===f||void 0===g||null===a||null===c||null===f||null===g)void 0==a&&(a=-180),void 0==f&&(f=180),void 0==c&&(c=-90),void 0==g&&(g=90);this.left=a;this.bottom=c;this.right=f;this.top=g}};this.equals=function(b,c,f,g){if(!b)return!1;if(void 0!==c&&
this.left===b&&this.right===f&&this.top===g&&this.bottom===c)return!0;if("object"===typeof b){if(this.left===b.left&&this.right===b.right&&this.top===b.top&&this.bottom===b.bottom)return!0}else if(g=b.split(","),4!==g.length&&console.log("Invalid map bounding box: "+b),a=parseFloat(g[0]),c=parseFloat(g[1]),f=parseFloat(g[2]),g=parseFloat(g[3]),b=0,this.left===a&&b++,this.right===f&&b++,this.top===g&&b++,this.bottom===c&&b++,2<=b)return!0;return!1};this.toString=function(){return this.left+","+this.bottom+
","+this.right+","+this.top};this.setBBOX(a,c,f,g)};WMJSDateOutSideRange="outside range";WMJSDateTooEarlyString="date too early";WMJSDateTooLateString="date too late";
function WMJSDimension(a){this.parentLayer=this.defaultValue=this.currentValue=this.values=this.units=this.name=void 0;this.linked=!0;isDefined(a)&&(isDefined(a.name)&&(this.name=a.name),isDefined(a.units)&&(this.units=a.units),isDefined(a.values)&&(this.values=a.values),isDefined(a.currentValue)&&(this.currentValue=a.currentValue),isDefined(a.defaultValue)&&(this.defaultValue=a.defaultValue),isDefined(a.parentLayer)&&(this.parentLayer=a.parentLayer),isDefined(a.linked)&&(this.linked=a.linked));var c=
!1,f,g=[],b,d=[],l=function(a){if(1!=c&&isDefined(a.values)){c=!0;"ISO8601"==a.units?0<a.values.indexOf("/")?(b="timestartstopres",f=new parseISOTimeRangeDuration(a.values)):b="timevalues":(b="anyvalue",a.linked=!1);if("timestartstopres"!=b){for(var e=a.values.split(","),l=0;l<e.length;l++){var n=e[l].split("/");if(3==n.length){var l=parseFloat(n[0]),q=parseFloat(n[1]),n=parseFloat(n[2]),q=q+n;l>q&&(q=l);for(0>=n&&(n=1);l<q;l+=n)d.push(l)}else d.push(e[l])}if("timevalues"==b)for(l=0;l<d.length;l++)g[l]=
parseISO8601DateToDate(d[l])}isDefined(a.defaultValue)||(a.defaultValue=a.getValueForIndex(0));isDefined(a.currentValue)||(a.currentValue=a.getValueForIndex(0))}};this.getValue=function(){return isDefined(this.currentValue)?this.currentValue:this.defaultValue};this.setValue=function(a){a!=WMJSDateOutSideRange&&a!=WMJSDateTooEarlyString&&a!=WMJSDateTooLateString&&(this.currentValue=a)};this.setClosestValue=function(a){this.currentValue=this.getClosestValue(a)};this.getNextClosestValue=function(a){var b=
this.getClosestValue(a),b=this.getIndexForValue(b),b=this.getValueForIndex(b+1);return!b||"date too early"===b||moment(a)>=moment(b)?null:b};this.getClosestValue=function(a){var b=-1,c=WMJSDateOutSideRange;try{b=this.getIndexForValue(a),c=this.getValueForIndex(b)}catch(d){"number"===typeof d&&(c=0==d?WMJSDateTooEarlyString:WMJSDateTooLateString)}"current"==a||"default"==a||""==a?c=this.defaultValue:"latest"==a?c=this.getValueForIndex(dim.size()-1):"earliest"==a?c=this.getValueForIndex(0):"middle"==
a&&(a=this.size()/2-1,0>a&&(a=0),c=this.getValueForIndex(a));return c};this.getValueForIndex=function(a){l(this);if(0>a)return-1==a?WMJSDateTooEarlyString:-2==a?WMJSDateTooLateString:-1;if("timestartstopres"==b){try{return f.getDateAtTimeStep(a).toISO8601()}catch(c){}return f.getDateAtTimeStep(a)}if("timevalues"==b||"anyvalue"==b)return d[a]};this.get=function(a){return this.getValueForIndex(a)};this.getIndexForValue=function(a,c){l(this);isDefined(c)||(c=!0);if("string"===typeof a&&"current"==a&&
"current"!=this.defaultValue)return this.getIndexForValue(this.defaultValue);if("timestartstopres"==b)try{return"string"===typeof a?f.getTimeStepFromISODate(a,c):f.getTimeStepFromDate(a,c)}catch(z){return 0==parseInt(z)?-1:-2}if("timevalues"==b)try{for(var r=parseISO8601DateToDate(a).getTime(),n,q=0,u=0;u<d.length;u++){var E=g[u].getTime()-r;0>E&&(E=-E);0==u&&(n=E);E<n&&(n=E,q=u)}return q}catch(z){return error("WMSJDimension::getIndexForValue,2: "+z),-1}if("anyvalue"==b)for(u=0;u<d.length;u++)if(d[u]==
a)return u;return-1};this.size=function(){l(this);if("timestartstopres"==b)return f.getTimeSteps();if("timevalues"==b||"anyvalue"==b)return d.length};this.clone=function(){var a=new WMJSDimension;a.name=this.name;a.units=this.units;a.values=this.values;a.currentValue=this.currentValue;a.defaultValue=this.defaultValue;a.parentLayer=this.parentLayer;a.linked=this.linked;return a};l(this)};var WMSVersion={version100:"1.0.0",version111:"1.1.1",version130:"1.3.0"},WMJSGetCapabilities=function(a,c,f,g){if(0==isDefined(a))g(I18n.no_service_defined.text);else if(0==a.length)g(I18n.service_url_empty.text);else{var b=xml2jsonrequestURL+"request=";-1==a.indexOf("?")&&(a+="?");debug("GetCapabilities:");a+="&service=WMS&request=GetCapabilities";debug("<a target='_blank' href='"+a+"'>"+a+"</a>",!1);b+=URLEncode(a);debug(b);debug(URLEncode(a));debug(a);try{$.ajax({url:b,crossDomain:!0,dataType:"jsonp"}).done(function(a){f(a)}).fail(function(){var a=
{error:"Request failed for "+b};console.log("errormesasge");g(I18n.unable_to_do_getcapabilities.text+":\n"+b+"\n"+I18n.result.text+":\n"+a)})}catch(d){console.log("catch: ",d)}}},WMJSServiceStore=[],WMJSgetServiceFromStore=function(a){for(var c=0;c<WMJSServiceStore.length;c++)if(WMJSServiceStore[c].service==a)return WMJSServiceStore[c];a=new WMJSService({service:a});WMJSServiceStore.push(a);return a};
function WMJSService(a){function c(a,b){return a.sort(function(a,c){var d=a[b],f=c[b];return d<f?-1:d>f?1:0})}this.abstract=this.onlineresource=this.title=this.service=void 0;this.version=WMSVersion.version111;this.getcapabilitiesDoc=void 0;this.busy=!1;var f,g=this;a&&(this.service=a.service,this.title=a.title);this.getCapabilityElement=function(a){var b;try{b=a.WMT_MS_Capabilities.Capability}catch(c){try{b=a.WMS_Capabilities.Capability}catch(e){throw I18n.no_capability_element_found.text;}}if(!isDefined(b))throw I18n.no_capability_element_found.text;
return b};this.checkVersion=function(a){var b=WMSVersion.version111;try{WMSVersion.version100==a.WMT_MS_Capabilities.attr.version&&(b=WMSVersion.version100),WMSVersion.version111==a.WMT_MS_Capabilities.attr.version&&(b=WMSVersion.version111),WMSVersion.version130==a.WMT_MS_Capabilities.attr.version&&(b=WMSVersion.version130)}catch(c){try{WMSVersion.version100==a.WMS_Capabilities.attr.version&&(b=WMSVersion.version100),WMSVersion.version111==a.WMS_Capabilities.attr.version&&(b=WMSVersion.version111),
WMSVersion.version130==a.WMS_Capabilities.attr.version&&(b=WMSVersion.version130)}catch(e){throw g.checkException(a);}}return b==WMSVersion.version111||b==WMSVersion.version130?b:WMSVersion.version111};var b=[];this.getCapabilities=function(a,c,g){f=void 0;var e=this;if(this.busy)a={callback:a,fail:c},b.push(a);else if(e.getcapabilitiesDoc&&1!=g)a(this.getcapabilitiesDoc);else{e.busy=!0;var r=function(a){e.busy=!1;for(var c=0;c<b.length;c++)b[c].fail(a),b[c].fail=function(){};b=[]};a={callback:a,
fail:c};b.push(a);WMJSGetCapabilities(this.service,!1,function(a){e.busy=!1;e.getcapabilitiesDoc=a;try{e.version=e.checkVersion(a)}catch(c){r(c);return}var d=a.WMS_Capabilities;d||(d=a.WMT_MS_Capabilities);try{e.abstract=d.Service.Abstract.value}catch(c){this.abstract=I18n.not_available_message.text}try{e.title=d.Service.Title.value}catch(c){this.title=I18n.not_available_message.text}try{e.onlineresource=d.Service.OnlineResource.value?d.Service.OnlineResource.value:d.Service.OnlineResource.attr["xlink:href"]}catch(c){e.onlineresource=
I18n.not_available_message.text}for(d=0;d<b.length;d++)b[d].callback(a),b[d].callback=function(){};b=[];e.busy=!1},r)}};this.checkException=function(a){if(a.ServiceExceptionReport){var b="Undefined",c=b;if(a=a.ServiceExceptionReport.ServiceException){try{a.attr.code&&(b=a.attr.code)}catch(e){}if(a.value)return c=a.value,"Exception: "+b+".\n"+c}return I18n.wms_service_exception_code.text+b}};this.getNodes=function(a,b,f){this.nodeCache=void 0;b||(b=function(a){error(a)});var e=function(e){function f(a,
b,e){for(var d=0;d<a.length;d++){var g=!1;a[d].Name&&(g=!0);try{a[d].Layer&&(g=!1)}catch(l){}a[d].Name?g={name:a[d].Name.value,text:a[d].Title.value,leaf:g,path:e}:(isNull(a[d].Title)&&(a[d].Title=[],a[d].Title.value="Layer"),g={text:a[d].Title.value,leaf:g});b.push(g);a[d].Layer&&(g.children=[],f(toArray(a[d].Layer),g.children,e+a[d].Title.value))}c(b,"text")}var m={},u=g.getCapabilityElement(e).Layer;try{g.version=g.checkVersion(e)}catch(E){b(E);return}e=toArray(u.Layer);try{m.text=u.Title.value}catch(E){m.text=
I18n.unnamed_service.text}m.leaf=!1;m.expanded=!0;m.children=[];f(e,m.children,"");a(m)};this.getCapabilities(function(a){e(a)},function(a){b(a)},f)};this.getLayerNames=function(a,b){this.getNodes(function(b){var c=[],f=function(a){for(var b=0;b<a.length;b++)a[b].name&&c.push(a[b].name),a[b].children&&f(a[b].children)};f(b.children);a(c)},b)};this.getLayerObjectsFlat=function(a,b){isDefined(f)&&a(f);this.getNodes(function(b){var c=[],f=function(a){for(var b=0;b<a.length;b++)a[b].name&&c.push(a[b]),
a[b].children&&f(a[b].children)};f(b.children);a(c)},b)}};function WMJSListener(){function a(){this.functionpointer=this.name=void 0;this.finished=0;this.keepOnCall=!1}var c=[],f=0,g=[],b=this;this.addToCallback=function(b,g,m){var e=-1;m||(m=!1);for(var r=0;r<f;r++){if(1===c[r].finished){e=r;break}if(c[r].name===b&&c[r].functionpointer===g)return c[r].keepOnCall=m,!1}-1===e&&(e=f,f++,c[e]=new a);c[e].name=b;c[e].functionpointer=g;c[e].finished=0;c[e].keepOnCall=m;return!0};this.removeEvents=function(a,b){for(var g=0;g<f;g++)0===c[g].finished&&c[g].name===
a&&(b?c[g].functionpointer===b&&(c[g].finished=1):c[g].finished=1)};this.suspendEvent=function(a){g[a]=!0};this.resumeEvent=function(a){g[a]=!1};this.triggerEvent=function(a,l){if(!0!==g[a]){for(var m=[],e=0,r=0;r<f;r++)if(0===c[r].finished&&c[r].name===a){!1===c[r].keepOnCall&&(c[r].finished=1);try{e++,m.push(c[r].functionpointer(l,b))}catch(n){console.log("Error for event "+a+" with "+l),console.log(n)}}return m}}};function WMJSTimer(){function a(){g&&clearTimeout(f);g=!1}function c(){0==d?(a(),""!=m&&m()):(--d,g=!0,f=self.setTimeout(function(){c()},b))}this.init=function(b,f){d=parseInt(b/10+.5);1>d&&(d=1);l=d;m=f;a();0<d&&c()};this.reset=function(){d=l};this.stop=function(){a()};var f=null,g=!1,b=10,d,l,m=""}var WMJSDebouncer=function(){var a=!1,c=10;this.init=function(f,g){c=f;10>c&&(c=10);!1===a&&(self.setTimeout(function(){a=!1;g()},c),a=!0)}};var sliderTooltip=function(a){isDefined(a)?(a='<div class="slidertooltip"><div class="slidertooltip-inner">'+a+"</div></div>",$(".relativecontrol .ui-slider-handle").html(a)):$(".ui-slider-handle .relativecontrol").html("")},RelativeSlider=function(a){var c=this,f=a.renderTo;$('<input class="datetimepicker"/><br/><span class="relativeslider"/><span class="timeprevious"/><span class="timenext"/>').appendTo(f);var g=0,b=function(b){g+=b;NaN<g&&(g=NaN);0>g&&(g=0);isDefined(a.change)&&a.change(c,g)},
d=function(a){return parseInt(a-50)},l=f.find(".relativeslider").slider({min:0,max:100,value:50,animate:1E3,change:function(a,c){if(a.originalEvent){var f=d(c.value);b(f);50!=c.value&&l.slider("value",50)}},slide:function(b,f){var l=d(f.value),m=g,l=g+l;void 0<l&&(l=void 0);0>l&&(l=0);isDefined(a.slide)&&a.slide(c,l);g=m}});l.addClass("relativecontrol");f.find(".timeprevious").iconbutton({text:!1,icons:{primary:"ui-icon-circle-triangle-w"}});f.find(".timenext").iconbutton({text:!1,icons:{primary:"ui-icon-circle-triangle-e"}});
f.find(".timeprevious").click(function(){b(-1)});f.find(".timenext").click(function(){b(1)});var m=f.find(".datetimepicker").datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss",separator:"T",showOn:"button",buttonText:"",altFieldTimeOnly:!1,showAnim:"slideDown",changeMonth:!0,changeYear:!0,showTimezone:!1,onSelect:function(a,b){var d=c.setPositionByText(a);a!=d.dimvalue&&m.datetimepicker("setDate",d.dimvalue.replace("Z",""))},css:{zIndex:4E3}});this.setPosition=function(a){g=a};this.setPositionByText=
function(b){if(isDefined(a.textUpdate))return a.textUpdate(c,b)};this.setText=function(a,b){a=a.replace("Z","");f.find(".datetimepicker").val(a)};this.setMax=function(a,b,c){m.datetimepicker("option",{minDate:b.replace("Z",""),maxDate:c.replace("Z","")})}},TimeSlider=function(a){var c,f;this.setDimension=function(a,b,d){c=a;isDefined(void 0)&&(void 0).setMax(a.size(),a.getValueForIndex(0),a.getValueForIndex(a.size()-1));f="";this.setValue(a.name,a.getValue())};this.setValue=function(a,b){if(isDefined(c)&&
"time"==a&&f!=b){f=b;var d;try{d=c.getIndexForValue(b)}catch(l){d=c.size()-1,b=c.getValueForIndex(d),debug("Date "+b+" is outside range: "+d)}isDefined(void 0)&&((void 0).setText(b),(void 0).setPosition(d));return{index:d,dimvalue:b}}}};var WMJSProcessing=function(a){var c=a.url,f=!1;a.failure||(a.failure=function(a){alert(dump(a))});var g=function(b){var c;try{c=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessAccepted"].value}catch(g){}if(isDefined(c)){var l=b["wps:ExecuteResponse"].attr.statusLocation,m=new WMJSTimer,e=function(b){if(0!=f){var c,e,d,g,l;b.error&&(g=!0,l=b.error);try{g=!0,l=dump(b.ExceptionReport.Exception)}catch(m){}try{g=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessFailed"],l="Process failed",l=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessFailed"]["wps:ExceptionReport"]["ows:Exception"]["ows:ExceptionText"].value}catch(m){}if(isDefined(g))f=
!1,a.failure({message:l});else{try{c=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessSucceeded"].value}catch(m){}try{e=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessStarted"].attr.percentCompleted,d=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessStarted"].value,0==d.indexOf("processstarted")&&(d=d.substr(14))}catch(m){}isDefined(c)?(c=b["wps:ExecuteResponse"]["wps:ProcessOutputs"]["wps:Output"],a.progress(100,"completed"),a.success(c,b),f=!1):a.progress(parseFloat(e),d)}}},r=function(){$.ajax({dataType:"jsonp",
url:xml2jsonrequestURL+"request="+URLEncode(l),data:"",success:e}).fail(function(b){f=!1;a.failure({message:"<h1>Invalid JSON returned from server:</h1><hr/>"+b.responseText})});f&&m.init(1E3,r)};r()}else{c="";try{c=dump(b.ExceptionReport.Exception.attr),a.failure({message:"Process was not accepted, ExceptionReport:\n"+c})}catch(g){b.error?(b.message||(b.message=b.error),a.failure(b)):(c=dump(b),a.failure({message:"Process was not accepted (dump):\n"+c}))}}};this.execute=function(b,d){f=!0;var l=
c+"service=WPS&request=execute&identifier="+b+"&version=1.0.0&storeExecuteResponse=true&status=true&",l=l+"datainputs=",m="",e;for(e in d)if("object"===typeof d[e])for(var r in d[e])0<m.length&&(m+=";"),m+=e+"="+encodeURIComponent(d[e][r]);else 0<m.length&&(m+=";"),m+=e+"="+encodeURIComponent(d[e]);$.ajax({dataType:"jsonp",url:xml2jsonrequestURL,data:{request:l+m},success:g}).fail(function(b){a.failure({message:b.responseText})})}};var WMJSCoverage=function(a){this.service=this.name=void 0;this.dimensions=[];this.supportedProjections=[];this.nativeFormat=this.nativeCRS=this.originY=this.originX=this.cellsizeY=this.cellsizeX=this.height=this.width=void 0;this.formats=[];this.setDimension=function(a,f){this.dimensions.push({name:a,value:f,currentValue:f})};isDefined(a)&&(this.name=a.name,this.service=a.service)},WCJSRequest=function(a,c,f,g){var b=xml2jsonrequestURL+"request=";-1==a.indexOf("?")&&(a+="?");debug("GetCapabilities:");
var d=a+"&service=WCS&REQUEST=DescribeCoverage&COVERAGE="+c;debug("<a target='_blank' href='"+d+"'>"+d+"</a>",!1);b+=URLEncode(d);$.ajax({dataType:"jsonp",url:b,success:function(b){b.service=a;b.name=c;f(b)},error:function(a){g(I18n.unable_to_do_getcapabilities.text+":\n"+b+"\n"+I18n.result.text+":\n"+a)}})},parseDescribeCoverage=function(a,c){var f;f=c?c:new WMJSCoverage;f.service=a.service;try{f.name=a.CoverageDescription.CoverageOffering.name.value}catch(e){alert("This layer has no Web Coverage Service.");
return}f.title=a.CoverageDescription.CoverageOffering.label.value;f["abstract"]=a.CoverageDescription.CoverageOffering.description.value;var g=a.CoverageDescription.CoverageOffering.lonLatEnvelope["gml:pos"][0].value.replaceAll(" ",","),b=a.CoverageDescription.CoverageOffering.lonLatEnvelope["gml:pos"][1].value.replaceAll(" ",",");f.lonlatbox=new WMJSBBOX(g+","+b);for(var d=toArray(a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:Envelope"]),l=0;l<d.length;l++){var m=d[l].attr.srsName,
g=d[l]["gml:pos"][0].value.replaceAll(" ",","),b=d[l]["gml:pos"][1].value.replaceAll(" ",","),g=new WMJSBBOX(g+","+b);f.supportedProjections.push({srs:m,bbox:g.toString()})}l=a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:RectifiedGrid"]["gml:limits"]["gml:GridEnvelope"]["gml:high"].value.split(" ");f.width=parseInt(l[0])+1;f.height=parseInt(l[1])+1;f.cellsizeX=parseFloat(a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:RectifiedGrid"]["gml:offsetVector"][0].value.split(" ")[0]);
f.cellsizeY=parseFloat(a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:RectifiedGrid"]["gml:offsetVector"][1].value.split(" ")[1]);f.originX=a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:RectifiedGrid"]["gml:origin"]["gml:pos"].value.split(" ")[0];f.originY=a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:RectifiedGrid"]["gml:origin"]["gml:pos"].value.split(" ")[1];f.nativeCRS=a.CoverageDescription.CoverageOffering.supportedCRSs.nativeCRSs?
a.CoverageDescription.CoverageOffering.supportedCRSs.nativeCRSs.value:"EPSG:4326";f.nativeFormat=a.CoverageDescription.CoverageOffering.supportedFormats.attr.nativeFormat;d=toArray(a.CoverageDescription.CoverageOffering.supportedFormats.formats);for(l=0;l<d.length;l++)f.formats.push(d[l].value);return f};var WMJSImage=function(a,c,f,g){var b=this,d=!0;isDefined(g)&&isDefined(g.randomizer)&&!1===g.randomizer&&(d=!1);var l,m,e,r,n;b.init=function(){l="undefined image";r=e=m=!1;n=1};b.init();this.srcToLoad=a;b.isLoaded=function(){return e?!1:m};b.isLoading=function(){return e};b.checkIfThisSourceIsSet=function(a){return l==a||this.srcToLoad==a?!0:!1};b.setSource=function(a){e||(this.srcToLoad=a,m=l==this.srcToLoad?!0:!1)};b.clear=function(){b.init()};b.getSrc=function(){return this.srcToLoad};b.hasError=
function(){return r};b.load=function(){r=!1;1==m?q(b):(e=!0,this.srcToLoad==l?q(b):(u.load(function(){q(b,!1)}),u.error(function(){q(b,!0)}),d?u.attr("src",this.srcToLoad+"&"+Math.random()):u.attr("src",this.srcToLoad)))};var q=function(a,d){if(0!=e||1!=m)r=d,e=!1,m=!0,l=this.srcToLoad,isDefined(c)&&c(b)};b.setOpacity=function(a){n=parseFloat(a);u.css("opacity",n)};b.getOpacity=function(a){return n};b.setPosition=function(a,b){u.css({top:parseInt(b)+"px",left:parseInt(a)+"px",position:"absolute"})};
b.setSize=function(a,b){a=parseInt(a);b=parseInt(b);0===a||0===b||isNaN(a)||isNaN(b)||(u.width(parseInt(a)+"px"),u.height(parseInt(b)+"px"))};b.setZIndex=function(a){u.zIndex=a};b.getElement=function(){return u};var u=$(document.createElement("img"));u.onselectstart=function(){return!1};u.ondrag=function(){return!1};return b};var WMJSCanvasBuffer=function(a,c,f,g,b){var d=this;this.canvas=$("<canvas/>",{"class":"WMJSCanvasBuffer"}).width(g).height(b);var l=d.canvas[0].getContext("2d");l.canvas.width=g;l.canvas.height=b;this.hidden=this.ready=!0;this.layerstodisplay=[];this.layers=[];var m=g,e=b;"imagebuffer"===c&&this.canvas.addClass("wmjsimagebuffer");"legendbuffer"===c&&this.canvas.addClass("wmjslegendbuffer");this.canvas.addClass("WMJSCanvasBuffer-noselect");this.getCanvasContext=function(){return l};this.imageLoadComplete=
function(b){r();a.triggerEvent("onimageload")};var r=function(){for(var a=0;a<d.layers.length;a++)if(!1===d.layers[a].isLoaded())return;d.finishedLoading()},n=new WMJSImage("webmapjs/img/stoploading.png",function(){console.log("fake image loaded");r()},c);this.hide=function(){d.hidden=!0;d.canvas.hide();d.layers=[]};this.display=function(b,f){if(b&&!f)console.log("skipping WMJSCanvasBuffer:display because newbbox is undefined");else{d.hidden=!1;l.globalAlpha=1;"legendbuffer"===c&&l.clearRect(0,0,
m,e);"imagebuffer"===c&&(l.beginPath(),l.rect(0,0,m,e),l.fillStyle="white",l.fill(),a.triggerEvent("beforecanvasstartdraw",l));var g,n;b&&(g=q({x:f.left,y:f.top},b),n=q({x:f.right,y:f.bottom},b));for(var r=0,u=0;u<d.layerstodisplay.length;u++)if(d.layerstodisplay[u].setSize(m,e),!1===d.layerstodisplay[u].hasError()){var k=d.layerstodisplay[u].getOpacity();l.globalAlpha=k;k=d.layerstodisplay[u].getElement()[0];if("legendbuffer"===c){var E=parseInt(k.width)+4,G=parseInt(k.height)+4,r=r+(E+4),A=m-r+
2,w=e-G-2;l.beginPath();l.fillStyle="#FFFFFF";l.lineWidth=.3;l.globalAlpha=.5;l.strokeStyle="#000000";l.rect(parseInt(A)+.5,parseInt(w)+.5,E,G);l.fill();l.stroke();l.globalAlpha=1;l.drawImage(k,A,w)}else b?(E=parseInt(g.x+.5),G=parseInt(g.y+.5),A=parseInt(n.x-g.x+.5),w=parseInt(n.y-g.y+.5),A===parseInt(l.canvas.width)&&w===parseInt(l.canvas.height)?l.drawImage(k,E,G):l.drawImage(k,E,G,A,w)):l.drawImage(k,0,0,m,e)}else error("<a target='_blank' href='"+d.layerstodisplay[u].getSrc()+"'>"+d.layerstodisplay[u].getSrc()+
"</a>",!1);l.globalAlpha=1;"imagebuffer"===c&&a.triggerEvent("beforecanvasdisplay",l);d.canvas.show();"imagebuffer"===c&&a.triggerEvent("aftercanvasdisplay",l)}};this.finishedLoading=function(){if(!d.ready){d.ready=!0;for(var a=0;a<d.layers.length;a++)d.layerstodisplay[a]=d.layers[a];try{if(isDefined(d.onLoadReadyFunction))d.onLoadReadyFunction(d)}catch(b){error("Exception in Divbuffer::finishedLoading: "+b)}}};this.setPosition=function(a,b){console.log("setPosition is deprecated")};this.setSize=
function(a,b){console.log("setSize is deprecated")};this.resize=function(a,b){a=parseInt(a);b=parseInt(b);if(m!==a||e!==b)m=a,e=b,d.canvas.width(a),d.canvas.height(b),l.canvas.height=b,l.canvas.width=a};this.load=function(a){if(!1!==d.ready){d.ready=!1;d.layerstodisplay=[];a?this.onLoadReadyFunction=a:d.onLoadReadyFunction=function(){};for(a=d.nrLoading=0;a<this.layers.length;a++)d.layers[a].loadThisOne=!1,!1===d.layers[a].isLoaded()&&(d.layers[a].loadThisOne=!0,d.nrLoading++);if(0===this.nrLoading)r();
else{"imagebuffer"===c&&debug("GetMap:");"legendbuffer"===c&&debug("GetLegendGraphic:");for(a=0;a<this.layers.length;a++)!0===this.layers[a].loadThisOne&&debug("<a target='_blank' href='"+this.layers[a].getSrc()+"'>"+this.layers[a].getSrc()+"</a>",!1);for(a=0;a<this.layers.length;a++)!0===this.layers[a].loadThisOne&&this.layers[a].load()}}};this.setSrc=function(a,b,c,e){if(isDefined(b)){for(;a>=this.layers.length;)this.layers.push(n);b=f.getImage(b);b.setZIndex(a);this.layers[a]=b}else console.log("undefined")};
var q=function(a,b){return{x:m*(a.x-b.left)/(b.right-b.left),y:e*(a.y-b.top)/(b.bottom-b.top)}},u,E;this.setBBOX=function(a,b){if(u!==b+""||E!==a+"")u=b+"",E=a+"",!1===d.hidden&&d.display(a,b)};this.setOpacity=function(a,b){if(a>=this.layers.length)error("setOpacity :invalid id");else{var c=parseFloat(b);this.layers[a].getOpacity()!==c&&this.layers[a].setOpacity(c)}};this.getBuffer=function(){return d.canvas}};function WMJSTimeSelector(a,c,f){var g=function(){this.values=[]};g.prototype.add=function(a){if(!0===this[a])return!1;this[a]=!0;this.values.push(a);return!0};var b=this;this.element=a;this.webmapjs=void 0;this.values=[];var d=24;isDefined(f)&&(d=f);var l=$('<div class="WMJSTimeSelector-controlElement WMJSTimeSelector-noselect"/>',{}),m=$('<div class="WMJSTimeSelector-timeChooserElement WMJSTimeSelector-noselect"/>',{}),e=$('<div class="WMJSTimeSelector-timeinfo WMJSTimeSelector-noselect"/>',{}),
r=$('<div class=""WMJSTimeSelector-controlElementBottom WMJSTimeSelector-noselect"/>',{});this.element.append(e);this.element.append(l);this.element.append(m);this.element.append(r);a=$("<button>&lt;&lt;</button>").button().click(function(){var a=b.makeDateList(b.webmapjs,b.currentValue,d);Q(a[0])});f=$("<button>&gt;&gt;</button>").button().click(function(){var a=b.makeDateList(b.webmapjs,b.currentValue,d);Q(a[a.length-1])});var n=$("<button>&lt;</button>").button().click(function(){for(var a=b.makeDateList(b.webmapjs,
b.currentValue,d),c=1;c<a.length;c++)if(a[c]==b.currentValue){Q(a[c-1]);return}Q(a[0])}),q=$("<button>&gt;</button>").button().click(function(){for(var a=b.makeDateList(b.webmapjs,b.currentValue,d),c=0;c<a.length-1;c++)if(a[c]==b.currentValue){Q(a[c+1]);return}Q(a[a.length-1])});l.append("<table class='WMJSTimeSelector-table'><tr><th>"+I18n.year.text+"</th><th>"+I18n.month.text+"</th><th>"+I18n.day.text+"</th><th>"+I18n.hour.text+"</th><th>"+I18n.min.text+"</th></tr><tr><td><input class='WMJSTimeSelector_yearspinner'/></td><td><input class='WMJSTimeSelector_monthspinner'/></td><td><input class='WMJSTimeSelector_dayspinner'/></td><td><input class='WMJSTimeSelector_hourspinner'/></td><td><input class='WMJSTimeSelector_minutespinner'/></td></tr>");
var u=$("<button>"+I18n.load_all.text+"</button>").button().click(function(){for(var a=b.values,c=0;c<a.length;c++)D(a[c])}),E=$("<button>"+I18n.play_animation.text+"</button>").button().click(function(){for(var a=b.values,c=[],e=0;e<a.length;e++)D(a[e]),c.push({name:"time",value:a[e]});b.webmapjs.draw(c)}),z=$("<button>"+I18n.stop.text+"</button>").button().click(function(){b.webmapjs.stopAnimating()});r.append(u);r.append(E);r.append(z);var C=l.find(".WMJSTimeSelector_yearspinner"),t=l.find(".WMJSTimeSelector_monthspinner"),
K=l.find(".WMJSTimeSelector_dayspinner"),F=l.find(".WMJSTimeSelector_hourspinner"),T=l.find(".WMJSTimeSelector_minutespinner"),k=l.find(".WMJSTimeSelector_secondspinner"),r=$('<div class="WMJSTimeSelector_timebuttons"/>',{});r.append(a);r.append(n);r.append(q);r.append(f);l.append(r);var fa="",G=function(a,b){for(a=""+a;a.length<b;)a="0"+a;return a},A=function(a,c){var e=fa;"year"==a&&(e=[G(c,4),e.slice(4)].join(""));"month"==a&&(e=[e.slice(0,5),G(c,2),e.slice(7)].join(""));"day"==a&&(e=[e.slice(0,
8),G(c,2),e.slice(10)].join(""));"hour"==a&&(e=[e.slice(0,11),G(c,2),e.slice(13)].join(""));"minute"==a&&(e=[e.slice(0,14),G(c,2),e.slice(16)].join(""));"second"==a&&(e=[e.slice(0,17),G(c,2),e.slice(19)].join(""));var d=parseISO8601DateToDate(e),e=d.toISO8601();if(e!=b.currentValue){var f=b.makeDateList(b.webmapjs,e,3);if(f[1]==b.currentValue){var g=parseISO8601DateToDate(f[1]);d>g?e=f[2]:d<g&&(e=f[0])}}e!=fa&&(w(e),Q(e));return!1},w=function(a){isDefined(a)&&(fa=a,C.spinner("value",a.substring(0,
4)),t.spinner("value",a.substring(5,7)),K.spinner("value",a.substring(8,10)),F.spinner("value",a.substring(11,13)),T.spinner("value",a.substring(14,16)),k.spinner("value",a.substring(17,19)))};C.spinner({spin:function(a,b){return A("year",b.value)},change:function(a,b){A("year",$(a.target).spinner("value"))},numberFormat:"d4"});t.spinner({spin:function(a,b){return A("month",b.value)},change:function(a,b){A("month",$(a.target).spinner("value"))},numberFormat:"d2"});K.spinner({spin:function(a,b){return A("day",
b.value)},change:function(a,b){A("day",$(a.target).spinner("value"))},numberFormat:"d2"});F.spinner({spin:function(a,b){return A("hour",b.value)},change:function(a,b){A("hour",$(a.target).spinner("value"))},numberFormat:"d2"});T.spinner({spin:function(a,b){return A("minute",b.value)},change:function(a,b){A("minute",$(a.target).spinner("value"))},numberFormat:"d2"});k.spinner({spin:function(a,b){return A("second",b.value)},change:function(a,b){A("second",$(a.target).spinner("value"))},numberFormat:"d2"});
C.spinner().keyup(function(a,b){13==(a.keyCode||a.which)&&A("year",$(event.target).spinner("value"))});t.spinner().keyup(function(a,b){13==(a.keyCode||a.which)&&A("month",$(event.target).spinner("value"))});K.spinner().keyup(function(a,b){13==(a.keyCode||a.which)&&A("day",$(event.target).spinner("value"))});F.spinner().keyup(function(a,b){13==(a.keyCode||a.which)&&A("hour",$(event.target).spinner("value"))});T.spinner().keyup(function(a,b){13==(a.keyCode||a.which)&&A("minute",$(event.target).spinner("value"))});
k.spinner().keyup(function(a,b){13==(a.keyCode||a.which)&&A("second",$(event.target).spinner("value"))});this.loadingComplete=function(a){this.generate(a,!1,!0)};this.dimensionUpdate=function(a){this.generate(a,!0,!0)};this.dimensionChange=function(a){this.generate(a,!1,!1)};var ba=function(a){w(a);a=parseISO8601DateToDate(a);$(e).html(I18n.local_time.text+":<br/><b>"+a.toString().replace(/GMT.*/g,"")+"</b>")},Q=function(a){b.webmapjs.stopAnimating();ba(a);c(a)};this.makeDateList=function(a,b,c){var e=
[];a=a.getLayers();for(var d=0;d<a.length;d++)if(1==a[d].enabled){var f=a[d].getDimension("time");f&&e.push(f)}a=new g;for(d=0;d<c;d++)for(var k=0;k<e.length;k++){var l=e[k],f=l.getIndexForValue(b,!1),m=d+f;0>m&&(m=0);m>l.size()-1&&(m=l.size()-1);0<=m&&m<l.size()&&a.add(l.getValueForIndex(m));m=-d+f;0>m&&(m=0);m>l.size()-1&&(m=l.size()-1);0<=m&&m<l.size()&&a.add(l.getValueForIndex(m))}a.values.sort();for(d=e=0;d<a.values.length;d++)if(b==a.values[d]){e=d;break}k=0;b=new g;for(d=0;d<c;d++){f=e+d;if(0<
f&&f<a.values.length&&1==b.add(a.values[f])&&(k++,k>c))break;f=e-d;if(0<f&&f<a.values.length&&1==b.add(a.values[f])&&(k++,k>c))break}b.values.sort();c=[];for(d=0;d<b.values.length;d++)c.push(b.values[d]);return c};var p=function(a){if(!b.webmapjs)return!1;var c=b.webmapjs.getDimension("time");if(!isDefined(c))return!1;c=c.currentValue;b.webmapjs.suspendEvent("ondimchange");b.webmapjs.suspendEvent("ondimupdate");b.webmapjs.setDimension("time",a);a=function(){var a=b.webmapjs.getWMSRequests();if(0==
a.length)return!1;for(var c=0;c<a.length;c++)if(0==b.webmapjs.isThisRequestLoaded(a[c]))return!1;return!0}();b.webmapjs.setDimension("time",c);b.webmapjs.resumeEvent("ondimchange");b.webmapjs.resumeEvent("ondimupdate");return a},D=function(a){if(!b.webmapjs)return!1;var c=b.webmapjs.getDimension("time");if(!isDefined(c))return!1;c=c.currentValue;b.webmapjs.suspendEvent("ondimchange");b.webmapjs.suspendEvent("ondimupdate");b.webmapjs.setDimension("time",a);a=[];var e=b.webmapjs.getWMSRequests();if(0==
e.length)a=!1;else for(var d=0;d<e.length;d++)0==b.webmapjs.isThisRequestLoaded(e[d])&&a.push(e[d]);b.webmapjs.prefetch(a);b.webmapjs.setDimension("time",c);b.webmapjs.resumeEvent("ondimchange");b.webmapjs.resumeEvent("ondimupdate");return a};this.generate=function(a,c,f){this.webmapjs=a;if(a.getDimension("time")){l.show();e.show();var g=a.getDimension("time").currentValue;if("current"==g)for(var k=a.getLayers(),n=0;n<k.length;n++){var r=k[n].getDimension("time");r&&(g=r.getValueForIndex(r.getIndexForValue(g,
!1)))}b.currentValue=g;ba(b.currentValue);if(0==c){c=!1;if(isDefined(b.values))for($(b.element).find(".WMJSTimeSelector-tr").removeClass("WMJSTimeSelector-col-selected"),n=0;n<b.values.length;n++)k=!1,r=$(b.element).find(".WMJSTimeSelector-tr:eq("+n+")"),!0===f&&(k=!1,r.hasClass("WMJSTimeSelector-col-loaded")&&(k=!0),k||(k=1==p(b.values[n])),k?r.addClass("WMJSTimeSelector-col-loaded"):r.removeClass("WMJSTimeSelector-col-loaded")),b.currentValue==b.values[n]&&(b.currentValue=g,r.addClass("WMJSTimeSelector-col-selected"),
c=!0);if(1==c)return}b.values=b.makeDateList(a,g,d);a="<table class='WMJSTimeSelector-table WMJSTimeSelector-noselect'>";f=function(a){var b="WMJSTimeSelector-tr";1==a.isLoaded&&(b+=" WMJSTimeSelector-col-loaded");a.value==g&&(b+=" WMJSTimeSelector-col-selected");return"<tr class='"+b+"'>"+("<td class='WMJSTimeSelector-colindex'>"+a.index+"</td><td class='WMJSTimeSelector-col'>"+a.textdate+"</td><td class='WMJSTimeSelector-colindex'>"+a.index+"</td><td class='WMJSTimeSelector-col'>"+a.texttime+"</td>")+
"</tr>"};c={};for(n=0;n<b.values.length;n++)c.index=n,c.value=b.values[n],c.text=c.value.replace(/T/g," | "),c.text=c.text.replace(/Z/g," "),c.textdate=c.value.split("T")[0],c.texttime=c.value.split("T")[1],c.texttime=c.texttime.split(":")[0]+":"+c.texttime.split(":")[1]+"z",c.isLoaded=p(c.value),a+=f(c);n=""+(a+"</table>");$(m).html(n);var q=function(a){a=$(a.target).parent().find("td").first().html();Q(b.values[a])};$(b.element).find(".WMJSTimeSelector-tr").mouseover(function(a){0!=ea&&q(a)});$(b.element).find(".WMJSTimeSelector-tr").mousedown(q)}else $(m).html(I18n.no_dimensions_available.text),
l.hide(),e.hide(),b.currentValue="",b.values=[]};var ea=!1;$(document).mousedown(function(){ea=!0}).mouseup(function(){ea=!1});$(b.element).bind("mousewheel",function(a){var b=0;try{isDefined(a.originalEvent.deltaY)&&(b=a.originalEvent.deltaY)}catch(c){}0==b&&(b=0<a.originalEvent.wheelDelta/120?-1:1);0>b?n.click():q.click()})};var GFITimeElevationWindow=function(a){this.t=function(){return 123};var c;this.setSize=function(f,b){f-=80;b-=70;a.width(f);a.height(b);var d=a.find(".timeaxis").get(0).getContext("2d");d.canvas.height=50;d.canvas.width=f;d=a.find(".heightaxis").get(0).getContext("2d");d.canvas.height=b;d.canvas.width=60;c.setSize(f,b);c.draw()};a.html('<table class="gfi_table"><tr class="gfi_table_tr"><td class="gfi_table_td"><canvas class="heightaxis" class="gfi_nomarginpadding"  ></canvas></td><td class="gfi_table_td"><div class="gfi_nomarginpadding gfi_mainmap" style="width:1200px;height:600px;"></div></td><td><div class="legend"></div></td></tr><tr class="gfi_table_tr"><td class="gfi_table_td"></td><td><canvas class="timeaxis"  class="gfi_nomarginpadding"   ></canvas><td class="gfi_table_td"></td></tr></table>');
var f=a.find(".gfi_mainmap").get(0);c=new WMJSMap(f);c.hideScaleBar();c.displayLegendInMap(!1);c.getOverlayElement().css("border","1px solid black");this.setSize(a.width(),a.height());this.updateBBOX=function(f){var b=a.find(".timeaxis").get(0).getContext("2d");b.fillStyle="#FFF";b.font="10px Arial";b.fillRect(0,0,c.getWidth(),50);for(var d=-1,l=Math.round(f.left);l<Math.round(f.right);l+=1E4){var m=new Date(l);-1==d&&(d=m.getUTCHours());if(d!=m.getUTCHours()){b.fillStyle="#000000";var e=(l-f.left)/
(f.right-f.left)*c.getWidth();b.beginPath();b.moveTo(e-1,0);b.lineTo(e-1,10);b.stroke();d=m.getUTCHours();b.fillText(d,e-b.measureText(d).width/2-1,20);d=m.getUTCHours()}}b.font="14px Arial";b.fillText("time UTC (h)",c.getWidth()/2-100,38);b=a.find(".heightaxis").get(0).getContext("2d");b.font="10px Arial";b.fillStyle="#FFF";b.fillRect(0,0,60,c.getHeight());b.textAlign="right";d=-1.1;if(!(100<Math.abs(Math.round(f.top)-Math.round(f.bottom))/1E3)){for(l=Math.round(f.bottom);l<Math.round(f.top);l+=
1)m=Math.floor(l/1E3),-1.1==d&&(d=m),d!=m&&(b.fillStyle="#000000",e=(l-f.top)/(f.bottom-f.top)*c.getHeight(),b.beginPath(),b.moveTo(50,e),b.lineTo(60,e),b.stroke(),d=l,b.fillText(d,48,e+3),d=m);b.save();b.translate(5,c.getHeight()/2-50);b.rotate(-Math.PI/2);b.font="14px Arial";b.fillText("height (m)",5,6);b.restore()}};this.drawLegend=function(){var f=c.getLayers()[0],f=c.getLegendGraphicURLForLayer(f);a.find(".legend").html('<img class="legendimg" src="'+f+'&TRANSPARENT=TRUE"/>')};c.addListener("onupdatebbox",
this.updateBBOX,!0);c.setProjection("GFI:TIME_ELEVATION",[(new Date("2016-04-01T00:00:00Z")).getTime(),0,(new Date("2016-04-02T00:00:00Z")).getTime(),15270]);this.updateBBOX(c.getProjection().bbox);this.getWebMapJS=function(){return c}};var WMJSAnimate=function(a){a.animationDelay=100;var c=a.getListener(),f=a.getImageStore(),g=this,b=document.createElement("div");$(b).mouseout(function(){a.mouseHoverAnimationBox=!1});var d=0,l=function(){if(0==a.isAnimating)a.isAnimatingLoopRunning=!1;else if(a.animationTimer.init(50,l),g.checkAnimation(),d--,!(0<d)){var b=a.animationDelay;0==a.currentAnimationStep&&(b*=3);a.currentAnimationStep==a.animationList.length-1&&(b*=5);d=b/50;if(!1===a.mouseHoverAnimationBox){0!=a.isAnimating&&1!=a.animateBusy&&
((b=a.animationList[a.currentAnimationStep])?(a.setDimension(b.name,b.value,!1),c.triggerEvent("ondimchange"),c.triggerEvent("onnextanimationstep",a),a._pdraw(),a.animateBusy=!1):error("No animation step for "+a.currentAnimationStep));b=a.currentAnimationStep+1;b>=a.animationList.length&&(b=0);var e=!1,f=0,n=a.animationList[b];a.setDimension(n.name,n.value,!1);a.animationList[b].requests=a.getWMSRequests();n=a.animationList[a.currentAnimationStep];a.setDimension(n.name,n.value,!1);for(n=0;n<a.animationList[b].requests.length;n++){var q=
a.animationList[b].requests[n];(q=a.getImageStore().getImageForSrc(q))&&q.isLoaded()?f++:d=0}f==a.animationList[b].requests.length&&(e=!0);e&&(a.currentAnimationStep=b)}}};a.isAnimatingLoopRunning=!1;g.checkAnimation=function(){if(0==a.isAnimating)a.isAnimatingLoopRunning=!1;else{a.animationTimer||(a.animationTimer=new WMJSTimer);if(!1===a.mouseHoverAnimationBox){var b=f.getNumImagesLoading();if(2>b&&0<a.animationList.length)for(var c=0;6>c;c++){for(var d=c+a.currentAnimationStep;0>d;)d+=a.animationList.length;
for(;d>=a.animationList.length;)d-=a.animationList.length;0>d&&(d=0);if(0<=d){var g=a.animationList[d];a.setDimension(g.name,g.value,!1);a.animationList[d].requests=a.getWMSRequests();g=a.animationList[a.currentAnimationStep];a.setDimension(g.name,g.value,!1);a.animationList[d].imagesInPrefetch=a.prefetch(a.animationList[d].requests);b+=a.animationList[d].imagesInPrefetch.length;if(1<b)break}}}0==a.isAnimatingLoopRunning&&(a.isAnimatingLoopRunning=!0,l())}};a.stopAnimating=function(){0!=a.isAnimating&&
(b.style.display="none",a.isAnimating=!1,a.animateBusy=!1,a.rebuildMapDimensions(),c.triggerEvent("onstopanimation",a))};a.currentAnimationStep=0;a.animationList=void 0;a.isAnimating=!1;a.setAnimationDelay=function(b){1>b&&(b=1);a.animationDelay=b};b.style.zIndex=1E4;b.style.background="none";b.style.position="absolute";b.style.border="none";b.style.margin="0px";b.style.padding="0px";b.style.lineHeight="14px";b.style.fontFamily='"Courier New", "Lucida Console", Monospace';b.style.fontSize="10px";
a.getBaseElement().append(b)};var WMJSDialog={},WMJSDialogsCreated=0;WMJSDialog.closeAllDialogs=function(a){for(var c=0;c<a.length;c++)a[c].remove()};
WMJSDialog.createDialog=function(a,c,f){WMJSDialogsCreated++;var g=0,b=0,d=!0;isDefined(a.id);isDefined(a.x)&&(g=a.x);isDefined(a.y)&&(b=a.y);isDefined(a.autoDestroy)&&(d=a.autoDestroy);var l=jQuery("<div />",{css:{minHeight:"20px",height:180,width:320,zIndex:1E3,border:"1px solid #01405e",borderRadius:"3px",position:"absolute",boxShadow:"0.06rem 0.125rem 0.125rem rgba(0, 0, 0, 0.3)",margin:0,padding:"0px",backgroundColor:"#01547d",display:"inline-block"},mousedown:function(a){a.stopPropagation();
preventdefault_event(a)},mousewheel:function(a){a.stopPropagation()}}).appendTo(c);l.hasBeenDragged=!1;l.on("drag",function(a,b){l.hasBeenDragged=!0});l.resizable();l.draggable();l.closeDialog=function(){0==d?(l.hide(),l.trigger("hide")):(l.remove(),dialogClosed(l))};l.keyup(function(a){27==a.keyCode&&l.closeDialog()});jQuery("<div/>",{css:{color:"white",fontWeight:"bold",textColor:"white",width:"16px",height:"16px",lineHeight:"14px",margin:"1px",padding:"1px !important",zIndex:1200},click:function(){l.closeDialog()}}).appendTo(l).iconbutton({label:"X"}).addClass("wmjsdialog-closebutton");
var m=jQuery("<div/>",{css:{position:"absolute",right:"0px",top:"18px",background:"#FFF",borderTop:"1px solid #01405e",width:"100%",height:"100%",overflow:"auto",fontSize:"10px",lineHeight:"12px"},mousedown:function(a){a.stopPropagation();preventdefault_event(a)}}).appendTo(l);l.resize(function(){m.css({width:l.width()+"px",height:l.height()-18+"px"})});l.resize();l.setLoading=function(){m.html('<img style="margin-left:10px;margin-top:10px;" src="'+loadingImageSrc+'"/>')};l.setXY=function(a,b){l.hasBeenDragged=
!1;l.css({left:a+"px",top:b+"px"});var c=f.getGeoCoordFromPixelCoord({x:a,y:b});l.geoPosX=c.x;l.geoPosY=c.y;l.x=a;l.y=b};l.setXY(g,b);l.origX=g;l.origY=b;l.setLoading();l.setHTML=function(a){m.html(a)};isDefined(a.dataURL)&&(c=function(a){m.html(a)},MakeHTTPRequest(a.dataURL,c,c));return l};
